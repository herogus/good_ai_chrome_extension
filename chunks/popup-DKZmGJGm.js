import{d as $,u as x,a as A,r as M,t as P,c as w,o as T,b as R,s as b,e as g,f as d,g as s,h,F as U,i as V,n as r,j as k,k as c,l as v,_ as E,m as q,A as z,w as _,p as L,q as O,v as j,x as C,y as G,z as H}from"./encryptionUtil-D8hn_wyo.js";const J={class:"theme-settings"},K={class:"setting-group"},Q={class:"setting-item"},X={class:"theme-options"},Y=["onClick"],Z={class:"theme-icon-wrapper"},ee={class:"theme-icon"},se={class:"option-label"},te={class:"setting-item floating-window-settings"},ae={class:"floating-controls"},oe={class:"control-section"},ne={class:"radio-options"},ie={class:"control-section"},le={class:"radio-options"},re=$({__name:"SystemSettings",setup(I){const n=x(),{themeConfig:l,setTheme:p}=A(),i=[{value:"light",label:"亮色",icon:"🌞"},{value:"dark",label:"暗色",icon:"🌙"}],f=M({disableState:"enabled",isRefreshing:!1}),{disableState:o,isRefreshing:m}=P(f),W=w(()=>l.value.mode);w(()=>{switch(o.value){case"local":return"🔒";case"page":return"⚠️";default:return"✅"}}),w(()=>{switch(o.value){case"local":return"悬浮窗全局被禁用";case"page":return"当前页面被禁用";default:return"悬浮窗已全局启用"}}),T(async()=>{await y();const t=setInterval(y,5e3);R(()=>{clearInterval(t)})});const B=async t=>{try{p(t),n.info("主题设置已更新:",t);try{(await b("setTheme",{theme:t})).status==="success"&&n.info("主题已同步到标签页")}catch(e){n.warn("主题同步到标签页失败，但设置已保存:",e)}}catch(e){n.error("主题切换失败:",e),v("主题切换失败，请稍后重试")}};async function y(){if(!m.value){m.value=!0;try{const t=await b("checkFloatingWindowState",{});t.data.localDisabled?o.value="local":t.data.pageDisabled?o.value="page":o.value="enabled",n.info("悬浮窗状态检查完成:",o.value)}catch(t){n.error("检查悬浮窗禁用状态失败—popup:",t),o.value="enabled"}finally{m.value=!1}}}async function u(t,e){try{const a=await b("setFloatingWindowState",{scope:t,disabled:e});if(a.status==="failed")throw new Error(a.message||"设置悬浮窗状态失败");t==="local"?o.value=e?"local":"enabled":o.value=e?"page":"enabled",v(`${t==="local"?"全局":"当前页面"}悬浮窗已${e?"隐藏":"显示"}，请刷新页面查看效果`),n.info(`悬浮窗状态切换成功: ${t} - ${e?"禁用":"启用"}`)}catch(a){n.error(`切换悬浮窗状态失败（${t}）:`,a),v("设置失败，请稍后重试！")}}async function D(){var t;try{const e=await chrome.tabs.query({active:!0,currentWindow:!0});if((t=e[0])!=null&&t.id)await chrome.sidePanel.open({tabId:e[0].id}),n.info("侧边栏打开成功");else throw new Error("未找到当前标签页")}catch(e){n.error("打开侧边栏失败:",e),v("打开侧边栏失败，请稍后重试")}}return(t,e)=>(d(),g("div",J,[s("div",K,[e[13]||(e[13]=s("div",{class:"group-title"},[s("span",{class:"title-icon"},"⚙️"),h(" 系统设置 ")],-1)),s("div",Q,[e[4]||(e[4]=s("div",{class:"setting-label"},"外观模式",-1)),s("div",X,[(d(),g(U,null,V(i,a=>s("div",{key:a.value,class:r(["theme-option",{active:W.value===a.value}]),onClick:N=>B(a.value)},[s("div",Z,[s("span",ee,k(a.icon),1)]),s("span",se,k(a.label),1)],10,Y)),64))])]),s("div",{class:"setting-item sidepanel-settings"},[e[6]||(e[6]=s("div",{class:"setting-label"},"侧边栏控制",-1)),s("div",{class:"sidepanel-controls"},[s("div",{class:"control-button-group"},[s("button",{class:"control-button open-button",onClick:D},e[5]||(e[5]=[s("span",{class:"button-icon"},"👁️",-1),s("span",{class:"button-text"},"展示侧边栏",-1)]))])])]),e[14]||(e[14]=s("div",{class:"group-title"},[s("span",{class:"title-icon"},"🪟"),h(" 悬浮窗设置 ")],-1)),s("div",te,[s("div",ae,[s("div",oe,[e[9]||(e[9]=s("div",{class:"control-label"},"当前页面",-1)),s("div",ne,[s("div",{class:r(["radio-option",{active:c(o)==="enabled"}]),onClick:e[0]||(e[0]=a=>u("page",!1))},e[7]||(e[7]=[s("div",{class:"radio-icon-wrapper"},[s("span",{class:"radio-icon"},"👁️")],-1),s("span",{class:"option-label"},"显示悬浮窗",-1)]),2),s("div",{class:r(["radio-option",{active:c(o)==="page"}]),onClick:e[1]||(e[1]=a=>u("page",!0))},e[8]||(e[8]=[s("div",{class:"radio-icon-wrapper"},[s("span",{class:"radio-icon"},"🙈")],-1),s("span",{class:"option-label"},"隐藏悬浮窗",-1)]),2)])]),s("div",ie,[e[12]||(e[12]=s("div",{class:"control-label"},"全局设置",-1)),s("div",le,[s("div",{class:r(["radio-option",{active:c(o)==="enabled"}]),onClick:e[2]||(e[2]=a=>u("local",!1))},e[10]||(e[10]=[s("div",{class:"radio-icon-wrapper"},[s("span",{class:"radio-icon"},"🔓")],-1),s("span",{class:"option-label"},"全局启用",-1)]),2),s("div",{class:r(["radio-option",{active:c(o)==="local"}]),onClick:e[3]||(e[3]=a=>u("local",!0))},e[11]||(e[11]=[s("div",{class:"radio-icon-wrapper"},[s("span",{class:"radio-icon"},"🔒")],-1),s("span",{class:"option-label"},"全局禁用",-1)]),2)])])])])])]))}}),S=E(re,[["__scopeId","data-v-907227f2"]]),ce={class:"popup-container"},de={key:1},pe=$({__name:"Popup",setup(I){const n=x(),l=q("");return T(async()=>{const p=new z;try{const i=await p.decrypt(_.content,_.contentEx);l.value=i.trim()}catch(i){n.error("水印解密失败:",i)}}),(p,i)=>{const f=L("el-watermark");return d(),g("div",ce,[c(_).enabled&&l.value?(d(),O(f,{key:0,content:l.value,opacity:.1},{default:j(()=>[C(S)]),_:1},8,["content"])):(d(),g("div",de,[C(S)]))])}}}),ue=E(pe,[["__scopeId","data-v-25d19947"]]),F=G(ue);F.use(H);F.mount("#app");
