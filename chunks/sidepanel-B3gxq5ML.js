var I7=Object.defineProperty;var O7=(r,e,t)=>e in r?I7(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var g=(r,e,t)=>O7(r,typeof e!="symbol"?e+"":e,t);import{d as _o,u as fa,a as R7,r as iu,t as Jc,B as c4,o as Bu,C as jr,D as qt,p as cr,e as rt,f as Oe,g as le,x as se,h as pr,q as kr,E as nr,k as ie,v as xe,G as Nf,j as Xt,H as d4,F as Bn,i as Mn,I as If,J as t1,K as Mr,l as nt,L as si,M as D7,N as Jp,O as xa,_ as Mu,m as ou,n as $i,P as sl,A as B7,Q as M7,w as $7,R as Ai,b as P7,s as uu,S as L7,c as U0,T as r1,U as z7,V as n1,W as a1,X as s1,Y as i1,Z as o1,$ as U7,a0 as u1,a1 as j7,a2 as il,a3 as l1,a4 as q7,a5 as c1,a6 as H7,a7 as d1,y as V7,z as G7}from"./encryptionUtil-B6a1Xhnw.js";const Dr=[];for(let r=0;r<256;++r)Dr.push((r+256).toString(16).slice(1));function Z7(r,e=0){return(Dr[r[e+0]]+Dr[r[e+1]]+Dr[r[e+2]]+Dr[r[e+3]]+"-"+Dr[r[e+4]]+Dr[r[e+5]]+"-"+Dr[r[e+6]]+Dr[r[e+7]]+"-"+Dr[r[e+8]]+Dr[r[e+9]]+"-"+Dr[r[e+10]]+Dr[r[e+11]]+Dr[r[e+12]]+Dr[r[e+13]]+Dr[r[e+14]]+Dr[r[e+15]]).toLowerCase()}let j0;const K7=new Uint8Array(16);function W7(){if(!j0){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");j0=crypto.getRandomValues.bind(crypto)}return j0(K7)}const Y7=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),h1={randomUUID:Y7};function Wo(r,e,t){var a;if(h1.randomUUID&&!r)return h1.randomUUID();r=r||{};const n=r.random??((a=r.rng)==null?void 0:a.call(r))??W7();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Z7(n)}const J7={class:"chat-history"},X7={class:"chat-history-header"},Q7={class:"header-top"},e3={class:"chat-history-header-title"},t3={class:"chat-history-main"},r3={class:"group-header"},n3={class:"group-content"},a3=["onClick"],s3={key:0,class:"history-item-title"},i3={class:"history-item-time"},o3={class:"history-item-actions"},u3={class:"chat-history-footer"},l3={class:"footer-buttons"},q0=30,f1=30,c3=1e3,d3=_o({__name:"ChatHistory",props:{visible:{type:Boolean}},emits:["select-chat","clear-history","update-chat-title"],setup(r,{emit:e}){const t=r,n=fa(),{toggleTheme:a,currentTheme:s}=R7(),i=iu({currentChatId:null,chatHistoryGroups:[],switchs:{showHistory:!1},isRefreshing:!1,lastRefreshTime:0}),{currentChatId:o,chatHistoryGroups:u,switchs:l,isRefreshing:c,lastRefreshTime:d}=Jc(i),h=D=>Array.isArray(D)?D.filter(M=>!M||typeof M!="object"||!M.key||!M.title?!1:(Array.isArray(M.chats)||(M.chats=[]),M.chats=M.chats.filter(P=>P&&typeof P=="object"&&P.id&&P.title),!0)):[],f=D=>{if(typeof(D==null?void 0:D.timestamp)=="number"&&isFinite(D.timestamp))return D.timestamp;if(typeof(D==null?void 0:D.id)=="string"&&D.id.startsWith("chat-")){const M=D.id.split("-");if(M.length>=2){const P=Number(M[1]);if(Number.isFinite(P))return P}}return null},p=D=>{const P=new Date,Z=new Date(P.getFullYear(),P.getMonth(),P.getDate()).getTime(),W=new Date(D),X=new Date(W.getFullYear(),W.getMonth(),W.getDate()).getTime(),Y=Math.floor((Z-X)/864e5);if(Y===0)return{key:"today",title:"\u4ECA\u5929",order:X};if(Y===1)return{key:"yesterday",title:"\u6628\u5929",order:X};const re=W.getFullYear(),U=String(W.getMonth()+1).padStart(2,"0"),j=String(W.getDate()).padStart(2,"0");return{key:`${re}-${U}-${j}`,title:`${re}-${U}-${j}`,order:X}},m=async()=>{try{const D=await jr(qt.CHAT_HISTORY_KEY),M=h(D),P=new Map;for(const ae of M)for(const Q of ae.chats)Q!=null&&Q.id&&(P.has(Q.id)||P.set(Q.id,Q));const Z=Array.from(P.values()),W=Date.now()-f1*24*60*60*1e3,X=Z.filter(ae=>{const Q=f(ae);return Q==null?!0:Q>W});X.sort((ae,Q)=>{const C=f(ae)??0;return(f(Q)??0)-C});const Y={};for(const ae of X){const Q=f(ae)??Date.now(),C=p(Q);Y[C.key]||(Y[C.key]={key:C.key,title:C.title,chats:[],order:C.order}),Y[C.key].chats.push(ae)}for(const ae of Object.keys(Y))Y[ae].chats.sort((Q,C)=>{const x=f(Q)??0;return(f(C)??0)-x});const re=Object.values(Y).sort((ae,Q)=>Q.order-ae.order),U=[];let j=0;for(const ae of re){if(j>=q0)break;const Q=q0-j,C=ae.chats.slice(0,Q);C.length>0&&(U.push({key:ae.key,title:ae.title,chats:C}),j+=C.length)}u.value=U,n.info("\u5386\u53F2\u4F1A\u8BDD\u52A0\u8F7D\u6210\u529F",{groupCount:U.length,totalChats:j,maxDays:f1,maxChats:q0})}catch(D){n.error("\u52A0\u8F7D\u5386\u53F2\u4F1A\u8BDD\u5931\u8D25:",D),u.value=[]}};c4(()=>t.visible,async(D,M)=>{if(D&&!M){const P=Date.now();if(P-d.value<c3){n.info("\u5237\u65B0\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8DF3\u8FC7\u6B64\u6B21\u5237\u65B0");return}n.info("\u5386\u53F2\u4F1A\u8BDD\u5F39\u7A97\u6253\u5F00\uFF0C\u5F00\u59CB\u5237\u65B0\u6570\u636E"),d.value=P,await v()}});const v=async()=>{if(c.value){n.info("\u6B63\u5728\u5237\u65B0\u4E2D\uFF0C\u8DF3\u8FC7\u91CD\u590D\u5237\u65B0");return}try{c.value=!0,n.info("\u5F00\u59CB\u5237\u65B0\u5386\u53F2\u4F1A\u8BDD\u6570\u636E");const D={groupCount:u.value.length,totalChats:u.value.reduce((Z,W)=>Z+W.chats.length,0),totalMessages:u.value.reduce((Z,W)=>Z+W.chats.reduce((X,Y)=>{var re;return X+(((re=Y.messages)==null?void 0:re.length)||0)},0),0)};await m();const M={groupCount:u.value.length,totalChats:u.value.reduce((Z,W)=>Z+W.chats.length,0),totalMessages:u.value.reduce((Z,W)=>Z+W.chats.reduce((X,Y)=>{var re;return X+(((re=Y.messages)==null?void 0:re.length)||0)},0),0)};n.info("\u5386\u53F2\u4F1A\u8BDD\u6570\u636E\u5237\u65B0\u5B8C\u6210",{before:D,after:M,hasChanges:JSON.stringify(D)!==JSON.stringify(M)});const P=D.groupCount!==M.groupCount||D.totalChats!==M.totalChats||D.totalMessages!==M.totalMessages}catch(D){n.error("\u5237\u65B0\u5386\u53F2\u4F1A\u8BDD\u5931\u8D25:",D),nt("\u5237\u65B0\u5386\u53F2\u4F1A\u8BDD\u5931\u8D25")}finally{c.value=!1}};Bu(async()=>{n.info("ChatHistory\u7EC4\u4EF6\u5DF2\u6302\u8F7D");const D=await jr(qt.THEME_KEY)||"light";D==="dark"?document.body.classList.add("theme-dark"):document.body.classList.add("theme-light"),n.info("\u4E3B\u9898\u52A0\u8F7D\u5B8C\u6210:",D),await m(),n.info("ChatHistory\u7EC4\u4EF6\u521D\u59CB\u5316\u5B8C\u6210\uFF0C\u5F53\u524D\u5386\u53F2\u4F1A\u8BDD\u7EC4\u6570\u91CF:",u.value.length)});const _=()=>"\u65B0\u7684\u804A\u5929",w=()=>{const D=new Date,M=D.getMinutes();return`${D.getHours()}:${M<10?"0"+M:M}`},E=async()=>{try{const D=Date.now(),M=`chat-${D}-${Wo()}`,P={id:M,title:_(),time:w(),timestamp:D,messages:[]};Array.isArray(u.value)||(u.value=[]),u.value.find(U=>U.key==="today")||u.value.unshift({key:"today",title:"\u4ECA\u5929",chats:[]});const Z=await jr(qt.CHAT_HISTORY_KEY),W=Array.isArray(Z)?Z:[];let X=W.find(U=>U.key==="today");X||(X={key:"today",title:"\u4ECA\u5929",chats:[]},W.unshift(X));const Y=u.value.find(U=>U.key==="today"),re=(Y==null?void 0:Y.chats)||[];for(const U of re)X.chats.find(j=>j.id===U.id)||X.chats.push(U);X.chats.find(U=>U.id===P.id)||X.chats.unshift(P),u.value=W,await Mr(qt.CHAT_HISTORY_KEY,W),n.info("\u65B0\u4F1A\u8BDD\u5DF2\u4FDD\u5B58\u5230\u672C\u5730\u5B58\u50A8"),k(M)}catch(D){n.error("\u65B0\u5EFA\u804A\u5929\u5931\u8D25:",D),nt("\u65B0\u5EFA\u4F1A\u8BDD\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},F=e,k=D=>{try{if(o.value=D,!Array.isArray(u.value))throw n.error("chatHistoryGroups \u4E0D\u662F\u6570\u7EC4:",u.value),u.value=[],new Error("\u5386\u53F2\u4F1A\u8BDD\u6570\u636E\u683C\u5F0F\u9519\u8BEF");const M=u.value.flatMap(P=>P.chats||[]).find(P=>P.id===D);if(!M)throw new Error("\u672A\u627E\u5230\u9009\u4E2D\u7684\u4F1A\u8BDD");F("select-chat",M),l.value.showHistory=!1,n.info("\u9009\u62E9\u804A\u5929\u6210\u529F:",D)}catch(M){n.error("\u9009\u62E9\u804A\u5929\u5931\u8D25:",M),nt("\u9009\u62E9\u4F1A\u8BDD\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},N=async()=>{try{n.info("\u70B9\u51FB\u4E3B\u9898\u5207\u6362\uFF0C\u5F53\u524D\u4E3B\u9898:",s.value),await a(),setTimeout(()=>{n.info("\u5207\u6362\u540E\u4E3B\u9898:",s.value),n.info("body\u7C7B\u540D:",document.body.className)},100)}catch(D){n.error("\u4E3B\u9898\u5207\u6362\u5931\u8D25:",D),nt("\u4E3B\u9898\u5207\u6362\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")}},B=async()=>{try{n.info("\u5F00\u59CB\u4E0B\u8F7D\u5168\u90E8\u5386\u53F2\u8BB0\u5F55");const D=await jr(qt.CHAT_HISTORY_KEY),M=Array.isArray(D)?D:[];if(M.length===0){nt("\u6682\u65E0\u5386\u53F2\u8BB0\u5F55\u53EF\u4E0B\u8F7D");return}let P=`# \u5168\u90E8\u5386\u53F2\u8BB0\u5F55\u5BFC\u51FA
`;P+=`\u5BFC\u51FA\u65F6\u95F4: ${new Date().toLocaleString("zh-CN")}

`,P+=`---

`;let Z=0;if(M.forEach(j=>{Array.isArray(j.chats)&&j.chats.length>0&&(P+=`## ${j.title}

`,j.chats.forEach(ae=>{Z++,P+=`### \u4F1A\u8BDD: ${ae.title}
`,P+=`**\u65F6\u95F4:** ${ae.time}
`,ae.timestamp&&(P+=`**\u65F6\u95F4\u6233:** ${new Date(ae.timestamp).toLocaleString("zh-CN")}
`),P+=`
`,ae.messages&&ae.messages.length>0?ae.messages.forEach(Q=>{const C=Q.sender==="user"?"\u{1F464} \u7528\u6237":"\u{1F916} \u52A9\u624B",x=new Date(Q.timestamp).toLocaleString("zh-CN");P+=`**${C} (${x}):**
${Q.content}

`}):P+=`*\u6682\u65E0\u5BF9\u8BDD\u5185\u5BB9*

`,P+=`---

`}))}),Z===0){nt("\u6682\u65E0\u5386\u53F2\u8BB0\u5F55\u53EF\u4E0B\u8F7D");return}const W=new Blob([P],{type:"text/markdown;charset=utf-8"}),X=URL.createObjectURL(W),Y=document.createElement("a"),U=`\u5168\u90E8\u5386\u53F2\u8BB0\u5F55_${new Date().toISOString().split("T")[0]}.md`;Y.href=X,Y.download=U,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(X),n.info("\u5168\u90E8\u5386\u53F2\u8BB0\u5F55\u5BFC\u51FA\u6210\u529F:",U),nt("\u5168\u90E8\u5386\u53F2\u8BB0\u5F55\u5BFC\u51FA\u6210\u529F")}catch(D){n.error("\u5BFC\u51FA\u5168\u90E8\u5386\u53F2\u8BB0\u5F55\u5931\u8D25:",D),nt("\u5BFC\u51FA\u5168\u90E8\u5386\u53F2\u8BB0\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},A=async()=>{if(n.info("\u6E05\u7A7A\u5386\u53F2\u8BB0\u5F55"),confirm("\u786E\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5386\u53F2\u8BB0\u5F55\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D\u3002"))try{n.info("\u7528\u6237\u786E\u8BA4\u6E05\u7A7A\u5386\u53F2\u8BB0\u5F55"),u.value=[],await Mr(qt.CHAT_HISTORY_KEY,[]),F("clear-history"),nt("\u5386\u53F2\u8BB0\u5F55\u5DF2\u6E05\u7A7A")}catch(D){n.error("\u6E05\u7A7A\u5386\u53F2\u8BB0\u5F55\u5931\u8D25:",D),nt("\u6E05\u7A7A\u5386\u53F2\u8BB0\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},L=D=>{D.editing=!0,D.editTitle=D.title,n.info("\u5F00\u59CB\u7F16\u8F91\u4F1A\u8BDD\u6807\u9898:",D.id),xa(()=>{document.querySelectorAll(".edit-input input").forEach(P=>{if(P instanceof HTMLElement&&(P.focus(),P instanceof HTMLInputElement)){const Z=P.value.length;P.setSelectionRange(Z,Z)}})})},V=async D=>{var M;try{if(!((M=D.editTitle)!=null&&M.trim())){nt("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A");return}const P=D.editTitle.trim();D.title=P,D.editing=!1,delete D.editTitle;const Z=await jr(qt.CHAT_HISTORY_KEY),W=Array.isArray(Z)?Z:[];let X=!1;for(const Y of W)if(Array.isArray(Y.chats)){const re=Y.chats.find(U=>U.id===D.id);if(re){re.title=P,re.time=w(),re.timestamp=Date.now(),X=!0;break}}X&&await Mr(qt.CHAT_HISTORY_KEY,W),F("update-chat-title",D.id,P)}catch(P){n.error("\u4FDD\u5B58\u6807\u9898\u5931\u8D25:",P),nt("\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},G=async D=>{var M;try{if((M=D.editTitle)!=null&&M.trim()){await V(D);return}D.editing=!1,delete D.editTitle,n.info("\u53D6\u6D88\u7F16\u8F91\u4F1A\u8BDD\u6807\u9898:",D.id)}catch(P){n.error("\u5904\u7406\u53D6\u6D88\u7F16\u8F91\u5931\u8D25:",P),D.editing=!1,delete D.editTitle}},te=async(D,M)=>{try{const P=await jr(qt.CHAT_HISTORY_KEY),Z=Array.isArray(P)?P:[];let W=!1;for(let X=0;X<Z.length;X++){const Y=Z[X];if(Array.isArray(Y.chats)){const re=Y.chats.findIndex(U=>U.id===D);if(re>-1){Y.chats.splice(re,1),W=!0,Y.chats.length===0&&Z.splice(X,1);break}}}if(W){await Mr(qt.CHAT_HISTORY_KEY,Z);const X=M.chats.findIndex(Y=>Y.id===D);if(X>-1&&M.chats.splice(X,1),M.chats.length===0){const Y=u.value.findIndex(re=>re.key===M.key);Y>-1&&u.value.splice(Y,1)}nt("\u4F1A\u8BDD\u5DF2\u5220\u9664")}}catch(P){n.error("\u5220\u9664\u4F1A\u8BDD\u5931\u8D25:",P),nt("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},ve=async D=>{try{n.info("\u5F00\u59CB\u5BFC\u51FA\u4F1A\u8BDD:",D.id);const M=await jr(qt.CHAT_HISTORY_KEY),P=Array.isArray(M)?M:[];let Z=null;for(const C of P)if(Array.isArray(C.chats)){const x=C.chats.find(q=>q.id===D.id);if(x){Z=x;break}}if(!Z){nt("\u672A\u627E\u5230\u4F1A\u8BDD\u6570\u636E");return}let W=`# ${Z.title}

`;if(W+=`**\u4F1A\u8BDDID:** ${Z.id}
`,W+=`**\u521B\u5EFA\u65F6\u95F4:** ${Z.time}
`,Z.timestamp){const C=new Date(Z.timestamp);W+=`**\u65F6\u95F4\u6233:** ${C.toLocaleString("zh-CN")}
`}W+=`
---

`,Z.messages&&Z.messages.length>0?(W+=`## \u5BF9\u8BDD\u5185\u5BB9

`,Z.messages.forEach((C,x)=>{const q=C.sender==="user"?"\u{1F464} \u7528\u6237":"\u{1F916} \u52A9\u624B",$=new Date(C.timestamp).toLocaleString("zh-CN");W+=`### ${q} (${$})

`,W+=`${C.content}

`,x<Z.messages.length-1&&(W+=`---

`)})):W+=`*\u6682\u65E0\u5BF9\u8BDD\u5185\u5BB9*
`;const X=new Blob([W],{type:"text/markdown;charset=utf-8"}),Y=URL.createObjectURL(X),re=document.createElement("a"),U=Z.title.replace(/[^\w\u4e00-\u9fa5]/g,"_").substring(0,50),j=Z.timestamp||Date.now(),ae=new Date(j).toISOString().split("T")[0],Q=`${U}_${ae}.md`;re.href=Y,re.download=Q,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(Y),n.info("\u4F1A\u8BDD\u5BFC\u51FA\u6210\u529F:",Q)}catch(M){n.error("\u5BFC\u51FA\u4F1A\u8BDD\u5931\u8D25:",M),nt("\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}};return(D,M)=>{const P=cr("el-icon"),Z=cr("el-tooltip"),W=cr("el-input");return Oe(),rt("div",J7,[le("div",X7,[le("div",Q7,[le("div",e3,[M[3]||(M[3]=pr(" \u5386\u53F2\u4F1A\u8BDD ")),ie(c)?(Oe(),kr(P,{key:0,class:"is-loading"},{default:xe(()=>[se(ie(Nf))]),_:1})):nr("",!0)]),se(Z,{class:"box-item",effect:"dark",content:`\u5207\u6362\u5230${ie(s)==="dark"?"\u4EAE\u8272":"\u6697\u8272"}\u4E3B\u9898`,placement:"bottom",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[le("div",{class:"theme-toggle",onClick:N},[le("span",null,Xt(ie(s)==="dark"?"\u{1F31E}":"\u{1F319}"),1)])]),_:1},8,["content"])]),le("div",{class:"chat-history-header-new",onClick:E},[se(P,null,{default:xe(()=>[se(ie(d4))]),_:1}),M[4]||(M[4]=le("span",null,"\u65B0\u5EFA\u5BF9\u8BDD",-1))])]),le("div",t3,[(Oe(!0),rt(Bn,null,Mn(ie(u),X=>(Oe(),rt("div",{key:X.key,class:"history-group"},[le("div",r3,Xt(X.title),1),le("div",n3,[(Oe(!0),rt(Bn,null,Mn(X.chats,Y=>(Oe(),rt("div",{key:Y.id,class:"history-item"},[le("div",{class:"history-item-content",onClick:re=>k(Y.id)},[Y.editing?(Oe(),kr(W,{key:1,modelValue:Y.editTitle,"onUpdate:modelValue":re=>Y.editTitle=re,onKeyup:D7(re=>V(Y),["enter"]),onBlur:re=>G(Y),onClick:M[0]||(M[0]=si(()=>{},["stop"])),onMousedown:M[1]||(M[1]=si(()=>{},["stop"])),onTouchstart:M[2]||(M[2]=si(()=>{},["stop"])),class:"edit-input",placeholder:"\u8F93\u5165\u65B0\u6807\u9898",maxlength:"50",ref_for:!0,ref:"editInput",autofocus:""},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(Oe(),rt("div",s3,Xt(Y.title),1)),le("div",i3,Xt(Y.time),1)],8,a3),le("div",o3,[se(Z,{class:"box-item",effect:"dark",content:"\u7F16\u8F91\u6807\u9898",placement:"top",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(P,{class:"action-icon edit-icon",size:16,onClick:si(re=>L(Y),["stop"])},{default:xe(()=>[se(ie(Jp))]),_:2},1032,["onClick"])]),_:2},1024),se(Z,{class:"box-item",effect:"dark",content:"\u5220\u9664\u4F1A\u8BDD\uFF0C\u7CFB\u7EDF\u4E0D\u4F1A\u4E8C\u6B21\u786E\u8BA4\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C",placement:"top",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(P,{class:"action-icon delete-icon",size:16,onClick:si(re=>te(Y.id,X),["stop"])},{default:xe(()=>[se(ie(If))]),_:2},1032,["onClick"])]),_:2},1024),se(Z,{class:"box-item",effect:"dark",content:"\u5BFC\u51FA\u4F1A\u8BDD",placement:"top",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(P,{class:"action-icon export-icon",size:16,onClick:si(re=>ve(Y),["stop"])},{default:xe(()=>[se(ie(t1))]),_:2},1032,["onClick"])]),_:2},1024)])]))),128))])]))),128))]),le("div",u3,[le("div",l3,[le("div",{class:"footer-button",onClick:A},[se(P,null,{default:xe(()=>[se(ie(If))]),_:1}),M[5]||(M[5]=le("span",null,"\u6E05\u7A7A\u5386\u53F2",-1))]),le("div",{class:"footer-button",onClick:B},[se(P,null,{default:xe(()=>[se(ie(t1))]),_:1}),M[6]||(M[6]=le("span",null,"\u5BFC\u51FA\u5168\u90E8\u4F1A\u8BDD",-1))])])])])}}}),h3=Mu(d3,[["__scopeId","data-v-56aa65ca"]]),p1=[{text:"\u963F\u91CC\u4E91\u767E\u70BC",value:"aliyun",description:"\u963F\u91CC\u4E91\u767E\u70BC\u5E73\u53F0\u63D0\u4F9B\u7684\u5927\u6A21\u578B\u670D\u52A1\uFF0C\u652F\u6301 qwen \u7CFB\u5217\u6A21\u578B\u3002"},{text:"\u963F\u91CC\u4E91\u767E\u70BC\u5E94\u7528",value:"aliyun_app",description:"\u652F\u6301\u963F\u91CC\u4E91\u767E\u70BC\u5E73\u53F0\u4E0A\u642D\u5EFA\u7684\u5E94\u7528\u3002\u4F8B\u5982\uFF1A\u7ED3\u5408\u81EA\u5B9A\u4E49\u77E5\u8BC6\u5E93\u95EE\u7B54\u7B49\u573A\u666F\u3002"},{text:"DeepSeek",value:"deepseek",description:"DeepSeek \u63D0\u4F9B\u7684\u5927\u6A21\u578B\u670D\u52A1\uFF0C\u652F\u6301 deepseek \u7CFB\u5217\u6A21\u578B\u3002"},{text:"\u8C46\u5305",value:"doubao",description:"\u8C46\u5305\u5E73\u53F0\u63D0\u4F9B\u7684\u5927\u6A21\u578B\u670D\u52A1\uFF0C\u652F\u6301 doubao \u7CFB\u5217\u6A21\u578B\u3002"},{text:"Moonshot",value:"moonshot",description:"Moonshot \u63D0\u4F9B\u7684\u5927\u6A21\u578B\u670D\u52A1\uFF0C\u652F\u6301 kimi \u7CFB\u5217\u6A21\u578B\u3002"},{text:"OpenAI",value:"openai",description:"OpenAI \u63D0\u4F9B\u7684\u5927\u6A21\u578B\u670D\u52A1\uFF0C\u652F\u6301 GPT \u7CFB\u5217\u6A21\u578B\u3002"},{text:"Dify\u5DE5\u4F5C\u6D41",value:"dify_workflow",description:"\u652F\u6301 Dify \u4E0A\u642D\u5EFA\u7684\u5DE5\u4F5C\u6D41\u670D\u52A1\u3002"},{text:"Ollama",value:"ollama",description:"\u672C\u5730\u8FD0\u884C\u7684\u5F00\u6E90\u6A21\u578B\u670D\u52A1\uFF0C\u65E0\u9700API Key\uFF0C\u652F\u6301\u591A\u79CD\u5F00\u6E90\u6A21\u578B\u3002"},{text:"LM Studio",value:"lmstudio",description:"\u672C\u5730\u8FD0\u884C\u7684\u6A21\u578B\u670D\u52A1\u5DE5\u5177\uFF0C\u65E0\u9700API Key\uFF0C\u53CB\u597D\u7684\u56FE\u5F62\u754C\u9762\u3002"},{text:"\u81EA\u5B9A\u4E49",value:"customize",description:"\u81EA\u5B9A\u4E49\u517C\u5BB9OpenAI\u683C\u5F0F\u7684\u6A21\u578B\u670D\u52A1\u5730\u5740\u3002"}],m1={aliyun:{baseUrl:"https://dashscope.aliyuncs.com/compatible-mode/v1",placeholder:"\u8BF7\u586B\u5199\u963F\u91CC\u4E91\u767E\u70BCAPI Key",modelPlaceholder:"\u793A\u4F8B: qwen-turbo",applyUrl:"https://bailian.console.aliyun.com/?tab=model#/api-key"},aliyun_app:{baseUrl:"https://dashscope.aliyuncs.com/api/v1",placeholder:"\u8BF7\u586B\u5199\u963F\u91CC\u4E91\u767E\u70BCAPI Key",modelPlaceholder:"\u8BF7\u586B\u5199\u5E94\u7528ID\uFF0C\u4F8B\u5982: abc123def456",applyUrl:"https://bailian.console.aliyun.com"},deepseek:{baseUrl:"https://api.deepseek.com/v1",placeholder:"\u8BF7\u586B\u5199DeepSeek API Key",modelPlaceholder:"\u793A\u4F8B: deepseek-chat",applyUrl:"https://platform.deepseek.com/api_keys"},doubao:{baseUrl:"https://ark.cn-beijing.volces.com/api/v3",placeholder:"\u8BF7\u586B\u5199\u8C46\u5305API Key",modelPlaceholder:"\u793A\u4F8B: doubao-chat",applyUrl:"https://console.volcengine.com/ark"},moonshot:{baseUrl:"https://api.moonshot.cn/v1",placeholder:"\u8BF7\u586B\u5199Moonshot API Key",modelPlaceholder:"\u793A\u4F8B: kimi-chat",applyUrl:"https://platform.moonshot.cn/console/api-keys"},openai:{baseUrl:"https://api.openai.com/v1",placeholder:"\u8BF7\u586B\u5199OpenAI API Key",modelPlaceholder:"\u793A\u4F8B: gpt-4o-mini",applyUrl:"https://platform.openai.com/api-keys"},dify_workflow:{baseUrl:"https://api.dify.ai/v1",placeholder:"\u8BF7\u586B\u5199Dify API Key",modelPlaceholder:"Dify \u5DE5\u4F5C\u6D41\u6A21\u5F0F\u65E0\u9700\u6A21\u578B\u540D\u79F0",applyUrl:"https://cloud.dify.ai/apps"},ollama:{baseUrl:"http://localhost:11434/v1",placeholder:"\u65E0\u9700API Key",modelPlaceholder:"\u793A\u4F8B: llama2",applyUrl:""},lmstudio:{baseUrl:"http://localhost:1234/v1",placeholder:"\u65E0\u9700API Key",modelPlaceholder:"\u793A\u4F8B: local-model",applyUrl:""},customize:{baseUrl:"",placeholder:"\u8BF7\u586B\u5199BaseUrl",modelPlaceholder:"\u793A\u4F8B: \u8BF7\u586B\u5199\u6A21\u578B",applyUrl:""}},g1=[{text:"\u5BF9\u8BDD\u6A21\u5F0F",value:"chat",description:"\u9002\u5408\u65E5\u5E38\u4EA4\u6D41\u548C\u5B66\u4E60\uFF0C\u6B64\u6A21\u5F0F\u63D0\u4F9B\u4E00\u952E\u603B\u7ED3\u9875\u9762\uFF0C\u57FA\u4E8E\u7F51\u9875\u5185\u5BB9\u56DE\u7B54\u95EE\u9898\u7B49\u529F\u80FD",openingRemarks:""},{text:"\u8003\u8BD5/\u7B54\u9898\u6A21\u5F0F",value:"exam",description:"\u4E13\u4E3A\u7B54\u9898\u573A\u666F\u8BBE\u8BA1\uFF0C\u52A9\u624B\u4F1A\u81EA\u52A8\u8BC6\u522B\u9898\u578B\u5E76\u7ED9\u51FA\u7B54\u6848\u548C\u8BE6\u7EC6\u89E3\u6790\uFF0C\u652F\u6301\u5355\u9009\u3001\u591A\u9009\u3001\u5224\u65AD\u3001\u7F16\u7A0B\u7B49\u9898\u578B",openingRemarks:""}],H0=[{text:"\u6587\u672C\u6A21\u5F0F",value:"concise",description:"\u4EC5\u83B7\u53D6\u7F51\u9875\u7684\u6587\u672C\u5185\u5BB9\uFF0C\u6A21\u578B\u603B\u7ED3\u65F6\u4E0D\u4F1A\u5D4C\u5165\u56FE\u7247"},{text:"\u56FE\u6587\u6A21\u5F0F",value:"detailed",description:"\u83B7\u53D6\u7F51\u9875\u7684\u6587\u672C\u5185\u5BB9\u548C\u56FE\u7247\u5185\u5BB9\uFF0C\u6A21\u578B\u603B\u7ED3\u65F6\u4F1A\u5D4C\u5165\u56FE\u7247"}],Zr=fa();class f3{async getAllConfigs(){try{return await jr(qt.MODEL_CONFIGS_KEY)}catch(e){return Zr.error("\u83B7\u53D6\u6A21\u578B\u914D\u7F6E\u5931\u8D25:",e),null}}async getCurrentConfig(){try{const e=await this.getAllConfigs();return!e||!e.currentConfigId||!e.configs?null:e.configs[e.currentConfigId]||null}catch(e){return Zr.error("\u83B7\u53D6\u5F53\u524D\u914D\u7F6E\u5931\u8D25:",e),null}}async getConfigList(){try{const e=await this.getAllConfigs();return!e||!e.configs?[]:Object.values(e.configs).sort((t,n)=>n.createTime-t.createTime)}catch(e){return Zr.error("\u83B7\u53D6\u914D\u7F6E\u5217\u8868\u5931\u8D25:",e),[]}}async saveConfig(e){try{let t=await this.getAllConfigs();return t||(t={currentConfigId:"",configs:{}}),e.id||(e.id=Wo(),e.createTime=Date.now()),e.configName||(e.configName=`${e.providerName}-${e.modelName}`),t.configs[e.id]=e,t.currentConfigId?t.currentConfigId===e.id&&await Mr(qt.MODEL_INFO_KEY,e):(t.currentConfigId=e.id,await Mr(qt.MODEL_INFO_KEY,e)),await Mr(qt.MODEL_CONFIGS_KEY,t),Zr.info(`\u5DF2\u4FDD\u5B58\u914D\u7F6E: ${e.configName}`),e.id}catch(t){throw Zr.error("\u4FDD\u5B58\u6A21\u578B\u914D\u7F6E\u5931\u8D25:",t),t}}async useConfig(e){try{const t=await this.getAllConfigs();if(!t||!t.configs||!t.configs[e])return Zr.warn(`\u914D\u7F6E ${e} \u4E0D\u5B58\u5728`),null;t.currentConfigId=e,await Mr(qt.MODEL_CONFIGS_KEY,t);const n=t.configs[e];return await Mr(qt.MODEL_INFO_KEY,n),Zr.info(`\u5DF2\u5207\u6362\u5230\u914D\u7F6E: ${n.configName}`),n}catch(t){return Zr.error("\u5207\u6362\u914D\u7F6E\u5931\u8D25:",t),null}}async deleteConfig(e){try{const t=await this.getAllConfigs();if(!t||!t.configs)return;if(delete t.configs[e],t.currentConfigId===e){const n=Object.keys(t.configs);if(n.length>0){t.currentConfigId=n[0];const a=t.configs[n[0]];await Mr(qt.MODEL_INFO_KEY,a)}else t.currentConfigId="",await Mr(qt.MODEL_INFO_KEY,null)}await Mr(qt.MODEL_CONFIGS_KEY,t),Zr.info(`\u5DF2\u5220\u9664\u914D\u7F6E ${e}`)}catch(t){throw Zr.error("\u5220\u9664\u6A21\u578B\u914D\u7F6E\u5931\u8D25:",t),t}}async migrateOldConfig(){try{const e=await jr(qt.MODEL_CONFIGS_KEY);if(!e){const t=await jr(qt.MODEL_INFO_KEY);if(t&&t.providerCode){const n=Wo(),a={id:n,createTime:Date.now(),configName:t.configName||t.providerName||"\u9ED8\u8BA4\u914D\u7F6E",providerName:t.providerName,providerCode:t.providerCode,baseUrl:t.baseUrl,appId:t.appId||"",apiKey:t.apiKey,modelName:t.modelName},s={currentConfigId:n,configs:{[n]:a}};await Mr(qt.MODEL_CONFIGS_KEY,s),Zr.info("\u5DF2\u4ECE\u65E7\u7248\u5355\u914D\u7F6E\u8FC1\u79FB\u6210\u529F")}return}if(e.configs){const t=Object.keys(e.configs);if(t.length>0&&!e.configs[t[0]].id){Zr.info("\u68C0\u6D4B\u5230\u4E2D\u95F4\u7248\u672C\u914D\u7F6E\uFF0C\u5F00\u59CB\u8FC1\u79FB...");const a={currentConfigId:"",configs:{}};for(const s of t){const i=e.configs[s],o=Wo(),u={id:o,createTime:Date.now(),configName:i.configName||i.providerName||s,providerName:i.providerName,providerCode:i.providerCode,baseUrl:i.baseUrl,appId:i.appId||"",apiKey:i.apiKey,modelName:i.modelName};a.configs[o]=u,e.currentProvider===s&&(a.currentConfigId=o)}!a.currentConfigId&&t.length>0&&(a.currentConfigId=Object.keys(a.configs)[0]),await Mr(qt.MODEL_CONFIGS_KEY,a),Zr.info("\u4E2D\u95F4\u7248\u672C\u914D\u7F6E\u8FC1\u79FB\u5B8C\u6210")}}if(e&&e.configs){let t=!1;const n={};for(const[a,s]of Object.entries(e.configs)){const i=s;i.modeCode!==void 0||i.summaryMode!==void 0?(t=!0,n[a]={id:i.id,createTime:i.createTime,configName:i.configName,providerName:i.providerName,providerCode:i.providerCode,baseUrl:i.baseUrl,appId:i.appId||"",apiKey:i.apiKey,modelName:i.modelName}):n[a]=i}t&&(e.configs=n,await Mr(qt.MODEL_CONFIGS_KEY,e),Zr.info("\u5DF2\u6E05\u7406\u6A21\u578B\u914D\u7F6E\u4E2D\u7684\u5BF9\u8BDD\u8BBE\u7F6E\u5B57\u6BB5"))}}catch(e){Zr.error("\u8FC1\u79FB\u914D\u7F6E\u5931\u8D25:",e)}}}const ti=new f3,va=fa(),Io={modeName:"\u5BF9\u8BDD\u6A21\u5F0F",modeCode:"chat",maxMemHisSessionNum:12,summaryModeName:"\u6587\u672C\u6A21\u5F0F",summaryMode:"concise"};class p3{constructor(){g(this,"STORAGE_KEY","CHAT_SETTINGS")}async getChatSettings(){try{const e=await jr(this.STORAGE_KEY);return e||{...Io}}catch(e){return va.error("\u83B7\u53D6\u5BF9\u8BDD\u8BBE\u7F6E\u5931\u8D25:",e),{...Io}}}async saveChatSettings(e){try{await Mr(this.STORAGE_KEY,e),va.info("\u5BF9\u8BDD\u8BBE\u7F6E\u5DF2\u4FDD\u5B58")}catch(t){throw va.error("\u4FDD\u5B58\u5BF9\u8BDD\u8BBE\u7F6E\u5931\u8D25:",t),t}}async updateChatSettings(e){try{const n={...await this.getChatSettings(),...e};return await this.saveChatSettings(n),n}catch(t){throw va.error("\u66F4\u65B0\u5BF9\u8BDD\u8BBE\u7F6E\u5931\u8D25:",t),t}}async resetToDefaults(){try{return await this.saveChatSettings({...Io}),va.info("\u5BF9\u8BDD\u8BBE\u7F6E\u5DF2\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C"),{...Io}}catch(e){throw va.error("\u91CD\u7F6E\u5BF9\u8BDD\u8BBE\u7F6E\u5931\u8D25:",e),e}}async migrateFromModelConfig(){try{if(await jr(this.STORAGE_KEY)){va.info("\u5BF9\u8BDD\u8BBE\u7F6E\u5DF2\u5B58\u5728\uFF0C\u8DF3\u8FC7\u8FC1\u79FB");return}const t=await jr(qt.MODEL_INFO_KEY);if(t&&t.modeCode){const n={modeName:t.modeName||"\u5BF9\u8BDD\u6A21\u5F0F",modeCode:t.modeCode||"chat",maxMemHisSessionNum:t.maxMemHisSessionNum||12,summaryModeName:t.summaryModeName||"\u6587\u672C\u6A21\u5F0F",summaryMode:t.summaryMode||"concise"};await this.saveChatSettings(n),va.info("\u5DF2\u4ECE\u65E7\u6A21\u578B\u914D\u7F6E\u8FC1\u79FB\u5BF9\u8BDD\u8BBE\u7F6E")}else await this.saveChatSettings({...Io}),va.info("\u5DF2\u521D\u59CB\u5316\u9ED8\u8BA4\u5BF9\u8BDD\u8BBE\u7F6E")}catch(e){va.error("\u8FC1\u79FB\u5BF9\u8BDD\u8BBE\u7F6E\u5931\u8D25:",e)}}}const V0=new p3,m3={class:"model-manager"},g3={key:0,class:"view-container list-view"},y3={class:"model-setting"},v3={class:"view-header"},_3={class:"header-actions"},b3={class:"config-list-content"},w3={key:0,class:"empty-config"},E3={key:1,class:"config-cards"},x3=["onClick"],S3={class:"card-main"},A3={class:"card-info"},k3={class:"card-title"},C3={class:"card-sub"},T3={key:0,class:"card-sub"},F3={class:"card-status"},N3={class:"session-setting"},I3={class:"functional-settings"},O3={class:"mode-option-content"},R3={class:"mode-option-title"},D3={class:"mode-option-description"},B3={class:"summary-option-content"},M3={class:"summary-option-title"},$3={class:"summary-option-description"},P3={class:"settings-actions"},L3={key:1,class:"view-container edit-view"},z3={class:"view-header no-border"},U3={class:"view-title center"},j3={class:"edit-content"},q3={class:"provider-option-content"},H3={class:"provider-option-title"},V3={class:"provider-option-description"},G3={key:0,class:"api-key-apply-link",style:{display:"block"}},Z3=["href"],K3={class:"chat-setting-submit"},W3=_o({__name:"ModelManager",emits:["setting-completed","close-setting"],setup(r,{emit:e}){const t=fa(),n=e,a=ou(),s=ou(null),i=iu({viewState:"list",isEditMode:!1,configList:[],currentConfigId:"",selectedConfigId:"",currentModelInfo:null,modelInfo:{id:"",configName:"",createTime:0,providerName:"",providerCode:"",baseUrl:"",appId:"",apiKey:"",modelName:""},chatSettings:{modeName:"\u5BF9\u8BDD\u6A21\u5F0F",modeCode:"chat",maxMemHisSessionNum:12,summaryModeName:"\u6587\u672C\u6A21\u5F0F",summaryMode:"concise"}}),{viewState:o,isEditMode:u,configList:l,currentConfigId:c,selectedConfigId:d,currentModelInfo:h,modelInfo:f,chatSettings:p}=Jc(i);Bu(async()=>{await m()});const m=async()=>{await ti.migrateOldConfig(),await V0.migrateFromModelConfig();const U=await V0.getChatSettings();p.value=U,await v(),l.value.length===0&&w()},v=async()=>{const U=await ti.getConfigList();l.value=U;const j=await ti.getCurrentConfig();c.value=(j==null?void 0:j.id)||"",d.value||(d.value=(j==null?void 0:j.id)||""),j?h.value=JSON.parse(JSON.stringify(j)):h.value=null,await _()},_=async()=>{await xa(),s.value&&s.value.scrollIntoView({behavior:"smooth",block:"nearest"})},w=()=>{G(),u.value=!1,o.value="edit"},E=U=>{Object.assign(f.value,JSON.parse(JSON.stringify(U))),u.value=!0,o.value="edit"},F=async U=>{d.value=U.id,await _()},k=async U=>{try{if(await ti.deleteConfig(U),d.value===U&&(d.value=""),c.value===U&&(c.value=""),await v(),nt("\u5220\u9664\u6210\u529F"),l.value.length===0)n("setting-completed",null);else{const j=await ti.getCurrentConfig();j&&j.id!==c.value&&(c.value=j.id,d.value=j.id,h.value=JSON.parse(JSON.stringify(j)),ve(j))}}catch{nt({message:"\u5220\u9664\u5931\u8D25",type:"danger"})}},N=()=>{const U=g1.find(j=>j.value===p.value.modeCode);if(U&&(p.value.modeName=U.text),p.value.modeCode==="exam"){p.value.maxMemHisSessionNum=3,p.value.summaryMode="concise";const j=H0.find(ae=>ae.value==="concise");j&&(p.value.summaryModeName=j.text)}else p.value.maxMemHisSessionNum=12},B=()=>{const U=H0.find(j=>j.value===p.value.summaryMode);U&&(p.value.summaryModeName=U.text)},A=async()=>{try{if(!d.value&&!c.value){nt("\u8BF7\u5148\u9009\u62E9\u6A21\u578B");return}if(d.value&&d.value!==c.value){const U=l.value.find(j=>j.id===d.value);U&&(await ti.useConfig(d.value),c.value=d.value,h.value=JSON.parse(JSON.stringify(U)),ve(U))}else h.value&&ve(h.value);await L()}catch(U){t.error("\u4FDD\u5B58\u5931\u8D25:",U),nt({message:"\u4FDD\u5B58\u5931\u8D25",type:"danger"})}},L=async()=>{try{await V0.saveChatSettings(sl(p.value)),h.value&&ve(h.value)}catch(U){t.error("\u4FDD\u5B58\u5BF9\u8BDD\u8BBE\u7F6E\u5931\u8D25:",U)}},V=()=>{n("close-setting")},G=()=>{f.value={id:"",configName:"",createTime:0,providerName:"",providerCode:"",baseUrl:"",appId:"",apiKey:"",modelName:""}},te=async()=>{var j;const U=f.value.providerCode;if(f.value.providerName=((j=p1.find(ae=>ae.value===U))==null?void 0:j.text)||"",!u.value){const ae=m1[U];ae&&(f.value.baseUrl=ae.baseUrl,U!=="ollama"&&U!=="lmstudio"&&(f.value.apiKey=""),f.value.modelName="",f.value.appId="",f.value.configName||(f.value.configName=`${f.value.providerName}\u914D\u7F6E`))}},ve=U=>{n("setting-completed",{modelInfo:sl(U),chatSettings:sl(p.value)})},D=async()=>{if(a.value)try{await a.value.validate();const U=sl(f.value),j=await ti.saveConfig(U);nt("\u4FDD\u5B58\u6210\u529F"),await v(),o.value="list"}catch(U){U instanceof Error&&(t.error("\u4FDD\u5B58\u8BBE\u7F6E\u5931\u8D25:",U),nt({message:"\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5",type:"danger"}))}},M=async()=>{o.value="list",u.value||await _()},P=()=>{const U=f.value.providerCode;return U?m1[U]:null},Z=()=>{var U;return((U=P())==null?void 0:U.baseUrl)||"\u8BF7\u586B\u5199\u8BF7\u6C42\u6A21\u578B\u7684BaseUrl"},W=()=>{var U;return((U=P())==null?void 0:U.placeholder)||"\u8BF7\u586B\u5199\u7533\u8BF7\u7684API_KEY"},X=()=>{var U;return((U=P())==null?void 0:U.modelPlaceholder)||"\u8BF7\u586B\u5199\u6A21\u578B\u540D\u79F0"},Y=()=>{var U;return((U=P())==null?void 0:U.applyUrl)||""},re=()=>{const U=f.value.providerCode;return U==="ollama"||U==="lmstudio"?[]:[{required:!0,message:"\u5404\u6A21\u578B\u5E73\u53F0\u7533\u8BF7\u7684API_KEY"}]};return(U,j)=>{const ae=cr("el-icon"),Q=cr("el-button"),C=cr("el-empty"),x=cr("el-tag"),q=cr("el-option"),$=cr("el-select"),Ee=cr("el-form-item"),Ve=cr("el-input-number"),at=cr("el-form"),ot=cr("el-input"),Et=cr("el-divider");return Oe(),rt("div",m3,[ie(o)==="list"?(Oe(),rt("div",g3,[le("div",y3,[le("div",v3,[j[11]||(j[11]=le("h3",{class:"view-title"},"\u6A21\u578B\u9009\u62E9",-1)),le("div",_3,[se(Q,{type:"primary",link:"",onClick:w,class:"create-btn"},{default:xe(()=>[se(ae,null,{default:xe(()=>[se(ie(d4))]),_:1}),j[10]||(j[10]=pr(" \u65B0\u589E "))]),_:1,__:[10]})])]),le("div",b3,[ie(l).length===0?(Oe(),rt("div",w3,[se(C,{description:"\u6682\u65E0\u6A21\u578B\u914D\u7F6E\uFF0C\u8BF7\u70B9\u51FB\u53F3\u4E0A\u89D2\u65B0\u589E","image-size":100})])):(Oe(),rt("div",E3,[(Oe(!0),rt(Bn,null,Mn(ie(l),Se=>(Oe(),rt("div",{key:Se.id,class:$i(["config-card",{active:ie(d)===Se.id,"in-use":ie(c)===Se.id}]),ref_for:!0,ref:vt=>{ie(d)===Se.id&&(s.value=vt)},onClick:vt=>F(Se)},[le("div",S3,[le("div",A3,[le("div",k3,Xt(Se.configName),1),le("div",C3,Xt(Se.providerName)+" \xB7 "+Xt(Se.modelName),1),Se.appId?(Oe(),rt("div",T3," \u5E94\u7528ID\uFF1A"+Xt(Se.appId),1)):nr("",!0)]),le("div",F3,[ie(c)===Se.id?(Oe(),kr(x,{key:0,type:"success",size:"small",effect:"dark"},{default:xe(()=>j[12]||(j[12]=[pr("\u4F7F\u7528\u4E2D ")])),_:1,__:[12]})):ie(d)===Se.id?(Oe(),kr(x,{key:1,type:"primary",size:"small",effect:"plain"},{default:xe(()=>j[13]||(j[13]=[pr("\u5DF2\u9009\u4E2D ")])),_:1,__:[13]})):nr("",!0)])]),le("div",{class:"card-actions",onClick:j[0]||(j[0]=si(()=>{},["stop"]))},[se(Q,{type:"primary",link:"",size:"small",onClick:vt=>E(Se)},{default:xe(()=>[se(ae,null,{default:xe(()=>[se(ie(Jp))]),_:1}),j[14]||(j[14]=pr(" \u7F16\u8F91 "))]),_:2,__:[14]},1032,["onClick"]),se(Q,{type:"danger",link:"",size:"small",onClick:vt=>k(Se.id)},{default:xe(()=>[se(ae,null,{default:xe(()=>[se(ie(If))]),_:1}),j[15]||(j[15]=pr(" \u5220\u9664 "))]),_:2,__:[15]},1032,["onClick"])])],10,x3))),128))]))])]),le("div",N3,[j[16]||(j[16]=le("div",{class:"view-header"},[le("h3",{class:"view-title"},"\u5BF9\u8BDD\u8BBE\u7F6E")],-1)),le("div",I3,[se(at,{model:ie(p),"label-width":"100px",class:"setting-form compact-form"},{default:xe(()=>[se(Ee,{label:"\u5BF9\u8BDD\u6A21\u5F0F"},{default:xe(()=>[se($,{modelValue:ie(p).modeCode,"onUpdate:modelValue":j[1]||(j[1]=Se=>ie(p).modeCode=Se),onChange:N,placeholder:"\u8BF7\u9009\u62E9\u6A21\u5F0F",style:{width:"100%"},teleported:!1,"popper-class":"chat-setting-select-popper mode-select-popper",placement:"bottom-start"},{default:xe(()=>[(Oe(!0),rt(Bn,null,Mn(ie(g1),Se=>(Oe(),kr(q,{key:Se.value,label:Se.text,value:Se.value},{default:xe(()=>[le("div",O3,[le("div",R3,Xt(Se.text),1),le("div",D3,Xt(Se.description),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),se(Ee,{label:"\u8BB0\u5FC6\u6761\u6570"},{default:xe(()=>[se(Ve,{modelValue:ie(p).maxMemHisSessionNum,"onUpdate:modelValue":j[2]||(j[2]=Se=>ie(p).maxMemHisSessionNum=Se),min:1,max:20,size:"default",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),se(Ee,{label:"\u7F51\u9875\u8BFB\u53D6"},{default:xe(()=>[se($,{modelValue:ie(p).summaryMode,"onUpdate:modelValue":j[3]||(j[3]=Se=>ie(p).summaryMode=Se),onChange:B,placeholder:"\u8BF7\u9009\u62E9",style:{width:"100%"},teleported:!1,"popper-class":"chat-setting-select-popper summary-select-popper",placement:"bottom-start"},{default:xe(()=>[(Oe(!0),rt(Bn,null,Mn(ie(H0),Se=>(Oe(),kr(q,{key:Se.value,label:Se.text,value:Se.value},{default:xe(()=>[le("div",B3,[le("div",M3,Xt(Se.text),1),le("div",$3,Xt(Se.description),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),le("div",P3,[se(Q,{type:"primary",onClick:A,style:{width:"30%"}},{default:xe(()=>j[17]||(j[17]=[pr("\u4FDD\u5B58\u5E76\u4F7F\u7528")])),_:1,__:[17]}),ie(l).length>0?(Oe(),kr(Q,{key:0,type:"default",onClick:V,style:{width:"30%"}},{default:xe(()=>j[18]||(j[18]=[pr("\u53D6\u6D88 ")])),_:1,__:[18]})):nr("",!0)])])):(Oe(),rt("div",L3,[le("div",z3,[le("h3",U3,Xt(ie(u)?"\u7F16\u8F91\u6A21\u578B\u914D\u7F6E":"\u65B0\u589E\u6A21\u578B\u914D\u7F6E"),1)]),le("div",j3,[se(at,{model:ie(f),ref_key:"formRef",ref:a,"label-width":"120px",class:"setting-form"},{default:xe(()=>[se(Ee,{label:"\u914D\u7F6E\u540D\u79F0",prop:"configName",rules:[{required:!0,message:"\u8BF7\u7ED9\u8FD9\u4E2A\u914D\u7F6E\u8D77\u4E2A\u540D\u5B57"}]},{default:xe(()=>[se(ot,{modelValue:ie(f).configName,"onUpdate:modelValue":j[4]||(j[4]=Se=>ie(f).configName=Se),placeholder:"\u4F8B\u5982\uFF1A\u516C\u53F8GPT-4 / \u4E2A\u4EBADeepSeek"},null,8,["modelValue"])]),_:1}),se(Et,{"content-position":"left"},{default:xe(()=>j[19]||(j[19]=[pr("\u6A21\u578B\u53C2\u6570")])),_:1,__:[19]}),se(Ee,{label:"\u6A21\u578B\u63D0\u4F9B\u5546",prop:"providerCode",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6A21\u578B\u63D0\u4F9B\u5546"}]},{default:xe(()=>[se($,{modelValue:ie(f).providerCode,"onUpdate:modelValue":j[5]||(j[5]=Se=>ie(f).providerCode=Se),onChange:te,placeholder:"\u8BF7\u9009\u62E9\u6A21\u578B\u63D0\u4F9B\u5546",style:{width:"100%"},teleported:!1,"popper-class":"chat-setting-select-popper provider-select-popper","fit-input-width":!0,placement:"bottom-start","popper-options":{strategy:"fixed"}},{default:xe(()=>[(Oe(!0),rt(Bn,null,Mn(ie(p1),Se=>(Oe(),kr(q,{key:Se.value,label:Se.text,value:Se.value},{default:xe(()=>[le("div",q3,[le("div",H3,Xt(Se.text),1),le("div",V3,Xt(Se.description),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),se(Ee,{label:"BaseUrl",prop:"baseUrl",rules:[{required:!0,message:"\u8BF7\u586B\u5199BaseUrl"}]},{default:xe(()=>[se(ot,{modelValue:ie(f).baseUrl,"onUpdate:modelValue":j[6]||(j[6]=Se=>ie(f).baseUrl=Se),placeholder:Z()},null,8,["modelValue","placeholder"])]),_:1}),ie(f).providerCode==="aliyun_app"?(Oe(),kr(Ee,{key:0,label:"\u5E94\u7528ID",prop:"appId",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u5E94\u7528ID"}]},{default:xe(()=>[se(ot,{modelValue:ie(f).appId,"onUpdate:modelValue":j[7]||(j[7]=Se=>ie(f).appId=Se),placeholder:X()},null,8,["modelValue","placeholder"])]),_:1})):nr("",!0),se(Ee,{label:"\u5BC6\u94A5(api key)",prop:"apiKey",rules:re()},{default:xe(()=>[se(ot,{modelValue:ie(f).apiKey,"onUpdate:modelValue":j[8]||(j[8]=Se=>ie(f).apiKey=Se),placeholder:W(),type:"password","show-password":""},null,8,["modelValue","placeholder"]),Y()?(Oe(),rt("div",G3,[le("a",{href:Y(),target:"_blank",rel:"noopener noreferrer"},j[20]||(j[20]=[le("span",{class:"link-text"},"\u53BB\u7533\u8BF7 \u2197",-1)]),8,Z3)])):nr("",!0)]),_:1},8,["rules"]),ie(f).providerCode==="dify_workflow"||ie(f).providerCode==="aliyun_app"?nr("",!0):(Oe(),kr(Ee,{key:1,label:"\u6A21\u578B\u540D\u79F0",prop:"modelName",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u6A21\u578B\u540D\u79F0"}]},{default:xe(()=>[se(ot,{modelValue:ie(f).modelName,"onUpdate:modelValue":j[9]||(j[9]=Se=>ie(f).modelName=Se),placeholder:X()},null,8,["modelValue","placeholder"])]),_:1}))]),_:1},8,["model"]),le("div",K3,[se(Q,{type:"primary",onClick:D},{default:xe(()=>j[21]||(j[21]=[pr(" \u4FDD\u5B58\u914D\u7F6E ")])),_:1,__:[21]}),se(Q,{type:"default",onClick:M,style:{width:"30%"}},{default:xe(()=>j[22]||(j[22]=[pr(" \u53D6\u6D88 ")])),_:1,__:[22]})])])]))])}}}),Y3=Mu(W3,[["__scopeId","data-v-a8162e2d"]]),J3={class:"chat-setting"},X3={class:"chat-setting-content"},Q3={class:"copyright-section"},eE={class:"github-link"},tE=["href"],rE=_o({__name:"ChatSetting",emits:["setting-completed","setting-cancel"],setup(r,{emit:e}){const t=fa(),n=e,a=ou("");Bu(async()=>{const o=new B7;try{const u=await o.decrypt(M7.githubUrl,$7.contentEx);a.value=u.trim()}catch(u){t.error("GitHub URL \u89E3\u5BC6\u5931\u8D25:",u),a.value="https://github.com/herogus/good_ai_chrome_extension"}});const s=o=>{n("setting-completed",o)},i=()=>{n("setting-cancel")};return(o,u)=>(Oe(),rt("div",J3,[le("div",X3,[se(Y3,{onSettingCompleted:s,onCloseSetting:i})]),le("div",Q3,[u[0]||(u[0]=le("div",{class:"copyright-text"}," \xA9 2026 \u987E\u5F97\u52A9\u624B \u7248\u6743\u6240\u6709 ",-1)),le("div",eE,[le("a",{href:a.value,target:"_blank",rel:"noopener noreferrer"}," \u5173\u6CE8GitHub\u8D26\u53F7\u4E86\u89E3\u66F4\u591A ",8,tE)])])]))}}),nE=Mu(rE,[["__scopeId","data-v-baf9d4d0"]]);var G0,y1;function aE(){if(y1)return G0;y1=1;function r(R){return R instanceof Map?R.clear=R.delete=R.set=function(){throw new Error("map is read-only")}:R instanceof Set&&(R.add=R.clear=R.delete=function(){throw new Error("set is read-only")}),Object.freeze(R),Object.getOwnPropertyNames(R).forEach(J=>{const me=R[J],Qe=typeof me;(Qe==="object"||Qe==="function")&&!Object.isFrozen(me)&&r(me)}),R}class e{constructor(J){J.data===void 0&&(J.data={}),this.data=J.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function t(R){return R.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function n(R,...J){const me=Object.create(null);for(const Qe in R)me[Qe]=R[Qe];return J.forEach(function(Qe){for(const tr in Qe)me[tr]=Qe[tr]}),me}const a="</span>",s=R=>!!R.scope,i=(R,{prefix:J})=>{if(R.startsWith("language:"))return R.replace("language:","language-");if(R.includes(".")){const me=R.split(".");return[`${J}${me.shift()}`,...me.map((Qe,tr)=>`${Qe}${"_".repeat(tr+1)}`)].join(" ")}return`${J}${R}`};class o{constructor(J,me){this.buffer="",this.classPrefix=me.classPrefix,J.walk(this)}addText(J){this.buffer+=t(J)}openNode(J){if(!s(J))return;const me=i(J.scope,{prefix:this.classPrefix});this.span(me)}closeNode(J){s(J)&&(this.buffer+=a)}value(){return this.buffer}span(J){this.buffer+=`<span class="${J}">`}}const u=(R={})=>{const J={children:[]};return Object.assign(J,R),J};class l{constructor(){this.rootNode=u(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(J){this.top.children.push(J)}openNode(J){const me=u({scope:J});this.add(me),this.stack.push(me)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(J){return this.constructor._walk(J,this.rootNode)}static _walk(J,me){return typeof me=="string"?J.addText(me):me.children&&(J.openNode(me),me.children.forEach(Qe=>this._walk(J,Qe)),J.closeNode(me)),J}static _collapse(J){typeof J!="string"&&J.children&&(J.children.every(me=>typeof me=="string")?J.children=[J.children.join("")]:J.children.forEach(me=>{l._collapse(me)}))}}class c extends l{constructor(J){super(),this.options=J}addText(J){J!==""&&this.add(J)}startScope(J){this.openNode(J)}endScope(){this.closeNode()}__addSublanguage(J,me){const Qe=J.root;me&&(Qe.scope=`language:${me}`),this.add(Qe)}toHTML(){return new o(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}}function d(R){return R?typeof R=="string"?R:R.source:null}function h(R){return m("(?=",R,")")}function f(R){return m("(?:",R,")*")}function p(R){return m("(?:",R,")?")}function m(...R){return R.map(me=>d(me)).join("")}function v(R){const J=R[R.length-1];return typeof J=="object"&&J.constructor===Object?(R.splice(R.length-1,1),J):{}}function _(...R){return"("+(v(R).capture?"":"?:")+R.map(Qe=>d(Qe)).join("|")+")"}function w(R){return new RegExp(R.toString()+"|").exec("").length-1}function E(R,J){const me=R&&R.exec(J);return me&&me.index===0}const F=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function k(R,{joinWith:J}){let me=0;return R.map(Qe=>{me+=1;const tr=me;let fr=d(Qe),Ue="";for(;fr.length>0;){const Me=F.exec(fr);if(!Me){Ue+=fr;break}Ue+=fr.substring(0,Me.index),fr=fr.substring(Me.index+Me[0].length),Me[0][0]==="\\"&&Me[1]?Ue+="\\"+String(Number(Me[1])+tr):(Ue+=Me[0],Me[0]==="("&&me++)}return Ue}).map(Qe=>`(${Qe})`).join(J)}const N=/\b\B/,B="[a-zA-Z]\\w*",A="[a-zA-Z_]\\w*",L="\\b\\d+(\\.\\d+)?",V="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",G="\\b(0b[01]+)",te="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",ve=(R={})=>{const J=/^#![ ]*\//;return R.binary&&(R.begin=m(J,/.*\b/,R.binary,/\b.*/)),n({scope:"meta",begin:J,end:/$/,relevance:0,"on:begin":(me,Qe)=>{me.index!==0&&Qe.ignoreMatch()}},R)},D={begin:"\\\\[\\s\\S]",relevance:0},M={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[D]},P={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[D]},Z={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},W=function(R,J,me={}){const Qe=n({scope:"comment",begin:R,end:J,contains:[]},me);Qe.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const tr=_("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return Qe.contains.push({begin:m(/[ ]+/,"(",tr,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),Qe},X=W("//","$"),Y=W("/\\*","\\*/"),re=W("#","$"),U={scope:"number",begin:L,relevance:0},j={scope:"number",begin:V,relevance:0},ae={scope:"number",begin:G,relevance:0},Q={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[D,{begin:/\[/,end:/\]/,relevance:0,contains:[D]}]},C={scope:"title",begin:B,relevance:0},x={scope:"title",begin:A,relevance:0},q={begin:"\\.\\s*"+A,relevance:0};var Ee=Object.freeze({__proto__:null,APOS_STRING_MODE:M,BACKSLASH_ESCAPE:D,BINARY_NUMBER_MODE:ae,BINARY_NUMBER_RE:G,COMMENT:W,C_BLOCK_COMMENT_MODE:Y,C_LINE_COMMENT_MODE:X,C_NUMBER_MODE:j,C_NUMBER_RE:V,END_SAME_AS_BEGIN:function(R){return Object.assign(R,{"on:begin":(J,me)=>{me.data._beginMatch=J[1]},"on:end":(J,me)=>{me.data._beginMatch!==J[1]&&me.ignoreMatch()}})},HASH_COMMENT_MODE:re,IDENT_RE:B,MATCH_NOTHING_RE:N,METHOD_GUARD:q,NUMBER_MODE:U,NUMBER_RE:L,PHRASAL_WORDS_MODE:Z,QUOTE_STRING_MODE:P,REGEXP_MODE:Q,RE_STARTERS_RE:te,SHEBANG:ve,TITLE_MODE:C,UNDERSCORE_IDENT_RE:A,UNDERSCORE_TITLE_MODE:x});function Ve(R,J){R.input[R.index-1]==="."&&J.ignoreMatch()}function at(R,J){R.className!==void 0&&(R.scope=R.className,delete R.className)}function ot(R,J){J&&R.beginKeywords&&(R.begin="\\b("+R.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",R.__beforeBegin=Ve,R.keywords=R.keywords||R.beginKeywords,delete R.beginKeywords,R.relevance===void 0&&(R.relevance=0))}function Et(R,J){Array.isArray(R.illegal)&&(R.illegal=_(...R.illegal))}function Se(R,J){if(R.match){if(R.begin||R.end)throw new Error("begin & end are not supported with match");R.begin=R.match,delete R.match}}function vt(R,J){R.relevance===void 0&&(R.relevance=1)}const Qt=(R,J)=>{if(!R.beforeMatch)return;if(R.starts)throw new Error("beforeMatch cannot be used with starts");const me=Object.assign({},R);Object.keys(R).forEach(Qe=>{delete R[Qe]}),R.keywords=me.keywords,R.begin=m(me.beforeMatch,h(me.begin)),R.starts={relevance:0,contains:[Object.assign(me,{endsParent:!0})]},R.relevance=0,delete me.beforeMatch},Sr=["of","and","for","in","not","or","if","then","parent","list","value"],Vr="keyword";function be(R,J,me=Vr){const Qe=Object.create(null);return typeof R=="string"?tr(me,R.split(" ")):Array.isArray(R)?tr(me,R):Object.keys(R).forEach(function(fr){Object.assign(Qe,be(R[fr],J,fr))}),Qe;function tr(fr,Ue){J&&(Ue=Ue.map(Me=>Me.toLowerCase())),Ue.forEach(function(Me){const it=Me.split("|");Qe[it[0]]=[fr,Gr(it[0],it[1])]})}}function Gr(R,J){return J?Number(J):Je(R)?0:1}function Je(R){return Sr.includes(R.toLowerCase())}const we={},Ge=R=>{console.error(R)},Ae=(R,...J)=>{console.log(`WARN: ${R}`,...J)},ce=(R,J)=>{we[`${R}/${J}`]||(console.log(`Deprecated as of ${R}. ${J}`),we[`${R}/${J}`]=!0)},Ke=new Error;function ze(R,J,{key:me}){let Qe=0;const tr=R[me],fr={},Ue={};for(let Me=1;Me<=J.length;Me++)Ue[Me+Qe]=tr[Me],fr[Me+Qe]=!0,Qe+=w(J[Me-1]);R[me]=Ue,R[me]._emit=fr,R[me]._multi=!0}function er(R){if(Array.isArray(R.begin)){if(R.skip||R.excludeBegin||R.returnBegin)throw Ge("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Ke;if(typeof R.beginScope!="object"||R.beginScope===null)throw Ge("beginScope must be object"),Ke;ze(R,R.begin,{key:"beginScope"}),R.begin=k(R.begin,{joinWith:""})}}function Rn(R){if(Array.isArray(R.end)){if(R.skip||R.excludeEnd||R.returnEnd)throw Ge("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Ke;if(typeof R.endScope!="object"||R.endScope===null)throw Ge("endScope must be object"),Ke;ze(R,R.end,{key:"endScope"}),R.end=k(R.end,{joinWith:""})}}function K(R){R.scope&&typeof R.scope=="object"&&R.scope!==null&&(R.beginScope=R.scope,delete R.scope)}function ee(R){K(R),typeof R.beginScope=="string"&&(R.beginScope={_wrap:R.beginScope}),typeof R.endScope=="string"&&(R.endScope={_wrap:R.endScope}),er(R),Rn(R)}function _e(R){function J(Ue,Me){return new RegExp(d(Ue),"m"+(R.case_insensitive?"i":"")+(R.unicodeRegex?"u":"")+(Me?"g":""))}class me{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(Me,it){it.position=this.position++,this.matchIndexes[this.matchAt]=it,this.regexes.push([it,Me]),this.matchAt+=w(Me)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const Me=this.regexes.map(it=>it[1]);this.matcherRe=J(k(Me,{joinWith:"|"}),!0),this.lastIndex=0}exec(Me){this.matcherRe.lastIndex=this.lastIndex;const it=this.matcherRe.exec(Me);if(!it)return null;const Nr=it.findIndex((No,B0)=>B0>0&&No!==void 0),yr=this.matchIndexes[Nr];return it.splice(0,Nr),Object.assign(it,yr)}}class Qe{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(Me){if(this.multiRegexes[Me])return this.multiRegexes[Me];const it=new me;return this.rules.slice(Me).forEach(([Nr,yr])=>it.addRule(Nr,yr)),it.compile(),this.multiRegexes[Me]=it,it}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(Me,it){this.rules.push([Me,it]),it.type==="begin"&&this.count++}exec(Me){const it=this.getMatcher(this.regexIndex);it.lastIndex=this.lastIndex;let Nr=it.exec(Me);if(this.resumingScanAtSamePosition()&&!(Nr&&Nr.index===this.lastIndex)){const yr=this.getMatcher(0);yr.lastIndex=this.lastIndex+1,Nr=yr.exec(Me)}return Nr&&(this.regexIndex+=Nr.position+1,this.regexIndex===this.count&&this.considerAll()),Nr}}function tr(Ue){const Me=new Qe;return Ue.contains.forEach(it=>Me.addRule(it.begin,{rule:it,type:"begin"})),Ue.terminatorEnd&&Me.addRule(Ue.terminatorEnd,{type:"end"}),Ue.illegal&&Me.addRule(Ue.illegal,{type:"illegal"}),Me}function fr(Ue,Me){const it=Ue;if(Ue.isCompiled)return it;[at,Se,ee,Qt].forEach(yr=>yr(Ue,Me)),R.compilerExtensions.forEach(yr=>yr(Ue,Me)),Ue.__beforeBegin=null,[ot,Et,vt].forEach(yr=>yr(Ue,Me)),Ue.isCompiled=!0;let Nr=null;return typeof Ue.keywords=="object"&&Ue.keywords.$pattern&&(Ue.keywords=Object.assign({},Ue.keywords),Nr=Ue.keywords.$pattern,delete Ue.keywords.$pattern),Nr=Nr||/\w+/,Ue.keywords&&(Ue.keywords=be(Ue.keywords,R.case_insensitive)),it.keywordPatternRe=J(Nr,!0),Me&&(Ue.begin||(Ue.begin=/\B|\b/),it.beginRe=J(it.begin),!Ue.end&&!Ue.endsWithParent&&(Ue.end=/\B|\b/),Ue.end&&(it.endRe=J(it.end)),it.terminatorEnd=d(it.end)||"",Ue.endsWithParent&&Me.terminatorEnd&&(it.terminatorEnd+=(Ue.end?"|":"")+Me.terminatorEnd)),Ue.illegal&&(it.illegalRe=J(Ue.illegal)),Ue.contains||(Ue.contains=[]),Ue.contains=[].concat(...Ue.contains.map(function(yr){return ke(yr==="self"?Ue:yr)})),Ue.contains.forEach(function(yr){fr(yr,it)}),Ue.starts&&fr(Ue.starts,Me),it.matcher=tr(it),it}if(R.compilerExtensions||(R.compilerExtensions=[]),R.contains&&R.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return R.classNameAliases=n(R.classNameAliases||{}),fr(R)}function Fe(R){return R?R.endsWithParent||Fe(R.starts):!1}function ke(R){return R.variants&&!R.cachedVariants&&(R.cachedVariants=R.variants.map(function(J){return n(R,{variants:null},J)})),R.cachedVariants?R.cachedVariants:Fe(R)?n(R,{starts:R.starts?n(R.starts):null}):Object.isFrozen(R)?n(R):R}var Ut="11.11.1";class Jt extends Error{constructor(J,me){super(J),this.name="HTMLInjectionError",this.html=me}}const hr=t,ps=n,kt=Symbol("nomatch"),mt=7,De=function(R){const J=Object.create(null),me=Object.create(null),Qe=[];let tr=!0;const fr="Could not find the language '{}', did you forget to load/include a language module?",Ue={disableAutodetect:!0,name:"Plain text",contains:[]};let Me={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:c};function it(pe){return Me.noHighlightRe.test(pe)}function Nr(pe){let Ye=pe.className+" ";Ye+=pe.parentNode?pe.parentNode.className:"";const xt=Me.languageDetectRe.exec(Ye);if(xt){const Kt=ms(xt[1]);return Kt||(Ae(fr.replace("{}",xt[1])),Ae("Falling back to no-highlight mode for this block.",pe)),Kt?xt[1]:"no-highlight"}return Ye.split(/\s+/).find(Kt=>it(Kt)||ms(Kt))}function yr(pe,Ye,xt){let Kt="",Ar="";typeof Ye=="object"?(Kt=pe,xt=Ye.ignoreIllegals,Ar=Ye.language):(ce("10.7.0","highlight(lang, code, ...args) has been deprecated."),ce("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),Ar=pe,Kt=Ye),xt===void 0&&(xt=!0);const Wn={code:Kt,language:Ar};tl("before:highlight",Wn);const gs=Wn.result?Wn.result:No(Wn.language,Wn.code,xt);return gs.code=Wn.code,tl("after:highlight",gs),gs}function No(pe,Ye,xt,Kt){const Ar=Object.create(null);function Wn(Ce,Ze){return Ce.keywords[Ze]}function gs(){if(!ft.keywords){Rr.addText(Wt);return}let Ce=0;ft.keywordPatternRe.lastIndex=0;let Ze=ft.keywordPatternRe.exec(Wt),yt="";for(;Ze;){yt+=Wt.substring(Ce,Ze.index);const jt=ya.case_insensitive?Ze[0].toLowerCase():Ze[0],zr=Wn(ft,jt);if(zr){const[La,F7]=zr;if(Rr.addText(yt),yt="",Ar[jt]=(Ar[jt]||0)+1,Ar[jt]<=mt&&(al+=F7),La.startsWith("_"))yt+=Ze[0];else{const N7=ya.classNameAliases[La]||La;ga(Ze[0],N7)}}else yt+=Ze[0];Ce=ft.keywordPatternRe.lastIndex,Ze=ft.keywordPatternRe.exec(Wt)}yt+=Wt.substring(Ce),Rr.addText(yt)}function rl(){if(Wt==="")return;let Ce=null;if(typeof ft.subLanguage=="string"){if(!J[ft.subLanguage]){Rr.addText(Wt);return}Ce=No(ft.subLanguage,Wt,!0,e1[ft.subLanguage]),e1[ft.subLanguage]=Ce._top}else Ce=M0(Wt,ft.subLanguage.length?ft.subLanguage:null);ft.relevance>0&&(al+=Ce.relevance),Rr.__addSublanguage(Ce._emitter,Ce.language)}function xn(){ft.subLanguage!=null?rl():gs(),Wt=""}function ga(Ce,Ze){Ce!==""&&(Rr.startScope(Ze),Rr.addText(Ce),Rr.endScope())}function Yg(Ce,Ze){let yt=1;const jt=Ze.length-1;for(;yt<=jt;){if(!Ce._emit[yt]){yt++;continue}const zr=ya.classNameAliases[Ce[yt]]||Ce[yt],La=Ze[yt];zr?ga(La,zr):(Wt=La,gs(),Wt=""),yt++}}function Jg(Ce,Ze){return Ce.scope&&typeof Ce.scope=="string"&&Rr.openNode(ya.classNameAliases[Ce.scope]||Ce.scope),Ce.beginScope&&(Ce.beginScope._wrap?(ga(Wt,ya.classNameAliases[Ce.beginScope._wrap]||Ce.beginScope._wrap),Wt=""):Ce.beginScope._multi&&(Yg(Ce.beginScope,Ze),Wt="")),ft=Object.create(Ce,{parent:{value:ft}}),ft}function Xg(Ce,Ze,yt){let jt=E(Ce.endRe,yt);if(jt){if(Ce["on:end"]){const zr=new e(Ce);Ce["on:end"](Ze,zr),zr.isMatchIgnored&&(jt=!1)}if(jt){for(;Ce.endsParent&&Ce.parent;)Ce=Ce.parent;return Ce}}if(Ce.endsWithParent)return Xg(Ce.parent,Ze,yt)}function S7(Ce){return ft.matcher.regexIndex===0?(Wt+=Ce[0],1):(z0=!0,0)}function A7(Ce){const Ze=Ce[0],yt=Ce.rule,jt=new e(yt),zr=[yt.__beforeBegin,yt["on:begin"]];for(const La of zr)if(La&&(La(Ce,jt),jt.isMatchIgnored))return S7(Ze);return yt.skip?Wt+=Ze:(yt.excludeBegin&&(Wt+=Ze),xn(),!yt.returnBegin&&!yt.excludeBegin&&(Wt=Ze)),Jg(yt,Ce),yt.returnBegin?0:Ze.length}function k7(Ce){const Ze=Ce[0],yt=Ye.substring(Ce.index),jt=Xg(ft,Ce,yt);if(!jt)return kt;const zr=ft;ft.endScope&&ft.endScope._wrap?(xn(),ga(Ze,ft.endScope._wrap)):ft.endScope&&ft.endScope._multi?(xn(),Yg(ft.endScope,Ce)):zr.skip?Wt+=Ze:(zr.returnEnd||zr.excludeEnd||(Wt+=Ze),xn(),zr.excludeEnd&&(Wt=Ze));do ft.scope&&Rr.closeNode(),!ft.skip&&!ft.subLanguage&&(al+=ft.relevance),ft=ft.parent;while(ft!==jt.parent);return jt.starts&&Jg(jt.starts,Ce),zr.returnEnd?0:Ze.length}function C7(){const Ce=[];for(let Ze=ft;Ze!==ya;Ze=Ze.parent)Ze.scope&&Ce.unshift(Ze.scope);Ce.forEach(Ze=>Rr.openNode(Ze))}let nl={};function Qg(Ce,Ze){const yt=Ze&&Ze[0];if(Wt+=Ce,yt==null)return xn(),0;if(nl.type==="begin"&&Ze.type==="end"&&nl.index===Ze.index&&yt===""){if(Wt+=Ye.slice(Ze.index,Ze.index+1),!tr){const jt=new Error(`0 width match regex (${pe})`);throw jt.languageName=pe,jt.badRule=nl.rule,jt}return 1}if(nl=Ze,Ze.type==="begin")return A7(Ze);if(Ze.type==="illegal"&&!xt){const jt=new Error('Illegal lexeme "'+yt+'" for mode "'+(ft.scope||"<unnamed>")+'"');throw jt.mode=ft,jt}else if(Ze.type==="end"){const jt=k7(Ze);if(jt!==kt)return jt}if(Ze.type==="illegal"&&yt==="")return Wt+=`
`,1;if(L0>1e5&&L0>Ze.index*3)throw new Error("potential infinite loop, way more iterations than matches");return Wt+=yt,yt.length}const ya=ms(pe);if(!ya)throw Ge(fr.replace("{}",pe)),new Error('Unknown language: "'+pe+'"');const T7=_e(ya);let P0="",ft=Kt||T7;const e1={},Rr=new Me.__emitter(Me);C7();let Wt="",al=0,ei=0,L0=0,z0=!1;try{if(ya.__emitTokens)ya.__emitTokens(Ye,Rr);else{for(ft.matcher.considerAll();;){L0++,z0?z0=!1:ft.matcher.considerAll(),ft.matcher.lastIndex=ei;const Ce=ft.matcher.exec(Ye);if(!Ce)break;const Ze=Ye.substring(ei,Ce.index),yt=Qg(Ze,Ce);ei=Ce.index+yt}Qg(Ye.substring(ei))}return Rr.finalize(),P0=Rr.toHTML(),{language:pe,value:P0,relevance:al,illegal:!1,_emitter:Rr,_top:ft}}catch(Ce){if(Ce.message&&Ce.message.includes("Illegal"))return{language:pe,value:hr(Ye),illegal:!0,relevance:0,_illegalBy:{message:Ce.message,index:ei,context:Ye.slice(ei-100,ei+100),mode:Ce.mode,resultSoFar:P0},_emitter:Rr};if(tr)return{language:pe,value:hr(Ye),illegal:!1,relevance:0,errorRaised:Ce,_emitter:Rr,_top:ft};throw Ce}}function B0(pe){const Ye={value:hr(pe),illegal:!1,relevance:0,_top:Ue,_emitter:new Me.__emitter(Me)};return Ye._emitter.addText(pe),Ye}function M0(pe,Ye){Ye=Ye||Me.languages||Object.keys(J);const xt=B0(pe),Kt=Ye.filter(ms).filter(Wg).map(xn=>No(xn,pe,!1));Kt.unshift(xt);const Ar=Kt.sort((xn,ga)=>{if(xn.relevance!==ga.relevance)return ga.relevance-xn.relevance;if(xn.language&&ga.language){if(ms(xn.language).supersetOf===ga.language)return 1;if(ms(ga.language).supersetOf===xn.language)return-1}return 0}),[Wn,gs]=Ar,rl=Wn;return rl.secondBest=gs,rl}function f7(pe,Ye,xt){const Kt=Ye&&me[Ye]||xt;pe.classList.add("hljs"),pe.classList.add(`language-${Kt}`)}function $0(pe){let Ye=null;const xt=Nr(pe);if(it(xt))return;if(tl("before:highlightElement",{el:pe,language:xt}),pe.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",pe);return}if(pe.children.length>0&&(Me.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(pe)),Me.throwUnescapedHTML))throw new Jt("One of your code blocks includes unescaped HTML.",pe.innerHTML);Ye=pe;const Kt=Ye.textContent,Ar=xt?yr(Kt,{language:xt,ignoreIllegals:!0}):M0(Kt);pe.innerHTML=Ar.value,pe.dataset.highlighted="yes",f7(pe,xt,Ar.language),pe.result={language:Ar.language,re:Ar.relevance,relevance:Ar.relevance},Ar.secondBest&&(pe.secondBest={language:Ar.secondBest.language,relevance:Ar.secondBest.relevance}),tl("after:highlightElement",{el:pe,result:Ar,text:Kt})}function p7(pe){Me=ps(Me,pe)}const m7=()=>{el(),ce("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function g7(){el(),ce("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let Zg=!1;function el(){function pe(){el()}if(document.readyState==="loading"){Zg||window.addEventListener("DOMContentLoaded",pe,!1),Zg=!0;return}document.querySelectorAll(Me.cssSelector).forEach($0)}function y7(pe,Ye){let xt=null;try{xt=Ye(R)}catch(Kt){if(Ge("Language definition for '{}' could not be registered.".replace("{}",pe)),tr)Ge(Kt);else throw Kt;xt=Ue}xt.name||(xt.name=pe),J[pe]=xt,xt.rawDefinition=Ye.bind(null,R),xt.aliases&&Kg(xt.aliases,{languageName:pe})}function v7(pe){delete J[pe];for(const Ye of Object.keys(me))me[Ye]===pe&&delete me[Ye]}function _7(){return Object.keys(J)}function ms(pe){return pe=(pe||"").toLowerCase(),J[pe]||J[me[pe]]}function Kg(pe,{languageName:Ye}){typeof pe=="string"&&(pe=[pe]),pe.forEach(xt=>{me[xt.toLowerCase()]=Ye})}function Wg(pe){const Ye=ms(pe);return Ye&&!Ye.disableAutodetect}function b7(pe){pe["before:highlightBlock"]&&!pe["before:highlightElement"]&&(pe["before:highlightElement"]=Ye=>{pe["before:highlightBlock"](Object.assign({block:Ye.el},Ye))}),pe["after:highlightBlock"]&&!pe["after:highlightElement"]&&(pe["after:highlightElement"]=Ye=>{pe["after:highlightBlock"](Object.assign({block:Ye.el},Ye))})}function w7(pe){b7(pe),Qe.push(pe)}function E7(pe){const Ye=Qe.indexOf(pe);Ye!==-1&&Qe.splice(Ye,1)}function tl(pe,Ye){const xt=pe;Qe.forEach(function(Kt){Kt[xt]&&Kt[xt](Ye)})}function x7(pe){return ce("10.7.0","highlightBlock will be removed entirely in v12.0"),ce("10.7.0","Please use highlightElement now."),$0(pe)}Object.assign(R,{highlight:yr,highlightAuto:M0,highlightAll:el,highlightElement:$0,highlightBlock:x7,configure:p7,initHighlighting:m7,initHighlightingOnLoad:g7,registerLanguage:y7,unregisterLanguage:v7,listLanguages:_7,getLanguage:ms,registerAliases:Kg,autoDetection:Wg,inherit:ps,addPlugin:w7,removePlugin:E7}),R.debugMode=function(){tr=!1},R.safeMode=function(){tr=!0},R.versionString=Ut,R.regex={concat:m,lookahead:h,either:_,optional:p,anyNumberOfTimes:f};for(const pe in Ee)typeof Ee[pe]=="object"&&r(Ee[pe]);return Object.assign(R,Ee),R},Mt=De({});return Mt.newInstance=()=>De({}),G0=Mt,Mt.HighlightJS=Mt,Mt.default=Mt,G0}var Z0,v1;function sE(){if(v1)return Z0;v1=1;function r(e){const t=e.regex,n=t.concat(/[\p{L}_]/u,t.optional(/[\p{L}0-9_.-]*:/u),/[\p{L}0-9_.-]*/u),a=/[\p{L}0-9._:-]+/u,s={className:"symbol",begin:/&[a-z]+;|&#[0-9]+;|&#x[a-f0-9]+;/},i={begin:/\s/,contains:[{className:"keyword",begin:/#?[a-z_][a-z1-9_-]+/,illegal:/\n/}]},o=e.inherit(i,{begin:/\(/,end:/\)/}),u=e.inherit(e.APOS_STRING_MODE,{className:"string"}),l=e.inherit(e.QUOTE_STRING_MODE,{className:"string"}),c={endsWithParent:!0,illegal:/</,relevance:0,contains:[{className:"attr",begin:a,relevance:0},{begin:/=\s*/,relevance:0,contains:[{className:"string",endsParent:!0,variants:[{begin:/"/,end:/"/,contains:[s]},{begin:/'/,end:/'/,contains:[s]},{begin:/[^\s"'=<>`]+/}]}]}]};return{name:"HTML, XML",aliases:["html","xhtml","rss","atom","xjb","xsd","xsl","plist","wsf","svg"],case_insensitive:!0,unicodeRegex:!0,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,relevance:10,contains:[i,l,u,o,{begin:/\[/,end:/\]/,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,contains:[i,o,l,u]}]}]},e.COMMENT(/<!--/,/-->/,{relevance:10}),{begin:/<!\[CDATA\[/,end:/\]\]>/,relevance:10},s,{className:"meta",end:/\?>/,variants:[{begin:/<\?xml/,relevance:10,contains:[l]},{begin:/<\?[a-z][a-z0-9]+/}]},{className:"tag",begin:/<style(?=\s|>)/,end:/>/,keywords:{name:"style"},contains:[c],starts:{end:/<\/style>/,returnEnd:!0,subLanguage:["css","xml"]}},{className:"tag",begin:/<script(?=\s|>)/,end:/>/,keywords:{name:"script"},contains:[c],starts:{end:/<\/script>/,returnEnd:!0,subLanguage:["javascript","handlebars","xml"]}},{className:"tag",begin:/<>|<\/>/},{className:"tag",begin:t.concat(/</,t.lookahead(t.concat(n,t.either(/\/>/,/>/,/\s/)))),end:/\/?>/,contains:[{className:"name",begin:n,relevance:0,starts:c}]},{className:"tag",begin:t.concat(/<\//,t.lookahead(t.concat(n,/>/))),contains:[{className:"name",begin:n,relevance:0},{begin:/>/,relevance:0,endsParent:!0}]}]}}return Z0=r,Z0}var K0,_1;function iE(){if(_1)return K0;_1=1;function r(e){const t=e.regex,n={},a={begin:/\$\{/,end:/\}/,contains:["self",{begin:/:-/,contains:[n]}]};Object.assign(n,{className:"variable",variants:[{begin:t.concat(/\$[\w\d#@][\w\d_]*/,"(?![\\w\\d])(?![$])")},a]});const s={className:"subst",begin:/\$\(/,end:/\)/,contains:[e.BACKSLASH_ESCAPE]},i=e.inherit(e.COMMENT(),{match:[/(^|\s)/,/#.*$/],scope:{2:"comment"}}),o={begin:/<<-?\s*(?=\w+)/,starts:{contains:[e.END_SAME_AS_BEGIN({begin:/(\w+)/,end:/(\w+)/,className:"string"})]}},u={className:"string",begin:/"/,end:/"/,contains:[e.BACKSLASH_ESCAPE,n,s]};s.contains.push(u);const l={match:/\\"/},c={className:"string",begin:/'/,end:/'/},d={match:/\\'/},h={begin:/\$?\(\(/,end:/\)\)/,contains:[{begin:/\d+#[0-9a-f]+/,className:"number"},e.NUMBER_MODE,n]},f=["fish","bash","zsh","sh","csh","ksh","tcsh","dash","scsh"],p=e.SHEBANG({binary:`(${f.join("|")})`,relevance:10}),m={className:"function",begin:/\w[\w\d_]*\s*\(\s*\)\s*\{/,returnBegin:!0,contains:[e.inherit(e.TITLE_MODE,{begin:/\w[\w\d_]*/})],relevance:0},v=["if","then","else","elif","fi","time","for","while","until","in","do","done","case","esac","coproc","function","select"],_=["true","false"],w={match:/(\/[a-z._-]+)+/},E=["break","cd","continue","eval","exec","exit","export","getopts","hash","pwd","readonly","return","shift","test","times","trap","umask","unset"],F=["alias","bind","builtin","caller","command","declare","echo","enable","help","let","local","logout","mapfile","printf","read","readarray","source","sudo","type","typeset","ulimit","unalias"],k=["autoload","bg","bindkey","bye","cap","chdir","clone","comparguments","compcall","compctl","compdescribe","compfiles","compgroups","compquote","comptags","comptry","compvalues","dirs","disable","disown","echotc","echoti","emulate","fc","fg","float","functions","getcap","getln","history","integer","jobs","kill","limit","log","noglob","popd","print","pushd","pushln","rehash","sched","setcap","setopt","stat","suspend","ttyctl","unfunction","unhash","unlimit","unsetopt","vared","wait","whence","where","which","zcompile","zformat","zftp","zle","zmodload","zparseopts","zprof","zpty","zregexparse","zsocket","zstyle","ztcp"],N=["chcon","chgrp","chown","chmod","cp","dd","df","dir","dircolors","ln","ls","mkdir","mkfifo","mknod","mktemp","mv","realpath","rm","rmdir","shred","sync","touch","truncate","vdir","b2sum","base32","base64","cat","cksum","comm","csplit","cut","expand","fmt","fold","head","join","md5sum","nl","numfmt","od","paste","ptx","pr","sha1sum","sha224sum","sha256sum","sha384sum","sha512sum","shuf","sort","split","sum","tac","tail","tr","tsort","unexpand","uniq","wc","arch","basename","chroot","date","dirname","du","echo","env","expr","factor","groups","hostid","id","link","logname","nice","nohup","nproc","pathchk","pinky","printenv","printf","pwd","readlink","runcon","seq","sleep","stat","stdbuf","stty","tee","test","timeout","tty","uname","unlink","uptime","users","who","whoami","yes"];return{name:"Bash",aliases:["sh","zsh"],keywords:{$pattern:/\b[a-z][a-z0-9._-]+\b/,keyword:v,literal:_,built_in:[...E,...F,"set","shopt",...k,...N]},contains:[p,e.SHEBANG(),m,h,i,o,w,u,l,c,d,n]}}return K0=r,K0}var W0,b1;function oE(){if(b1)return W0;b1=1;function r(e){const t=e.regex,n=e.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),a="decltype\\(auto\\)",s="[a-zA-Z_]\\w*::",o="("+a+"|"+t.optional(s)+"[a-zA-Z_]\\w*"+t.optional("<[^<>]+>")+")",u={className:"type",variants:[{begin:"\\b[a-z\\d_]*_t\\b"},{match:/\batomic_[a-z]{3,6}\b/}]},c={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[e.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+"\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)"+"|.)",end:"'",illegal:"."},e.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},d={className:"number",variants:[{match:/\b(0b[01']+)/},{match:/(-?)\b([\d']+(\.[\d']*)?|\.[\d']+)((ll|LL|l|L)(u|U)?|(u|U)(ll|LL|l|L)?|f|F|b|B)/},{match:/(-?)\b(0[xX][a-fA-F0-9]+(?:'[a-fA-F0-9]+)*(?:\.[a-fA-F0-9]*(?:'[a-fA-F0-9]*)*)?(?:[pP][-+]?[0-9]+)?(l|L)?(u|U)?)/},{match:/(-?)\b\d+(?:'\d+)*(?:\.\d*(?:'\d*)*)?(?:[eE][-+]?\d+)?/}],relevance:0},h={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef elifdef elifndef include"},contains:[{begin:/\\\n/,relevance:0},e.inherit(c,{className:"string"}),{className:"string",begin:/<.*?>/},n,e.C_BLOCK_COMMENT_MODE]},f={className:"title",begin:t.optional(s)+e.IDENT_RE,relevance:0},p=t.optional(s)+e.IDENT_RE+"\\s*\\(",_={keyword:["asm","auto","break","case","continue","default","do","else","enum","extern","for","fortran","goto","if","inline","register","restrict","return","sizeof","typeof","typeof_unqual","struct","switch","typedef","union","volatile","while","_Alignas","_Alignof","_Atomic","_Generic","_Noreturn","_Static_assert","_Thread_local","alignas","alignof","noreturn","static_assert","thread_local","_Pragma"],type:["float","double","signed","unsigned","int","short","long","char","void","_Bool","_BitInt","_Complex","_Imaginary","_Decimal32","_Decimal64","_Decimal96","_Decimal128","_Decimal64x","_Decimal128x","_Float16","_Float32","_Float64","_Float128","_Float32x","_Float64x","_Float128x","const","static","constexpr","complex","bool","imaginary"],literal:"true false NULL",built_in:"std string wstring cin cout cerr clog stdin stdout stderr stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set pair bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap priority_queue make_pair array shared_ptr abort terminate abs acos asin atan2 atan calloc ceil cosh cos exit exp fabs floor fmod fprintf fputs free frexp fscanf future isalnum isalpha iscntrl isdigit isgraph islower isprint ispunct isspace isupper isxdigit tolower toupper labs ldexp log10 log malloc realloc memchr memcmp memcpy memset modf pow printf putchar puts scanf sinh sin snprintf sprintf sqrt sscanf strcat strchr strcmp strcpy strcspn strlen strncat strncmp strncpy strpbrk strrchr strspn strstr tanh tan vfprintf vprintf vsprintf endl initializer_list unique_ptr"},w=[h,u,n,e.C_BLOCK_COMMENT_MODE,d,c],E={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:_,contains:w.concat([{begin:/\(/,end:/\)/,keywords:_,contains:w.concat(["self"]),relevance:0}]),relevance:0},F={begin:"("+o+"[\\*&\\s]+)+"+p,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:_,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:a,keywords:_,relevance:0},{begin:p,returnBegin:!0,contains:[e.inherit(f,{className:"title.function"})],relevance:0},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:_,relevance:0,contains:[n,e.C_BLOCK_COMMENT_MODE,c,d,u,{begin:/\(/,end:/\)/,keywords:_,relevance:0,contains:["self",n,e.C_BLOCK_COMMENT_MODE,c,d,u]}]},u,n,e.C_BLOCK_COMMENT_MODE,h]};return{name:"C",aliases:["h"],keywords:_,disableAutodetect:!0,illegal:"</",contains:[].concat(E,F,w,[h,{begin:e.IDENT_RE+"::",keywords:_},{className:"class",beginKeywords:"enum class struct union",end:/[{;:<>=]/,contains:[{beginKeywords:"final class struct"},e.TITLE_MODE]}]),exports:{preprocessor:h,strings:c,keywords:_}}}return W0=r,W0}var Y0,w1;function uE(){if(w1)return Y0;w1=1;function r(e){const t=e.regex,n=e.COMMENT("//","$",{contains:[{begin:/\\\n/}]}),a="decltype\\(auto\\)",s="[a-zA-Z_]\\w*::",o="(?!struct)("+a+"|"+t.optional(s)+"[a-zA-Z_]\\w*"+t.optional("<[^<>]+>")+")",u={className:"type",begin:"\\b[a-z\\d_]*_t\\b"},c={className:"string",variants:[{begin:'(u8?|U|L)?"',end:'"',illegal:"\\n",contains:[e.BACKSLASH_ESCAPE]},{begin:"(u8?|U|L)?'("+"\\\\(x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4,8}|[0-7]{3}|\\S)"+"|.)",end:"'",illegal:"."},e.END_SAME_AS_BEGIN({begin:/(?:u8?|U|L)?R"([^()\\ ]{0,16})\(/,end:/\)([^()\\ ]{0,16})"/})]},d={className:"number",variants:[{begin:"[+-]?(?:(?:[0-9](?:'?[0-9])*\\.(?:[0-9](?:'?[0-9])*)?|\\.[0-9](?:'?[0-9])*)(?:[Ee][+-]?[0-9](?:'?[0-9])*)?|[0-9](?:'?[0-9])*[Ee][+-]?[0-9](?:'?[0-9])*|0[Xx](?:[0-9A-Fa-f](?:'?[0-9A-Fa-f])*(?:\\.(?:[0-9A-Fa-f](?:'?[0-9A-Fa-f])*)?)?|\\.[0-9A-Fa-f](?:'?[0-9A-Fa-f])*)[Pp][+-]?[0-9](?:'?[0-9])*)(?:[Ff](?:16|32|64|128)?|(BF|bf)16|[Ll]|)"},{begin:"[+-]?\\b(?:0[Bb][01](?:'?[01])*|0[Xx][0-9A-Fa-f](?:'?[0-9A-Fa-f])*|0(?:'?[0-7])*|[1-9](?:'?[0-9])*)(?:[Uu](?:LL?|ll?)|[Uu][Zz]?|(?:LL?|ll?)[Uu]?|[Zz][Uu]|)"}],relevance:0},h={className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma _Pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},e.inherit(c,{className:"string"}),{className:"string",begin:/<.*?>/},n,e.C_BLOCK_COMMENT_MODE]},f={className:"title",begin:t.optional(s)+e.IDENT_RE,relevance:0},p=t.optional(s)+e.IDENT_RE+"\\s*\\(",m=["alignas","alignof","and","and_eq","asm","atomic_cancel","atomic_commit","atomic_noexcept","auto","bitand","bitor","break","case","catch","class","co_await","co_return","co_yield","compl","concept","const_cast|10","consteval","constexpr","constinit","continue","decltype","default","delete","do","dynamic_cast|10","else","enum","explicit","export","extern","false","final","for","friend","goto","if","import","inline","module","mutable","namespace","new","noexcept","not","not_eq","nullptr","operator","or","or_eq","override","private","protected","public","reflexpr","register","reinterpret_cast|10","requires","return","sizeof","static_assert","static_cast|10","struct","switch","synchronized","template","this","thread_local","throw","transaction_safe","transaction_safe_dynamic","true","try","typedef","typeid","typename","union","using","virtual","volatile","while","xor","xor_eq"],v=["bool","char","char16_t","char32_t","char8_t","double","float","int","long","short","void","wchar_t","unsigned","signed","const","static"],_=["any","auto_ptr","barrier","binary_semaphore","bitset","complex","condition_variable","condition_variable_any","counting_semaphore","deque","false_type","flat_map","flat_set","future","imaginary","initializer_list","istringstream","jthread","latch","lock_guard","multimap","multiset","mutex","optional","ostringstream","packaged_task","pair","promise","priority_queue","queue","recursive_mutex","recursive_timed_mutex","scoped_lock","set","shared_future","shared_lock","shared_mutex","shared_timed_mutex","shared_ptr","stack","string_view","stringstream","timed_mutex","thread","true_type","tuple","unique_lock","unique_ptr","unordered_map","unordered_multimap","unordered_multiset","unordered_set","variant","vector","weak_ptr","wstring","wstring_view"],w=["abort","abs","acos","apply","as_const","asin","atan","atan2","calloc","ceil","cerr","cin","clog","cos","cosh","cout","declval","endl","exchange","exit","exp","fabs","floor","fmod","forward","fprintf","fputs","free","frexp","fscanf","future","invoke","isalnum","isalpha","iscntrl","isdigit","isgraph","islower","isprint","ispunct","isspace","isupper","isxdigit","labs","launder","ldexp","log","log10","make_pair","make_shared","make_shared_for_overwrite","make_tuple","make_unique","malloc","memchr","memcmp","memcpy","memset","modf","move","pow","printf","putchar","puts","realloc","scanf","sin","sinh","snprintf","sprintf","sqrt","sscanf","std","stderr","stdin","stdout","strcat","strchr","strcmp","strcpy","strcspn","strlen","strncat","strncmp","strncpy","strpbrk","strrchr","strspn","strstr","swap","tan","tanh","terminate","to_underlying","tolower","toupper","vfprintf","visit","vprintf","vsprintf"],k={type:v,keyword:m,literal:["NULL","false","nullopt","nullptr","true"],built_in:["_Pragma"],_type_hints:_},N={className:"function.dispatch",relevance:0,keywords:{_hint:w},begin:t.concat(/\b/,/(?!decltype)/,/(?!if)/,/(?!for)/,/(?!switch)/,/(?!while)/,e.IDENT_RE,t.lookahead(/(<[^<>]+>|)\s*\(/))},B=[N,h,u,n,e.C_BLOCK_COMMENT_MODE,d,c],A={variants:[{begin:/=/,end:/;/},{begin:/\(/,end:/\)/},{beginKeywords:"new throw return else",end:/;/}],keywords:k,contains:B.concat([{begin:/\(/,end:/\)/,keywords:k,contains:B.concat(["self"]),relevance:0}]),relevance:0},L={className:"function",begin:"("+o+"[\\*&\\s]+)+"+p,returnBegin:!0,end:/[{;=]/,excludeEnd:!0,keywords:k,illegal:/[^\w\s\*&:<>.]/,contains:[{begin:a,keywords:k,relevance:0},{begin:p,returnBegin:!0,contains:[f],relevance:0},{begin:/::/,relevance:0},{begin:/:/,endsWithParent:!0,contains:[c,d]},{relevance:0,match:/,/},{className:"params",begin:/\(/,end:/\)/,keywords:k,relevance:0,contains:[n,e.C_BLOCK_COMMENT_MODE,c,d,u,{begin:/\(/,end:/\)/,keywords:k,relevance:0,contains:["self",n,e.C_BLOCK_COMMENT_MODE,c,d,u]}]},u,n,e.C_BLOCK_COMMENT_MODE,h]};return{name:"C++",aliases:["cc","c++","h++","hpp","hh","hxx","cxx"],keywords:k,illegal:"</",classNameAliases:{"function.dispatch":"built_in"},contains:[].concat(A,L,N,B,[h,{begin:"\\b(deque|list|queue|priority_queue|pair|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array|tuple|optional|variant|function|flat_map|flat_set)\\s*<(?!<)",end:">",keywords:k,contains:["self",u]},{begin:e.IDENT_RE+"::",keywords:k},{match:[/\b(?:enum(?:\s+(?:class|struct))?|class|struct|union)/,/\s+/,/\w+/],className:{1:"keyword",3:"title.class"}}])}}return Y0=r,Y0}var J0,E1;function lE(){if(E1)return J0;E1=1;function r(e){const t=["bool","byte","char","decimal","delegate","double","dynamic","enum","float","int","long","nint","nuint","object","sbyte","short","string","ulong","uint","ushort"],n=["public","private","protected","static","internal","protected","abstract","async","extern","override","unsafe","virtual","new","sealed","partial"],a=["default","false","null","true"],s=["abstract","as","base","break","case","catch","class","const","continue","do","else","event","explicit","extern","finally","fixed","for","foreach","goto","if","implicit","in","interface","internal","is","lock","namespace","new","operator","out","override","params","private","protected","public","readonly","record","ref","return","scoped","sealed","sizeof","stackalloc","static","struct","switch","this","throw","try","typeof","unchecked","unsafe","using","virtual","void","volatile","while"],i=["add","alias","and","ascending","args","async","await","by","descending","dynamic","equals","file","from","get","global","group","init","into","join","let","nameof","not","notnull","on","or","orderby","partial","record","remove","required","scoped","select","set","unmanaged","value|0","var","when","where","with","yield"],o={keyword:s.concat(i),built_in:t,literal:a},u=e.inherit(e.TITLE_MODE,{begin:"[a-zA-Z](\\.?\\w)*"}),l={className:"number",variants:[{begin:"\\b(0b[01']+)"},{begin:"(-?)\\b([\\d']+(\\.[\\d']*)?|\\.[\\d']+)(u|U|l|L|ul|UL|f|F|b|B)"},{begin:"(-?)(\\b0[xX][a-fA-F0-9']+|(\\b[\\d']+(\\.[\\d']*)?|\\.[\\d']+)([eE][-+]?[\\d']+)?)"}],relevance:0},c={className:"string",begin:/"""("*)(?!")(.|\n)*?"""\1/,relevance:1},d={className:"string",begin:'@"',end:'"',contains:[{begin:'""'}]},h=e.inherit(d,{illegal:/\n/}),f={className:"subst",begin:/\{/,end:/\}/,keywords:o},p=e.inherit(f,{illegal:/\n/}),m={className:"string",begin:/\$"/,end:'"',illegal:/\n/,contains:[{begin:/\{\{/},{begin:/\}\}/},e.BACKSLASH_ESCAPE,p]},v={className:"string",begin:/\$@"/,end:'"',contains:[{begin:/\{\{/},{begin:/\}\}/},{begin:'""'},f]},_=e.inherit(v,{illegal:/\n/,contains:[{begin:/\{\{/},{begin:/\}\}/},{begin:'""'},p]});f.contains=[v,m,d,e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,l,e.C_BLOCK_COMMENT_MODE],p.contains=[_,m,h,e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,l,e.inherit(e.C_BLOCK_COMMENT_MODE,{illegal:/\n/})];const w={variants:[c,v,m,d,e.APOS_STRING_MODE,e.QUOTE_STRING_MODE]},E={begin:"<",end:">",contains:[{beginKeywords:"in out"},u]},F=e.IDENT_RE+"(<"+e.IDENT_RE+"(\\s*,\\s*"+e.IDENT_RE+")*>)?(\\[\\])?",k={begin:"@"+e.IDENT_RE,relevance:0};return{name:"C#",aliases:["cs","c#"],keywords:o,illegal:/::/,contains:[e.COMMENT("///","$",{returnBegin:!0,contains:[{className:"doctag",variants:[{begin:"///",relevance:0},{begin:"<!--|-->"},{begin:"</?",end:">"}]}]}),e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE,{className:"meta",begin:"#",end:"$",keywords:{keyword:"if else elif endif define undef warning error line region endregion pragma checksum"}},w,l,{beginKeywords:"class interface",relevance:0,end:/[{;=]/,illegal:/[^\s:,]/,contains:[{beginKeywords:"where class"},u,E,e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE]},{beginKeywords:"namespace",relevance:0,end:/[{;=]/,illegal:/[^\s:]/,contains:[u,e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE]},{beginKeywords:"record",relevance:0,end:/[{;=]/,illegal:/[^\s:]/,contains:[u,E,e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE]},{className:"meta",begin:"^\\s*\\[(?=[\\w])",excludeBegin:!0,end:"\\]",excludeEnd:!0,contains:[{className:"string",begin:/"/,end:/"/}]},{beginKeywords:"new return throw await else",relevance:0},{className:"function",begin:"("+F+"\\s+)+"+e.IDENT_RE+"\\s*(<[^=]+>\\s*)?\\(",returnBegin:!0,end:/\s*[{;=]/,excludeEnd:!0,keywords:o,contains:[{beginKeywords:n.join(" "),relevance:0},{begin:e.IDENT_RE+"\\s*(<[^=]+>\\s*)?\\(",returnBegin:!0,contains:[e.TITLE_MODE,E],relevance:0},{match:/\(\)/},{className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:o,relevance:0,contains:[w,l,e.C_BLOCK_COMMENT_MODE]},e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE]},k]}}return J0=r,J0}var X0,x1;function cE(){if(x1)return X0;x1=1;const r=l=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:l.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[l.APOS_STRING_MODE,l.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:l.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z_][A-Za-z0-9_-]*/}}),e=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","optgroup","option","p","picture","q","quote","samp","section","select","source","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],t=["defs","g","marker","mask","pattern","svg","switch","symbol","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feGaussianBlur","feImage","feMerge","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","linearGradient","radialGradient","stop","circle","ellipse","image","line","path","polygon","polyline","rect","text","use","textPath","tspan","foreignObject","clipPath"],n=[...e,...t],a=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"].sort().reverse(),s=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"].sort().reverse(),i=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"].sort().reverse(),o=["accent-color","align-content","align-items","align-self","alignment-baseline","all","anchor-name","animation","animation-composition","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-range","animation-range-end","animation-range-start","animation-timeline","animation-timing-function","appearance","aspect-ratio","backdrop-filter","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-position-x","background-position-y","background-repeat","background-size","baseline-shift","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-end-end-radius","border-end-start-radius","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-start-end-radius","border-start-start-radius","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-align","box-decoration-break","box-direction","box-flex","box-flex-group","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","color-scheme","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","contain-intrinsic-block-size","contain-intrinsic-height","contain-intrinsic-inline-size","contain-intrinsic-size","contain-intrinsic-width","container","container-name","container-type","content","content-visibility","counter-increment","counter-reset","counter-set","cue","cue-after","cue-before","cursor","cx","cy","direction","display","dominant-baseline","empty-cells","enable-background","field-sizing","fill","fill-opacity","fill-rule","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flood-color","flood-opacity","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-optical-sizing","font-palette","font-size","font-size-adjust","font-smooth","font-smoothing","font-stretch","font-style","font-synthesis","font-synthesis-position","font-synthesis-small-caps","font-synthesis-style","font-synthesis-weight","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-emoji","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","forced-color-adjust","gap","glyph-orientation-horizontal","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphenate-character","hyphenate-limit-chars","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","initial-letter","initial-letter-align","inline-size","inset","inset-area","inset-block","inset-block-end","inset-block-start","inset-inline","inset-inline-end","inset-inline-start","isolation","justify-content","justify-items","justify-self","kerning","left","letter-spacing","lighting-color","line-break","line-height","line-height-step","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","margin-trim","marker","marker-end","marker-mid","marker-start","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","masonry-auto-flow","math-depth","math-shift","math-style","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","offset","offset-anchor","offset-distance","offset-path","offset-position","offset-rotate","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-anchor","overflow-block","overflow-clip-margin","overflow-inline","overflow-wrap","overflow-x","overflow-y","overlay","overscroll-behavior","overscroll-behavior-block","overscroll-behavior-inline","overscroll-behavior-x","overscroll-behavior-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","paint-order","pause","pause-after","pause-before","perspective","perspective-origin","place-content","place-items","place-self","pointer-events","position","position-anchor","position-visibility","print-color-adjust","quotes","r","resize","rest","rest-after","rest-before","right","rotate","row-gap","ruby-align","ruby-position","scale","scroll-behavior","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scroll-timeline","scroll-timeline-axis","scroll-timeline-name","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","shape-rendering","speak","speak-as","src","stop-color","stop-opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","tab-size","table-layout","text-align","text-align-all","text-align-last","text-anchor","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-skip-ink","text-decoration-style","text-decoration-thickness","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-size-adjust","text-transform","text-underline-offset","text-underline-position","text-wrap","text-wrap-mode","text-wrap-style","timeline-scope","top","touch-action","transform","transform-box","transform-origin","transform-style","transition","transition-behavior","transition-delay","transition-duration","transition-property","transition-timing-function","translate","unicode-bidi","user-modify","user-select","vector-effect","vertical-align","view-timeline","view-timeline-axis","view-timeline-inset","view-timeline-name","view-transition-name","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","white-space-collapse","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","x","y","z-index","zoom"].sort().reverse();function u(l){const c=l.regex,d=r(l),h={begin:/-(webkit|moz|ms|o)-(?=[a-z])/},f="and or not only",p=/@-?\w[\w]*(-\w+)*/,m="[a-zA-Z-][a-zA-Z0-9_-]*",v=[l.APOS_STRING_MODE,l.QUOTE_STRING_MODE];return{name:"CSS",case_insensitive:!0,illegal:/[=|'\$]/,keywords:{keyframePosition:"from to"},classNameAliases:{keyframePosition:"selector-tag"},contains:[d.BLOCK_COMMENT,h,d.CSS_NUMBER_MODE,{className:"selector-id",begin:/#[A-Za-z0-9_-]+/,relevance:0},{className:"selector-class",begin:"\\."+m,relevance:0},d.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",variants:[{begin:":("+s.join("|")+")"},{begin:":(:)?("+i.join("|")+")"}]},d.CSS_VARIABLE,{className:"attribute",begin:"\\b("+o.join("|")+")\\b"},{begin:/:/,end:/[;}{]/,contains:[d.BLOCK_COMMENT,d.HEXCOLOR,d.IMPORTANT,d.CSS_NUMBER_MODE,...v,{begin:/(url|data-uri)\(/,end:/\)/,relevance:0,keywords:{built_in:"url data-uri"},contains:[...v,{className:"string",begin:/[^)]/,endsWithParent:!0,excludeEnd:!0}]},d.FUNCTION_DISPATCH]},{begin:c.lookahead(/@/),end:"[{;]",relevance:0,illegal:/:/,contains:[{className:"keyword",begin:p},{begin:/\s/,endsWithParent:!0,excludeEnd:!0,relevance:0,keywords:{$pattern:/[a-z-]+/,keyword:f,attribute:a.join(" ")},contains:[{begin:/[a-z-]+(?=:)/,className:"attribute"},...v,d.CSS_NUMBER_MODE]}]},{className:"selector-tag",begin:"\\b("+n.join("|")+")\\b"}]}}return X0=u,X0}var Q0,S1;function dE(){if(S1)return Q0;S1=1;function r(e){const t=e.regex,n={begin:/<\/?[A-Za-z_]/,end:">",subLanguage:"xml",relevance:0},a={begin:"^[-\\*]{3,}",end:"$"},s={className:"code",variants:[{begin:"(`{3,})[^`](.|\\n)*?\\1`*[ ]*"},{begin:"(~{3,})[^~](.|\\n)*?\\1~*[ ]*"},{begin:"```",end:"```+[ ]*$"},{begin:"~~~",end:"~~~+[ ]*$"},{begin:"`.+?`"},{begin:"(?=^( {4}|\\t))",contains:[{begin:"^( {4}|\\t)",end:"(\\n)$"}],relevance:0}]},i={className:"bullet",begin:"^[ 	]*([*+-]|(\\d+\\.))(?=\\s+)",end:"\\s+",excludeEnd:!0},o={begin:/^\[[^\n]+\]:/,returnBegin:!0,contains:[{className:"symbol",begin:/\[/,end:/\]/,excludeBegin:!0,excludeEnd:!0},{className:"link",begin:/:\s*/,end:/$/,excludeBegin:!0}]},u=/[A-Za-z][A-Za-z0-9+.-]*/,l={variants:[{begin:/\[.+?\]\[.*?\]/,relevance:0},{begin:/\[.+?\]\(((data|javascript|mailto):|(?:http|ftp)s?:\/\/).*?\)/,relevance:2},{begin:t.concat(/\[.+?\]\(/,u,/:\/\/.*?\)/),relevance:2},{begin:/\[.+?\]\([./?&#].*?\)/,relevance:1},{begin:/\[.*?\]\(.*?\)/,relevance:0}],returnBegin:!0,contains:[{match:/\[(?=\])/},{className:"string",relevance:0,begin:"\\[",end:"\\]",excludeBegin:!0,returnEnd:!0},{className:"link",relevance:0,begin:"\\]\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0},{className:"symbol",relevance:0,begin:"\\]\\[",end:"\\]",excludeBegin:!0,excludeEnd:!0}]},c={className:"strong",contains:[],variants:[{begin:/_{2}(?!\s)/,end:/_{2}/},{begin:/\*{2}(?!\s)/,end:/\*{2}/}]},d={className:"emphasis",contains:[],variants:[{begin:/\*(?![*\s])/,end:/\*/},{begin:/_(?![_\s])/,end:/_/,relevance:0}]},h=e.inherit(c,{contains:[]}),f=e.inherit(d,{contains:[]});c.contains.push(f),d.contains.push(h);let p=[n,l];return[c,d,h,f].forEach(w=>{w.contains=w.contains.concat(p)}),p=p.concat(c,d),{name:"Markdown",aliases:["md","mkdown","mkd"],contains:[{className:"section",variants:[{begin:"^#{1,6}",end:"$",contains:p},{begin:"(?=^.+?\\n[=-]{2,}$)",contains:[{begin:"^[=-]*$"},{begin:"^",end:"\\n",contains:p}]}]},n,i,c,d,{className:"quote",begin:"^>\\s+",contains:p,end:"$"},s,a,l,o,{scope:"literal",match:/&([a-zA-Z0-9]+|#[0-9]{1,7}|#[Xx][0-9a-fA-F]{1,6});/}]}}return Q0=r,Q0}var ed,A1;function hE(){if(A1)return ed;A1=1;function r(e){const t=e.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:t.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:t.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}return ed=r,ed}var td,k1;function fE(){if(k1)return td;k1=1;function r(e){const t=e.regex,n="([a-zA-Z_]\\w*[!?=]?|[-+~]@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?)",a=t.either(/\b([A-Z]+[a-z0-9]+)+/,/\b([A-Z]+[a-z0-9]+)+[A-Z]+/),s=t.concat(a,/(::\w+)*/),o={"variable.constant":["__FILE__","__LINE__","__ENCODING__"],"variable.language":["self","super"],keyword:["alias","and","begin","BEGIN","break","case","class","defined","do","else","elsif","end","END","ensure","for","if","in","module","next","not","or","redo","require","rescue","retry","return","then","undef","unless","until","when","while","yield",...["include","extend","prepend","public","private","protected","raise","throw"]],built_in:["proc","lambda","attr_accessor","attr_reader","attr_writer","define_method","private_constant","module_function"],literal:["true","false","nil"]},u={className:"doctag",begin:"@[A-Za-z]+"},l={begin:"#<",end:">"},c=[e.COMMENT("#","$",{contains:[u]}),e.COMMENT("^=begin","^=end",{contains:[u],relevance:10}),e.COMMENT("^__END__",e.MATCH_NOTHING_RE)],d={className:"subst",begin:/#\{/,end:/\}/,keywords:o},h={className:"string",contains:[e.BACKSLASH_ESCAPE,d],variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/`/,end:/`/},{begin:/%[qQwWx]?\(/,end:/\)/},{begin:/%[qQwWx]?\[/,end:/\]/},{begin:/%[qQwWx]?\{/,end:/\}/},{begin:/%[qQwWx]?</,end:/>/},{begin:/%[qQwWx]?\//,end:/\//},{begin:/%[qQwWx]?%/,end:/%/},{begin:/%[qQwWx]?-/,end:/-/},{begin:/%[qQwWx]?\|/,end:/\|/},{begin:/\B\?(\\\d{1,3})/},{begin:/\B\?(\\x[A-Fa-f0-9]{1,2})/},{begin:/\B\?(\\u\{?[A-Fa-f0-9]{1,6}\}?)/},{begin:/\B\?(\\M-\\C-|\\M-\\c|\\c\\M-|\\M-|\\C-\\M-)[\x20-\x7e]/},{begin:/\B\?\\(c|C-)[\x20-\x7e]/},{begin:/\B\?\\?\S/},{begin:t.concat(/<<[-~]?'?/,t.lookahead(/(\w+)(?=\W)[^\n]*\n(?:[^\n]*\n)*?\s*\1\b/)),contains:[e.END_SAME_AS_BEGIN({begin:/(\w+)/,end:/(\w+)/,contains:[e.BACKSLASH_ESCAPE,d]})]}]},f="[1-9](_?[0-9])*|0",p="[0-9](_?[0-9])*",m={className:"number",relevance:0,variants:[{begin:`\\b(${f})(\\.(${p}))?([eE][+-]?(${p})|r)?i?\\b`},{begin:"\\b0[dD][0-9](_?[0-9])*r?i?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*r?i?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*r?i?\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*r?i?\\b"},{begin:"\\b0(_?[0-7])+r?i?\\b"}]},v={variants:[{match:/\(\)/},{className:"params",begin:/\(/,end:/(?=\))/,excludeBegin:!0,endsParent:!0,keywords:o}]},B=[h,{variants:[{match:[/class\s+/,s,/\s+<\s+/,s]},{match:[/\b(class|module)\s+/,s]}],scope:{2:"title.class",4:"title.class.inherited"},keywords:o},{match:[/(include|extend)\s+/,s],scope:{2:"title.class"},keywords:o},{relevance:0,match:[s,/\.new[. (]/],scope:{1:"title.class"}},{relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"},{relevance:0,match:a,scope:"title.class"},{match:[/def/,/\s+/,n],scope:{1:"keyword",3:"title.function"},contains:[v]},{begin:e.IDENT_RE+"::"},{className:"symbol",begin:e.UNDERSCORE_IDENT_RE+"(!|\\?)?:",relevance:0},{className:"symbol",begin:":(?!\\s)",contains:[h,{begin:n}],relevance:0},m,{className:"variable",begin:"(\\$\\W)|((\\$|@@?)(\\w+))(?=[^@$?])(?![A-Za-z])(?![@$?'])"},{className:"params",begin:/\|(?!=)/,end:/\|/,excludeBegin:!0,excludeEnd:!0,relevance:0,keywords:o},{begin:"("+e.RE_STARTERS_RE+"|unless)\\s*",keywords:"unless",contains:[{className:"regexp",contains:[e.BACKSLASH_ESCAPE,d],illegal:/\n/,variants:[{begin:"/",end:"/[a-z]*"},{begin:/%r\{/,end:/\}[a-z]*/},{begin:"%r\\(",end:"\\)[a-z]*"},{begin:"%r!",end:"![a-z]*"},{begin:"%r\\[",end:"\\][a-z]*"}]}].concat(l,c),relevance:0}].concat(l,c);d.contains=B,v.contains=B;const G=[{begin:/^\s*=>/,starts:{end:"$",contains:B}},{className:"meta.prompt",begin:"^("+"[>?]>"+"|"+"[\\w#]+\\(\\w+\\):\\d+:\\d+[>*]"+"|"+"(\\w+-)?\\d+\\.\\d+\\.\\d+(p\\d+)?[^\\d][^>]+>"+")(?=[ ])",starts:{end:"$",keywords:o,contains:B}}];return c.unshift(l),{name:"Ruby",aliases:["rb","gemspec","podspec","thor","irb"],keywords:o,illegal:/\/\*/,contains:[e.SHEBANG({binary:"ruby"})].concat(G).concat(c).concat(B)}}return td=r,td}var rd,C1;function pE(){if(C1)return rd;C1=1;function r(e){const i={keyword:["break","case","chan","const","continue","default","defer","else","fallthrough","for","func","go","goto","if","import","interface","map","package","range","return","select","struct","switch","type","var"],type:["bool","byte","complex64","complex128","error","float32","float64","int8","int16","int32","int64","string","uint8","uint16","uint32","uint64","int","uint","uintptr","rune"],literal:["true","false","iota","nil"],built_in:["append","cap","close","complex","copy","imag","len","make","new","panic","print","println","real","recover","delete"]};return{name:"Go",aliases:["golang"],keywords:i,illegal:"</",contains:[e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE,{className:"string",variants:[e.QUOTE_STRING_MODE,e.APOS_STRING_MODE,{begin:"`",end:"`"}]},{className:"number",variants:[{match:/-?\b0[xX]\.[a-fA-F0-9](_?[a-fA-F0-9])*[pP][+-]?\d(_?\d)*i?/,relevance:0},{match:/-?\b0[xX](_?[a-fA-F0-9])+((\.([a-fA-F0-9](_?[a-fA-F0-9])*)?)?[pP][+-]?\d(_?\d)*)?i?/,relevance:0},{match:/-?\b0[oO](_?[0-7])*i?/,relevance:0},{match:/-?\.\d(_?\d)*([eE][+-]?\d(_?\d)*)?i?/,relevance:0},{match:/-?\b\d(_?\d)*(\.(\d(_?\d)*)?)?([eE][+-]?\d(_?\d)*)?i?/,relevance:0}]},{begin:/:=/},{className:"function",beginKeywords:"func",end:"\\s*(\\{|$)",excludeEnd:!0,contains:[e.TITLE_MODE,{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:i,illegal:/["']/}]}]}}return rd=r,rd}var nd,T1;function mE(){if(T1)return nd;T1=1;function r(e){const t=e.regex,n=/[_A-Za-z][_0-9A-Za-z]*/;return{name:"GraphQL",aliases:["gql"],case_insensitive:!0,disableAutodetect:!1,keywords:{keyword:["query","mutation","subscription","type","input","schema","directive","interface","union","scalar","fragment","enum","on"],literal:["true","false","null"]},contains:[e.HASH_COMMENT_MODE,e.QUOTE_STRING_MODE,e.NUMBER_MODE,{scope:"punctuation",match:/[.]{3}/,relevance:0},{scope:"punctuation",begin:/[\!\(\)\:\=\[\]\{\|\}]{1}/,relevance:0},{scope:"variable",begin:/\$/,end:/\W/,excludeEnd:!0,relevance:0},{scope:"meta",match:/@\w+/,excludeEnd:!0},{scope:"symbol",begin:t.concat(n,t.lookahead(/\s*:/)),relevance:0}],illegal:[/[;<']/,/BEGIN/]}}return nd=r,nd}var ad,F1;function gE(){if(F1)return ad;F1=1;function r(e){const t=e.regex,n={className:"number",relevance:0,variants:[{begin:/([+-]+)?[\d]+_[\d_]+/},{begin:e.NUMBER_RE}]},a=e.COMMENT();a.variants=[{begin:/;/,end:/$/},{begin:/#/,end:/$/}];const s={className:"variable",variants:[{begin:/\$[\w\d"][\w\d_]*/},{begin:/\$\{(.*?)\}/}]},i={className:"literal",begin:/\bon|off|true|false|yes|no\b/},o={className:"string",contains:[e.BACKSLASH_ESCAPE],variants:[{begin:"'''",end:"'''",relevance:10},{begin:'"""',end:'"""',relevance:10},{begin:'"',end:'"'},{begin:"'",end:"'"}]},u={begin:/\[/,end:/\]/,contains:[a,i,s,o,n,"self"],relevance:0},l=/[A-Za-z0-9_-]+/,c=/"(\\"|[^"])*"/,d=/'[^']*'/,h=t.either(l,c,d),f=t.concat(h,"(\\s*\\.\\s*",h,")*",t.lookahead(/\s*=\s*[^#\s]/));return{name:"TOML, also INI",aliases:["toml"],case_insensitive:!0,illegal:/\S/,contains:[a,{className:"section",begin:/\[+/,end:/\]+/},{begin:f,className:"attr",starts:{end:/$/,contains:[a,u,i,s,o,n]}}]}}return ad=r,ad}var sd,N1;function yE(){if(N1)return sd;N1=1;var r="[0-9](_*[0-9])*",e=`\\.(${r})`,t="[0-9a-fA-F](_*[0-9a-fA-F])*",n={className:"number",variants:[{begin:`(\\b(${r})((${e})|\\.)?|(${e}))[eE][+-]?(${r})[fFdD]?\\b`},{begin:`\\b(${r})((${e})[fFdD]?\\b|\\.([fFdD]\\b)?)`},{begin:`(${e})[fFdD]?\\b`},{begin:`\\b(${r})[fFdD]\\b`},{begin:`\\b0[xX]((${t})\\.?|(${t})?\\.(${t}))[pP][+-]?(${r})[fFdD]?\\b`},{begin:"\\b(0|[1-9](_*[0-9])*)[lL]?\\b"},{begin:`\\b0[xX](${t})[lL]?\\b`},{begin:"\\b0(_*[0-7])*[lL]?\\b"},{begin:"\\b0[bB][01](_*[01])*[lL]?\\b"}],relevance:0};function a(i,o,u){return u===-1?"":i.replace(o,l=>a(i,o,u-1))}function s(i){const o=i.regex,u="[\xC0-\u02B8a-zA-Z_$][\xC0-\u02B8a-zA-Z_$0-9]*",l=u+a("(?:<"+u+"~~~(?:\\s*,\\s*"+u+"~~~)*>)?",/~~~/g,2),p={keyword:["synchronized","abstract","private","var","static","if","const ","for","while","strictfp","finally","protected","import","native","final","void","enum","else","break","transient","catch","instanceof","volatile","case","assert","package","default","public","try","switch","continue","throws","protected","public","private","module","requires","exports","do","sealed","yield","permits","goto","when"],literal:["false","true","null"],type:["char","boolean","long","float","int","byte","short","double"],built_in:["super","this"]},m={className:"meta",begin:"@"+u,contains:[{begin:/\(/,end:/\)/,contains:["self"]}]},v={className:"params",begin:/\(/,end:/\)/,keywords:p,relevance:0,contains:[i.C_BLOCK_COMMENT_MODE],endsParent:!0};return{name:"Java",aliases:["jsp"],keywords:p,illegal:/<\/|#/,contains:[i.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{begin:/\w+@/,relevance:0},{className:"doctag",begin:"@[A-Za-z]+"}]}),{begin:/import java\.[a-z]+\./,keywords:"import",relevance:2},i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE,{begin:/"""/,end:/"""/,className:"string",contains:[i.BACKSLASH_ESCAPE]},i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,{match:[/\b(?:class|interface|enum|extends|implements|new)/,/\s+/,u],className:{1:"keyword",3:"title.class"}},{match:/non-sealed/,scope:"keyword"},{begin:[o.concat(/(?!else)/,u),/\s+/,u,/\s+/,/=(?!=)/],className:{1:"type",3:"variable",5:"operator"}},{begin:[/record/,/\s+/,u],className:{1:"keyword",3:"title.class"},contains:[v,i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},{beginKeywords:"new throw return else",relevance:0},{begin:["(?:"+l+"\\s+)",i.UNDERSCORE_IDENT_RE,/\s*(?=\()/],className:{2:"title.function"},keywords:p,contains:[{className:"params",begin:/\(/,end:/\)/,keywords:p,relevance:0,contains:[m,i.APOS_STRING_MODE,i.QUOTE_STRING_MODE,n,i.C_BLOCK_COMMENT_MODE]},i.C_LINE_COMMENT_MODE,i.C_BLOCK_COMMENT_MODE]},n,m]}}return sd=s,sd}var id,I1;function vE(){if(I1)return id;I1=1;const r="[A-Za-z$_][0-9A-Za-z$_]*",e=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends","using"],t=["true","false","null","undefined","NaN","Infinity"],n=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],a=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],s=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],i=["arguments","this","super","console","window","document","localStorage","sessionStorage","module","global"],o=[].concat(s,n,a);function u(l){const c=l.regex,d=(x,{after:q})=>{const $="</"+x[0].slice(1);return x.input.indexOf($,q)!==-1},h=r,f={begin:"<>",end:"</>"},p=/<[A-Za-z0-9\\._:-]+\s*\/>/,m={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(x,q)=>{const $=x[0].length+x.index,Ee=x.input[$];if(Ee==="<"||Ee===","){q.ignoreMatch();return}Ee===">"&&(d(x,{after:$})||q.ignoreMatch());let Ve;const at=x.input.substring($);if(Ve=at.match(/^\s*=/)){q.ignoreMatch();return}if((Ve=at.match(/^\s+extends\s+/))&&Ve.index===0){q.ignoreMatch();return}}},v={$pattern:r,keyword:e,literal:t,built_in:o,"variable.language":i},_="[0-9](_?[0-9])*",w=`\\.(${_})`,E="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",F={className:"number",variants:[{begin:`(\\b(${E})((${w})|\\.)?|(${w}))[eE][+-]?(${_})\\b`},{begin:`\\b(${E})\\b((${w})\\b|\\.)?|(${w})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},k={className:"subst",begin:"\\$\\{",end:"\\}",keywords:v,contains:[]},N={begin:".?html`",end:"",starts:{end:"`",returnEnd:!1,contains:[l.BACKSLASH_ESCAPE,k],subLanguage:"xml"}},B={begin:".?css`",end:"",starts:{end:"`",returnEnd:!1,contains:[l.BACKSLASH_ESCAPE,k],subLanguage:"css"}},A={begin:".?gql`",end:"",starts:{end:"`",returnEnd:!1,contains:[l.BACKSLASH_ESCAPE,k],subLanguage:"graphql"}},L={className:"string",begin:"`",end:"`",contains:[l.BACKSLASH_ESCAPE,k]},G={className:"comment",variants:[l.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:h+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),l.C_BLOCK_COMMENT_MODE,l.C_LINE_COMMENT_MODE]},te=[l.APOS_STRING_MODE,l.QUOTE_STRING_MODE,N,B,A,L,{match:/\$\d+/},F];k.contains=te.concat({begin:/\{/,end:/\}/,keywords:v,contains:["self"].concat(te)});const ve=[].concat(G,k.contains),D=ve.concat([{begin:/(\s*)\(/,end:/\)/,keywords:v,contains:["self"].concat(ve)}]),M={className:"params",begin:/(\s*)\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:v,contains:D},P={variants:[{match:[/class/,/\s+/,h,/\s+/,/extends/,/\s+/,c.concat(h,"(",c.concat(/\./,h),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,h],scope:{1:"keyword",3:"title.class"}}]},Z={relevance:0,match:c.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...n,...a]}},W={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},X={variants:[{match:[/function/,/\s+/,h,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[M],illegal:/%/},Y={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function re(x){return c.concat("(?!",x.join("|"),")")}const U={match:c.concat(/\b/,re([...s,"super","import"].map(x=>`${x}\\s*\\(`)),h,c.lookahead(/\s*\(/)),className:"title.function",relevance:0},j={begin:c.concat(/\./,c.lookahead(c.concat(h,/(?![0-9A-Za-z$_(])/))),end:h,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},ae={match:[/get|set/,/\s+/,h,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},M]},Q="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+l.UNDERSCORE_IDENT_RE+")\\s*=>",C={match:[/const|var|let/,/\s+/,h,/\s*/,/=\s*/,/(async\s*)?/,c.lookahead(Q)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[M]};return{name:"JavaScript",aliases:["js","jsx","mjs","cjs"],keywords:v,exports:{PARAMS_CONTAINS:D,CLASS_REFERENCE:Z},illegal:/#(?![$_A-z])/,contains:[l.SHEBANG({label:"shebang",binary:"node",relevance:5}),W,l.APOS_STRING_MODE,l.QUOTE_STRING_MODE,N,B,A,L,G,{match:/\$\d+/},F,Z,{scope:"attr",match:h+c.lookahead(":"),relevance:0},C,{begin:"("+l.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[G,l.REGEXP_MODE,{className:"function",begin:Q,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:l.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/(\s*)\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:v,contains:D}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:f.begin,end:f.end},{match:p},{begin:m.begin,"on:begin":m.isTrulyOpeningTag,end:m.end}],subLanguage:"xml",contains:[{begin:m.begin,end:m.end,skip:!0,contains:["self"]}]}]},X,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+l.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[M,l.inherit(l.TITLE_MODE,{begin:h,className:"title.function"})]},{match:/\.\.\./,relevance:0},j,{match:"\\$"+h,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[M]},U,Y,P,ae,{match:/\$[(.]/}]}}return id=u,id}var od,O1;function _E(){if(O1)return od;O1=1;function r(e){const t={className:"attr",begin:/"(\\.|[^\\"\r\n])*"(?=\s*:)/,relevance:1.01},n={match:/[{}[\],:]/,className:"punctuation",relevance:0},a=["true","false","null"],s={scope:"literal",beginKeywords:a.join(" ")};return{name:"JSON",aliases:["jsonc"],keywords:{literal:a},contains:[t,n,e.QUOTE_STRING_MODE,s,e.C_NUMBER_MODE,e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE],illegal:"\\S"}}return od=r,od}var ud,R1;function bE(){if(R1)return ud;R1=1;var r="[0-9](_*[0-9])*",e=`\\.(${r})`,t="[0-9a-fA-F](_*[0-9a-fA-F])*",n={className:"number",variants:[{begin:`(\\b(${r})((${e})|\\.)?|(${e}))[eE][+-]?(${r})[fFdD]?\\b`},{begin:`\\b(${r})((${e})[fFdD]?\\b|\\.([fFdD]\\b)?)`},{begin:`(${e})[fFdD]?\\b`},{begin:`\\b(${r})[fFdD]\\b`},{begin:`\\b0[xX]((${t})\\.?|(${t})?\\.(${t}))[pP][+-]?(${r})[fFdD]?\\b`},{begin:"\\b(0|[1-9](_*[0-9])*)[lL]?\\b"},{begin:`\\b0[xX](${t})[lL]?\\b`},{begin:"\\b0(_*[0-7])*[lL]?\\b"},{begin:"\\b0[bB][01](_*[01])*[lL]?\\b"}],relevance:0};function a(s){const i={keyword:"abstract as val var vararg get set class object open private protected public noinline crossinline dynamic final enum if else do while for when throw try catch finally import package is in fun override companion reified inline lateinit init interface annotation data sealed internal infix operator out by constructor super tailrec where const inner suspend typealias external expect actual",built_in:"Byte Short Char Int Long Boolean Float Double Void Unit Nothing",literal:"true false null"},o={className:"keyword",begin:/\b(break|continue|return|this)\b/,starts:{contains:[{className:"symbol",begin:/@\w+/}]}},u={className:"symbol",begin:s.UNDERSCORE_IDENT_RE+"@"},l={className:"subst",begin:/\$\{/,end:/\}/,contains:[s.C_NUMBER_MODE]},c={className:"variable",begin:"\\$"+s.UNDERSCORE_IDENT_RE},d={className:"string",variants:[{begin:'"""',end:'"""(?=[^"])',contains:[c,l]},{begin:"'",end:"'",illegal:/\n/,contains:[s.BACKSLASH_ESCAPE]},{begin:'"',end:'"',illegal:/\n/,contains:[s.BACKSLASH_ESCAPE,c,l]}]};l.contains.push(d);const h={className:"meta",begin:"@(?:file|property|field|get|set|receiver|param|setparam|delegate)\\s*:(?:\\s*"+s.UNDERSCORE_IDENT_RE+")?"},f={className:"meta",begin:"@"+s.UNDERSCORE_IDENT_RE,contains:[{begin:/\(/,end:/\)/,contains:[s.inherit(d,{className:"string"}),"self"]}]},p=n,m=s.COMMENT("/\\*","\\*/",{contains:[s.C_BLOCK_COMMENT_MODE]}),v={variants:[{className:"type",begin:s.UNDERSCORE_IDENT_RE},{begin:/\(/,end:/\)/,contains:[]}]},_=v;return _.variants[1].contains=[v],v.variants[1].contains=[_],{name:"Kotlin",aliases:["kt","kts"],keywords:i,contains:[s.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"}]}),s.C_LINE_COMMENT_MODE,m,o,u,h,f,{className:"function",beginKeywords:"fun",end:"[(]|$",returnBegin:!0,excludeEnd:!0,keywords:i,relevance:5,contains:[{begin:s.UNDERSCORE_IDENT_RE+"\\s*\\(",returnBegin:!0,relevance:0,contains:[s.UNDERSCORE_TITLE_MODE]},{className:"type",begin:/</,end:/>/,keywords:"reified",relevance:0},{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:i,relevance:0,contains:[{begin:/:/,end:/[=,\/]/,endsWithParent:!0,contains:[v,s.C_LINE_COMMENT_MODE,m],relevance:0},s.C_LINE_COMMENT_MODE,m,h,f,d,s.C_NUMBER_MODE]},m]},{begin:[/class|interface|trait/,/\s+/,s.UNDERSCORE_IDENT_RE],beginScope:{3:"title.class"},keywords:"class interface trait",end:/[:\{(]|$/,excludeEnd:!0,illegal:"extends implements",contains:[{beginKeywords:"public protected internal private constructor"},s.UNDERSCORE_TITLE_MODE,{className:"type",begin:/</,end:/>/,excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:/[,:]\s*/,end:/[<\(,){\s]|$/,excludeBegin:!0,returnEnd:!0},h,f]},d,{className:"meta",begin:"^#!/usr/bin/env",end:"$",illegal:`
`},p]}}return ud=a,ud}var ld,D1;function wE(){if(D1)return ld;D1=1;const r=c=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:c.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[c.APOS_STRING_MODE,c.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:c.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z_][A-Za-z0-9_-]*/}}),e=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","optgroup","option","p","picture","q","quote","samp","section","select","source","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],t=["defs","g","marker","mask","pattern","svg","switch","symbol","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feGaussianBlur","feImage","feMerge","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","linearGradient","radialGradient","stop","circle","ellipse","image","line","path","polygon","polyline","rect","text","use","textPath","tspan","foreignObject","clipPath"],n=[...e,...t],a=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"].sort().reverse(),s=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"].sort().reverse(),i=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"].sort().reverse(),o=["accent-color","align-content","align-items","align-self","alignment-baseline","all","anchor-name","animation","animation-composition","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-range","animation-range-end","animation-range-start","animation-timeline","animation-timing-function","appearance","aspect-ratio","backdrop-filter","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-position-x","background-position-y","background-repeat","background-size","baseline-shift","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-end-end-radius","border-end-start-radius","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-start-end-radius","border-start-start-radius","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-align","box-decoration-break","box-direction","box-flex","box-flex-group","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","color-scheme","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","contain-intrinsic-block-size","contain-intrinsic-height","contain-intrinsic-inline-size","contain-intrinsic-size","contain-intrinsic-width","container","container-name","container-type","content","content-visibility","counter-increment","counter-reset","counter-set","cue","cue-after","cue-before","cursor","cx","cy","direction","display","dominant-baseline","empty-cells","enable-background","field-sizing","fill","fill-opacity","fill-rule","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flood-color","flood-opacity","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-optical-sizing","font-palette","font-size","font-size-adjust","font-smooth","font-smoothing","font-stretch","font-style","font-synthesis","font-synthesis-position","font-synthesis-small-caps","font-synthesis-style","font-synthesis-weight","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-emoji","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","forced-color-adjust","gap","glyph-orientation-horizontal","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphenate-character","hyphenate-limit-chars","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","initial-letter","initial-letter-align","inline-size","inset","inset-area","inset-block","inset-block-end","inset-block-start","inset-inline","inset-inline-end","inset-inline-start","isolation","justify-content","justify-items","justify-self","kerning","left","letter-spacing","lighting-color","line-break","line-height","line-height-step","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","margin-trim","marker","marker-end","marker-mid","marker-start","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","masonry-auto-flow","math-depth","math-shift","math-style","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","offset","offset-anchor","offset-distance","offset-path","offset-position","offset-rotate","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-anchor","overflow-block","overflow-clip-margin","overflow-inline","overflow-wrap","overflow-x","overflow-y","overlay","overscroll-behavior","overscroll-behavior-block","overscroll-behavior-inline","overscroll-behavior-x","overscroll-behavior-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","paint-order","pause","pause-after","pause-before","perspective","perspective-origin","place-content","place-items","place-self","pointer-events","position","position-anchor","position-visibility","print-color-adjust","quotes","r","resize","rest","rest-after","rest-before","right","rotate","row-gap","ruby-align","ruby-position","scale","scroll-behavior","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scroll-timeline","scroll-timeline-axis","scroll-timeline-name","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","shape-rendering","speak","speak-as","src","stop-color","stop-opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","tab-size","table-layout","text-align","text-align-all","text-align-last","text-anchor","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-skip-ink","text-decoration-style","text-decoration-thickness","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-size-adjust","text-transform","text-underline-offset","text-underline-position","text-wrap","text-wrap-mode","text-wrap-style","timeline-scope","top","touch-action","transform","transform-box","transform-origin","transform-style","transition","transition-behavior","transition-delay","transition-duration","transition-property","transition-timing-function","translate","unicode-bidi","user-modify","user-select","vector-effect","vertical-align","view-timeline","view-timeline-axis","view-timeline-inset","view-timeline-name","view-transition-name","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","white-space-collapse","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","x","y","z-index","zoom"].sort().reverse(),u=s.concat(i).sort().reverse();function l(c){const d=r(c),h=u,f="and or not only",p="[\\w-]+",m="("+p+"|@\\{"+p+"\\})",v=[],_=[],w=function(ve){return{className:"string",begin:"~?"+ve+".*?"+ve}},E=function(ve,D,M){return{className:ve,begin:D,relevance:M}},F={$pattern:/[a-z-]+/,keyword:f,attribute:a.join(" ")},k={begin:"\\(",end:"\\)",contains:_,keywords:F,relevance:0};_.push(c.C_LINE_COMMENT_MODE,c.C_BLOCK_COMMENT_MODE,w("'"),w('"'),d.CSS_NUMBER_MODE,{begin:"(url|data-uri)\\(",starts:{className:"string",end:"[\\)\\n]",excludeEnd:!0}},d.HEXCOLOR,k,E("variable","@@?"+p,10),E("variable","@\\{"+p+"\\}"),E("built_in","~?`[^`]*?`"),{className:"attribute",begin:p+"\\s*:",end:":",returnBegin:!0,excludeEnd:!0},d.IMPORTANT,{beginKeywords:"and not"},d.FUNCTION_DISPATCH);const N=_.concat({begin:/\{/,end:/\}/,contains:v}),B={beginKeywords:"when",endsWithParent:!0,contains:[{beginKeywords:"and not"}].concat(_)},A={begin:m+"\\s*:",returnBegin:!0,end:/[;}]/,relevance:0,contains:[{begin:/-(webkit|moz|ms|o)-/},d.CSS_VARIABLE,{className:"attribute",begin:"\\b("+o.join("|")+")\\b",end:/(?=:)/,starts:{endsWithParent:!0,illegal:"[<=$]",relevance:0,contains:_}}]},L={className:"keyword",begin:"@(import|media|charset|font-face|(-[a-z]+-)?keyframes|supports|document|namespace|page|viewport|host)\\b",starts:{end:"[;{}]",keywords:F,returnEnd:!0,contains:_,relevance:0}},V={className:"variable",variants:[{begin:"@"+p+"\\s*:",relevance:15},{begin:"@"+p}],starts:{end:"[;}]",returnEnd:!0,contains:N}},G={variants:[{begin:"[\\.#:&\\[>]",end:"[;{}]"},{begin:m,end:/\{/}],returnBegin:!0,returnEnd:!0,illegal:`[<='$"]`,relevance:0,contains:[c.C_LINE_COMMENT_MODE,c.C_BLOCK_COMMENT_MODE,B,E("keyword","all\\b"),E("variable","@\\{"+p+"\\}"),{begin:"\\b("+n.join("|")+")\\b",className:"selector-tag"},d.CSS_NUMBER_MODE,E("selector-tag",m,0),E("selector-id","#"+m),E("selector-class","\\."+m,0),E("selector-tag","&",0),d.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",begin:":("+s.join("|")+")"},{className:"selector-pseudo",begin:":(:)?("+i.join("|")+")"},{begin:/\(/,end:/\)/,relevance:0,contains:N},{begin:"!important"},d.FUNCTION_DISPATCH]},te={begin:p+`:(:)?(${h.join("|")})`,returnBegin:!0,contains:[G]};return v.push(c.C_LINE_COMMENT_MODE,c.C_BLOCK_COMMENT_MODE,L,V,te,A,G,B,d.FUNCTION_DISPATCH),{name:"Less",case_insensitive:!0,illegal:`[=>'/<($"]`,contains:v}}return ld=l,ld}var cd,B1;function EE(){if(B1)return cd;B1=1;function r(e){const t="\\[=*\\[",n="\\]=*\\]",a={begin:t,end:n,contains:["self"]},s=[e.COMMENT("--(?!"+t+")","$"),e.COMMENT("--"+t,n,{contains:[a],relevance:10})];return{name:"Lua",aliases:["pluto"],keywords:{$pattern:e.UNDERSCORE_IDENT_RE,literal:"true false nil",keyword:"and break do else elseif end for goto if in local not or repeat return then until while",built_in:"_G _ENV _VERSION __index __newindex __mode __call __metatable __tostring __len __gc __add __sub __mul __div __mod __pow __concat __unm __eq __lt __le assert collectgarbage dofile error getfenv getmetatable ipairs load loadfile loadstring module next pairs pcall print rawequal rawget rawset require select setfenv setmetatable tonumber tostring type unpack xpcall arg self coroutine resume yield status wrap create running debug getupvalue debug sethook getmetatable gethook setmetatable setlocal traceback setfenv getinfo setupvalue getlocal getregistry getfenv io lines write close flush open output type read stderr stdin input stdout popen tmpfile math log max acos huge ldexp pi cos tanh pow deg tan cosh sinh random randomseed frexp ceil floor rad abs sqrt modf asin min mod fmod log10 atan2 exp sin atan os exit setlocale date getenv difftime remove time clock tmpname rename execute package preload loadlib loaded loaders cpath config path seeall string sub upper len gfind rep find match char dump gmatch reverse byte format gsub lower table setn insert getn foreachi maxn foreach concat sort remove"},contains:s.concat([{className:"function",beginKeywords:"function",end:"\\)",contains:[e.inherit(e.TITLE_MODE,{begin:"([_a-zA-Z]\\w*\\.)*([_a-zA-Z]\\w*:)?[_a-zA-Z]\\w*"}),{className:"params",begin:"\\(",endsWithParent:!0,contains:s}].concat(s)},e.C_NUMBER_MODE,e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,{className:"string",begin:t,end:n,contains:[a],relevance:5}])}}return cd=r,cd}var dd,M1;function xE(){if(M1)return dd;M1=1;function r(e){const t={className:"variable",variants:[{begin:"\\$\\("+e.UNDERSCORE_IDENT_RE+"\\)",contains:[e.BACKSLASH_ESCAPE]},{begin:/\$[@%<?\^\+\*]/}]},n={className:"string",begin:/"/,end:/"/,contains:[e.BACKSLASH_ESCAPE,t]},a={className:"variable",begin:/\$\([\w-]+\s/,end:/\)/,keywords:{built_in:"subst patsubst strip findstring filter filter-out sort word wordlist firstword lastword dir notdir suffix basename addsuffix addprefix join wildcard realpath abspath error warning shell origin flavor foreach if or and call eval file value"},contains:[t,n]},s={begin:"^"+e.UNDERSCORE_IDENT_RE+"\\s*(?=[:+?]?=)"},i={className:"meta",begin:/^\.PHONY:/,end:/$/,keywords:{$pattern:/[\.\w]+/,keyword:".PHONY"}},o={className:"section",begin:/^[^\s]+:/,end:/$/,contains:[t]};return{name:"Makefile",aliases:["mk","mak","make"],keywords:{$pattern:/[\w-]+/,keyword:"define endef undefine ifdef ifndef ifeq ifneq else endif include -include sinclude override export unexport private vpath"},contains:[e.HASH_COMMENT_MODE,t,n,a,s,i,o]}}return dd=r,dd}var hd,$1;function SE(){if($1)return hd;$1=1;function r(e){const t=e.regex,n=["abs","accept","alarm","and","atan2","bind","binmode","bless","break","caller","chdir","chmod","chomp","chop","chown","chr","chroot","class","close","closedir","connect","continue","cos","crypt","dbmclose","dbmopen","defined","delete","die","do","dump","each","else","elsif","endgrent","endhostent","endnetent","endprotoent","endpwent","endservent","eof","eval","exec","exists","exit","exp","fcntl","field","fileno","flock","for","foreach","fork","format","formline","getc","getgrent","getgrgid","getgrnam","gethostbyaddr","gethostbyname","gethostent","getlogin","getnetbyaddr","getnetbyname","getnetent","getpeername","getpgrp","getpriority","getprotobyname","getprotobynumber","getprotoent","getpwent","getpwnam","getpwuid","getservbyname","getservbyport","getservent","getsockname","getsockopt","given","glob","gmtime","goto","grep","gt","hex","if","index","int","ioctl","join","keys","kill","last","lc","lcfirst","length","link","listen","local","localtime","log","lstat","lt","ma","map","method","mkdir","msgctl","msgget","msgrcv","msgsnd","my","ne","next","no","not","oct","open","opendir","or","ord","our","pack","package","pipe","pop","pos","print","printf","prototype","push","q|0","qq","quotemeta","qw","qx","rand","read","readdir","readline","readlink","readpipe","recv","redo","ref","rename","require","reset","return","reverse","rewinddir","rindex","rmdir","say","scalar","seek","seekdir","select","semctl","semget","semop","send","setgrent","sethostent","setnetent","setpgrp","setpriority","setprotoent","setpwent","setservent","setsockopt","shift","shmctl","shmget","shmread","shmwrite","shutdown","sin","sleep","socket","socketpair","sort","splice","split","sprintf","sqrt","srand","stat","state","study","sub","substr","symlink","syscall","sysopen","sysread","sysseek","system","syswrite","tell","telldir","tie","tied","time","times","tr","truncate","uc","ucfirst","umask","undef","unless","unlink","unpack","unshift","untie","until","use","utime","values","vec","wait","waitpid","wantarray","warn","when","while","write","x|0","xor","y|0"],a=/[dualxmsipngr]{0,12}/,s={$pattern:/[\w.]+/,keyword:n.join(" ")},i={className:"subst",begin:"[$@]\\{",end:"\\}",keywords:s},o={begin:/->\{/,end:/\}/},u={scope:"attr",match:/\s+:\s*\w+(\s*\(.*?\))?/},l={scope:"variable",variants:[{begin:/\$\d/},{begin:t.concat(/[$%@](?!")(\^\w\b|#\w+(::\w+)*|\{\w+\}|\w+(::\w*)*)/,"(?![A-Za-z])(?![@$%])")},{begin:/[$%@](?!")[^\s\w{=]|\$=/,relevance:0}],contains:[u]},c={className:"number",variants:[{match:/0?\.[0-9][0-9_]+\b/},{match:/\bv?(0|[1-9][0-9_]*(\.[0-9_]+)?|[1-9][0-9_]*)\b/},{match:/\b0[0-7][0-7_]*\b/},{match:/\b0x[0-9a-fA-F][0-9a-fA-F_]*\b/},{match:/\b0b[0-1][0-1_]*\b/}],relevance:0},d=[e.BACKSLASH_ESCAPE,i,l],h=[/!/,/\//,/\|/,/\?/,/'/,/"/,/#/],f=(v,_,w="\\1")=>{const E=w==="\\1"?w:t.concat(w,_);return t.concat(t.concat("(?:",v,")"),_,/(?:\\.|[^\\\/])*?/,E,/(?:\\.|[^\\\/])*?/,w,a)},p=(v,_,w)=>t.concat(t.concat("(?:",v,")"),_,/(?:\\.|[^\\\/])*?/,w,a),m=[l,e.HASH_COMMENT_MODE,e.COMMENT(/^=\w/,/=cut/,{endsWithParent:!0}),o,{className:"string",contains:d,variants:[{begin:"q[qwxr]?\\s*\\(",end:"\\)",relevance:5},{begin:"q[qwxr]?\\s*\\[",end:"\\]",relevance:5},{begin:"q[qwxr]?\\s*\\{",end:"\\}",relevance:5},{begin:"q[qwxr]?\\s*\\|",end:"\\|",relevance:5},{begin:"q[qwxr]?\\s*<",end:">",relevance:5},{begin:"qw\\s+q",end:"q",relevance:5},{begin:"'",end:"'",contains:[e.BACKSLASH_ESCAPE]},{begin:'"',end:'"'},{begin:"`",end:"`",contains:[e.BACKSLASH_ESCAPE]},{begin:/\{\w+\}/,relevance:0},{begin:"-?\\w+\\s*=>",relevance:0}]},c,{begin:"(\\/\\/|"+e.RE_STARTERS_RE+"|\\b(split|return|print|reverse|grep)\\b)\\s*",keywords:"split return print reverse grep",relevance:0,contains:[e.HASH_COMMENT_MODE,{className:"regexp",variants:[{begin:f("s|tr|y",t.either(...h,{capture:!0}))},{begin:f("s|tr|y","\\(","\\)")},{begin:f("s|tr|y","\\[","\\]")},{begin:f("s|tr|y","\\{","\\}")}],relevance:2},{className:"regexp",variants:[{begin:/(m|qr)\/\//,relevance:0},{begin:p("(?:m|qr)?",/\//,/\//)},{begin:p("m|qr",t.either(...h,{capture:!0}),/\1/)},{begin:p("m|qr",/\(/,/\)/)},{begin:p("m|qr",/\[/,/\]/)},{begin:p("m|qr",/\{/,/\}/)}]}]},{className:"function",beginKeywords:"sub method",end:"(\\s*\\(.*?\\))?[;{]",excludeEnd:!0,relevance:5,contains:[e.TITLE_MODE,u]},{className:"class",beginKeywords:"class",end:"[;{]",excludeEnd:!0,relevance:5,contains:[e.TITLE_MODE,u,c]},{begin:"-\\w\\b",relevance:0},{begin:"^__DATA__$",end:"^__END__$",subLanguage:"mojolicious",contains:[{begin:"^@@.*",end:"$",className:"comment"}]}];return i.contains=m,o.contains=m,{name:"Perl",aliases:["pl","pm"],keywords:s,contains:m}}return hd=r,hd}var fd,P1;function AE(){if(P1)return fd;P1=1;function r(e){const t={className:"built_in",begin:"\\b(AV|CA|CF|CG|CI|CL|CM|CN|CT|MK|MP|MTK|MTL|NS|SCN|SK|UI|WK|XC)\\w+"},n=/[a-zA-Z@][a-zA-Z0-9_]*/,u={"variable.language":["this","super"],$pattern:n,keyword:["while","export","sizeof","typedef","const","struct","for","union","volatile","static","mutable","if","do","return","goto","enum","else","break","extern","asm","case","default","register","explicit","typename","switch","continue","inline","readonly","assign","readwrite","self","@synchronized","id","typeof","nonatomic","IBOutlet","IBAction","strong","weak","copy","in","out","inout","bycopy","byref","oneway","__strong","__weak","__block","__autoreleasing","@private","@protected","@public","@try","@property","@end","@throw","@catch","@finally","@autoreleasepool","@synthesize","@dynamic","@selector","@optional","@required","@encode","@package","@import","@defs","@compatibility_alias","__bridge","__bridge_transfer","__bridge_retained","__bridge_retain","__covariant","__contravariant","__kindof","_Nonnull","_Nullable","_Null_unspecified","__FUNCTION__","__PRETTY_FUNCTION__","__attribute__","getter","setter","retain","unsafe_unretained","nonnull","nullable","null_unspecified","null_resettable","class","instancetype","NS_DESIGNATED_INITIALIZER","NS_UNAVAILABLE","NS_REQUIRES_SUPER","NS_RETURNS_INNER_POINTER","NS_INLINE","NS_AVAILABLE","NS_DEPRECATED","NS_ENUM","NS_OPTIONS","NS_SWIFT_UNAVAILABLE","NS_ASSUME_NONNULL_BEGIN","NS_ASSUME_NONNULL_END","NS_REFINED_FOR_SWIFT","NS_SWIFT_NAME","NS_SWIFT_NOTHROW","NS_DURING","NS_HANDLER","NS_ENDHANDLER","NS_VALUERETURN","NS_VOIDRETURN"],literal:["false","true","FALSE","TRUE","nil","YES","NO","NULL"],built_in:["dispatch_once_t","dispatch_queue_t","dispatch_sync","dispatch_async","dispatch_once"],type:["int","float","char","unsigned","signed","short","long","double","wchar_t","unichar","void","bool","BOOL","id|0","_Bool"]},l={$pattern:n,keyword:["@interface","@class","@protocol","@implementation"]};return{name:"Objective-C",aliases:["mm","objc","obj-c","obj-c++","objective-c++"],keywords:u,illegal:"</",contains:[t,e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE,e.C_NUMBER_MODE,e.QUOTE_STRING_MODE,e.APOS_STRING_MODE,{className:"string",variants:[{begin:'@"',end:'"',illegal:"\\n",contains:[e.BACKSLASH_ESCAPE]}]},{className:"meta",begin:/#\s*[a-z]+\b/,end:/$/,keywords:{keyword:"if else elif endif define undef warning error line pragma ifdef ifndef include"},contains:[{begin:/\\\n/,relevance:0},e.inherit(e.QUOTE_STRING_MODE,{className:"string"}),{className:"string",begin:/<.*?>/,end:/$/,illegal:"\\n"},e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE]},{className:"class",begin:"("+l.keyword.join("|")+")\\b",end:/(\{|$)/,excludeEnd:!0,keywords:l,contains:[e.UNDERSCORE_TITLE_MODE]},{begin:"\\."+e.UNDERSCORE_IDENT_RE,relevance:0}]}}return fd=r,fd}var pd,L1;function kE(){if(L1)return pd;L1=1;function r(e){const t=e.regex,n=/(?![A-Za-z0-9])(?![$])/,a=t.concat(/[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/,n),s=t.concat(/(\\?[A-Z][a-z0-9_\x7f-\xff]+|\\?[A-Z]+(?=[A-Z][a-z0-9_\x7f-\xff])){1,}/,n),i=t.concat(/[A-Z]+/,n),o={scope:"variable",match:"\\$+"+a},u={scope:"meta",variants:[{begin:/<\?php/,relevance:10},{begin:/<\?=/},{begin:/<\?/,relevance:.1},{begin:/\?>/}]},l={scope:"subst",variants:[{begin:/\$\w+/},{begin:/\{\$/,end:/\}/}]},c=e.inherit(e.APOS_STRING_MODE,{illegal:null}),d=e.inherit(e.QUOTE_STRING_MODE,{illegal:null,contains:e.QUOTE_STRING_MODE.contains.concat(l)}),h={begin:/<<<[ \t]*(?:(\w+)|"(\w+)")\n/,end:/[ \t]*(\w+)\b/,contains:e.QUOTE_STRING_MODE.contains.concat(l),"on:begin":(M,P)=>{P.data._beginMatch=M[1]||M[2]},"on:end":(M,P)=>{P.data._beginMatch!==M[1]&&P.ignoreMatch()}},f=e.END_SAME_AS_BEGIN({begin:/<<<[ \t]*'(\w+)'\n/,end:/[ \t]*(\w+)\b/}),p=`[ 	
]`,m={scope:"string",variants:[d,c,h,f]},v={scope:"number",variants:[{begin:"\\b0[bB][01]+(?:_[01]+)*\\b"},{begin:"\\b0[oO][0-7]+(?:_[0-7]+)*\\b"},{begin:"\\b0[xX][\\da-fA-F]+(?:_[\\da-fA-F]+)*\\b"},{begin:"(?:\\b\\d+(?:_\\d+)*(\\.(?:\\d+(?:_\\d+)*))?|\\B\\.\\d+)(?:[eE][+-]?\\d+)?"}],relevance:0},_=["false","null","true"],w=["__CLASS__","__DIR__","__FILE__","__FUNCTION__","__COMPILER_HALT_OFFSET__","__LINE__","__METHOD__","__NAMESPACE__","__TRAIT__","die","echo","exit","include","include_once","print","require","require_once","array","abstract","and","as","binary","bool","boolean","break","callable","case","catch","class","clone","const","continue","declare","default","do","double","else","elseif","empty","enddeclare","endfor","endforeach","endif","endswitch","endwhile","enum","eval","extends","final","finally","float","for","foreach","from","global","goto","if","implements","instanceof","insteadof","int","integer","interface","isset","iterable","list","match|0","mixed","new","never","object","or","private","protected","public","readonly","real","return","string","switch","throw","trait","try","unset","use","var","void","while","xor","yield"],E=["Error|0","AppendIterator","ArgumentCountError","ArithmeticError","ArrayIterator","ArrayObject","AssertionError","BadFunctionCallException","BadMethodCallException","CachingIterator","CallbackFilterIterator","CompileError","Countable","DirectoryIterator","DivisionByZeroError","DomainException","EmptyIterator","ErrorException","Exception","FilesystemIterator","FilterIterator","GlobIterator","InfiniteIterator","InvalidArgumentException","IteratorIterator","LengthException","LimitIterator","LogicException","MultipleIterator","NoRewindIterator","OutOfBoundsException","OutOfRangeException","OuterIterator","OverflowException","ParentIterator","ParseError","RangeException","RecursiveArrayIterator","RecursiveCachingIterator","RecursiveCallbackFilterIterator","RecursiveDirectoryIterator","RecursiveFilterIterator","RecursiveIterator","RecursiveIteratorIterator","RecursiveRegexIterator","RecursiveTreeIterator","RegexIterator","RuntimeException","SeekableIterator","SplDoublyLinkedList","SplFileInfo","SplFileObject","SplFixedArray","SplHeap","SplMaxHeap","SplMinHeap","SplObjectStorage","SplObserver","SplPriorityQueue","SplQueue","SplStack","SplSubject","SplTempFileObject","TypeError","UnderflowException","UnexpectedValueException","UnhandledMatchError","ArrayAccess","BackedEnum","Closure","Fiber","Generator","Iterator","IteratorAggregate","Serializable","Stringable","Throwable","Traversable","UnitEnum","WeakReference","WeakMap","Directory","__PHP_Incomplete_Class","parent","php_user_filter","self","static","stdClass"],k={keyword:w,literal:(M=>{const P=[];return M.forEach(Z=>{P.push(Z),Z.toLowerCase()===Z?P.push(Z.toUpperCase()):P.push(Z.toLowerCase())}),P})(_),built_in:E},N=M=>M.map(P=>P.replace(/\|\d+$/,"")),B={variants:[{match:[/new/,t.concat(p,"+"),t.concat("(?!",N(E).join("\\b|"),"\\b)"),s],scope:{1:"keyword",4:"title.class"}}]},A=t.concat(a,"\\b(?!\\()"),L={variants:[{match:[t.concat(/::/,t.lookahead(/(?!class\b)/)),A],scope:{2:"variable.constant"}},{match:[/::/,/class/],scope:{2:"variable.language"}},{match:[s,t.concat(/::/,t.lookahead(/(?!class\b)/)),A],scope:{1:"title.class",3:"variable.constant"}},{match:[s,t.concat("::",t.lookahead(/(?!class\b)/))],scope:{1:"title.class"}},{match:[s,/::/,/class/],scope:{1:"title.class",3:"variable.language"}}]},V={scope:"attr",match:t.concat(a,t.lookahead(":"),t.lookahead(/(?!::)/))},G={relevance:0,begin:/\(/,end:/\)/,keywords:k,contains:[V,o,L,e.C_BLOCK_COMMENT_MODE,m,v,B]},te={relevance:0,match:[/\b/,t.concat("(?!fn\\b|function\\b|",N(w).join("\\b|"),"|",N(E).join("\\b|"),"\\b)"),a,t.concat(p,"*"),t.lookahead(/(?=\()/)],scope:{3:"title.function.invoke"},contains:[G]};G.contains.push(te);const ve=[V,L,e.C_BLOCK_COMMENT_MODE,m,v,B],D={begin:t.concat(/#\[\s*\\?/,t.either(s,i)),beginScope:"meta",end:/]/,endScope:"meta",keywords:{literal:_,keyword:["new","array"]},contains:[{begin:/\[/,end:/]/,keywords:{literal:_,keyword:["new","array"]},contains:["self",...ve]},...ve,{scope:"meta",variants:[{match:s},{match:i}]}]};return{case_insensitive:!1,keywords:k,contains:[D,e.HASH_COMMENT_MODE,e.COMMENT("//","$"),e.COMMENT("/\\*","\\*/",{contains:[{scope:"doctag",match:"@[A-Za-z]+"}]}),{match:/__halt_compiler\(\);/,keywords:"__halt_compiler",starts:{scope:"comment",end:e.MATCH_NOTHING_RE,contains:[{match:/\?>/,scope:"meta",endsParent:!0}]}},u,{scope:"variable.language",match:/\$this\b/},o,te,L,{match:[/const/,/\s/,a],scope:{1:"keyword",3:"variable.constant"}},B,{scope:"function",relevance:0,beginKeywords:"fn function",end:/[;{]/,excludeEnd:!0,illegal:"[$%\\[]",contains:[{beginKeywords:"use"},e.UNDERSCORE_TITLE_MODE,{begin:"=>",endsParent:!0},{scope:"params",begin:"\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0,keywords:k,contains:["self",D,o,L,e.C_BLOCK_COMMENT_MODE,m,v]}]},{scope:"class",variants:[{beginKeywords:"enum",illegal:/[($"]/},{beginKeywords:"class interface trait",illegal:/[:($"]/}],relevance:0,end:/\{/,excludeEnd:!0,contains:[{beginKeywords:"extends implements"},e.UNDERSCORE_TITLE_MODE]},{beginKeywords:"namespace",relevance:0,end:";",illegal:/[.']/,contains:[e.inherit(e.UNDERSCORE_TITLE_MODE,{scope:"title.class"})]},{beginKeywords:"use",relevance:0,end:";",contains:[{match:/\b(as|const|function)\b/,scope:"keyword"},e.UNDERSCORE_TITLE_MODE]},m,v]}}return pd=r,pd}var md,z1;function CE(){if(z1)return md;z1=1;function r(e){return{name:"PHP template",subLanguage:"xml",contains:[{begin:/<\?(php|=)?/,end:/\?>/,subLanguage:"php",contains:[{begin:"/\\*",end:"\\*/",skip:!0},{begin:'b"',end:'"',skip:!0},{begin:"b'",end:"'",skip:!0},e.inherit(e.APOS_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0}),e.inherit(e.QUOTE_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0})]}]}}return md=r,md}var gd,U1;function TE(){if(U1)return gd;U1=1;function r(e){return{name:"Plain text",aliases:["text","txt"],disableAutodetect:!0}}return gd=r,gd}var yd,j1;function FE(){if(j1)return yd;j1=1;function r(e){const t=e.regex,n=new RegExp("[\\p{XID_Start}_]\\p{XID_Continue}*","u"),a=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],u={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:a,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},l={className:"meta",begin:/^(>>>|\.\.\.) /},c={className:"subst",begin:/\{/,end:/\}/,keywords:u,illegal:/#/},d={begin:/\{\{/,relevance:0},h={className:"string",contains:[e.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[e.BACKSLASH_ESCAPE,l],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[e.BACKSLASH_ESCAPE,l],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[e.BACKSLASH_ESCAPE,l,d,c]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[e.BACKSLASH_ESCAPE,l,d,c]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[e.BACKSLASH_ESCAPE,d,c]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[e.BACKSLASH_ESCAPE,d,c]},e.APOS_STRING_MODE,e.QUOTE_STRING_MODE]},f="[0-9](_?[0-9])*",p=`(\\b(${f}))?\\.(${f})|\\b(${f})\\.`,m=`\\b|${a.join("|")}`,v={className:"number",relevance:0,variants:[{begin:`(\\b(${f})|(${p}))[eE][+-]?(${f})[jJ]?(?=${m})`},{begin:`(${p})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${m})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${m})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${m})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${m})`},{begin:`\\b(${f})[jJ](?=${m})`}]},_={className:"comment",begin:t.lookahead(/# type:/),end:/$/,keywords:u,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},w={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:u,contains:["self",l,v,h,e.HASH_COMMENT_MODE]}]};return c.contains=[h,v,l],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:u,illegal:/(<\/|\?)|=>/,contains:[l,v,{scope:"variable.language",match:/\bself\b/},{beginKeywords:"if",relevance:0},{match:/\bor\b/,scope:"keyword"},h,_,e.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,n],scope:{1:"keyword",3:"title.function"},contains:[w]},{variants:[{match:[/\bclass/,/\s+/,n,/\s*/,/\(\s*/,n,/\s*\)/]},{match:[/\bclass/,/\s+/,n]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[v,w,h]}]}}return yd=r,yd}var vd,q1;function NE(){if(q1)return vd;q1=1;function r(e){return{aliases:["pycon"],contains:[{className:"meta.prompt",starts:{end:/ |$/,starts:{end:"$",subLanguage:"python"}},variants:[{begin:/^>>>(?=[ ]|$)/},{begin:/^\.\.\.(?=[ ]|$)/}]}]}}return vd=r,vd}var _d,H1;function IE(){if(H1)return _d;H1=1;function r(e){const t=e.regex,n=/(?:(?:[a-zA-Z]|\.[._a-zA-Z])[._a-zA-Z0-9]*)|\.(?!\d)/,a=t.either(/0[xX][0-9a-fA-F]+\.[0-9a-fA-F]*[pP][+-]?\d+i?/,/0[xX][0-9a-fA-F]+(?:[pP][+-]?\d+)?[Li]?/,/(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?[Li]?/),s=/[=!<>:]=|\|\||&&|:::?|<-|<<-|->>|->|\|>|[-+*\/?!$&|:<=>@^~]|\*\*/,i=t.either(/[()]/,/[{}]/,/\[\[/,/[[\]]/,/\\/,/,/);return{name:"R",keywords:{$pattern:n,keyword:"function if in break next repeat else for while",literal:"NULL NA TRUE FALSE Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10",built_in:"LETTERS letters month.abb month.name pi T F abs acos acosh all any anyNA Arg as.call as.character as.complex as.double as.environment as.integer as.logical as.null.default as.numeric as.raw asin asinh atan atanh attr attributes baseenv browser c call ceiling class Conj cos cosh cospi cummax cummin cumprod cumsum digamma dim dimnames emptyenv exp expression floor forceAndCall gamma gc.time globalenv Im interactive invisible is.array is.atomic is.call is.character is.complex is.double is.environment is.expression is.finite is.function is.infinite is.integer is.language is.list is.logical is.matrix is.na is.name is.nan is.null is.numeric is.object is.pairlist is.raw is.recursive is.single is.symbol lazyLoadDBfetch length lgamma list log max min missing Mod names nargs nzchar oldClass on.exit pos.to.env proc.time prod quote range Re rep retracemem return round seq_along seq_len seq.int sign signif sin sinh sinpi sqrt standardGeneric substitute sum switch tan tanh tanpi tracemem trigamma trunc unclass untracemem UseMethod xtfrm"},contains:[e.COMMENT(/#'/,/$/,{contains:[{scope:"doctag",match:/@examples/,starts:{end:t.lookahead(t.either(/\n^#'\s*(?=@[a-zA-Z]+)/,/\n^(?!#')/)),endsParent:!0}},{scope:"doctag",begin:"@param",end:/$/,contains:[{scope:"variable",variants:[{match:n},{match:/`(?:\\.|[^`\\])+`/}],endsParent:!0}]},{scope:"doctag",match:/@[a-zA-Z]+/},{scope:"keyword",match:/\\[a-zA-Z]+/}]}),e.HASH_COMMENT_MODE,{scope:"string",contains:[e.BACKSLASH_ESCAPE],variants:[e.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\(/,end:/\)(-*)"/}),e.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\{/,end:/\}(-*)"/}),e.END_SAME_AS_BEGIN({begin:/[rR]"(-*)\[/,end:/\](-*)"/}),e.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\(/,end:/\)(-*)'/}),e.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\{/,end:/\}(-*)'/}),e.END_SAME_AS_BEGIN({begin:/[rR]'(-*)\[/,end:/\](-*)'/}),{begin:'"',end:'"',relevance:0},{begin:"'",end:"'",relevance:0}]},{relevance:0,variants:[{scope:{1:"operator",2:"number"},match:[s,a]},{scope:{1:"operator",2:"number"},match:[/%[^%]*%/,a]},{scope:{1:"punctuation",2:"number"},match:[i,a]},{scope:{2:"number"},match:[/[^a-zA-Z0-9._]|^/,a]}]},{scope:{3:"operator"},match:[n,/\s+/,/<-/,/\s+/]},{scope:"operator",relevance:0,variants:[{match:s},{match:/%[^%]*%/}]},{scope:"punctuation",relevance:0,match:i},{begin:"`",end:"`",contains:[{begin:/\\./}]}]}}return _d=r,_d}var bd,V1;function OE(){if(V1)return bd;V1=1;function r(e){const t=e.regex,n=/(r#)?/,a=t.concat(n,e.UNDERSCORE_IDENT_RE),s=t.concat(n,e.IDENT_RE),i={className:"title.function.invoke",relevance:0,begin:t.concat(/\b/,/(?!let|for|while|if|else|match\b)/,s,t.lookahead(/\s*\(/))},o="([ui](8|16|32|64|128|size)|f(32|64))?",u=["abstract","as","async","await","become","box","break","const","continue","crate","do","dyn","else","enum","extern","false","final","fn","for","if","impl","in","let","loop","macro","match","mod","move","mut","override","priv","pub","ref","return","self","Self","static","struct","super","trait","true","try","type","typeof","union","unsafe","unsized","use","virtual","where","while","yield"],l=["true","false","Some","None","Ok","Err"],c=["drop ","Copy","Send","Sized","Sync","Drop","Fn","FnMut","FnOnce","ToOwned","Clone","Debug","PartialEq","PartialOrd","Eq","Ord","AsRef","AsMut","Into","From","Default","Iterator","Extend","IntoIterator","DoubleEndedIterator","ExactSizeIterator","SliceConcatExt","ToString","assert!","assert_eq!","bitflags!","bytes!","cfg!","col!","concat!","concat_idents!","debug_assert!","debug_assert_eq!","env!","eprintln!","panic!","file!","format!","format_args!","include_bytes!","include_str!","line!","local_data_key!","module_path!","option_env!","print!","println!","select!","stringify!","try!","unimplemented!","unreachable!","vec!","write!","writeln!","macro_rules!","assert_ne!","debug_assert_ne!"],d=["i8","i16","i32","i64","i128","isize","u8","u16","u32","u64","u128","usize","f32","f64","str","char","bool","Box","Option","Result","String","Vec"];return{name:"Rust",aliases:["rs"],keywords:{$pattern:e.IDENT_RE+"!?",type:d,keyword:u,literal:l,built_in:c},illegal:"</",contains:[e.C_LINE_COMMENT_MODE,e.COMMENT("/\\*","\\*/",{contains:["self"]}),e.inherit(e.QUOTE_STRING_MODE,{begin:/b?"/,illegal:null}),{className:"symbol",begin:/'[a-zA-Z_][a-zA-Z0-9_]*(?!')/},{scope:"string",variants:[{begin:/b?r(#*)"(.|\n)*?"\1(?!#)/},{begin:/b?'/,end:/'/,contains:[{scope:"char.escape",match:/\\('|\w|x\w{2}|u\w{4}|U\w{8})/}]}]},{className:"number",variants:[{begin:"\\b0b([01_]+)"+o},{begin:"\\b0o([0-7_]+)"+o},{begin:"\\b0x([A-Fa-f0-9_]+)"+o},{begin:"\\b(\\d[\\d_]*(\\.[0-9_]+)?([eE][+-]?[0-9_]+)?)"+o}],relevance:0},{begin:[/fn/,/\s+/,a],className:{1:"keyword",3:"title.function"}},{className:"meta",begin:"#!?\\[",end:"\\]",contains:[{className:"string",begin:/"/,end:/"/,contains:[e.BACKSLASH_ESCAPE]}]},{begin:[/let/,/\s+/,/(?:mut\s+)?/,a],className:{1:"keyword",3:"keyword",4:"variable"}},{begin:[/for/,/\s+/,a,/\s+/,/in/],className:{1:"keyword",3:"variable",5:"keyword"}},{begin:[/type/,/\s+/,a],className:{1:"keyword",3:"title.class"}},{begin:[/(?:trait|enum|struct|union|impl|for)/,/\s+/,a],className:{1:"keyword",3:"title.class"}},{begin:e.IDENT_RE+"::",keywords:{keyword:"Self",built_in:c,type:d}},{className:"punctuation",begin:"->"},i]}}return bd=r,bd}var wd,G1;function RE(){if(G1)return wd;G1=1;const r=l=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:l.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[l.APOS_STRING_MODE,l.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:l.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z_][A-Za-z0-9_-]*/}}),e=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","optgroup","option","p","picture","q","quote","samp","section","select","source","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],t=["defs","g","marker","mask","pattern","svg","switch","symbol","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feGaussianBlur","feImage","feMerge","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","linearGradient","radialGradient","stop","circle","ellipse","image","line","path","polygon","polyline","rect","text","use","textPath","tspan","foreignObject","clipPath"],n=[...e,...t],a=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"].sort().reverse(),s=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"].sort().reverse(),i=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"].sort().reverse(),o=["accent-color","align-content","align-items","align-self","alignment-baseline","all","anchor-name","animation","animation-composition","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-range","animation-range-end","animation-range-start","animation-timeline","animation-timing-function","appearance","aspect-ratio","backdrop-filter","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-position-x","background-position-y","background-repeat","background-size","baseline-shift","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-end-end-radius","border-end-start-radius","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-start-end-radius","border-start-start-radius","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-align","box-decoration-break","box-direction","box-flex","box-flex-group","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","color-scheme","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","contain-intrinsic-block-size","contain-intrinsic-height","contain-intrinsic-inline-size","contain-intrinsic-size","contain-intrinsic-width","container","container-name","container-type","content","content-visibility","counter-increment","counter-reset","counter-set","cue","cue-after","cue-before","cursor","cx","cy","direction","display","dominant-baseline","empty-cells","enable-background","field-sizing","fill","fill-opacity","fill-rule","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flood-color","flood-opacity","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-optical-sizing","font-palette","font-size","font-size-adjust","font-smooth","font-smoothing","font-stretch","font-style","font-synthesis","font-synthesis-position","font-synthesis-small-caps","font-synthesis-style","font-synthesis-weight","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-emoji","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","forced-color-adjust","gap","glyph-orientation-horizontal","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphenate-character","hyphenate-limit-chars","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","initial-letter","initial-letter-align","inline-size","inset","inset-area","inset-block","inset-block-end","inset-block-start","inset-inline","inset-inline-end","inset-inline-start","isolation","justify-content","justify-items","justify-self","kerning","left","letter-spacing","lighting-color","line-break","line-height","line-height-step","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","margin-trim","marker","marker-end","marker-mid","marker-start","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","masonry-auto-flow","math-depth","math-shift","math-style","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","offset","offset-anchor","offset-distance","offset-path","offset-position","offset-rotate","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-anchor","overflow-block","overflow-clip-margin","overflow-inline","overflow-wrap","overflow-x","overflow-y","overlay","overscroll-behavior","overscroll-behavior-block","overscroll-behavior-inline","overscroll-behavior-x","overscroll-behavior-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","paint-order","pause","pause-after","pause-before","perspective","perspective-origin","place-content","place-items","place-self","pointer-events","position","position-anchor","position-visibility","print-color-adjust","quotes","r","resize","rest","rest-after","rest-before","right","rotate","row-gap","ruby-align","ruby-position","scale","scroll-behavior","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scroll-timeline","scroll-timeline-axis","scroll-timeline-name","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","shape-rendering","speak","speak-as","src","stop-color","stop-opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","tab-size","table-layout","text-align","text-align-all","text-align-last","text-anchor","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-skip-ink","text-decoration-style","text-decoration-thickness","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-size-adjust","text-transform","text-underline-offset","text-underline-position","text-wrap","text-wrap-mode","text-wrap-style","timeline-scope","top","touch-action","transform","transform-box","transform-origin","transform-style","transition","transition-behavior","transition-delay","transition-duration","transition-property","transition-timing-function","translate","unicode-bidi","user-modify","user-select","vector-effect","vertical-align","view-timeline","view-timeline-axis","view-timeline-inset","view-timeline-name","view-transition-name","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","white-space-collapse","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","x","y","z-index","zoom"].sort().reverse();function u(l){const c=r(l),d=i,h=s,f="@[a-z-]+",p="and or not only",v={className:"variable",begin:"(\\$"+"[a-zA-Z-][a-zA-Z0-9_-]*"+")\\b",relevance:0};return{name:"SCSS",case_insensitive:!0,illegal:"[=/|']",contains:[l.C_LINE_COMMENT_MODE,l.C_BLOCK_COMMENT_MODE,c.CSS_NUMBER_MODE,{className:"selector-id",begin:"#[A-Za-z0-9_-]+",relevance:0},{className:"selector-class",begin:"\\.[A-Za-z0-9_-]+",relevance:0},c.ATTRIBUTE_SELECTOR_MODE,{className:"selector-tag",begin:"\\b("+n.join("|")+")\\b",relevance:0},{className:"selector-pseudo",begin:":("+h.join("|")+")"},{className:"selector-pseudo",begin:":(:)?("+d.join("|")+")"},v,{begin:/\(/,end:/\)/,contains:[c.CSS_NUMBER_MODE]},c.CSS_VARIABLE,{className:"attribute",begin:"\\b("+o.join("|")+")\\b"},{begin:"\\b(whitespace|wait|w-resize|visible|vertical-text|vertical-ideographic|uppercase|upper-roman|upper-alpha|underline|transparent|top|thin|thick|text|text-top|text-bottom|tb-rl|table-header-group|table-footer-group|sw-resize|super|strict|static|square|solid|small-caps|separate|se-resize|scroll|s-resize|rtl|row-resize|ridge|right|repeat|repeat-y|repeat-x|relative|progress|pointer|overline|outside|outset|oblique|nowrap|not-allowed|normal|none|nw-resize|no-repeat|no-drop|newspaper|ne-resize|n-resize|move|middle|medium|ltr|lr-tb|lowercase|lower-roman|lower-alpha|loose|list-item|line|line-through|line-edge|lighter|left|keep-all|justify|italic|inter-word|inter-ideograph|inside|inset|inline|inline-block|inherit|inactive|ideograph-space|ideograph-parenthesis|ideograph-numeric|ideograph-alpha|horizontal|hidden|help|hand|groove|fixed|ellipsis|e-resize|double|dotted|distribute|distribute-space|distribute-letter|distribute-all-lines|disc|disabled|default|decimal|dashed|crosshair|collapse|col-resize|circle|char|center|capitalize|break-word|break-all|bottom|both|bolder|bold|block|bidi-override|below|baseline|auto|always|all-scroll|absolute|table|table-cell)\\b"},{begin:/:/,end:/[;}{]/,relevance:0,contains:[c.BLOCK_COMMENT,v,c.HEXCOLOR,c.CSS_NUMBER_MODE,l.QUOTE_STRING_MODE,l.APOS_STRING_MODE,c.IMPORTANT,c.FUNCTION_DISPATCH]},{begin:"@(page|font-face)",keywords:{$pattern:f,keyword:"@page @font-face"}},{begin:"@",end:"[{;]",returnBegin:!0,keywords:{$pattern:/[a-z-]+/,keyword:p,attribute:a.join(" ")},contains:[{begin:f,className:"keyword"},{begin:/[a-z-]+(?=:)/,className:"attribute"},v,l.QUOTE_STRING_MODE,l.APOS_STRING_MODE,c.HEXCOLOR,c.CSS_NUMBER_MODE]},c.FUNCTION_DISPATCH]}}return wd=u,wd}var Ed,Z1;function DE(){if(Z1)return Ed;Z1=1;function r(e){return{name:"Shell Session",aliases:["console","shellsession"],contains:[{className:"meta.prompt",begin:/^\s{0,3}[/~\w\d[\]()@-]*[>%$#][ ]?/,starts:{end:/[^\\](?=\s*$)/,subLanguage:"bash"}}]}}return Ed=r,Ed}var xd,K1;function BE(){if(K1)return xd;K1=1;function r(e){const t=e.regex,n=e.COMMENT("--","$"),a={scope:"string",variants:[{begin:/'/,end:/'/,contains:[{match:/''/}]}]},s={begin:/"/,end:/"/,contains:[{match:/""/}]},i=["true","false","unknown"],o=["double precision","large object","with timezone","without timezone"],u=["bigint","binary","blob","boolean","char","character","clob","date","dec","decfloat","decimal","float","int","integer","interval","nchar","nclob","national","numeric","real","row","smallint","time","timestamp","varchar","varying","varbinary"],l=["add","asc","collation","desc","final","first","last","view"],c=["abs","acos","all","allocate","alter","and","any","are","array","array_agg","array_max_cardinality","as","asensitive","asin","asymmetric","at","atan","atomic","authorization","avg","begin","begin_frame","begin_partition","between","bigint","binary","blob","boolean","both","by","call","called","cardinality","cascaded","case","cast","ceil","ceiling","char","char_length","character","character_length","check","classifier","clob","close","coalesce","collate","collect","column","commit","condition","connect","constraint","contains","convert","copy","corr","corresponding","cos","cosh","count","covar_pop","covar_samp","create","cross","cube","cume_dist","current","current_catalog","current_date","current_default_transform_group","current_path","current_role","current_row","current_schema","current_time","current_timestamp","current_path","current_role","current_transform_group_for_type","current_user","cursor","cycle","date","day","deallocate","dec","decimal","decfloat","declare","default","define","delete","dense_rank","deref","describe","deterministic","disconnect","distinct","double","drop","dynamic","each","element","else","empty","end","end_frame","end_partition","end-exec","equals","escape","every","except","exec","execute","exists","exp","external","extract","false","fetch","filter","first_value","float","floor","for","foreign","frame_row","free","from","full","function","fusion","get","global","grant","group","grouping","groups","having","hold","hour","identity","in","indicator","initial","inner","inout","insensitive","insert","int","integer","intersect","intersection","interval","into","is","join","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_table","json_table_primitive","json_value","lag","language","large","last_value","lateral","lead","leading","left","like","like_regex","listagg","ln","local","localtime","localtimestamp","log","log10","lower","match","match_number","match_recognize","matches","max","member","merge","method","min","minute","mod","modifies","module","month","multiset","national","natural","nchar","nclob","new","no","none","normalize","not","nth_value","ntile","null","nullif","numeric","octet_length","occurrences_regex","of","offset","old","omit","on","one","only","open","or","order","out","outer","over","overlaps","overlay","parameter","partition","pattern","per","percent","percent_rank","percentile_cont","percentile_disc","period","portion","position","position_regex","power","precedes","precision","prepare","primary","procedure","ptf","range","rank","reads","real","recursive","ref","references","referencing","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","release","result","return","returns","revoke","right","rollback","rollup","row","row_number","rows","running","savepoint","scope","scroll","search","second","seek","select","sensitive","session_user","set","show","similar","sin","sinh","skip","smallint","some","specific","specifictype","sql","sqlexception","sqlstate","sqlwarning","sqrt","start","static","stddev_pop","stddev_samp","submultiset","subset","substring","substring_regex","succeeds","sum","symmetric","system","system_time","system_user","table","tablesample","tan","tanh","then","time","timestamp","timezone_hour","timezone_minute","to","trailing","translate","translate_regex","translation","treat","trigger","trim","trim_array","true","truncate","uescape","union","unique","unknown","unnest","update","upper","user","using","value","values","value_of","var_pop","var_samp","varbinary","varchar","varying","versioning","when","whenever","where","width_bucket","window","with","within","without","year"],d=["abs","acos","array_agg","asin","atan","avg","cast","ceil","ceiling","coalesce","corr","cos","cosh","count","covar_pop","covar_samp","cume_dist","dense_rank","deref","element","exp","extract","first_value","floor","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_table","json_table_primitive","json_value","lag","last_value","lead","listagg","ln","log","log10","lower","max","min","mod","nth_value","ntile","nullif","percent_rank","percentile_cont","percentile_disc","position","position_regex","power","rank","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","row_number","sin","sinh","sqrt","stddev_pop","stddev_samp","substring","substring_regex","sum","tan","tanh","translate","translate_regex","treat","trim","trim_array","unnest","upper","value_of","var_pop","var_samp","width_bucket"],h=["current_catalog","current_date","current_default_transform_group","current_path","current_role","current_schema","current_transform_group_for_type","current_user","session_user","system_time","system_user","current_time","localtime","current_timestamp","localtimestamp"],f=["create table","insert into","primary key","foreign key","not null","alter table","add constraint","grouping sets","on overflow","character set","respect nulls","ignore nulls","nulls first","nulls last","depth first","breadth first"],p=d,m=[...c,...l].filter(N=>!d.includes(N)),v={scope:"variable",match:/@[a-z0-9][a-z0-9_]*/},_={scope:"operator",match:/[-+*/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?/,relevance:0},w={match:t.concat(/\b/,t.either(...p),/\s*\(/),relevance:0,keywords:{built_in:p}};function E(N){return t.concat(/\b/,t.either(...N.map(B=>B.replace(/\s+/,"\\s+"))),/\b/)}const F={scope:"keyword",match:E(f),relevance:0};function k(N,{exceptions:B,when:A}={}){const L=A;return B=B||[],N.map(V=>V.match(/\|\d+$/)||B.includes(V)?V:L(V)?`${V}|0`:V)}return{name:"SQL",case_insensitive:!0,illegal:/[{}]|<\//,keywords:{$pattern:/\b[\w\.]+/,keyword:k(m,{when:N=>N.length<3}),literal:i,type:u,built_in:h},contains:[{scope:"type",match:E(o)},F,w,v,a,s,e.C_NUMBER_MODE,e.C_BLOCK_COMMENT_MODE,n,_]}}return xd=r,xd}var Sd,W1;function ME(){if(W1)return Sd;W1=1;function r(A){return A?typeof A=="string"?A:A.source:null}function e(A){return t("(?=",A,")")}function t(...A){return A.map(V=>r(V)).join("")}function n(A){const L=A[A.length-1];return typeof L=="object"&&L.constructor===Object?(A.splice(A.length-1,1),L):{}}function a(...A){return"("+(n(A).capture?"":"?:")+A.map(G=>r(G)).join("|")+")"}const s=A=>t(/\b/,A,/\w$/.test(A)?/\b/:/\B/),i=["Protocol","Type"].map(s),o=["init","self"].map(s),u=["Any","Self"],l=["actor","any","associatedtype","async","await",/as\?/,/as!/,"as","borrowing","break","case","catch","class","consume","consuming","continue","convenience","copy","default","defer","deinit","didSet","distributed","do","dynamic","each","else","enum","extension","fallthrough",/fileprivate\(set\)/,"fileprivate","final","for","func","get","guard","if","import","indirect","infix",/init\?/,/init!/,"inout",/internal\(set\)/,"internal","in","is","isolated","nonisolated","lazy","let","macro","mutating","nonmutating",/open\(set\)/,"open","operator","optional","override","package","postfix","precedencegroup","prefix",/private\(set\)/,"private","protocol",/public\(set\)/,"public","repeat","required","rethrows","return","set","some","static","struct","subscript","super","switch","throws","throw",/try\?/,/try!/,"try","typealias",/unowned\(safe\)/,/unowned\(unsafe\)/,"unowned","var","weak","where","while","willSet"],c=["false","nil","true"],d=["assignment","associativity","higherThan","left","lowerThan","none","right"],h=["#colorLiteral","#column","#dsohandle","#else","#elseif","#endif","#error","#file","#fileID","#fileLiteral","#filePath","#function","#if","#imageLiteral","#keyPath","#line","#selector","#sourceLocation","#warning"],f=["abs","all","any","assert","assertionFailure","debugPrint","dump","fatalError","getVaList","isKnownUniquelyReferenced","max","min","numericCast","pointwiseMax","pointwiseMin","precondition","preconditionFailure","print","readLine","repeatElement","sequence","stride","swap","swift_unboxFromSwiftValueWithType","transcode","type","unsafeBitCast","unsafeDowncast","withExtendedLifetime","withUnsafeMutablePointer","withUnsafePointer","withVaList","withoutActuallyEscaping","zip"],p=a(/[/=\-+!*%<>&|^~?]/,/[\u00A1-\u00A7]/,/[\u00A9\u00AB]/,/[\u00AC\u00AE]/,/[\u00B0\u00B1]/,/[\u00B6\u00BB\u00BF\u00D7\u00F7]/,/[\u2016-\u2017]/,/[\u2020-\u2027]/,/[\u2030-\u203E]/,/[\u2041-\u2053]/,/[\u2055-\u205E]/,/[\u2190-\u23FF]/,/[\u2500-\u2775]/,/[\u2794-\u2BFF]/,/[\u2E00-\u2E7F]/,/[\u3001-\u3003]/,/[\u3008-\u3020]/,/[\u3030]/),m=a(p,/[\u0300-\u036F]/,/[\u1DC0-\u1DFF]/,/[\u20D0-\u20FF]/,/[\uFE00-\uFE0F]/,/[\uFE20-\uFE2F]/),v=t(p,m,"*"),_=a(/[a-zA-Z_]/,/[\u00A8\u00AA\u00AD\u00AF\u00B2-\u00B5\u00B7-\u00BA]/,/[\u00BC-\u00BE\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF]/,/[\u0100-\u02FF\u0370-\u167F\u1681-\u180D\u180F-\u1DBF]/,/[\u1E00-\u1FFF]/,/[\u200B-\u200D\u202A-\u202E\u203F-\u2040\u2054\u2060-\u206F]/,/[\u2070-\u20CF\u2100-\u218F\u2460-\u24FF\u2776-\u2793]/,/[\u2C00-\u2DFF\u2E80-\u2FFF]/,/[\u3004-\u3007\u3021-\u302F\u3031-\u303F\u3040-\uD7FF]/,/[\uF900-\uFD3D\uFD40-\uFDCF\uFDF0-\uFE1F\uFE30-\uFE44]/,/[\uFE47-\uFEFE\uFF00-\uFFFD]/),w=a(_,/\d/,/[\u0300-\u036F\u1DC0-\u1DFF\u20D0-\u20FF\uFE20-\uFE2F]/),E=t(_,w,"*"),F=t(/[A-Z]/,w,"*"),k=["attached","autoclosure",t(/convention\(/,a("swift","block","c"),/\)/),"discardableResult","dynamicCallable","dynamicMemberLookup","escaping","freestanding","frozen","GKInspectable","IBAction","IBDesignable","IBInspectable","IBOutlet","IBSegueAction","inlinable","main","nonobjc","NSApplicationMain","NSCopying","NSManaged",t(/objc\(/,E,/\)/),"objc","objcMembers","propertyWrapper","requires_stored_property_inits","resultBuilder","Sendable","testable","UIApplicationMain","unchecked","unknown","usableFromInline","warn_unqualified_access"],N=["iOS","iOSApplicationExtension","macOS","macOSApplicationExtension","macCatalyst","macCatalystApplicationExtension","watchOS","watchOSApplicationExtension","tvOS","tvOSApplicationExtension","swift"];function B(A){const L={match:/\s+/,relevance:0},V=A.COMMENT("/\\*","\\*/",{contains:["self"]}),G=[A.C_LINE_COMMENT_MODE,V],te={match:[/\./,a(...i,...o)],className:{2:"keyword"}},ve={match:t(/\./,a(...l)),relevance:0},D=l.filter(kt=>typeof kt=="string").concat(["_|0"]),M=l.filter(kt=>typeof kt!="string").concat(u).map(s),P={variants:[{className:"keyword",match:a(...M,...o)}]},Z={$pattern:a(/\b\w+/,/#\w+/),keyword:D.concat(h),literal:c},W=[te,ve,P],X={match:t(/\./,a(...f)),relevance:0},Y={className:"built_in",match:t(/\b/,a(...f),/(?=\()/)},re=[X,Y],U={match:/->/,relevance:0},j={className:"operator",relevance:0,variants:[{match:v},{match:`\\.(\\.|${m})+`}]},ae=[U,j],Q="([0-9]_*)+",C="([0-9a-fA-F]_*)+",x={className:"number",relevance:0,variants:[{match:`\\b(${Q})(\\.(${Q}))?([eE][+-]?(${Q}))?\\b`},{match:`\\b0x(${C})(\\.(${C}))?([pP][+-]?(${Q}))?\\b`},{match:/\b0o([0-7]_*)+\b/},{match:/\b0b([01]_*)+\b/}]},q=(kt="")=>({className:"subst",variants:[{match:t(/\\/,kt,/[0\\tnr"']/)},{match:t(/\\/,kt,/u\{[0-9a-fA-F]{1,8}\}/)}]}),$=(kt="")=>({className:"subst",match:t(/\\/,kt,/[\t ]*(?:[\r\n]|\r\n)/)}),Ee=(kt="")=>({className:"subst",label:"interpol",begin:t(/\\/,kt,/\(/),end:/\)/}),Ve=(kt="")=>({begin:t(kt,/"""/),end:t(/"""/,kt),contains:[q(kt),$(kt),Ee(kt)]}),at=(kt="")=>({begin:t(kt,/"/),end:t(/"/,kt),contains:[q(kt),Ee(kt)]}),ot={className:"string",variants:[Ve(),Ve("#"),Ve("##"),Ve("###"),at(),at("#"),at("##"),at("###")]},Et=[A.BACKSLASH_ESCAPE,{begin:/\[/,end:/\]/,relevance:0,contains:[A.BACKSLASH_ESCAPE]}],Se={begin:/\/[^\s](?=[^/\n]*\/)/,end:/\//,contains:Et},vt=kt=>{const mt=t(kt,/\//),De=t(/\//,kt);return{begin:mt,end:De,contains:[...Et,{scope:"comment",begin:`#(?!.*${De})`,end:/$/}]}},Qt={scope:"regexp",variants:[vt("###"),vt("##"),vt("#"),Se]},Sr={match:t(/`/,E,/`/)},Vr={className:"variable",match:/\$\d+/},be={className:"variable",match:`\\$${w}+`},Gr=[Sr,Vr,be],Je={match:/(@|#(un)?)available/,scope:"keyword",starts:{contains:[{begin:/\(/,end:/\)/,keywords:N,contains:[...ae,x,ot]}]}},we={scope:"keyword",match:t(/@/,a(...k),e(a(/\(/,/\s+/)))},Ge={scope:"meta",match:t(/@/,E)},Ae=[Je,we,Ge],ce={match:e(/\b[A-Z]/),relevance:0,contains:[{className:"type",match:t(/(AV|CA|CF|CG|CI|CL|CM|CN|CT|MK|MP|MTK|MTL|NS|SCN|SK|UI|WK|XC)/,w,"+")},{className:"type",match:F,relevance:0},{match:/[?!]+/,relevance:0},{match:/\.\.\./,relevance:0},{match:t(/\s+&\s+/,e(F)),relevance:0}]},Ke={begin:/</,end:/>/,keywords:Z,contains:[...G,...W,...Ae,U,ce]};ce.contains.push(Ke);const ze={match:t(E,/\s*:/),keywords:"_|0",relevance:0},er={begin:/\(/,end:/\)/,relevance:0,keywords:Z,contains:["self",ze,...G,Qt,...W,...re,...ae,x,ot,...Gr,...Ae,ce]},Rn={begin:/</,end:/>/,keywords:"repeat each",contains:[...G,ce]},K={begin:a(e(t(E,/\s*:/)),e(t(E,/\s+/,E,/\s*:/))),end:/:/,relevance:0,contains:[{className:"keyword",match:/\b_\b/},{className:"params",match:E}]},ee={begin:/\(/,end:/\)/,keywords:Z,contains:[K,...G,...W,...ae,x,ot,...Ae,ce,er],endsParent:!0,illegal:/["']/},_e={match:[/(func|macro)/,/\s+/,a(Sr.match,E,v)],className:{1:"keyword",3:"title.function"},contains:[Rn,ee,L],illegal:[/\[/,/%/]},Fe={match:[/\b(?:subscript|init[?!]?)/,/\s*(?=[<(])/],className:{1:"keyword"},contains:[Rn,ee,L],illegal:/\[|%/},ke={match:[/operator/,/\s+/,v],className:{1:"keyword",3:"title"}},Ut={begin:[/precedencegroup/,/\s+/,F],className:{1:"keyword",3:"title"},contains:[ce],keywords:[...d,...c],end:/}/},Jt={match:[/class\b/,/\s+/,/func\b/,/\s+/,/\b[A-Za-z_][A-Za-z0-9_]*\b/],scope:{1:"keyword",3:"keyword",5:"title.function"}},hr={match:[/class\b/,/\s+/,/var\b/],scope:{1:"keyword",3:"keyword"}},ps={begin:[/(struct|protocol|class|extension|enum|actor)/,/\s+/,E,/\s*/],beginScope:{1:"keyword",3:"title.class"},keywords:Z,contains:[Rn,...W,{begin:/:/,end:/\{/,keywords:Z,contains:[{scope:"title.class.inherited",match:F},...W],relevance:0}]};for(const kt of ot.variants){const mt=kt.contains.find(Mt=>Mt.label==="interpol");mt.keywords=Z;const De=[...W,...re,...ae,x,ot,...Gr];mt.contains=[...De,{begin:/\(/,end:/\)/,contains:["self",...De]}]}return{name:"Swift",keywords:Z,contains:[...G,_e,Fe,Jt,hr,ps,ke,Ut,{beginKeywords:"import",end:/$/,contains:[...G],relevance:0},Qt,...W,...re,...ae,x,ot,...Gr,...Ae,ce,er]}}return Sd=B,Sd}var Ad,Y1;function $E(){if(Y1)return Ad;Y1=1;function r(e){const t="true false yes no null",n="[\\w#;/?:@&=+$,.~*'()[\\]]+",a={className:"attr",variants:[{begin:/[\w*@][\w*@ :()\./-]*:(?=[ \t]|$)/},{begin:/"[\w*@][\w*@ :()\./-]*":(?=[ \t]|$)/},{begin:/'[\w*@][\w*@ :()\./-]*':(?=[ \t]|$)/}]},s={className:"template-variable",variants:[{begin:/\{\{/,end:/\}\}/},{begin:/%\{/,end:/\}/}]},i={className:"string",relevance:0,begin:/'/,end:/'/,contains:[{match:/''/,scope:"char.escape",relevance:0}]},o={className:"string",relevance:0,variants:[{begin:/"/,end:/"/},{begin:/\S+/}],contains:[e.BACKSLASH_ESCAPE,s]},u=e.inherit(o,{variants:[{begin:/'/,end:/'/,contains:[{begin:/''/,relevance:0}]},{begin:/"/,end:/"/},{begin:/[^\s,{}[\]]+/}]}),f={className:"number",begin:"\\b"+"[0-9]{4}(-[0-9][0-9]){0,2}"+"([Tt \\t][0-9][0-9]?(:[0-9][0-9]){2})?"+"(\\.[0-9]*)?"+"([ \\t])*(Z|[-+][0-9][0-9]?(:[0-9][0-9])?)?"+"\\b"},p={end:",",endsWithParent:!0,excludeEnd:!0,keywords:t,relevance:0},m={begin:/\{/,end:/\}/,contains:[p],illegal:"\\n",relevance:0},v={begin:"\\[",end:"\\]",contains:[p],illegal:"\\n",relevance:0},_=[a,{className:"meta",begin:"^---\\s*$",relevance:10},{className:"string",begin:"[\\|>]([1-9]?[+-])?[ ]*\\n( +)[^ ][^\\n]*\\n(\\2[^\\n]+\\n?)*"},{begin:"<%[%=-]?",end:"[%-]?%>",subLanguage:"ruby",excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:"!\\w+!"+n},{className:"type",begin:"!<"+n+">"},{className:"type",begin:"!"+n},{className:"type",begin:"!!"+n},{className:"meta",begin:"&"+e.UNDERSCORE_IDENT_RE+"$"},{className:"meta",begin:"\\*"+e.UNDERSCORE_IDENT_RE+"$"},{className:"bullet",begin:"-(?=[ ]|$)",relevance:0},e.HASH_COMMENT_MODE,{beginKeywords:t,keywords:{literal:t}},f,{className:"number",begin:e.C_NUMBER_RE+"\\b",relevance:0},m,v,i,o],w=[..._];return w.pop(),w.push(u),p.contains=w,{name:"YAML",case_insensitive:!0,aliases:["yml"],contains:_}}return Ad=r,Ad}var kd,J1;function PE(){if(J1)return kd;J1=1;const r="[A-Za-z$_][0-9A-Za-z$_]*",e=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends","using"],t=["true","false","null","undefined","NaN","Infinity"],n=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],a=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],s=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],i=["arguments","this","super","console","window","document","localStorage","sessionStorage","module","global"],o=[].concat(s,n,a);function u(c){const d=c.regex,h=(q,{after:$})=>{const Ee="</"+q[0].slice(1);return q.input.indexOf(Ee,$)!==-1},f=r,p={begin:"<>",end:"</>"},m=/<[A-Za-z0-9\\._:-]+\s*\/>/,v={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(q,$)=>{const Ee=q[0].length+q.index,Ve=q.input[Ee];if(Ve==="<"||Ve===","){$.ignoreMatch();return}Ve===">"&&(h(q,{after:Ee})||$.ignoreMatch());let at;const ot=q.input.substring(Ee);if(at=ot.match(/^\s*=/)){$.ignoreMatch();return}if((at=ot.match(/^\s+extends\s+/))&&at.index===0){$.ignoreMatch();return}}},_={$pattern:r,keyword:e,literal:t,built_in:o,"variable.language":i},w="[0-9](_?[0-9])*",E=`\\.(${w})`,F="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",k={className:"number",variants:[{begin:`(\\b(${F})((${E})|\\.)?|(${E}))[eE][+-]?(${w})\\b`},{begin:`\\b(${F})\\b((${E})\\b|\\.)?|(${E})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},N={className:"subst",begin:"\\$\\{",end:"\\}",keywords:_,contains:[]},B={begin:".?html`",end:"",starts:{end:"`",returnEnd:!1,contains:[c.BACKSLASH_ESCAPE,N],subLanguage:"xml"}},A={begin:".?css`",end:"",starts:{end:"`",returnEnd:!1,contains:[c.BACKSLASH_ESCAPE,N],subLanguage:"css"}},L={begin:".?gql`",end:"",starts:{end:"`",returnEnd:!1,contains:[c.BACKSLASH_ESCAPE,N],subLanguage:"graphql"}},V={className:"string",begin:"`",end:"`",contains:[c.BACKSLASH_ESCAPE,N]},te={className:"comment",variants:[c.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:f+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),c.C_BLOCK_COMMENT_MODE,c.C_LINE_COMMENT_MODE]},ve=[c.APOS_STRING_MODE,c.QUOTE_STRING_MODE,B,A,L,V,{match:/\$\d+/},k];N.contains=ve.concat({begin:/\{/,end:/\}/,keywords:_,contains:["self"].concat(ve)});const D=[].concat(te,N.contains),M=D.concat([{begin:/(\s*)\(/,end:/\)/,keywords:_,contains:["self"].concat(D)}]),P={className:"params",begin:/(\s*)\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:_,contains:M},Z={variants:[{match:[/class/,/\s+/,f,/\s+/,/extends/,/\s+/,d.concat(f,"(",d.concat(/\./,f),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,f],scope:{1:"keyword",3:"title.class"}}]},W={relevance:0,match:d.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...n,...a]}},X={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},Y={variants:[{match:[/function/,/\s+/,f,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[P],illegal:/%/},re={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function U(q){return d.concat("(?!",q.join("|"),")")}const j={match:d.concat(/\b/,U([...s,"super","import"].map(q=>`${q}\\s*\\(`)),f,d.lookahead(/\s*\(/)),className:"title.function",relevance:0},ae={begin:d.concat(/\./,d.lookahead(d.concat(f,/(?![0-9A-Za-z$_(])/))),end:f,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},Q={match:[/get|set/,/\s+/,f,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},P]},C="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+c.UNDERSCORE_IDENT_RE+")\\s*=>",x={match:[/const|var|let/,/\s+/,f,/\s*/,/=\s*/,/(async\s*)?/,d.lookahead(C)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[P]};return{name:"JavaScript",aliases:["js","jsx","mjs","cjs"],keywords:_,exports:{PARAMS_CONTAINS:M,CLASS_REFERENCE:W},illegal:/#(?![$_A-z])/,contains:[c.SHEBANG({label:"shebang",binary:"node",relevance:5}),X,c.APOS_STRING_MODE,c.QUOTE_STRING_MODE,B,A,L,V,te,{match:/\$\d+/},k,W,{scope:"attr",match:f+d.lookahead(":"),relevance:0},x,{begin:"("+c.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[te,c.REGEXP_MODE,{className:"function",begin:C,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:c.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/(\s*)\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:_,contains:M}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:p.begin,end:p.end},{match:m},{begin:v.begin,"on:begin":v.isTrulyOpeningTag,end:v.end}],subLanguage:"xml",contains:[{begin:v.begin,end:v.end,skip:!0,contains:["self"]}]}]},Y,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+c.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[P,c.inherit(c.TITLE_MODE,{begin:f,className:"title.function"})]},{match:/\.\.\./,relevance:0},ae,{match:"\\$"+f,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[P]},j,re,Z,Q,{match:/\$[(.]/}]}}function l(c){const d=c.regex,h=u(c),f=r,p=["any","void","number","boolean","string","object","never","symbol","bigint","unknown"],m={begin:[/namespace/,/\s+/,c.IDENT_RE],beginScope:{1:"keyword",3:"title.class"}},v={beginKeywords:"interface",end:/\{/,excludeEnd:!0,keywords:{keyword:"interface extends",built_in:p},contains:[h.exports.CLASS_REFERENCE]},_={className:"meta",relevance:10,begin:/^\s*['"]use strict['"]/},w=["type","interface","public","private","protected","implements","declare","abstract","readonly","enum","override","satisfies"],E={$pattern:r,keyword:e.concat(w),literal:t,built_in:o.concat(p),"variable.language":i},F={className:"meta",begin:"@"+f},k=(L,V,G)=>{const te=L.contains.findIndex(ve=>ve.label===V);if(te===-1)throw new Error("can not find mode to replace");L.contains.splice(te,1,G)};Object.assign(h.keywords,E),h.exports.PARAMS_CONTAINS.push(F);const N=h.contains.find(L=>L.scope==="attr"),B=Object.assign({},N,{match:d.concat(f,d.lookahead(/\s*\?:/))});h.exports.PARAMS_CONTAINS.push([h.exports.CLASS_REFERENCE,N,B]),h.contains=h.contains.concat([F,m,v,B]),k(h,"shebang",c.SHEBANG()),k(h,"use_strict",_);const A=h.contains.find(L=>L.label==="func.def");return A.relevance=0,Object.assign(h,{name:"TypeScript",aliases:["ts","tsx","mts","cts"]}),h}return kd=l,kd}var Cd,X1;function LE(){if(X1)return Cd;X1=1;function r(e){const t=e.regex,n={className:"string",begin:/"(""|[^/n])"C\b/},a={className:"string",begin:/"/,end:/"/,illegal:/\n/,contains:[{begin:/""/}]},s=/\d{1,2}\/\d{1,2}\/\d{4}/,i=/\d{4}-\d{1,2}-\d{1,2}/,o=/(\d|1[012])(:\d+){0,2} *(AM|PM)/,u=/\d{1,2}(:\d{1,2}){1,2}/,l={className:"literal",variants:[{begin:t.concat(/# */,t.either(i,s),/ *#/)},{begin:t.concat(/# */,u,/ *#/)},{begin:t.concat(/# */,o,/ *#/)},{begin:t.concat(/# */,t.either(i,s),/ +/,t.either(o,u),/ *#/)}]},c={className:"number",relevance:0,variants:[{begin:/\b\d[\d_]*((\.[\d_]+(E[+-]?[\d_]+)?)|(E[+-]?[\d_]+))[RFD@!#]?/},{begin:/\b\d[\d_]*((U?[SIL])|[%&])?/},{begin:/&H[\dA-F_]+((U?[SIL])|[%&])?/},{begin:/&O[0-7_]+((U?[SIL])|[%&])?/},{begin:/&B[01_]+((U?[SIL])|[%&])?/}]},d={className:"label",begin:/^\w+:/},h=e.COMMENT(/'''/,/$/,{contains:[{className:"doctag",begin:/<\/?/,end:/>/}]}),f=e.COMMENT(null,/$/,{variants:[{begin:/'/},{begin:/([\t ]|^)REM(?=\s)/}]});return{name:"Visual Basic .NET",aliases:["vb"],case_insensitive:!0,classNameAliases:{label:"symbol"},keywords:{keyword:"addhandler alias aggregate ansi as async assembly auto binary by byref byval call case catch class compare const continue custom declare default delegate dim distinct do each equals else elseif end enum erase error event exit explicit finally for friend from function get global goto group handles if implements imports in inherits interface into iterator join key let lib loop me mid module mustinherit mustoverride mybase myclass namespace narrowing new next notinheritable notoverridable of off on operator option optional order overloads overridable overrides paramarray partial preserve private property protected public raiseevent readonly redim removehandler resume return select set shadows shared skip static step stop structure strict sub synclock take text then throw to try unicode until using when where while widening with withevents writeonly yield",built_in:"addressof and andalso await directcast gettype getxmlnamespace is isfalse isnot istrue like mod nameof new not or orelse trycast typeof xor cbool cbyte cchar cdate cdbl cdec cint clng cobj csbyte cshort csng cstr cuint culng cushort",type:"boolean byte char date decimal double integer long object sbyte short single string uinteger ulong ushort",literal:"true false nothing"},illegal:"//|\\{|\\}|endif|gosub|variant|wend|^\\$ ",contains:[n,a,l,c,d,h,f,{className:"meta",begin:/[\t ]*#(const|disable|else|elseif|enable|end|externalsource|if|region)\b/,end:/$/,keywords:{keyword:"const disable else elseif enable end externalsource if region then"},contains:[f]}]}}return Cd=r,Cd}var Td,Q1;function zE(){if(Q1)return Td;Q1=1;function r(e){e.regex;const t=e.COMMENT(/\(;/,/;\)/);t.contains.push("self");const n=e.COMMENT(/;;/,/$/),a=["anyfunc","block","br","br_if","br_table","call","call_indirect","data","drop","elem","else","end","export","func","global.get","global.set","local.get","local.set","local.tee","get_global","get_local","global","if","import","local","loop","memory","memory.grow","memory.size","module","mut","nop","offset","param","result","return","select","set_global","set_local","start","table","tee_local","then","type","unreachable"],s={begin:[/(?:func|call|call_indirect)/,/\s+/,/\$[^\s)]+/],className:{1:"keyword",3:"title.function"}},i={className:"variable",begin:/\$[\w_]+/},o={match:/(\((?!;)|\))+/,className:"punctuation",relevance:0},u={className:"number",relevance:0,match:/[+-]?\b(?:\d(?:_?\d)*(?:\.\d(?:_?\d)*)?(?:[eE][+-]?\d(?:_?\d)*)?|0x[\da-fA-F](?:_?[\da-fA-F])*(?:\.[\da-fA-F](?:_?[\da-fA-D])*)?(?:[pP][+-]?\d(?:_?\d)*)?)\b|\binf\b|\bnan(?::0x[\da-fA-F](?:_?[\da-fA-D])*)?\b/},l={match:/(i32|i64|f32|f64)(?!\.)/,className:"type"},c={className:"keyword",match:/\b(f32|f64|i32|i64)(?:\.(?:abs|add|and|ceil|clz|const|convert_[su]\/i(?:32|64)|copysign|ctz|demote\/f64|div(?:_[su])?|eqz?|extend_[su]\/i32|floor|ge(?:_[su])?|gt(?:_[su])?|le(?:_[su])?|load(?:(?:8|16|32)_[su])?|lt(?:_[su])?|max|min|mul|nearest|neg?|or|popcnt|promote\/f32|reinterpret\/[fi](?:32|64)|rem_[su]|rot[lr]|shl|shr_[su]|store(?:8|16|32)?|sqrt|sub|trunc(?:_[su]\/f(?:32|64))?|wrap\/i64|xor))\b/};return{name:"WebAssembly",keywords:{$pattern:/[\w.]+/,keyword:a},contains:[n,t,{match:[/(?:offset|align)/,/\s*/,/=/],className:{1:"keyword",3:"operator"}},i,o,s,e.QUOTE_STRING_MODE,l,c,u]}}return Td=r,Td}var Fd,ey;function UE(){if(ey)return Fd;ey=1;var r=aE();return r.registerLanguage("xml",sE()),r.registerLanguage("bash",iE()),r.registerLanguage("c",oE()),r.registerLanguage("cpp",uE()),r.registerLanguage("csharp",lE()),r.registerLanguage("css",cE()),r.registerLanguage("markdown",dE()),r.registerLanguage("diff",hE()),r.registerLanguage("ruby",fE()),r.registerLanguage("go",pE()),r.registerLanguage("graphql",mE()),r.registerLanguage("ini",gE()),r.registerLanguage("java",yE()),r.registerLanguage("javascript",vE()),r.registerLanguage("json",_E()),r.registerLanguage("kotlin",bE()),r.registerLanguage("less",wE()),r.registerLanguage("lua",EE()),r.registerLanguage("makefile",xE()),r.registerLanguage("perl",SE()),r.registerLanguage("objectivec",AE()),r.registerLanguage("php",kE()),r.registerLanguage("php-template",CE()),r.registerLanguage("plaintext",TE()),r.registerLanguage("python",FE()),r.registerLanguage("python-repl",NE()),r.registerLanguage("r",IE()),r.registerLanguage("rust",OE()),r.registerLanguage("scss",RE()),r.registerLanguage("shell",DE()),r.registerLanguage("sql",BE()),r.registerLanguage("swift",ME()),r.registerLanguage("yaml",$E()),r.registerLanguage("typescript",PE()),r.registerLanguage("vbnet",LE()),r.registerLanguage("wasm",zE()),r.HighlightJS=r,r.default=r,Fd=r,Fd}var jE=UE();const Nd=Ai(jE);var ty={},ry;function qE(){if(ry)return ty;ry=1;var r=r||{};function e(t){return{subLanguage:"xml",contains:[t.COMMENT("<!--","-->",{relevance:10}),{begin:/^(\s*)(<script>)/gm,end:/^(\s*)(<\/script>)/gm,subLanguage:"javascript",excludeBegin:!0,excludeEnd:!0},{begin:/^(\s*)(<script lang=["']ts["']>)/gm,end:/^(\s*)(<\/script>)/gm,subLanguage:"typescript",excludeBegin:!0,excludeEnd:!0},{begin:/^(\s*)(<style(\sscoped)?>)/gm,end:/^(\s*)(<\/style>)/gm,subLanguage:"css",excludeBegin:!0,excludeEnd:!0},{begin:/^(\s*)(<style lang=["'](scss|sass)["'](\sscoped)?>)/gm,end:/^(\s*)(<\/style>)/gm,subLanguage:"scss",excludeBegin:!0,excludeEnd:!0},{begin:/^(\s*)(<style lang=["']stylus["'](\sscoped)?>)/gm,end:/^(\s*)(<\/style>)/gm,subLanguage:"stylus",excludeBegin:!0,excludeEnd:!0}]}}return r.exports=function(t){t.registerLanguage("vue",e)},r.exports.definer=e,ty}var HE=qE();const VE=Ai(HE);function Xp(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ki=Xp();function h4(r){ki=r}var Yo={exec:()=>null};function zt(r,e=""){let t=typeof r=="string"?r:r.source;const n={replace:(a,s)=>{let i=typeof s=="string"?s:s.source;return i=i.replace(Qr.caret,"$1"),t=t.replace(a,i),n},getRegex:()=>new RegExp(t,e)};return n}var Qr={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},GE=/^(?:[ \t]*(?:\n|$))+/,ZE=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,KE=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,$u=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,WE=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Qp=/(?:[*+-]|\d{1,9}[.)])/,f4=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,p4=zt(f4).replace(/bull/g,Qp).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),YE=zt(f4).replace(/bull/g,Qp).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),em=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,JE=/^[^\n]+/,tm=/(?!\s*\])(?:\\.|[^\[\]\\])+/,XE=zt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",tm).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),QE=zt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Qp).getRegex(),Xc="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",rm=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,e9=zt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",rm).replace("tag",Xc).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),m4=zt(em).replace("hr",$u).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Xc).getRegex(),t9=zt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",m4).getRegex(),nm={blockquote:t9,code:ZE,def:XE,fences:KE,heading:WE,hr:$u,html:e9,lheading:p4,list:QE,newline:GE,paragraph:m4,table:Yo,text:JE},ny=zt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",$u).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Xc).getRegex(),r9={...nm,lheading:YE,table:ny,paragraph:zt(em).replace("hr",$u).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ny).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Xc).getRegex()},n9={...nm,html:zt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",rm).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Yo,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:zt(em).replace("hr",$u).replace("heading",` *#{1,6} *[^
]`).replace("lheading",p4).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},a9=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,s9=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,g4=/^( {2,}|\\)\n(?!\s*$)/,i9=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Qc=/[\p{P}\p{S}]/u,am=/[\s\p{P}\p{S}]/u,y4=/[^\s\p{P}\p{S}]/u,o9=zt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,am).getRegex(),v4=/(?!~)[\p{P}\p{S}]/u,u9=/(?!~)[\s\p{P}\p{S}]/u,l9=/(?:[^\s\p{P}\p{S}]|~)/u,c9=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,_4=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,d9=zt(_4,"u").replace(/punct/g,Qc).getRegex(),h9=zt(_4,"u").replace(/punct/g,v4).getRegex(),b4="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",f9=zt(b4,"gu").replace(/notPunctSpace/g,y4).replace(/punctSpace/g,am).replace(/punct/g,Qc).getRegex(),p9=zt(b4,"gu").replace(/notPunctSpace/g,l9).replace(/punctSpace/g,u9).replace(/punct/g,v4).getRegex(),m9=zt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,y4).replace(/punctSpace/g,am).replace(/punct/g,Qc).getRegex(),g9=zt(/\\(punct)/,"gu").replace(/punct/g,Qc).getRegex(),y9=zt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),v9=zt(rm).replace("(?:-->|$)","-->").getRegex(),_9=zt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",v9).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),dc=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,b9=zt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",dc).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),w4=zt(/^!?\[(label)\]\[(ref)\]/).replace("label",dc).replace("ref",tm).getRegex(),E4=zt(/^!?\[(ref)\](?:\[\])?/).replace("ref",tm).getRegex(),w9=zt("reflink|nolink(?!\\()","g").replace("reflink",w4).replace("nolink",E4).getRegex(),sm={_backpedal:Yo,anyPunctuation:g9,autolink:y9,blockSkip:c9,br:g4,code:s9,del:Yo,emStrongLDelim:d9,emStrongRDelimAst:f9,emStrongRDelimUnd:m9,escape:a9,link:b9,nolink:E4,punctuation:o9,reflink:w4,reflinkSearch:w9,tag:_9,text:i9,url:Yo},E9={...sm,link:zt(/^!?\[(label)\]\((.*?)\)/).replace("label",dc).getRegex(),reflink:zt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",dc).getRegex()},Of={...sm,emStrongRDelimAst:p9,emStrongLDelim:h9,url:zt(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},x9={...Of,br:zt(g4).replace("{2,}","*").getRegex(),text:zt(Of.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ol={normal:nm,gfm:r9,pedantic:n9},Oo={normal:sm,gfm:Of,breaks:x9,pedantic:E9},S9={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ay=r=>S9[r];function wa(r,e){if(e){if(Qr.escapeTest.test(r))return r.replace(Qr.escapeReplace,ay)}else if(Qr.escapeTestNoEncode.test(r))return r.replace(Qr.escapeReplaceNoEncode,ay);return r}function sy(r){try{r=encodeURI(r).replace(Qr.percentDecode,"%")}catch{return null}return r}function iy(r,e){var s;const t=r.replace(Qr.findPipe,(i,o,u)=>{let l=!1,c=o;for(;--c>=0&&u[c]==="\\";)l=!l;return l?"|":" |"}),n=t.split(Qr.splitPipe);let a=0;if(n[0].trim()||n.shift(),n.length>0&&!((s=n.at(-1))!=null&&s.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;a<n.length;a++)n[a]=n[a].trim().replace(Qr.slashPipe,"|");return n}function Ro(r,e,t){const n=r.length;if(n===0)return"";let a=0;for(;a<n&&r.charAt(n-a-1)===e;)a++;return r.slice(0,n-a)}function A9(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return t>0?-2:-1}function oy(r,e,t,n,a){const s=e.href,i=e.title||null,o=r[1].replace(a.other.outputLinkReplace,"$1");n.state.inLink=!0;const u={type:r[0].charAt(0)==="!"?"image":"link",raw:t,href:s,title:i,text:o,tokens:n.inlineTokens(o)};return n.state.inLink=!1,u}function k9(r,e,t){const n=r.match(t.other.indentCodeCompensation);if(n===null)return e;const a=n[1];return e.split(`
`).map(s=>{const i=s.match(t.other.beginningSpace);if(i===null)return s;const[o]=i;return o.length>=a.length?s.slice(a.length):s}).join(`
`)}var hc=class{constructor(r){g(this,"options");g(this,"rules");g(this,"lexer");this.options=r||ki}space(r){const e=this.rules.block.newline.exec(r);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(r){const e=this.rules.block.code.exec(r);if(e){const t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:Ro(t,`
`)}}}fences(r){const e=this.rules.block.fences.exec(r);if(e){const t=e[0],n=k9(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:n}}}heading(r){const e=this.rules.block.heading.exec(r);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){const n=Ro(t,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(t=n.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(r){const e=this.rules.block.hr.exec(r);if(e)return{type:"hr",raw:Ro(e[0],`
`)}}blockquote(r){const e=this.rules.block.blockquote.exec(r);if(e){let t=Ro(e[0],`
`).split(`
`),n="",a="";const s=[];for(;t.length>0;){let i=!1;const o=[];let u;for(u=0;u<t.length;u++)if(this.rules.other.blockquoteStart.test(t[u]))o.push(t[u]),i=!0;else if(!i)o.push(t[u]);else break;t=t.slice(u);const l=o.join(`
`),c=l.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${l}`:l,a=a?`${a}
${c}`:c;const d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(c,s,!0),this.lexer.state.top=d,t.length===0)break;const h=s.at(-1);if((h==null?void 0:h.type)==="code")break;if((h==null?void 0:h.type)==="blockquote"){const f=h,p=f.raw+`
`+t.join(`
`),m=this.blockquote(p);s[s.length-1]=m,n=n.substring(0,n.length-f.raw.length)+m.raw,a=a.substring(0,a.length-f.text.length)+m.text;break}else if((h==null?void 0:h.type)==="list"){const f=h,p=f.raw+`
`+t.join(`
`),m=this.list(p);s[s.length-1]=m,n=n.substring(0,n.length-h.raw.length)+m.raw,a=a.substring(0,a.length-f.raw.length)+m.raw,t=p.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:s,text:a}}}list(r){let e=this.rules.block.list.exec(r);if(e){let t=e[1].trim();const n=t.length>1,a={type:"list",raw:"",ordered:n,start:n?+t.slice(0,-1):"",loose:!1,items:[]};t=n?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=n?t:"[*+-]");const s=this.rules.other.listItemRegex(t);let i=!1;for(;r;){let u=!1,l="",c="";if(!(e=s.exec(r))||this.rules.block.hr.test(r))break;l=e[0],r=r.substring(l.length);let d=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,_=>" ".repeat(3*_.length)),h=r.split(`
`,1)[0],f=!d.trim(),p=0;if(this.options.pedantic?(p=2,c=d.trimStart()):f?p=e[1].length+1:(p=e[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,c=d.slice(p),p+=e[1].length),f&&this.rules.other.blankLine.test(h)&&(l+=h+`
`,r=r.substring(h.length+1),u=!0),!u){const _=this.rules.other.nextBulletRegex(p),w=this.rules.other.hrRegex(p),E=this.rules.other.fencesBeginRegex(p),F=this.rules.other.headingBeginRegex(p),k=this.rules.other.htmlBeginRegex(p);for(;r;){const N=r.split(`
`,1)[0];let B;if(h=N,this.options.pedantic?(h=h.replace(this.rules.other.listReplaceNesting,"  "),B=h):B=h.replace(this.rules.other.tabCharGlobal,"    "),E.test(h)||F.test(h)||k.test(h)||_.test(h)||w.test(h))break;if(B.search(this.rules.other.nonSpaceChar)>=p||!h.trim())c+=`
`+B.slice(p);else{if(f||d.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||E.test(d)||F.test(d)||w.test(d))break;c+=`
`+h}!f&&!h.trim()&&(f=!0),l+=N+`
`,r=r.substring(N.length+1),d=B.slice(p)}}a.loose||(i?a.loose=!0:this.rules.other.doubleBlankLine.test(l)&&(i=!0));let m=null,v;this.options.gfm&&(m=this.rules.other.listIsTask.exec(c),m&&(v=m[0]!=="[ ] ",c=c.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:l,task:!!m,checked:v,loose:!1,text:c,tokens:[]}),a.raw+=l}const o=a.items.at(-1);if(o)o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let u=0;u<a.items.length;u++)if(this.lexer.state.top=!1,a.items[u].tokens=this.lexer.blockTokens(a.items[u].text,[]),!a.loose){const l=a.items[u].tokens.filter(d=>d.type==="space"),c=l.length>0&&l.some(d=>this.rules.other.anyLine.test(d.raw));a.loose=c}if(a.loose)for(let u=0;u<a.items.length;u++)a.items[u].loose=!0;return a}}html(r){const e=this.rules.block.html.exec(r);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(r){const e=this.rules.block.def.exec(r);if(e){const t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:n,title:a}}}table(r){var i;const e=this.rules.block.table.exec(r);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;const t=iy(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(i=e[3])!=null&&i.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===n.length){for(const o of n)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<t.length;o++)s.header.push({text:t[o],tokens:this.lexer.inline(t[o]),header:!0,align:s.align[o]});for(const o of a)s.rows.push(iy(o,s.header.length).map((u,l)=>({text:u,tokens:this.lexer.inline(u),header:!1,align:s.align[l]})));return s}}lheading(r){const e=this.rules.block.lheading.exec(r);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(r){const e=this.rules.block.paragraph.exec(r);if(e){const t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(r){const e=this.rules.block.text.exec(r);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(r){const e=this.rules.inline.escape.exec(r);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(r){const e=this.rules.inline.tag.exec(r);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(r){const e=this.rules.inline.link.exec(r);if(e){const t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;const s=Ro(t.slice(0,-1),"\\");if((t.length-s.length)%2===0)return}else{const s=A9(e[2],"()");if(s===-2)return;if(s>-1){const o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let n=e[2],a="";if(this.options.pedantic){const s=this.rules.other.pedanticHrefTitle.exec(n);s&&(n=s[1],a=s[3])}else a=e[3]?e[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?n=n.slice(1):n=n.slice(1,-1)),oy(e,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(r,e){let t;if((t=this.rules.inline.reflink.exec(r))||(t=this.rules.inline.nolink.exec(r))){const n=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[n.toLowerCase()];if(!a){const s=t[0].charAt(0);return{type:"text",raw:s,text:s}}return oy(t,a,t[0],this.lexer,this.rules)}}emStrong(r,e,t=""){let n=this.rules.inline.emStrongLDelim.exec(r);if(!n||n[3]&&t.match(this.rules.other.unicodeAlphaNumeric))return;if(!(n[1]||n[2]||"")||!t||this.rules.inline.punctuation.exec(t)){const s=[...n[0]].length-1;let i,o,u=s,l=0;const c=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,e=e.slice(-1*r.length+s);(n=c.exec(e))!=null;){if(i=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!i)continue;if(o=[...i].length,n[3]||n[4]){u+=o;continue}else if((n[5]||n[6])&&s%3&&!((s+o)%3)){l+=o;continue}if(u-=o,u>0)continue;o=Math.min(o,o+u+l);const d=[...n[0]][0].length,h=r.slice(0,s+n.index+d+o);if(Math.min(s,o)%2){const p=h.slice(1,-1);return{type:"em",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}const f=h.slice(2,-2);return{type:"strong",raw:h,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(r){const e=this.rules.inline.code.exec(r);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," ");const n=this.rules.other.nonSpaceChar.test(t),a=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return n&&a&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(r){const e=this.rules.inline.br.exec(r);if(e)return{type:"br",raw:e[0]}}del(r){const e=this.rules.inline.del.exec(r);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(r){const e=this.rules.inline.autolink.exec(r);if(e){let t,n;return e[2]==="@"?(t=e[1],n="mailto:"+t):(t=e[1],n=t),{type:"link",raw:e[0],text:t,href:n,tokens:[{type:"text",raw:t,text:t}]}}}url(r){var t;let e;if(e=this.rules.inline.url.exec(r)){let n,a;if(e[2]==="@")n=e[0],a="mailto:"+n;else{let s;do s=e[0],e[0]=((t=this.rules.inline._backpedal.exec(e[0]))==null?void 0:t[0])??"";while(s!==e[0]);n=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(r){const e=this.rules.inline.text.exec(r);if(e){const t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},Za=class Rf{constructor(e){g(this,"tokens");g(this,"options");g(this,"state");g(this,"tokenizer");g(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ki,this.options.tokenizer=this.options.tokenizer||new hc,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:Qr,block:ol.normal,inline:Oo.normal};this.options.pedantic?(t.block=ol.pedantic,t.inline=Oo.pedantic):this.options.gfm&&(t.block=ol.gfm,this.options.breaks?t.inline=Oo.breaks:t.inline=Oo.gfm),this.tokenizer.rules=t}static get rules(){return{block:ol,inline:Oo}}static lex(e,t){return new Rf(t).lex(e)}static lexInline(e,t){return new Rf(t).inlineTokens(e)}lex(e){e=e.replace(Qr.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){var a,s,i;for(this.options.pedantic&&(e=e.replace(Qr.tabCharGlobal,"    ").replace(Qr.spaceLine,""));e;){let o;if((s=(a=this.options.extensions)==null?void 0:a.block)!=null&&s.some(l=>(o=l.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);const l=t.at(-1);o.raw.length===1&&l!==void 0?l.raw+=`
`:t.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);const l=t.at(-1);(l==null?void 0:l.type)==="paragraph"||(l==null?void 0:l.type)==="text"?(l.raw+=`
`+o.raw,l.text+=`
`+o.text,this.inlineQueue.at(-1).src=l.text):t.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);const l=t.at(-1);(l==null?void 0:l.type)==="paragraph"||(l==null?void 0:l.type)==="text"?(l.raw+=`
`+o.raw,l.text+=`
`+o.raw,this.inlineQueue.at(-1).src=l.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),t.push(o);continue}let u=e;if((i=this.options.extensions)!=null&&i.startBlock){let l=1/0;const c=e.slice(1);let d;this.options.extensions.startBlock.forEach(h=>{d=h.call({lexer:this},c),typeof d=="number"&&d>=0&&(l=Math.min(l,d))}),l<1/0&&l>=0&&(u=e.substring(0,l+1))}if(this.state.top&&(o=this.tokenizer.paragraph(u))){const l=t.at(-1);n&&(l==null?void 0:l.type)==="paragraph"?(l.raw+=`
`+o.raw,l.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):t.push(o),n=u.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);const l=t.at(-1);(l==null?void 0:l.type)==="text"?(l.raw+=`
`+o.raw,l.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):t.push(o);continue}if(e){const l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var o,u,l;let n=e,a=null;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)c.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,a.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let s=!1,i="";for(;e;){s||(i=""),s=!1;let c;if((u=(o=this.options.extensions)==null?void 0:o.inline)!=null&&u.some(h=>(c=h.call({lexer:this},e,t))?(e=e.substring(c.raw.length),t.push(c),!0):!1))continue;if(c=this.tokenizer.escape(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.tag(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.link(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(c.raw.length);const h=t.at(-1);c.type==="text"&&(h==null?void 0:h.type)==="text"?(h.raw+=c.raw,h.text+=c.text):t.push(c);continue}if(c=this.tokenizer.emStrong(e,n,i)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.codespan(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.br(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.del(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.autolink(e)){e=e.substring(c.raw.length),t.push(c);continue}if(!this.state.inLink&&(c=this.tokenizer.url(e))){e=e.substring(c.raw.length),t.push(c);continue}let d=e;if((l=this.options.extensions)!=null&&l.startInline){let h=1/0;const f=e.slice(1);let p;this.options.extensions.startInline.forEach(m=>{p=m.call({lexer:this},f),typeof p=="number"&&p>=0&&(h=Math.min(h,p))}),h<1/0&&h>=0&&(d=e.substring(0,h+1))}if(c=this.tokenizer.inlineText(d)){e=e.substring(c.raw.length),c.raw.slice(-1)!=="_"&&(i=c.raw.slice(-1)),s=!0;const h=t.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=c.raw,h.text+=c.text):t.push(c);continue}if(e){const h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return t}},fc=class{constructor(r){g(this,"options");g(this,"parser");this.options=r||ki}space(r){return""}code({text:r,lang:e,escaped:t}){var s;const n=(s=(e||"").match(Qr.notSpaceStart))==null?void 0:s[0],a=r.replace(Qr.endingNewline,"")+`
`;return n?'<pre><code class="language-'+wa(n)+'">'+(t?a:wa(a,!0))+`</code></pre>
`:"<pre><code>"+(t?a:wa(a,!0))+`</code></pre>
`}blockquote({tokens:r}){return`<blockquote>
${this.parser.parse(r)}</blockquote>
`}html({text:r}){return r}heading({tokens:r,depth:e}){return`<h${e}>${this.parser.parseInline(r)}</h${e}>
`}hr(r){return`<hr>
`}list(r){const e=r.ordered,t=r.start;let n="";for(let i=0;i<r.items.length;i++){const o=r.items[i];n+=this.listitem(o)}const a=e?"ol":"ul",s=e&&t!==1?' start="'+t+'"':"";return"<"+a+s+`>
`+n+"</"+a+`>
`}listitem(r){var t;let e="";if(r.task){const n=this.checkbox({checked:!!r.checked});r.loose?((t=r.tokens[0])==null?void 0:t.type)==="paragraph"?(r.tokens[0].text=n+" "+r.tokens[0].text,r.tokens[0].tokens&&r.tokens[0].tokens.length>0&&r.tokens[0].tokens[0].type==="text"&&(r.tokens[0].tokens[0].text=n+" "+wa(r.tokens[0].tokens[0].text),r.tokens[0].tokens[0].escaped=!0)):r.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):e+=n+" "}return e+=this.parser.parse(r.tokens,!!r.loose),`<li>${e}</li>
`}checkbox({checked:r}){return"<input "+(r?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:r}){return`<p>${this.parser.parseInline(r)}</p>
`}table(r){let e="",t="";for(let a=0;a<r.header.length;a++)t+=this.tablecell(r.header[a]);e+=this.tablerow({text:t});let n="";for(let a=0;a<r.rows.length;a++){const s=r.rows[a];t="";for(let i=0;i<s.length;i++)t+=this.tablecell(s[i]);n+=this.tablerow({text:t})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+n+`</table>
`}tablerow({text:r}){return`<tr>
${r}</tr>
`}tablecell(r){const e=this.parser.parseInline(r.tokens),t=r.header?"th":"td";return(r.align?`<${t} align="${r.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:r}){return`<strong>${this.parser.parseInline(r)}</strong>`}em({tokens:r}){return`<em>${this.parser.parseInline(r)}</em>`}codespan({text:r}){return`<code>${wa(r,!0)}</code>`}br(r){return"<br>"}del({tokens:r}){return`<del>${this.parser.parseInline(r)}</del>`}link({href:r,title:e,tokens:t}){const n=this.parser.parseInline(t),a=sy(r);if(a===null)return n;r=a;let s='<a href="'+r+'"';return e&&(s+=' title="'+wa(e)+'"'),s+=">"+n+"</a>",s}image({href:r,title:e,text:t,tokens:n}){n&&(t=this.parser.parseInline(n,this.parser.textRenderer));const a=sy(r);if(a===null)return wa(t);r=a;let s=`<img src="${r}" alt="${t}"`;return e&&(s+=` title="${wa(e)}"`),s+=">",s}text(r){return"tokens"in r&&r.tokens?this.parser.parseInline(r.tokens):"escaped"in r&&r.escaped?r.text:wa(r.text)}},im=class{strong({text:r}){return r}em({text:r}){return r}codespan({text:r}){return r}del({text:r}){return r}html({text:r}){return r}text({text:r}){return r}link({text:r}){return""+r}image({text:r}){return""+r}br(){return""}},Ka=class Df{constructor(e){g(this,"options");g(this,"renderer");g(this,"textRenderer");this.options=e||ki,this.options.renderer=this.options.renderer||new fc,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new im}static parse(e,t){return new Df(t).parse(e)}static parseInline(e,t){return new Df(t).parseInline(e)}parse(e,t=!0){var a,s;let n="";for(let i=0;i<e.length;i++){const o=e[i];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[o.type]){const l=o,c=this.options.extensions.renderers[l.type].call({parser:this},l);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(l.type)){n+=c||"";continue}}const u=o;switch(u.type){case"space":{n+=this.renderer.space(u);continue}case"hr":{n+=this.renderer.hr(u);continue}case"heading":{n+=this.renderer.heading(u);continue}case"code":{n+=this.renderer.code(u);continue}case"table":{n+=this.renderer.table(u);continue}case"blockquote":{n+=this.renderer.blockquote(u);continue}case"list":{n+=this.renderer.list(u);continue}case"html":{n+=this.renderer.html(u);continue}case"paragraph":{n+=this.renderer.paragraph(u);continue}case"text":{let l=u,c=this.renderer.text(l);for(;i+1<e.length&&e[i+1].type==="text";)l=e[++i],c+=`
`+this.renderer.text(l);t?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{const l='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}parseInline(e,t=this.renderer){var a,s;let n="";for(let i=0;i<e.length;i++){const o=e[i];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[o.type]){const l=this.options.extensions.renderers[o.type].call({parser:this},o);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=l||"";continue}}const u=o;switch(u.type){case"escape":{n+=t.text(u);break}case"html":{n+=t.html(u);break}case"link":{n+=t.link(u);break}case"image":{n+=t.image(u);break}case"strong":{n+=t.strong(u);break}case"em":{n+=t.em(u);break}case"codespan":{n+=t.codespan(u);break}case"br":{n+=t.br(u);break}case"del":{n+=t.del(u);break}case"text":{n+=t.text(u);break}default:{const l='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}},Tf,Ul=(Tf=class{constructor(r){g(this,"options");g(this,"block");this.options=r||ki}preprocess(r){return r}postprocess(r){return r}processAllTokens(r){return r}provideLexer(){return this.block?Za.lex:Za.lexInline}provideParser(){return this.block?Ka.parse:Ka.parseInline}},g(Tf,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),Tf),C9=class{constructor(...r){g(this,"defaults",Xp());g(this,"options",this.setOptions);g(this,"parse",this.parseMarkdown(!0));g(this,"parseInline",this.parseMarkdown(!1));g(this,"Parser",Ka);g(this,"Renderer",fc);g(this,"TextRenderer",im);g(this,"Lexer",Za);g(this,"Tokenizer",hc);g(this,"Hooks",Ul);this.use(...r)}walkTokens(r,e){var n,a;let t=[];for(const s of r)switch(t=t.concat(e.call(this,s)),s.type){case"table":{const i=s;for(const o of i.header)t=t.concat(this.walkTokens(o.tokens,e));for(const o of i.rows)for(const u of o)t=t.concat(this.walkTokens(u.tokens,e));break}case"list":{const i=s;t=t.concat(this.walkTokens(i.items,e));break}default:{const i=s;(a=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&a[i.type]?this.defaults.extensions.childTokens[i.type].forEach(o=>{const u=i[o].flat(1/0);t=t.concat(this.walkTokens(u,e))}):i.tokens&&(t=t.concat(this.walkTokens(i.tokens,e)))}}return t}use(...r){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return r.forEach(t=>{const n={...t};if(n.async=this.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){const s=e.renderers[a.name];s?e.renderers[a.name]=function(...i){let o=a.renderer.apply(this,i);return o===!1&&(o=s.apply(this,i)),o}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const s=e[a.level];s?s.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),n.extensions=e),t.renderer){const a=this.defaults.renderer||new fc(this.defaults);for(const s in t.renderer){if(!(s in a))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;const i=s,o=t.renderer[i],u=a[i];a[i]=(...l)=>{let c=o.apply(a,l);return c===!1&&(c=u.apply(a,l)),c||""}}n.renderer=a}if(t.tokenizer){const a=this.defaults.tokenizer||new hc(this.defaults);for(const s in t.tokenizer){if(!(s in a))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;const i=s,o=t.tokenizer[i],u=a[i];a[i]=(...l)=>{let c=o.apply(a,l);return c===!1&&(c=u.apply(a,l)),c}}n.tokenizer=a}if(t.hooks){const a=this.defaults.hooks||new Ul;for(const s in t.hooks){if(!(s in a))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;const i=s,o=t.hooks[i],u=a[i];Ul.passThroughHooks.has(s)?a[i]=l=>{if(this.defaults.async)return Promise.resolve(o.call(a,l)).then(d=>u.call(a,d));const c=o.call(a,l);return u.call(a,c)}:a[i]=(...l)=>{let c=o.apply(a,l);return c===!1&&(c=u.apply(a,l)),c}}n.hooks=a}if(t.walkTokens){const a=this.defaults.walkTokens,s=t.walkTokens;n.walkTokens=function(i){let o=[];return o.push(s.call(this,i)),a&&(o=o.concat(a.call(this,i))),o}}this.defaults={...this.defaults,...n}}),this}setOptions(r){return this.defaults={...this.defaults,...r},this}lexer(r,e){return Za.lex(r,e??this.defaults)}parser(r,e){return Ka.parse(r,e??this.defaults)}parseMarkdown(r){return(t,n)=>{const a={...n},s={...this.defaults,...a},i=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&a.async===!1)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));s.hooks&&(s.hooks.options=s,s.hooks.block=r);const o=s.hooks?s.hooks.provideLexer():r?Za.lex:Za.lexInline,u=s.hooks?s.hooks.provideParser():r?Ka.parse:Ka.parseInline;if(s.async)return Promise.resolve(s.hooks?s.hooks.preprocess(t):t).then(l=>o(l,s)).then(l=>s.hooks?s.hooks.processAllTokens(l):l).then(l=>s.walkTokens?Promise.all(this.walkTokens(l,s.walkTokens)).then(()=>l):l).then(l=>u(l,s)).then(l=>s.hooks?s.hooks.postprocess(l):l).catch(i);try{s.hooks&&(t=s.hooks.preprocess(t));let l=o(t,s);s.hooks&&(l=s.hooks.processAllTokens(l)),s.walkTokens&&this.walkTokens(l,s.walkTokens);let c=u(l,s);return s.hooks&&(c=s.hooks.postprocess(c)),c}catch(l){return i(l)}}}onError(r,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,r){const n="<p>An error occurred:</p><pre>"+wa(t.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(t);throw t}}},vi=new C9;function $t(r,e){return vi.parse(r,e)}$t.options=$t.setOptions=function(r){return vi.setOptions(r),$t.defaults=vi.defaults,h4($t.defaults),$t};$t.getDefaults=Xp;$t.defaults=ki;$t.use=function(...r){return vi.use(...r),$t.defaults=vi.defaults,h4($t.defaults),$t};$t.walkTokens=function(r,e){return vi.walkTokens(r,e)};$t.parseInline=vi.parseInline;$t.Parser=Ka;$t.parser=Ka.parse;$t.Renderer=fc;$t.TextRenderer=im;$t.Lexer=Za;$t.lexer=Za.lex;$t.Tokenizer=hc;$t.Hooks=Ul;$t.parse=$t;$t.options;$t.setOptions;$t.use;$t.walkTokens;$t.parseInline;Ka.parse;Za.lex;class dn{constructor(e,t,n){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=n}static range(e,t){return t?!e||!e.loc||!t.loc||e.loc.lexer!==t.loc.lexer?null:new dn(e.loc.lexer,e.loc.start,t.loc.end):e&&e.loc}}class Tn{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new Tn(t,dn.range(this,e))}}class ue{constructor(e,t){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var n="KaTeX parse error: "+e,a,s,i=t&&t.loc;if(i&&i.start<=i.end){var o=i.lexer.input;a=i.start,s=i.end,a===o.length?n+=" at end of input: ":n+=" at position "+(a+1)+": ";var u=o.slice(a,s).replace(/[^]/g,"$&\u0332"),l;a>15?l="\u2026"+o.slice(a-15,a):l=o.slice(0,a);var c;s+15<o.length?c=o.slice(s,s+15)+"\u2026":c=o.slice(s),n+=l+u+c}var d=new Error(n);return d.name="ParseError",d.__proto__=ue.prototype,d.position=a,a!=null&&s!=null&&(d.length=s-a),d.rawMessage=e,d}}ue.prototype.__proto__=Error.prototype;var T9=function(e,t){return e===void 0?t:e},F9=/([A-Z])/g,N9=function(e){return e.replace(F9,"-$1").toLowerCase()},I9={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},O9=/[&><"']/g;function R9(r){return String(r).replace(O9,e=>I9[e])}var x4=function r(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?r(e.body[0]):e:e.type==="font"?r(e.body):e},D9=function(e){var t=x4(e);return t.type==="mathord"||t.type==="textord"||t.type==="atom"},B9=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},M9=function(e){var t=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return t?t[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(t[1])?null:t[1].toLowerCase():"_relative"},Bt={deflt:T9,escape:R9,hyphenate:N9,getBaseElem:x4,isCharacterBox:D9,protocolFromUrl:M9},jl={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:r=>"#"+r},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(r,e)=>(e.push(r),e)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:r=>Math.max(0,r),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:r=>Math.max(0,r),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:r=>Math.max(0,r),cli:"-e, --max-expand <n>",cliProcessor:r=>r==="Infinity"?1/0:parseInt(r)},globalGroup:{type:"boolean",cli:!1}};function $9(r){if(r.default)return r.default;var e=r.type,t=Array.isArray(e)?e[0]:e;if(typeof t!="string")return t.enum[0];switch(t){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class om{constructor(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{};for(var t in jl)if(jl.hasOwnProperty(t)){var n=jl[t];this[t]=e[t]!==void 0?n.processor?n.processor(e[t]):e[t]:$9(n)}}reportNonstrict(e,t,n){var a=this.strict;if(typeof a=="function"&&(a=a(e,t,n)),!(!a||a==="ignore")){if(a===!0||a==="error")throw new ue("LaTeX-incompatible input and strict mode is set to 'error': "+(t+" ["+e+"]"),n);a==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+a+"': "+t+" ["+e+"]"))}}useStrictBehavior(e,t,n){var a=this.strict;if(typeof a=="function")try{a=a(e,t,n)}catch{a="error"}return!a||a==="ignore"?!1:a===!0||a==="error"?!0:a==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+a+"': "+t+" ["+e+"]")),!1)}isTrusted(e){if(e.url&&!e.protocol){var t=Bt.protocolFromUrl(e.url);if(t==null)return!1;e.protocol=t}var n=typeof this.trust=="function"?this.trust(e):this.trust;return!!n}}class ys{constructor(e,t,n){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=n}sup(){return Sa[P9[this.id]]}sub(){return Sa[L9[this.id]]}fracNum(){return Sa[z9[this.id]]}fracDen(){return Sa[U9[this.id]]}cramp(){return Sa[j9[this.id]]}text(){return Sa[q9[this.id]]}isTight(){return this.size>=2}}var um=0,pc=1,Wi=2,Ya=3,lu=4,zn=5,Qi=6,en=7,Sa=[new ys(um,0,!1),new ys(pc,0,!0),new ys(Wi,1,!1),new ys(Ya,1,!0),new ys(lu,2,!1),new ys(zn,2,!0),new ys(Qi,3,!1),new ys(en,3,!0)],P9=[lu,zn,lu,zn,Qi,en,Qi,en],L9=[zn,zn,zn,zn,en,en,en,en],z9=[Wi,Ya,lu,zn,Qi,en,Qi,en],U9=[Ya,Ya,zn,zn,en,en,en,en],j9=[pc,pc,Ya,Ya,zn,zn,en,en],q9=[um,pc,Wi,Ya,Wi,Ya,Wi,Ya],tt={DISPLAY:Sa[um],TEXT:Sa[Wi],SCRIPT:Sa[lu],SCRIPTSCRIPT:Sa[Qi]},Bf=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function H9(r){for(var e=0;e<Bf.length;e++)for(var t=Bf[e],n=0;n<t.blocks.length;n++){var a=t.blocks[n];if(r>=a[0]&&r<=a[1])return t.name}return null}var ql=[];Bf.forEach(r=>r.blocks.forEach(e=>ql.push(...e)));function S4(r){for(var e=0;e<ql.length;e+=2)if(r>=ql[e]&&r<=ql[e+1])return!0;return!1}var Ri=80,V9=function(e,t){return"M95,"+(622+e+t)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},G9=function(e,t){return"M263,"+(601+e+t)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},Z9=function(e,t){return"M983 "+(10+e+t)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},K9=function(e,t){return"M424,"+(2398+e+t)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+t+`
h400000v`+(40+e)+"h-400000z"},W9=function(e,t){return"M473,"+(2713+e+t)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+t+"h400000v"+(40+e)+"H1017.7z"},Y9=function(e){var t=e/2;return"M400000 "+e+" H0 L"+t+" 0 l65 45 L145 "+(e-80)+" H400000z"},J9=function(e,t,n){var a=n-54-t-e;return"M702 "+(e+t)+"H400000"+(40+e)+`
H742v`+a+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+t+"H400000v"+(40+e)+"H742z"},X9=function(e,t,n){t=1e3*t;var a="";switch(e){case"sqrtMain":a=V9(t,Ri);break;case"sqrtSize1":a=G9(t,Ri);break;case"sqrtSize2":a=Z9(t,Ri);break;case"sqrtSize3":a=K9(t,Ri);break;case"sqrtSize4":a=W9(t,Ri);break;case"sqrtTall":a=J9(t,Ri,n)}return a},Q9=function(e,t){switch(e){case"\u239C":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"\u2223":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"\u2225":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z"+("M367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z");case"\u239F":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"\u23A2":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"\u23A5":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"\u23AA":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"\u23D0":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"\u2016":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257z"+("M478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z");default:return""}},uy={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},ex=function(e,t){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+t+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+t+" v1759 h84z";case"vert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+" v585 h43z";case"doublevert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+` v585 h43z
M367 15 v585 v`+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+t+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+t+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+t+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v602 h84z
M403 1759 V0 H319 V1759 v`+t+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v602 h84z
M347 1759 V0 h-84 V1759 v`+t+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(t+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(t+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(t+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(t+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class Pu{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return this.classes.includes(e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){var e=t=>t.toText();return this.children.map(e).join("")}}var ka={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},ul={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},ly={\u00C5:"A",\u00D0:"D",\u00DE:"o",\u00E5:"a",\u00F0:"d",\u00FE:"o",\u0410:"A",\u0411:"B",\u0412:"B",\u0413:"F",\u0414:"A",\u0415:"E",\u0416:"K",\u0417:"3",\u0418:"N",\u0419:"N",\u041A:"K",\u041B:"N",\u041C:"M",\u041D:"H",\u041E:"O",\u041F:"N",\u0420:"P",\u0421:"C",\u0422:"T",\u0423:"y",\u0424:"O",\u0425:"X",\u0426:"U",\u0427:"h",\u0428:"W",\u0429:"W",\u042A:"B",\u042B:"X",\u042C:"B",\u042D:"3",\u042E:"X",\u042F:"R",\u0430:"a",\u0431:"b",\u0432:"a",\u0433:"r",\u0434:"y",\u0435:"e",\u0436:"m",\u0437:"e",\u0438:"n",\u0439:"n",\u043A:"n",\u043B:"n",\u043C:"m",\u043D:"n",\u043E:"o",\u043F:"n",\u0440:"p",\u0441:"c",\u0442:"o",\u0443:"y",\u0444:"b",\u0445:"x",\u0446:"n",\u0447:"n",\u0448:"w",\u0449:"w",\u044A:"a",\u044B:"m",\u044C:"a",\u044D:"e",\u044E:"m",\u044F:"r"};function tx(r,e){ka[r]=e}function lm(r,e,t){if(!ka[e])throw new Error("Font metrics not found for font: "+e+".");var n=r.charCodeAt(0),a=ka[e][n];if(!a&&r[0]in ly&&(n=ly[r[0]].charCodeAt(0),a=ka[e][n]),!a&&t==="text"&&S4(n)&&(a=ka[e][77]),a)return{depth:a[0],height:a[1],italic:a[2],skew:a[3],width:a[4]}}var Id={};function rx(r){var e;if(r>=5?e=0:r>=3?e=1:e=2,!Id[e]){var t=Id[e]={cssEmPerMu:ul.quad[e]/18};for(var n in ul)ul.hasOwnProperty(n)&&(t[n]=ul[n][e])}return Id[e]}var nx=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],cy=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],dy=function(e,t){return t.size<2?e:nx[e-1][t.size-1]};class ja{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||ja.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=cy[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return new ja(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:dy(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:cy[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=dy(ja.BASESIZE,e);return this.size===t&&this.textSize===ja.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==ja.BASESIZE?["sizing","reset-size"+this.size,"size"+ja.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=rx(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}ja.BASESIZE=6;var Mf={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},ax={ex:!0,em:!0,mu:!0},A4=function(e){return typeof e!="string"&&(e=e.unit),e in Mf||e in ax||e==="ex"},or=function(e,t){var n;if(e.unit in Mf)n=Mf[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if(e.unit==="mu")n=t.fontMetrics().cssEmPerMu;else{var a;if(t.style.isTight()?a=t.havingStyle(t.style.text()):a=t,e.unit==="ex")n=a.fontMetrics().xHeight;else if(e.unit==="em")n=a.fontMetrics().quad;else throw new ue("Invalid unit: '"+e.unit+"'");a!==t&&(n*=a.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*n,t.maxSize)},ye=function(e){return+e.toFixed(4)+"em"},Ps=function(e){return e.filter(t=>t).join(" ")},k4=function(e,t,n){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=n||{},t){t.style.isTight()&&this.classes.push("mtight");var a=t.getColor();a&&(this.style.color=a)}},C4=function(e){var t=document.createElement(e);t.className=Ps(this.classes);for(var n in this.style)this.style.hasOwnProperty(n)&&(t.style[n]=this.style[n]);for(var a in this.attributes)this.attributes.hasOwnProperty(a)&&t.setAttribute(a,this.attributes[a]);for(var s=0;s<this.children.length;s++)t.appendChild(this.children[s].toNode());return t},sx=/[\s"'>/=\x00-\x1f]/,T4=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+Bt.escape(Ps(this.classes))+'"');var n="";for(var a in this.style)this.style.hasOwnProperty(a)&&(n+=Bt.hyphenate(a)+":"+this.style[a]+";");n&&(t+=' style="'+Bt.escape(n)+'"');for(var s in this.attributes)if(this.attributes.hasOwnProperty(s)){if(sx.test(s))throw new ue("Invalid attribute name '"+s+"'");t+=" "+s+'="'+Bt.escape(this.attributes[s])+'"'}t+=">";for(var i=0;i<this.children.length;i++)t+=this.children[i].toMarkup();return t+="</"+e+">",t};class Lu{constructor(e,t,n,a){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,k4.call(this,e,n,a),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return this.classes.includes(e)}toNode(){return C4.call(this,"span")}toMarkup(){return T4.call(this,"span")}}class cm{constructor(e,t,n,a){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,k4.call(this,t,a),this.children=n||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return this.classes.includes(e)}toNode(){return C4.call(this,"a")}toMarkup(){return T4.call(this,"a")}}class ix{constructor(e,t,n){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=n}hasClass(e){return this.classes.includes(e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var t in this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e='<img src="'+Bt.escape(this.src)+'"'+(' alt="'+Bt.escape(this.alt)+'"'),t="";for(var n in this.style)this.style.hasOwnProperty(n)&&(t+=Bt.hyphenate(n)+":"+this.style[n]+";");return t&&(e+=' style="'+Bt.escape(t)+'"'),e+="'/>",e}}var ox={\u00EE:"\u0131\u0302",\u00EF:"\u0131\u0308",\u00ED:"\u0131\u0301",\u00EC:"\u0131\u0300"};class qn{constructor(e,t,n,a,s,i,o,u){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=n||0,this.italic=a||0,this.skew=s||0,this.width=i||0,this.classes=o||[],this.style=u||{},this.maxFontSize=0;var l=H9(this.text.charCodeAt(0));l&&this.classes.push(l+"_fallback"),/[]/.test(this.text)&&(this.text=ox[this.text])}hasClass(e){return this.classes.includes(e)}toNode(){var e=document.createTextNode(this.text),t=null;this.italic>0&&(t=document.createElement("span"),t.style.marginRight=ye(this.italic)),this.classes.length>0&&(t=t||document.createElement("span"),t.className=Ps(this.classes));for(var n in this.style)this.style.hasOwnProperty(n)&&(t=t||document.createElement("span"),t.style[n]=this.style[n]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=Bt.escape(Ps(this.classes)),t+='"');var n="";this.italic>0&&(n+="margin-right:"+this.italic+"em;");for(var a in this.style)this.style.hasOwnProperty(a)&&(n+=Bt.hyphenate(a)+":"+this.style[a]+";");n&&(e=!0,t+=' style="'+Bt.escape(n)+'"');var s=Bt.escape(this.text);return e?(t+=">",t+=s,t+="</span>",t):s}}class rs{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&t.setAttribute(n,this.attributes[n]);for(var a=0;a<this.children.length;a++)t.appendChild(this.children[a].toNode());return t}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+Bt.escape(this.attributes[t])+'"');e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+="</svg>",e}}class Ls{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"path");return this.alternate?t.setAttribute("d",this.alternate):t.setAttribute("d",uy[this.pathName]),t}toMarkup(){return this.alternate?'<path d="'+Bt.escape(this.alternate)+'"/>':'<path d="'+Bt.escape(uy[this.pathName])+'"/>'}}class $f{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"line");for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&t.setAttribute(n,this.attributes[n]);return t}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+Bt.escape(this.attributes[t])+'"');return e+="/>",e}}function hy(r){if(r instanceof qn)return r;throw new Error("Expected symbolNode but got "+String(r)+".")}function ux(r){if(r instanceof Lu)return r;throw new Error("Expected span<HtmlDomNode> but got "+String(r)+".")}var lx={bin:1,close:1,inner:1,open:1,punct:1,rel:1},cx={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},Yt={math:{},text:{}};function y(r,e,t,n,a,s){Yt[r][a]={font:e,group:t,replace:n},s&&n&&(Yt[r][n]=Yt[r][a])}var b="math",ne="text",S="main",I="ams",sr="accent-token",Re="bin",rn="close",bo="inner",et="mathord",Er="op-token",On="open",e0="punct",O="rel",ds="spacing",z="textord";y(b,S,O,"\u2261","\\equiv",!0);y(b,S,O,"\u227A","\\prec",!0);y(b,S,O,"\u227B","\\succ",!0);y(b,S,O,"\u223C","\\sim",!0);y(b,S,O,"\u22A5","\\perp");y(b,S,O,"\u2AAF","\\preceq",!0);y(b,S,O,"\u2AB0","\\succeq",!0);y(b,S,O,"\u2243","\\simeq",!0);y(b,S,O,"\u2223","\\mid",!0);y(b,S,O,"\u226A","\\ll",!0);y(b,S,O,"\u226B","\\gg",!0);y(b,S,O,"\u224D","\\asymp",!0);y(b,S,O,"\u2225","\\parallel");y(b,S,O,"\u22C8","\\bowtie",!0);y(b,S,O,"\u2323","\\smile",!0);y(b,S,O,"\u2291","\\sqsubseteq",!0);y(b,S,O,"\u2292","\\sqsupseteq",!0);y(b,S,O,"\u2250","\\doteq",!0);y(b,S,O,"\u2322","\\frown",!0);y(b,S,O,"\u220B","\\ni",!0);y(b,S,O,"\u221D","\\propto",!0);y(b,S,O,"\u22A2","\\vdash",!0);y(b,S,O,"\u22A3","\\dashv",!0);y(b,S,O,"\u220B","\\owns");y(b,S,e0,".","\\ldotp");y(b,S,e0,"\u22C5","\\cdotp");y(b,S,z,"#","\\#");y(ne,S,z,"#","\\#");y(b,S,z,"&","\\&");y(ne,S,z,"&","\\&");y(b,S,z,"\u2135","\\aleph",!0);y(b,S,z,"\u2200","\\forall",!0);y(b,S,z,"\u210F","\\hbar",!0);y(b,S,z,"\u2203","\\exists",!0);y(b,S,z,"\u2207","\\nabla",!0);y(b,S,z,"\u266D","\\flat",!0);y(b,S,z,"\u2113","\\ell",!0);y(b,S,z,"\u266E","\\natural",!0);y(b,S,z,"\u2663","\\clubsuit",!0);y(b,S,z,"\u2118","\\wp",!0);y(b,S,z,"\u266F","\\sharp",!0);y(b,S,z,"\u2662","\\diamondsuit",!0);y(b,S,z,"\u211C","\\Re",!0);y(b,S,z,"\u2661","\\heartsuit",!0);y(b,S,z,"\u2111","\\Im",!0);y(b,S,z,"\u2660","\\spadesuit",!0);y(b,S,z,"\xA7","\\S",!0);y(ne,S,z,"\xA7","\\S");y(b,S,z,"\xB6","\\P",!0);y(ne,S,z,"\xB6","\\P");y(b,S,z,"\u2020","\\dag");y(ne,S,z,"\u2020","\\dag");y(ne,S,z,"\u2020","\\textdagger");y(b,S,z,"\u2021","\\ddag");y(ne,S,z,"\u2021","\\ddag");y(ne,S,z,"\u2021","\\textdaggerdbl");y(b,S,rn,"\u23B1","\\rmoustache",!0);y(b,S,On,"\u23B0","\\lmoustache",!0);y(b,S,rn,"\u27EF","\\rgroup",!0);y(b,S,On,"\u27EE","\\lgroup",!0);y(b,S,Re,"\u2213","\\mp",!0);y(b,S,Re,"\u2296","\\ominus",!0);y(b,S,Re,"\u228E","\\uplus",!0);y(b,S,Re,"\u2293","\\sqcap",!0);y(b,S,Re,"\u2217","\\ast");y(b,S,Re,"\u2294","\\sqcup",!0);y(b,S,Re,"\u25EF","\\bigcirc",!0);y(b,S,Re,"\u2219","\\bullet",!0);y(b,S,Re,"\u2021","\\ddagger");y(b,S,Re,"\u2240","\\wr",!0);y(b,S,Re,"\u2A3F","\\amalg");y(b,S,Re,"&","\\And");y(b,S,O,"\u27F5","\\longleftarrow",!0);y(b,S,O,"\u21D0","\\Leftarrow",!0);y(b,S,O,"\u27F8","\\Longleftarrow",!0);y(b,S,O,"\u27F6","\\longrightarrow",!0);y(b,S,O,"\u21D2","\\Rightarrow",!0);y(b,S,O,"\u27F9","\\Longrightarrow",!0);y(b,S,O,"\u2194","\\leftrightarrow",!0);y(b,S,O,"\u27F7","\\longleftrightarrow",!0);y(b,S,O,"\u21D4","\\Leftrightarrow",!0);y(b,S,O,"\u27FA","\\Longleftrightarrow",!0);y(b,S,O,"\u21A6","\\mapsto",!0);y(b,S,O,"\u27FC","\\longmapsto",!0);y(b,S,O,"\u2197","\\nearrow",!0);y(b,S,O,"\u21A9","\\hookleftarrow",!0);y(b,S,O,"\u21AA","\\hookrightarrow",!0);y(b,S,O,"\u2198","\\searrow",!0);y(b,S,O,"\u21BC","\\leftharpoonup",!0);y(b,S,O,"\u21C0","\\rightharpoonup",!0);y(b,S,O,"\u2199","\\swarrow",!0);y(b,S,O,"\u21BD","\\leftharpoondown",!0);y(b,S,O,"\u21C1","\\rightharpoondown",!0);y(b,S,O,"\u2196","\\nwarrow",!0);y(b,S,O,"\u21CC","\\rightleftharpoons",!0);y(b,I,O,"\u226E","\\nless",!0);y(b,I,O,"\uE010","\\@nleqslant");y(b,I,O,"\uE011","\\@nleqq");y(b,I,O,"\u2A87","\\lneq",!0);y(b,I,O,"\u2268","\\lneqq",!0);y(b,I,O,"\uE00C","\\@lvertneqq");y(b,I,O,"\u22E6","\\lnsim",!0);y(b,I,O,"\u2A89","\\lnapprox",!0);y(b,I,O,"\u2280","\\nprec",!0);y(b,I,O,"\u22E0","\\npreceq",!0);y(b,I,O,"\u22E8","\\precnsim",!0);y(b,I,O,"\u2AB9","\\precnapprox",!0);y(b,I,O,"\u2241","\\nsim",!0);y(b,I,O,"\uE006","\\@nshortmid");y(b,I,O,"\u2224","\\nmid",!0);y(b,I,O,"\u22AC","\\nvdash",!0);y(b,I,O,"\u22AD","\\nvDash",!0);y(b,I,O,"\u22EA","\\ntriangleleft");y(b,I,O,"\u22EC","\\ntrianglelefteq",!0);y(b,I,O,"\u228A","\\subsetneq",!0);y(b,I,O,"\uE01A","\\@varsubsetneq");y(b,I,O,"\u2ACB","\\subsetneqq",!0);y(b,I,O,"\uE017","\\@varsubsetneqq");y(b,I,O,"\u226F","\\ngtr",!0);y(b,I,O,"\uE00F","\\@ngeqslant");y(b,I,O,"\uE00E","\\@ngeqq");y(b,I,O,"\u2A88","\\gneq",!0);y(b,I,O,"\u2269","\\gneqq",!0);y(b,I,O,"\uE00D","\\@gvertneqq");y(b,I,O,"\u22E7","\\gnsim",!0);y(b,I,O,"\u2A8A","\\gnapprox",!0);y(b,I,O,"\u2281","\\nsucc",!0);y(b,I,O,"\u22E1","\\nsucceq",!0);y(b,I,O,"\u22E9","\\succnsim",!0);y(b,I,O,"\u2ABA","\\succnapprox",!0);y(b,I,O,"\u2246","\\ncong",!0);y(b,I,O,"\uE007","\\@nshortparallel");y(b,I,O,"\u2226","\\nparallel",!0);y(b,I,O,"\u22AF","\\nVDash",!0);y(b,I,O,"\u22EB","\\ntriangleright");y(b,I,O,"\u22ED","\\ntrianglerighteq",!0);y(b,I,O,"\uE018","\\@nsupseteqq");y(b,I,O,"\u228B","\\supsetneq",!0);y(b,I,O,"\uE01B","\\@varsupsetneq");y(b,I,O,"\u2ACC","\\supsetneqq",!0);y(b,I,O,"\uE019","\\@varsupsetneqq");y(b,I,O,"\u22AE","\\nVdash",!0);y(b,I,O,"\u2AB5","\\precneqq",!0);y(b,I,O,"\u2AB6","\\succneqq",!0);y(b,I,O,"\uE016","\\@nsubseteqq");y(b,I,Re,"\u22B4","\\unlhd");y(b,I,Re,"\u22B5","\\unrhd");y(b,I,O,"\u219A","\\nleftarrow",!0);y(b,I,O,"\u219B","\\nrightarrow",!0);y(b,I,O,"\u21CD","\\nLeftarrow",!0);y(b,I,O,"\u21CF","\\nRightarrow",!0);y(b,I,O,"\u21AE","\\nleftrightarrow",!0);y(b,I,O,"\u21CE","\\nLeftrightarrow",!0);y(b,I,O,"\u25B3","\\vartriangle");y(b,I,z,"\u210F","\\hslash");y(b,I,z,"\u25BD","\\triangledown");y(b,I,z,"\u25CA","\\lozenge");y(b,I,z,"\u24C8","\\circledS");y(b,I,z,"\xAE","\\circledR");y(ne,I,z,"\xAE","\\circledR");y(b,I,z,"\u2221","\\measuredangle",!0);y(b,I,z,"\u2204","\\nexists");y(b,I,z,"\u2127","\\mho");y(b,I,z,"\u2132","\\Finv",!0);y(b,I,z,"\u2141","\\Game",!0);y(b,I,z,"\u2035","\\backprime");y(b,I,z,"\u25B2","\\blacktriangle");y(b,I,z,"\u25BC","\\blacktriangledown");y(b,I,z,"\u25A0","\\blacksquare");y(b,I,z,"\u29EB","\\blacklozenge");y(b,I,z,"\u2605","\\bigstar");y(b,I,z,"\u2222","\\sphericalangle",!0);y(b,I,z,"\u2201","\\complement",!0);y(b,I,z,"\xF0","\\eth",!0);y(ne,S,z,"\xF0","\xF0");y(b,I,z,"\u2571","\\diagup");y(b,I,z,"\u2572","\\diagdown");y(b,I,z,"\u25A1","\\square");y(b,I,z,"\u25A1","\\Box");y(b,I,z,"\u25CA","\\Diamond");y(b,I,z,"\xA5","\\yen",!0);y(ne,I,z,"\xA5","\\yen",!0);y(b,I,z,"\u2713","\\checkmark",!0);y(ne,I,z,"\u2713","\\checkmark");y(b,I,z,"\u2136","\\beth",!0);y(b,I,z,"\u2138","\\daleth",!0);y(b,I,z,"\u2137","\\gimel",!0);y(b,I,z,"\u03DD","\\digamma",!0);y(b,I,z,"\u03F0","\\varkappa");y(b,I,On,"\u250C","\\@ulcorner",!0);y(b,I,rn,"\u2510","\\@urcorner",!0);y(b,I,On,"\u2514","\\@llcorner",!0);y(b,I,rn,"\u2518","\\@lrcorner",!0);y(b,I,O,"\u2266","\\leqq",!0);y(b,I,O,"\u2A7D","\\leqslant",!0);y(b,I,O,"\u2A95","\\eqslantless",!0);y(b,I,O,"\u2272","\\lesssim",!0);y(b,I,O,"\u2A85","\\lessapprox",!0);y(b,I,O,"\u224A","\\approxeq",!0);y(b,I,Re,"\u22D6","\\lessdot");y(b,I,O,"\u22D8","\\lll",!0);y(b,I,O,"\u2276","\\lessgtr",!0);y(b,I,O,"\u22DA","\\lesseqgtr",!0);y(b,I,O,"\u2A8B","\\lesseqqgtr",!0);y(b,I,O,"\u2251","\\doteqdot");y(b,I,O,"\u2253","\\risingdotseq",!0);y(b,I,O,"\u2252","\\fallingdotseq",!0);y(b,I,O,"\u223D","\\backsim",!0);y(b,I,O,"\u22CD","\\backsimeq",!0);y(b,I,O,"\u2AC5","\\subseteqq",!0);y(b,I,O,"\u22D0","\\Subset",!0);y(b,I,O,"\u228F","\\sqsubset",!0);y(b,I,O,"\u227C","\\preccurlyeq",!0);y(b,I,O,"\u22DE","\\curlyeqprec",!0);y(b,I,O,"\u227E","\\precsim",!0);y(b,I,O,"\u2AB7","\\precapprox",!0);y(b,I,O,"\u22B2","\\vartriangleleft");y(b,I,O,"\u22B4","\\trianglelefteq");y(b,I,O,"\u22A8","\\vDash",!0);y(b,I,O,"\u22AA","\\Vvdash",!0);y(b,I,O,"\u2323","\\smallsmile");y(b,I,O,"\u2322","\\smallfrown");y(b,I,O,"\u224F","\\bumpeq",!0);y(b,I,O,"\u224E","\\Bumpeq",!0);y(b,I,O,"\u2267","\\geqq",!0);y(b,I,O,"\u2A7E","\\geqslant",!0);y(b,I,O,"\u2A96","\\eqslantgtr",!0);y(b,I,O,"\u2273","\\gtrsim",!0);y(b,I,O,"\u2A86","\\gtrapprox",!0);y(b,I,Re,"\u22D7","\\gtrdot");y(b,I,O,"\u22D9","\\ggg",!0);y(b,I,O,"\u2277","\\gtrless",!0);y(b,I,O,"\u22DB","\\gtreqless",!0);y(b,I,O,"\u2A8C","\\gtreqqless",!0);y(b,I,O,"\u2256","\\eqcirc",!0);y(b,I,O,"\u2257","\\circeq",!0);y(b,I,O,"\u225C","\\triangleq",!0);y(b,I,O,"\u223C","\\thicksim");y(b,I,O,"\u2248","\\thickapprox");y(b,I,O,"\u2AC6","\\supseteqq",!0);y(b,I,O,"\u22D1","\\Supset",!0);y(b,I,O,"\u2290","\\sqsupset",!0);y(b,I,O,"\u227D","\\succcurlyeq",!0);y(b,I,O,"\u22DF","\\curlyeqsucc",!0);y(b,I,O,"\u227F","\\succsim",!0);y(b,I,O,"\u2AB8","\\succapprox",!0);y(b,I,O,"\u22B3","\\vartriangleright");y(b,I,O,"\u22B5","\\trianglerighteq");y(b,I,O,"\u22A9","\\Vdash",!0);y(b,I,O,"\u2223","\\shortmid");y(b,I,O,"\u2225","\\shortparallel");y(b,I,O,"\u226C","\\between",!0);y(b,I,O,"\u22D4","\\pitchfork",!0);y(b,I,O,"\u221D","\\varpropto");y(b,I,O,"\u25C0","\\blacktriangleleft");y(b,I,O,"\u2234","\\therefore",!0);y(b,I,O,"\u220D","\\backepsilon");y(b,I,O,"\u25B6","\\blacktriangleright");y(b,I,O,"\u2235","\\because",!0);y(b,I,O,"\u22D8","\\llless");y(b,I,O,"\u22D9","\\gggtr");y(b,I,Re,"\u22B2","\\lhd");y(b,I,Re,"\u22B3","\\rhd");y(b,I,O,"\u2242","\\eqsim",!0);y(b,S,O,"\u22C8","\\Join");y(b,I,O,"\u2251","\\Doteq",!0);y(b,I,Re,"\u2214","\\dotplus",!0);y(b,I,Re,"\u2216","\\smallsetminus");y(b,I,Re,"\u22D2","\\Cap",!0);y(b,I,Re,"\u22D3","\\Cup",!0);y(b,I,Re,"\u2A5E","\\doublebarwedge",!0);y(b,I,Re,"\u229F","\\boxminus",!0);y(b,I,Re,"\u229E","\\boxplus",!0);y(b,I,Re,"\u22C7","\\divideontimes",!0);y(b,I,Re,"\u22C9","\\ltimes",!0);y(b,I,Re,"\u22CA","\\rtimes",!0);y(b,I,Re,"\u22CB","\\leftthreetimes",!0);y(b,I,Re,"\u22CC","\\rightthreetimes",!0);y(b,I,Re,"\u22CF","\\curlywedge",!0);y(b,I,Re,"\u22CE","\\curlyvee",!0);y(b,I,Re,"\u229D","\\circleddash",!0);y(b,I,Re,"\u229B","\\circledast",!0);y(b,I,Re,"\u22C5","\\centerdot");y(b,I,Re,"\u22BA","\\intercal",!0);y(b,I,Re,"\u22D2","\\doublecap");y(b,I,Re,"\u22D3","\\doublecup");y(b,I,Re,"\u22A0","\\boxtimes",!0);y(b,I,O,"\u21E2","\\dashrightarrow",!0);y(b,I,O,"\u21E0","\\dashleftarrow",!0);y(b,I,O,"\u21C7","\\leftleftarrows",!0);y(b,I,O,"\u21C6","\\leftrightarrows",!0);y(b,I,O,"\u21DA","\\Lleftarrow",!0);y(b,I,O,"\u219E","\\twoheadleftarrow",!0);y(b,I,O,"\u21A2","\\leftarrowtail",!0);y(b,I,O,"\u21AB","\\looparrowleft",!0);y(b,I,O,"\u21CB","\\leftrightharpoons",!0);y(b,I,O,"\u21B6","\\curvearrowleft",!0);y(b,I,O,"\u21BA","\\circlearrowleft",!0);y(b,I,O,"\u21B0","\\Lsh",!0);y(b,I,O,"\u21C8","\\upuparrows",!0);y(b,I,O,"\u21BF","\\upharpoonleft",!0);y(b,I,O,"\u21C3","\\downharpoonleft",!0);y(b,S,O,"\u22B6","\\origof",!0);y(b,S,O,"\u22B7","\\imageof",!0);y(b,I,O,"\u22B8","\\multimap",!0);y(b,I,O,"\u21AD","\\leftrightsquigarrow",!0);y(b,I,O,"\u21C9","\\rightrightarrows",!0);y(b,I,O,"\u21C4","\\rightleftarrows",!0);y(b,I,O,"\u21A0","\\twoheadrightarrow",!0);y(b,I,O,"\u21A3","\\rightarrowtail",!0);y(b,I,O,"\u21AC","\\looparrowright",!0);y(b,I,O,"\u21B7","\\curvearrowright",!0);y(b,I,O,"\u21BB","\\circlearrowright",!0);y(b,I,O,"\u21B1","\\Rsh",!0);y(b,I,O,"\u21CA","\\downdownarrows",!0);y(b,I,O,"\u21BE","\\upharpoonright",!0);y(b,I,O,"\u21C2","\\downharpoonright",!0);y(b,I,O,"\u21DD","\\rightsquigarrow",!0);y(b,I,O,"\u21DD","\\leadsto");y(b,I,O,"\u21DB","\\Rrightarrow",!0);y(b,I,O,"\u21BE","\\restriction");y(b,S,z,"\u2018","`");y(b,S,z,"$","\\$");y(ne,S,z,"$","\\$");y(ne,S,z,"$","\\textdollar");y(b,S,z,"%","\\%");y(ne,S,z,"%","\\%");y(b,S,z,"_","\\_");y(ne,S,z,"_","\\_");y(ne,S,z,"_","\\textunderscore");y(b,S,z,"\u2220","\\angle",!0);y(b,S,z,"\u221E","\\infty",!0);y(b,S,z,"\u2032","\\prime");y(b,S,z,"\u25B3","\\triangle");y(b,S,z,"\u0393","\\Gamma",!0);y(b,S,z,"\u0394","\\Delta",!0);y(b,S,z,"\u0398","\\Theta",!0);y(b,S,z,"\u039B","\\Lambda",!0);y(b,S,z,"\u039E","\\Xi",!0);y(b,S,z,"\u03A0","\\Pi",!0);y(b,S,z,"\u03A3","\\Sigma",!0);y(b,S,z,"\u03A5","\\Upsilon",!0);y(b,S,z,"\u03A6","\\Phi",!0);y(b,S,z,"\u03A8","\\Psi",!0);y(b,S,z,"\u03A9","\\Omega",!0);y(b,S,z,"A","\u0391");y(b,S,z,"B","\u0392");y(b,S,z,"E","\u0395");y(b,S,z,"Z","\u0396");y(b,S,z,"H","\u0397");y(b,S,z,"I","\u0399");y(b,S,z,"K","\u039A");y(b,S,z,"M","\u039C");y(b,S,z,"N","\u039D");y(b,S,z,"O","\u039F");y(b,S,z,"P","\u03A1");y(b,S,z,"T","\u03A4");y(b,S,z,"X","\u03A7");y(b,S,z,"\xAC","\\neg",!0);y(b,S,z,"\xAC","\\lnot");y(b,S,z,"\u22A4","\\top");y(b,S,z,"\u22A5","\\bot");y(b,S,z,"\u2205","\\emptyset");y(b,I,z,"\u2205","\\varnothing");y(b,S,et,"\u03B1","\\alpha",!0);y(b,S,et,"\u03B2","\\beta",!0);y(b,S,et,"\u03B3","\\gamma",!0);y(b,S,et,"\u03B4","\\delta",!0);y(b,S,et,"\u03F5","\\epsilon",!0);y(b,S,et,"\u03B6","\\zeta",!0);y(b,S,et,"\u03B7","\\eta",!0);y(b,S,et,"\u03B8","\\theta",!0);y(b,S,et,"\u03B9","\\iota",!0);y(b,S,et,"\u03BA","\\kappa",!0);y(b,S,et,"\u03BB","\\lambda",!0);y(b,S,et,"\u03BC","\\mu",!0);y(b,S,et,"\u03BD","\\nu",!0);y(b,S,et,"\u03BE","\\xi",!0);y(b,S,et,"\u03BF","\\omicron",!0);y(b,S,et,"\u03C0","\\pi",!0);y(b,S,et,"\u03C1","\\rho",!0);y(b,S,et,"\u03C3","\\sigma",!0);y(b,S,et,"\u03C4","\\tau",!0);y(b,S,et,"\u03C5","\\upsilon",!0);y(b,S,et,"\u03D5","\\phi",!0);y(b,S,et,"\u03C7","\\chi",!0);y(b,S,et,"\u03C8","\\psi",!0);y(b,S,et,"\u03C9","\\omega",!0);y(b,S,et,"\u03B5","\\varepsilon",!0);y(b,S,et,"\u03D1","\\vartheta",!0);y(b,S,et,"\u03D6","\\varpi",!0);y(b,S,et,"\u03F1","\\varrho",!0);y(b,S,et,"\u03C2","\\varsigma",!0);y(b,S,et,"\u03C6","\\varphi",!0);y(b,S,Re,"\u2217","*",!0);y(b,S,Re,"+","+");y(b,S,Re,"\u2212","-",!0);y(b,S,Re,"\u22C5","\\cdot",!0);y(b,S,Re,"\u2218","\\circ",!0);y(b,S,Re,"\xF7","\\div",!0);y(b,S,Re,"\xB1","\\pm",!0);y(b,S,Re,"\xD7","\\times",!0);y(b,S,Re,"\u2229","\\cap",!0);y(b,S,Re,"\u222A","\\cup",!0);y(b,S,Re,"\u2216","\\setminus",!0);y(b,S,Re,"\u2227","\\land");y(b,S,Re,"\u2228","\\lor");y(b,S,Re,"\u2227","\\wedge",!0);y(b,S,Re,"\u2228","\\vee",!0);y(b,S,z,"\u221A","\\surd");y(b,S,On,"\u27E8","\\langle",!0);y(b,S,On,"\u2223","\\lvert");y(b,S,On,"\u2225","\\lVert");y(b,S,rn,"?","?");y(b,S,rn,"!","!");y(b,S,rn,"\u27E9","\\rangle",!0);y(b,S,rn,"\u2223","\\rvert");y(b,S,rn,"\u2225","\\rVert");y(b,S,O,"=","=");y(b,S,O,":",":");y(b,S,O,"\u2248","\\approx",!0);y(b,S,O,"\u2245","\\cong",!0);y(b,S,O,"\u2265","\\ge");y(b,S,O,"\u2265","\\geq",!0);y(b,S,O,"\u2190","\\gets");y(b,S,O,">","\\gt",!0);y(b,S,O,"\u2208","\\in",!0);y(b,S,O,"\uE020","\\@not");y(b,S,O,"\u2282","\\subset",!0);y(b,S,O,"\u2283","\\supset",!0);y(b,S,O,"\u2286","\\subseteq",!0);y(b,S,O,"\u2287","\\supseteq",!0);y(b,I,O,"\u2288","\\nsubseteq",!0);y(b,I,O,"\u2289","\\nsupseteq",!0);y(b,S,O,"\u22A8","\\models");y(b,S,O,"\u2190","\\leftarrow",!0);y(b,S,O,"\u2264","\\le");y(b,S,O,"\u2264","\\leq",!0);y(b,S,O,"<","\\lt",!0);y(b,S,O,"\u2192","\\rightarrow",!0);y(b,S,O,"\u2192","\\to");y(b,I,O,"\u2271","\\ngeq",!0);y(b,I,O,"\u2270","\\nleq",!0);y(b,S,ds,"\xA0","\\ ");y(b,S,ds,"\xA0","\\space");y(b,S,ds,"\xA0","\\nobreakspace");y(ne,S,ds,"\xA0","\\ ");y(ne,S,ds,"\xA0"," ");y(ne,S,ds,"\xA0","\\space");y(ne,S,ds,"\xA0","\\nobreakspace");y(b,S,ds,null,"\\nobreak");y(b,S,ds,null,"\\allowbreak");y(b,S,e0,",",",");y(b,S,e0,";",";");y(b,I,Re,"\u22BC","\\barwedge",!0);y(b,I,Re,"\u22BB","\\veebar",!0);y(b,S,Re,"\u2299","\\odot",!0);y(b,S,Re,"\u2295","\\oplus",!0);y(b,S,Re,"\u2297","\\otimes",!0);y(b,S,z,"\u2202","\\partial",!0);y(b,S,Re,"\u2298","\\oslash",!0);y(b,I,Re,"\u229A","\\circledcirc",!0);y(b,I,Re,"\u22A1","\\boxdot",!0);y(b,S,Re,"\u25B3","\\bigtriangleup");y(b,S,Re,"\u25BD","\\bigtriangledown");y(b,S,Re,"\u2020","\\dagger");y(b,S,Re,"\u22C4","\\diamond");y(b,S,Re,"\u22C6","\\star");y(b,S,Re,"\u25C3","\\triangleleft");y(b,S,Re,"\u25B9","\\triangleright");y(b,S,On,"{","\\{");y(ne,S,z,"{","\\{");y(ne,S,z,"{","\\textbraceleft");y(b,S,rn,"}","\\}");y(ne,S,z,"}","\\}");y(ne,S,z,"}","\\textbraceright");y(b,S,On,"{","\\lbrace");y(b,S,rn,"}","\\rbrace");y(b,S,On,"[","\\lbrack",!0);y(ne,S,z,"[","\\lbrack",!0);y(b,S,rn,"]","\\rbrack",!0);y(ne,S,z,"]","\\rbrack",!0);y(b,S,On,"(","\\lparen",!0);y(b,S,rn,")","\\rparen",!0);y(ne,S,z,"<","\\textless",!0);y(ne,S,z,">","\\textgreater",!0);y(b,S,On,"\u230A","\\lfloor",!0);y(b,S,rn,"\u230B","\\rfloor",!0);y(b,S,On,"\u2308","\\lceil",!0);y(b,S,rn,"\u2309","\\rceil",!0);y(b,S,z,"\\","\\backslash");y(b,S,z,"\u2223","|");y(b,S,z,"\u2223","\\vert");y(ne,S,z,"|","\\textbar",!0);y(b,S,z,"\u2225","\\|");y(b,S,z,"\u2225","\\Vert");y(ne,S,z,"\u2225","\\textbardbl");y(ne,S,z,"~","\\textasciitilde");y(ne,S,z,"\\","\\textbackslash");y(ne,S,z,"^","\\textasciicircum");y(b,S,O,"\u2191","\\uparrow",!0);y(b,S,O,"\u21D1","\\Uparrow",!0);y(b,S,O,"\u2193","\\downarrow",!0);y(b,S,O,"\u21D3","\\Downarrow",!0);y(b,S,O,"\u2195","\\updownarrow",!0);y(b,S,O,"\u21D5","\\Updownarrow",!0);y(b,S,Er,"\u2210","\\coprod");y(b,S,Er,"\u22C1","\\bigvee");y(b,S,Er,"\u22C0","\\bigwedge");y(b,S,Er,"\u2A04","\\biguplus");y(b,S,Er,"\u22C2","\\bigcap");y(b,S,Er,"\u22C3","\\bigcup");y(b,S,Er,"\u222B","\\int");y(b,S,Er,"\u222B","\\intop");y(b,S,Er,"\u222C","\\iint");y(b,S,Er,"\u222D","\\iiint");y(b,S,Er,"\u220F","\\prod");y(b,S,Er,"\u2211","\\sum");y(b,S,Er,"\u2A02","\\bigotimes");y(b,S,Er,"\u2A01","\\bigoplus");y(b,S,Er,"\u2A00","\\bigodot");y(b,S,Er,"\u222E","\\oint");y(b,S,Er,"\u222F","\\oiint");y(b,S,Er,"\u2230","\\oiiint");y(b,S,Er,"\u2A06","\\bigsqcup");y(b,S,Er,"\u222B","\\smallint");y(ne,S,bo,"\u2026","\\textellipsis");y(b,S,bo,"\u2026","\\mathellipsis");y(ne,S,bo,"\u2026","\\ldots",!0);y(b,S,bo,"\u2026","\\ldots",!0);y(b,S,bo,"\u22EF","\\@cdots",!0);y(b,S,bo,"\u22F1","\\ddots",!0);y(b,S,z,"\u22EE","\\varvdots");y(ne,S,z,"\u22EE","\\varvdots");y(b,S,sr,"\u02CA","\\acute");y(b,S,sr,"\u02CB","\\grave");y(b,S,sr,"\xA8","\\ddot");y(b,S,sr,"~","\\tilde");y(b,S,sr,"\u02C9","\\bar");y(b,S,sr,"\u02D8","\\breve");y(b,S,sr,"\u02C7","\\check");y(b,S,sr,"^","\\hat");y(b,S,sr,"\u20D7","\\vec");y(b,S,sr,"\u02D9","\\dot");y(b,S,sr,"\u02DA","\\mathring");y(b,S,et,"\uE131","\\@imath");y(b,S,et,"\uE237","\\@jmath");y(b,S,z,"\u0131","\u0131");y(b,S,z,"\u0237","\u0237");y(ne,S,z,"\u0131","\\i",!0);y(ne,S,z,"\u0237","\\j",!0);y(ne,S,z,"\xDF","\\ss",!0);y(ne,S,z,"\xE6","\\ae",!0);y(ne,S,z,"\u0153","\\oe",!0);y(ne,S,z,"\xF8","\\o",!0);y(ne,S,z,"\xC6","\\AE",!0);y(ne,S,z,"\u0152","\\OE",!0);y(ne,S,z,"\xD8","\\O",!0);y(ne,S,sr,"\u02CA","\\'");y(ne,S,sr,"\u02CB","\\`");y(ne,S,sr,"\u02C6","\\^");y(ne,S,sr,"\u02DC","\\~");y(ne,S,sr,"\u02C9","\\=");y(ne,S,sr,"\u02D8","\\u");y(ne,S,sr,"\u02D9","\\.");y(ne,S,sr,"\xB8","\\c");y(ne,S,sr,"\u02DA","\\r");y(ne,S,sr,"\u02C7","\\v");y(ne,S,sr,"\xA8",'\\"');y(ne,S,sr,"\u02DD","\\H");y(ne,S,sr,"\u25EF","\\textcircled");var F4={"--":!0,"---":!0,"``":!0,"''":!0};y(ne,S,z,"\u2013","--",!0);y(ne,S,z,"\u2013","\\textendash");y(ne,S,z,"\u2014","---",!0);y(ne,S,z,"\u2014","\\textemdash");y(ne,S,z,"\u2018","`",!0);y(ne,S,z,"\u2018","\\textquoteleft");y(ne,S,z,"\u2019","'",!0);y(ne,S,z,"\u2019","\\textquoteright");y(ne,S,z,"\u201C","``",!0);y(ne,S,z,"\u201C","\\textquotedblleft");y(ne,S,z,"\u201D","''",!0);y(ne,S,z,"\u201D","\\textquotedblright");y(b,S,z,"\xB0","\\degree",!0);y(ne,S,z,"\xB0","\\degree");y(ne,S,z,"\xB0","\\textdegree",!0);y(b,S,z,"\xA3","\\pounds");y(b,S,z,"\xA3","\\mathsterling",!0);y(ne,S,z,"\xA3","\\pounds");y(ne,S,z,"\xA3","\\textsterling",!0);y(b,I,z,"\u2720","\\maltese");y(ne,I,z,"\u2720","\\maltese");var fy='0123456789/@."';for(var Od=0;Od<fy.length;Od++){var py=fy.charAt(Od);y(b,S,z,py,py)}var my='0123456789!@*()-=+";:?/.,';for(var Rd=0;Rd<my.length;Rd++){var gy=my.charAt(Rd);y(ne,S,z,gy,gy)}var mc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var Dd=0;Dd<mc.length;Dd++){var ll=mc.charAt(Dd);y(b,S,et,ll,ll),y(ne,S,z,ll,ll)}y(b,I,z,"C","\u2102");y(ne,I,z,"C","\u2102");y(b,I,z,"H","\u210D");y(ne,I,z,"H","\u210D");y(b,I,z,"N","\u2115");y(ne,I,z,"N","\u2115");y(b,I,z,"P","\u2119");y(ne,I,z,"P","\u2119");y(b,I,z,"Q","\u211A");y(ne,I,z,"Q","\u211A");y(b,I,z,"R","\u211D");y(ne,I,z,"R","\u211D");y(b,I,z,"Z","\u2124");y(ne,I,z,"Z","\u2124");y(b,S,et,"h","\u210E");y(ne,S,et,"h","\u210E");var st="";for(var Kr=0;Kr<mc.length;Kr++){var lr=mc.charAt(Kr);st=String.fromCharCode(55349,56320+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56372+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56424+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56580+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56684+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56736+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56788+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56840+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56944+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),Kr<26&&(st=String.fromCharCode(55349,56632+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st),st=String.fromCharCode(55349,56476+Kr),y(b,S,et,lr,st),y(ne,S,z,lr,st))}st="\u{1D55C}";y(b,S,et,"k",st);y(ne,S,z,"k",st);for(var ri=0;ri<10;ri++){var vs=ri.toString();st=String.fromCharCode(55349,57294+ri),y(b,S,et,vs,st),y(ne,S,z,vs,st),st=String.fromCharCode(55349,57314+ri),y(b,S,et,vs,st),y(ne,S,z,vs,st),st=String.fromCharCode(55349,57324+ri),y(b,S,et,vs,st),y(ne,S,z,vs,st),st=String.fromCharCode(55349,57334+ri),y(b,S,et,vs,st),y(ne,S,z,vs,st)}var Pf="\xD0\xDE\xFE";for(var Bd=0;Bd<Pf.length;Bd++){var cl=Pf.charAt(Bd);y(b,S,et,cl,cl),y(ne,S,z,cl,cl)}var dl=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],yy=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],dx=function(e,t){var n=e.charCodeAt(0),a=e.charCodeAt(1),s=(n-55296)*1024+(a-56320)+65536,i=t==="math"?0:1;if(119808<=s&&s<120484){var o=Math.floor((s-119808)/26);return[dl[o][2],dl[o][i]]}else if(120782<=s&&s<=120831){var u=Math.floor((s-120782)/10);return[yy[u][2],yy[u][i]]}else{if(s===120485||s===120486)return[dl[0][2],dl[0][i]];if(120486<s&&s<120782)return["",""];throw new ue("Unsupported character: "+e)}},t0=function(e,t,n){return Yt[n][e]&&Yt[n][e].replace&&(e=Yt[n][e].replace),{value:e,metrics:lm(e,t,n)}},na=function(e,t,n,a,s){var i=t0(e,t,n),o=i.metrics;e=i.value;var u;if(o){var l=o.italic;(n==="text"||a&&a.font==="mathit")&&(l=0),u=new qn(e,o.height,o.depth,l,o.skew,o.width,s)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+t+"' and mode '"+n+"'")),u=new qn(e,0,0,0,0,0,s);if(a){u.maxFontSize=a.sizeMultiplier,a.style.isTight()&&u.classes.push("mtight");var c=a.getColor();c&&(u.style.color=c)}return u},hx=function(e,t,n,a){return a===void 0&&(a=[]),n.font==="boldsymbol"&&t0(e,"Main-Bold",t).metrics?na(e,"Main-Bold",t,n,a.concat(["mathbf"])):e==="\\"||Yt[t][e].font==="main"?na(e,"Main-Regular",t,n,a):na(e,"AMS-Regular",t,n,a.concat(["amsrm"]))},fx=function(e,t,n,a,s){return s!=="textord"&&t0(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},px=function(e,t,n){var a=e.mode,s=e.text,i=["mord"],o=a==="math"||a==="text"&&t.font,u=o?t.font:t.fontFamily,l="",c="";if(s.charCodeAt(0)===55349&&([l,c]=dx(s,a)),l.length>0)return na(s,l,a,t,i.concat(c));if(u){var d,h;if(u==="boldsymbol"){var f=fx(s,a,t,i,n);d=f.fontName,h=[f.fontClass]}else o?(d=O4[u].fontName,h=[u]):(d=hl(u,t.fontWeight,t.fontShape),h=[u,t.fontWeight,t.fontShape]);if(t0(s,d,a).metrics)return na(s,d,a,t,i.concat(h));if(F4.hasOwnProperty(s)&&d.slice(0,10)==="Typewriter"){for(var p=[],m=0;m<s.length;m++)p.push(na(s[m],d,a,t,i.concat(h)));return I4(p)}}if(n==="mathord")return na(s,"Math-Italic",a,t,i.concat(["mathnormal"]));if(n==="textord"){var v=Yt[a][s]&&Yt[a][s].font;if(v==="ams"){var _=hl("amsrm",t.fontWeight,t.fontShape);return na(s,_,a,t,i.concat("amsrm",t.fontWeight,t.fontShape))}else if(v==="main"||!v){var w=hl("textrm",t.fontWeight,t.fontShape);return na(s,w,a,t,i.concat(t.fontWeight,t.fontShape))}else{var E=hl(v,t.fontWeight,t.fontShape);return na(s,E,a,t,i.concat(E,t.fontWeight,t.fontShape))}}else throw new Error("unexpected type: "+n+" in makeOrd")},mx=(r,e)=>{if(Ps(r.classes)!==Ps(e.classes)||r.skew!==e.skew||r.maxFontSize!==e.maxFontSize)return!1;if(r.classes.length===1){var t=r.classes[0];if(t==="mbin"||t==="mord")return!1}for(var n in r.style)if(r.style.hasOwnProperty(n)&&r.style[n]!==e.style[n])return!1;for(var a in e.style)if(e.style.hasOwnProperty(a)&&r.style[a]!==e.style[a])return!1;return!0},gx=r=>{for(var e=0;e<r.length-1;e++){var t=r[e],n=r[e+1];t instanceof qn&&n instanceof qn&&mx(t,n)&&(t.text+=n.text,t.height=Math.max(t.height,n.height),t.depth=Math.max(t.depth,n.depth),t.italic=n.italic,r.splice(e+1,1),e--)}return r},dm=function(e){for(var t=0,n=0,a=0,s=0;s<e.children.length;s++){var i=e.children[s];i.height>t&&(t=i.height),i.depth>n&&(n=i.depth),i.maxFontSize>a&&(a=i.maxFontSize)}e.height=t,e.depth=n,e.maxFontSize=a},ln=function(e,t,n,a){var s=new Lu(e,t,n,a);return dm(s),s},N4=(r,e,t,n)=>new Lu(r,e,t,n),yx=function(e,t,n){var a=ln([e],[],t);return a.height=Math.max(n||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),a.style.borderBottomWidth=ye(a.height),a.maxFontSize=1,a},vx=function(e,t,n,a){var s=new cm(e,t,n,a);return dm(s),s},I4=function(e){var t=new Pu(e);return dm(t),t},_x=function(e,t){return e instanceof Pu?ln([],[e],t):e},bx=function(e){if(e.positionType==="individualShift"){for(var t=e.children,n=[t[0]],a=-t[0].shift-t[0].elem.depth,s=a,i=1;i<t.length;i++){var o=-t[i].shift-s-t[i].elem.depth,u=o-(t[i-1].elem.height+t[i-1].elem.depth);s=s+o,n.push({type:"kern",size:u}),n.push(t[i])}return{children:n,depth:a}}var l;if(e.positionType==="top"){for(var c=e.positionData,d=0;d<e.children.length;d++){var h=e.children[d];c-=h.type==="kern"?h.size:h.elem.height+h.elem.depth}l=c}else if(e.positionType==="bottom")l=-e.positionData;else{var f=e.children[0];if(f.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")l=-f.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")l=-f.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:l}},wx=function(e,t){for(var{children:n,depth:a}=bx(e),s=0,i=0;i<n.length;i++){var o=n[i];if(o.type==="elem"){var u=o.elem;s=Math.max(s,u.maxFontSize,u.height)}}s+=2;var l=ln(["pstrut"],[]);l.style.height=ye(s);for(var c=[],d=a,h=a,f=a,p=0;p<n.length;p++){var m=n[p];if(m.type==="kern")f+=m.size;else{var v=m.elem,_=m.wrapperClasses||[],w=m.wrapperStyle||{},E=ln(_,[l,v],void 0,w);E.style.top=ye(-s-f-v.depth),m.marginLeft&&(E.style.marginLeft=m.marginLeft),m.marginRight&&(E.style.marginRight=m.marginRight),c.push(E),f+=v.height+v.depth}d=Math.min(d,f),h=Math.max(h,f)}var F=ln(["vlist"],c);F.style.height=ye(h);var k;if(d<0){var N=ln([],[]),B=ln(["vlist"],[N]);B.style.height=ye(-d);var A=ln(["vlist-s"],[new qn("\u200B")]);k=[ln(["vlist-r"],[F,A]),ln(["vlist-r"],[B])]}else k=[ln(["vlist-r"],[F])];var L=ln(["vlist-t"],k);return k.length===2&&L.classes.push("vlist-t2"),L.height=h,L.depth=-d,L},Ex=(r,e)=>{var t=ln(["mspace"],[],e),n=or(r,e);return t.style.marginRight=ye(n),t},hl=function(e,t,n){var a="";switch(e){case"amsrm":a="AMS";break;case"textrm":a="Main";break;case"textsf":a="SansSerif";break;case"texttt":a="Typewriter";break;default:a=e}var s;return t==="textbf"&&n==="textit"?s="BoldItalic":t==="textbf"?s="Bold":t==="textit"?s="Italic":s="Regular",a+"-"+s},O4={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},R4={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},xx=function(e,t){var[n,a,s]=R4[e],i=new Ls(n),o=new rs([i],{width:ye(a),height:ye(s),style:"width:"+ye(a),viewBox:"0 0 "+1e3*a+" "+1e3*s,preserveAspectRatio:"xMinYMin"}),u=N4(["overlay"],[o],t);return u.height=s,u.style.height=ye(s),u.style.width=ye(a),u},H={fontMap:O4,makeSymbol:na,mathsym:hx,makeSpan:ln,makeSvgSpan:N4,makeLineSpan:yx,makeAnchor:vx,makeFragment:I4,wrapFragment:_x,makeVList:wx,makeOrd:px,makeGlue:Ex,staticSvg:xx,svgData:R4,tryCombineChars:gx},ir={number:3,unit:"mu"},ni={number:4,unit:"mu"},za={number:5,unit:"mu"},Sx={mord:{mop:ir,mbin:ni,mrel:za,minner:ir},mop:{mord:ir,mop:ir,mrel:za,minner:ir},mbin:{mord:ni,mop:ni,mopen:ni,minner:ni},mrel:{mord:za,mop:za,mopen:za,minner:za},mopen:{},mclose:{mop:ir,mbin:ni,mrel:za,minner:ir},mpunct:{mord:ir,mop:ir,mrel:za,mopen:ir,mclose:ir,mpunct:ir,minner:ir},minner:{mord:ir,mop:ir,mbin:ni,mrel:za,mopen:ir,mpunct:ir,minner:ir}},Ax={mord:{mop:ir},mop:{mord:ir,mop:ir},mbin:{},mrel:{},mopen:{},mclose:{mop:ir},mpunct:{},minner:{mop:ir}},D4={},gc={},yc={};function Te(r){for(var{type:e,names:t,props:n,handler:a,htmlBuilder:s,mathmlBuilder:i}=r,o={type:e,numArgs:n.numArgs,argTypes:n.argTypes,allowedInArgument:!!n.allowedInArgument,allowedInText:!!n.allowedInText,allowedInMath:n.allowedInMath===void 0?!0:n.allowedInMath,numOptionalArgs:n.numOptionalArgs||0,infix:!!n.infix,primitive:!!n.primitive,handler:a},u=0;u<t.length;++u)D4[t[u]]=o;e&&(s&&(gc[e]=s),i&&(yc[e]=i))}function Ci(r){var{type:e,htmlBuilder:t,mathmlBuilder:n}=r;Te({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:t,mathmlBuilder:n})}var vc=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},mr=function(e){return e.type==="ordgroup"?e.body:[e]},ns=H.makeSpan,kx=["leftmost","mbin","mopen","mrel","mop","mpunct"],Cx=["rightmost","mrel","mclose","mpunct"],Tx={display:tt.DISPLAY,text:tt.TEXT,script:tt.SCRIPT,scriptscript:tt.SCRIPTSCRIPT},Fx={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},Fr=function(e,t,n,a){a===void 0&&(a=[null,null]);for(var s=[],i=0;i<e.length;i++){var o=Ft(e[i],t);if(o instanceof Pu){var u=o.children;s.push(...u)}else s.push(o)}if(H.tryCombineChars(s),!n)return s;var l=t;if(e.length===1){var c=e[0];c.type==="sizing"?l=t.havingSize(c.size):c.type==="styling"&&(l=t.havingStyle(Tx[c.style]))}var d=ns([a[0]||"leftmost"],[],t),h=ns([a[1]||"rightmost"],[],t),f=n==="root";return vy(s,(p,m)=>{var v=m.classes[0],_=p.classes[0];v==="mbin"&&Cx.includes(_)?m.classes[0]="mord":_==="mbin"&&kx.includes(v)&&(p.classes[0]="mord")},{node:d},h,f),vy(s,(p,m)=>{var v=Lf(m),_=Lf(p),w=v&&_?p.hasClass("mtight")?Ax[v][_]:Sx[v][_]:null;if(w)return H.makeGlue(w,l)},{node:d},h,f),s},vy=function r(e,t,n,a,s){a&&e.push(a);for(var i=0;i<e.length;i++){var o=e[i],u=B4(o);if(u){r(u.children,t,n,null,s);continue}var l=!o.hasClass("mspace");if(l){var c=t(o,n.node);c&&(n.insertAfter?n.insertAfter(c):(e.unshift(c),i++))}l?n.node=o:s&&o.hasClass("newline")&&(n.node=ns(["leftmost"])),n.insertAfter=(d=>h=>{e.splice(d+1,0,h),i++})(i)}a&&e.pop()},B4=function(e){return e instanceof Pu||e instanceof cm||e instanceof Lu&&e.hasClass("enclosing")?e:null},Nx=function r(e,t){var n=B4(e);if(n){var a=n.children;if(a.length){if(t==="right")return r(a[a.length-1],"right");if(t==="left")return r(a[0],"left")}}return e},Lf=function(e,t){return e?(t&&(e=Nx(e,t)),Fx[e.classes[0]]||null):null},cu=function(e,t){var n=["nulldelimiter"].concat(e.baseSizingClasses());return ns(t.concat(n))},Ft=function(e,t,n){if(!e)return ns();if(gc[e.type]){var a=gc[e.type](e,t);if(n&&t.size!==n.size){a=ns(t.sizingClasses(n),[a],t);var s=t.sizeMultiplier/n.sizeMultiplier;a.height*=s,a.depth*=s}return a}else throw new ue("Got group of unknown type: '"+e.type+"'")};function fl(r,e){var t=ns(["base"],r,e),n=ns(["strut"]);return n.style.height=ye(t.height+t.depth),t.depth&&(n.style.verticalAlign=ye(-t.depth)),t.children.unshift(n),t}function zf(r,e){var t=null;r.length===1&&r[0].type==="tag"&&(t=r[0].tag,r=r[0].body);var n=Fr(r,e,"root"),a;n.length===2&&n[1].hasClass("tag")&&(a=n.pop());for(var s=[],i=[],o=0;o<n.length;o++)if(i.push(n[o]),n[o].hasClass("mbin")||n[o].hasClass("mrel")||n[o].hasClass("allowbreak")){for(var u=!1;o<n.length-1&&n[o+1].hasClass("mspace")&&!n[o+1].hasClass("newline");)o++,i.push(n[o]),n[o].hasClass("nobreak")&&(u=!0);u||(s.push(fl(i,e)),i=[])}else n[o].hasClass("newline")&&(i.pop(),i.length>0&&(s.push(fl(i,e)),i=[]),s.push(n[o]));i.length>0&&s.push(fl(i,e));var l;t?(l=fl(Fr(t,e,!0)),l.classes=["tag"],s.push(l)):a&&s.push(a);var c=ns(["katex-html"],s);if(c.setAttribute("aria-hidden","true"),l){var d=l.children[0];d.style.height=ye(c.height+c.depth),c.depth&&(d.style.verticalAlign=ye(-c.depth))}return c}function M4(r){return new Pu(r)}class Cn{constructor(e,t,n){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=n||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=Ps(this.classes));for(var n=0;n<this.children.length;n++)if(this.children[n]instanceof Ca&&this.children[n+1]instanceof Ca){for(var a=this.children[n].toText()+this.children[++n].toText();this.children[n+1]instanceof Ca;)a+=this.children[++n].toText();e.appendChild(new Ca(a).toNode())}else e.appendChild(this.children[n].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=Bt.escape(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+Bt.escape(Ps(this.classes))+'"'),e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}class Ca{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return Bt.escape(this.toText())}toText(){return this.text}}class Ix{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character="\u200A":e>=.1666&&e<=.1667?this.character="\u2009":e>=.2222&&e<=.2223?this.character="\u2005":e>=.2777&&e<=.2778?this.character="\u2005\u200A":e>=-.05556&&e<=-.05555?this.character="\u200A\u2063":e>=-.1667&&e<=-.1666?this.character="\u2009\u2063":e>=-.2223&&e<=-.2222?this.character="\u205F\u2063":e>=-.2778&&e<=-.2777?this.character="\u2005\u2063":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",ye(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+ye(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var oe={MathNode:Cn,TextNode:Ca,SpaceNode:Ix,newDocumentFragment:M4},Hn=function(e,t,n){return Yt[t][e]&&Yt[t][e].replace&&e.charCodeAt(0)!==55349&&!(F4.hasOwnProperty(e)&&n&&(n.fontFamily&&n.fontFamily.slice(4,6)==="tt"||n.font&&n.font.slice(4,6)==="tt"))&&(e=Yt[t][e].replace),new oe.TextNode(e)},hm=function(e){return e.length===1?e[0]:new oe.MathNode("mrow",e)},fm=function(e,t){if(t.fontFamily==="texttt")return"monospace";if(t.fontFamily==="textsf")return t.fontShape==="textit"&&t.fontWeight==="textbf"?"sans-serif-bold-italic":t.fontShape==="textit"?"sans-serif-italic":t.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(t.fontShape==="textit"&&t.fontWeight==="textbf")return"bold-italic";if(t.fontShape==="textit")return"italic";if(t.fontWeight==="textbf")return"bold";var n=t.font;if(!n||n==="mathnormal")return null;var a=e.mode;if(n==="mathit")return"italic";if(n==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(n==="mathbf")return"bold";if(n==="mathbb")return"double-struck";if(n==="mathsfit")return"sans-serif-italic";if(n==="mathfrak")return"fraktur";if(n==="mathscr"||n==="mathcal")return"script";if(n==="mathsf")return"sans-serif";if(n==="mathtt")return"monospace";var s=e.text;if(["\\imath","\\jmath"].includes(s))return null;Yt[a][s]&&Yt[a][s].replace&&(s=Yt[a][s].replace);var i=H.fontMap[n].fontName;return lm(s,i,a)?H.fontMap[n].variant:null};function Md(r){if(!r)return!1;if(r.type==="mi"&&r.children.length===1){var e=r.children[0];return e instanceof Ca&&e.text==="."}else if(r.type==="mo"&&r.children.length===1&&r.getAttribute("separator")==="true"&&r.getAttribute("lspace")==="0em"&&r.getAttribute("rspace")==="0em"){var t=r.children[0];return t instanceof Ca&&t.text===","}else return!1}var wn=function(e,t,n){if(e.length===1){var a=Zt(e[0],t);return n&&a instanceof Cn&&a.type==="mo"&&(a.setAttribute("lspace","0em"),a.setAttribute("rspace","0em")),[a]}for(var s=[],i,o=0;o<e.length;o++){var u=Zt(e[o],t);if(u instanceof Cn&&i instanceof Cn){if(u.type==="mtext"&&i.type==="mtext"&&u.getAttribute("mathvariant")===i.getAttribute("mathvariant")){i.children.push(...u.children);continue}else if(u.type==="mn"&&i.type==="mn"){i.children.push(...u.children);continue}else if(Md(u)&&i.type==="mn"){i.children.push(...u.children);continue}else if(u.type==="mn"&&Md(i))u.children=[...i.children,...u.children],s.pop();else if((u.type==="msup"||u.type==="msub")&&u.children.length>=1&&(i.type==="mn"||Md(i))){var l=u.children[0];l instanceof Cn&&l.type==="mn"&&(l.children=[...i.children,...l.children],s.pop())}else if(i.type==="mi"&&i.children.length===1){var c=i.children[0];if(c instanceof Ca&&c.text==="\u0338"&&(u.type==="mo"||u.type==="mi"||u.type==="mn")){var d=u.children[0];d instanceof Ca&&d.text.length>0&&(d.text=d.text.slice(0,1)+"\u0338"+d.text.slice(1),s.pop())}}}s.push(u),i=u}return s},zs=function(e,t,n){return hm(wn(e,t,n))},Zt=function(e,t){if(!e)return new oe.MathNode("mrow");if(yc[e.type]){var n=yc[e.type](e,t);return n}else throw new ue("Got group of unknown type: '"+e.type+"'")};function _y(r,e,t,n,a){var s=wn(r,t),i;s.length===1&&s[0]instanceof Cn&&["mrow","mtable"].includes(s[0].type)?i=s[0]:i=new oe.MathNode("mrow",s);var o=new oe.MathNode("annotation",[new oe.TextNode(e)]);o.setAttribute("encoding","application/x-tex");var u=new oe.MathNode("semantics",[i,o]),l=new oe.MathNode("math",[u]);l.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),n&&l.setAttribute("display","block");var c=a?"katex":"katex-mathml";return H.makeSpan([c],[l])}var $4=function(e){return new ja({style:e.displayMode?tt.DISPLAY:tt.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},P4=function(e,t){if(t.displayMode){var n=["katex-display"];t.leqno&&n.push("leqno"),t.fleqn&&n.push("fleqn"),e=H.makeSpan(n,[e])}return e},Ox=function(e,t,n){var a=$4(n),s;if(n.output==="mathml")return _y(e,t,a,n.displayMode,!0);if(n.output==="html"){var i=zf(e,a);s=H.makeSpan(["katex"],[i])}else{var o=_y(e,t,a,n.displayMode,!1),u=zf(e,a);s=H.makeSpan(["katex"],[o,u])}return P4(s,n)},Rx=function(e,t,n){var a=$4(n),s=zf(e,a),i=H.makeSpan(["katex"],[s]);return P4(i,n)},Dx={widehat:"^",widecheck:"\u02C7",widetilde:"~",utilde:"~",overleftarrow:"\u2190",underleftarrow:"\u2190",xleftarrow:"\u2190",overrightarrow:"\u2192",underrightarrow:"\u2192",xrightarrow:"\u2192",underbrace:"\u23DF",overbrace:"\u23DE",overgroup:"\u23E0",undergroup:"\u23E1",overleftrightarrow:"\u2194",underleftrightarrow:"\u2194",xleftrightarrow:"\u2194",Overrightarrow:"\u21D2",xRightarrow:"\u21D2",overleftharpoon:"\u21BC",xleftharpoonup:"\u21BC",overrightharpoon:"\u21C0",xrightharpoonup:"\u21C0",xLeftarrow:"\u21D0",xLeftrightarrow:"\u21D4",xhookleftarrow:"\u21A9",xhookrightarrow:"\u21AA",xmapsto:"\u21A6",xrightharpoondown:"\u21C1",xleftharpoondown:"\u21BD",xrightleftharpoons:"\u21CC",xleftrightharpoons:"\u21CB",xtwoheadleftarrow:"\u219E",xtwoheadrightarrow:"\u21A0",xlongequal:"=",xtofrom:"\u21C4",xrightleftarrows:"\u21C4",xrightequilibrium:"\u21CC",xleftequilibrium:"\u21CB","\\cdrightarrow":"\u2192","\\cdleftarrow":"\u2190","\\cdlongequal":"="},Bx=function(e){var t=new oe.MathNode("mo",[new oe.TextNode(Dx[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},Mx={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},$x=function(e){return e.type==="ordgroup"?e.body.length:1},Px=function(e,t){function n(){var o=4e5,u=e.label.slice(1);if(["widehat","widecheck","widetilde","utilde"].includes(u)){var l=e,c=$x(l.base),d,h,f;if(c>5)u==="widehat"||u==="widecheck"?(d=420,o=2364,f=.42,h=u+"4"):(d=312,o=2340,f=.34,h="tilde4");else{var p=[1,1,2,2,3,3][c];u==="widehat"||u==="widecheck"?(o=[0,1062,2364,2364,2364][p],d=[0,239,300,360,420][p],f=[0,.24,.3,.3,.36,.42][p],h=u+p):(o=[0,600,1033,2339,2340][p],d=[0,260,286,306,312][p],f=[0,.26,.286,.3,.306,.34][p],h="tilde"+p)}var m=new Ls(h),v=new rs([m],{width:"100%",height:ye(f),viewBox:"0 0 "+o+" "+d,preserveAspectRatio:"none"});return{span:H.makeSvgSpan([],[v],t),minWidth:0,height:f}}else{var _=[],w=Mx[u],[E,F,k]=w,N=k/1e3,B=E.length,A,L;if(B===1){var V=w[3];A=["hide-tail"],L=[V]}else if(B===2)A=["halfarrow-left","halfarrow-right"],L=["xMinYMin","xMaxYMin"];else if(B===3)A=["brace-left","brace-center","brace-right"],L=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+B+" children.");for(var G=0;G<B;G++){var te=new Ls(E[G]),ve=new rs([te],{width:"400em",height:ye(N),viewBox:"0 0 "+o+" "+k,preserveAspectRatio:L[G]+" slice"}),D=H.makeSvgSpan([A[G]],[ve],t);if(B===1)return{span:D,minWidth:F,height:N};D.style.height=ye(N),_.push(D)}return{span:H.makeSpan(["stretchy"],_,t),minWidth:F,height:N}}}var{span:a,minWidth:s,height:i}=n();return a.height=i,a.style.height=ye(i),s>0&&(a.style.minWidth=ye(s)),a},Lx=function(e,t,n,a,s){var i,o=e.height+e.depth+n+a;if(/fbox|color|angl/.test(t)){if(i=H.makeSpan(["stretchy",t],[],s),t==="fbox"){var u=s.color&&s.getColor();u&&(i.style.borderColor=u)}}else{var l=[];/^[bx]cancel$/.test(t)&&l.push(new $f({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&l.push(new $f({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var c=new rs(l,{width:"100%",height:ye(o)});i=H.makeSvgSpan([],[c],s)}return i.height=o,i.style.height=ye(o),i},as={encloseSpan:Lx,mathMLnode:Bx,svgSpan:Px};function pt(r,e){if(!r||r.type!==e)throw new Error("Expected node of type "+e+", but got "+(r?"node of type "+r.type:String(r)));return r}function pm(r){var e=r0(r);if(!e)throw new Error("Expected node of symbol group type, but got "+(r?"node of type "+r.type:String(r)));return e}function r0(r){return r&&(r.type==="atom"||cx.hasOwnProperty(r.type))?r:null}var mm=(r,e)=>{var t,n,a;r&&r.type==="supsub"?(n=pt(r.base,"accent"),t=n.base,r.base=t,a=ux(Ft(r,e)),r.base=n):(n=pt(r,"accent"),t=n.base);var s=Ft(t,e.havingCrampedStyle()),i=n.isShifty&&Bt.isCharacterBox(t),o=0;if(i){var u=Bt.getBaseElem(t),l=Ft(u,e.havingCrampedStyle());o=hy(l).skew}var c=n.label==="\\c",d=c?s.height+s.depth:Math.min(s.height,e.fontMetrics().xHeight),h;if(n.isStretchy)h=as.svgSpan(n,e),h=H.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"elem",elem:h,wrapperClasses:["svg-align"],wrapperStyle:o>0?{width:"calc(100% - "+ye(2*o)+")",marginLeft:ye(2*o)}:void 0}]},e);else{var f,p;n.label==="\\vec"?(f=H.staticSvg("vec",e),p=H.svgData.vec[1]):(f=H.makeOrd({mode:n.mode,text:n.label},e,"textord"),f=hy(f),f.italic=0,p=f.width,c&&(d+=f.depth)),h=H.makeSpan(["accent-body"],[f]);var m=n.label==="\\textcircled";m&&(h.classes.push("accent-full"),d=s.height);var v=o;m||(v-=p/2),h.style.left=ye(v),n.label==="\\textcircled"&&(h.style.top=".2em"),h=H.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"kern",size:-d},{type:"elem",elem:h}]},e)}var _=H.makeSpan(["mord","accent"],[h],e);return a?(a.children[0]=_,a.height=Math.max(_.height,a.height),a.classes[0]="mord",a):_},L4=(r,e)=>{var t=r.isStretchy?as.mathMLnode(r.label):new oe.MathNode("mo",[Hn(r.label,r.mode)]),n=new oe.MathNode("mover",[Zt(r.base,e),t]);return n.setAttribute("accent","true"),n},zx=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(r=>"\\"+r).join("|"));Te({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(r,e)=>{var t=vc(e[0]),n=!zx.test(r.funcName),a=!n||r.funcName==="\\widehat"||r.funcName==="\\widetilde"||r.funcName==="\\widecheck";return{type:"accent",mode:r.parser.mode,label:r.funcName,isStretchy:n,isShifty:a,base:t}},htmlBuilder:mm,mathmlBuilder:L4});Te({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(r,e)=>{var t=e[0],n=r.parser.mode;return n==="math"&&(r.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+r.funcName+" works only in text mode"),n="text"),{type:"accent",mode:n,label:r.funcName,isStretchy:!1,isShifty:!0,base:t}},htmlBuilder:mm,mathmlBuilder:L4});Te({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(r,e)=>{var{parser:t,funcName:n}=r,a=e[0];return{type:"accentUnder",mode:t.mode,label:n,base:a}},htmlBuilder:(r,e)=>{var t=Ft(r.base,e),n=as.svgSpan(r,e),a=r.label==="\\utilde"?.12:0,s=H.makeVList({positionType:"top",positionData:t.height,children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:a},{type:"elem",elem:t}]},e);return H.makeSpan(["mord","accentunder"],[s],e)},mathmlBuilder:(r,e)=>{var t=as.mathMLnode(r.label),n=new oe.MathNode("munder",[Zt(r.base,e),t]);return n.setAttribute("accentunder","true"),n}});var pl=r=>{var e=new oe.MathNode("mpadded",r?[r]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};Te({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(r,e,t){var{parser:n,funcName:a}=r;return{type:"xArrow",mode:n.mode,label:a,body:e[0],below:t[0]}},htmlBuilder(r,e){var t=e.style,n=e.havingStyle(t.sup()),a=H.wrapFragment(Ft(r.body,n,e),e),s=r.label.slice(0,2)==="\\x"?"x":"cd";a.classes.push(s+"-arrow-pad");var i;r.below&&(n=e.havingStyle(t.sub()),i=H.wrapFragment(Ft(r.below,n,e),e),i.classes.push(s+"-arrow-pad"));var o=as.svgSpan(r,e),u=-e.fontMetrics().axisHeight+.5*o.height,l=-e.fontMetrics().axisHeight-.5*o.height-.111;(a.depth>.25||r.label==="\\xleftequilibrium")&&(l-=a.depth);var c;if(i){var d=-e.fontMetrics().axisHeight+i.height+.5*o.height+.111;c=H.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:l},{type:"elem",elem:o,shift:u},{type:"elem",elem:i,shift:d}]},e)}else c=H.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:l},{type:"elem",elem:o,shift:u}]},e);return c.children[0].children[0].children[1].classes.push("svg-align"),H.makeSpan(["mrel","x-arrow"],[c],e)},mathmlBuilder(r,e){var t=as.mathMLnode(r.label);t.setAttribute("minsize",r.label.charAt(0)==="x"?"1.75em":"3.0em");var n;if(r.body){var a=pl(Zt(r.body,e));if(r.below){var s=pl(Zt(r.below,e));n=new oe.MathNode("munderover",[t,s,a])}else n=new oe.MathNode("mover",[t,a])}else if(r.below){var i=pl(Zt(r.below,e));n=new oe.MathNode("munder",[t,i])}else n=pl(),n=new oe.MathNode("mover",[t,n]);return n}});var Ux=H.makeSpan;function z4(r,e){var t=Fr(r.body,e,!0);return Ux([r.mclass],t,e)}function U4(r,e){var t,n=wn(r.body,e);return r.mclass==="minner"?t=new oe.MathNode("mpadded",n):r.mclass==="mord"?r.isCharacterBox?(t=n[0],t.type="mi"):t=new oe.MathNode("mi",n):(r.isCharacterBox?(t=n[0],t.type="mo"):t=new oe.MathNode("mo",n),r.mclass==="mbin"?(t.attributes.lspace="0.22em",t.attributes.rspace="0.22em"):r.mclass==="mpunct"?(t.attributes.lspace="0em",t.attributes.rspace="0.17em"):r.mclass==="mopen"||r.mclass==="mclose"?(t.attributes.lspace="0em",t.attributes.rspace="0em"):r.mclass==="minner"&&(t.attributes.lspace="0.0556em",t.attributes.width="+0.1111em")),t}Te({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(r,e){var{parser:t,funcName:n}=r,a=e[0];return{type:"mclass",mode:t.mode,mclass:"m"+n.slice(5),body:mr(a),isCharacterBox:Bt.isCharacterBox(a)}},htmlBuilder:z4,mathmlBuilder:U4});var n0=r=>{var e=r.type==="ordgroup"&&r.body.length?r.body[0]:r;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};Te({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(r,e){var{parser:t}=r;return{type:"mclass",mode:t.mode,mclass:n0(e[0]),body:mr(e[1]),isCharacterBox:Bt.isCharacterBox(e[1])}}});Te({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(r,e){var{parser:t,funcName:n}=r,a=e[1],s=e[0],i;n!=="\\stackrel"?i=n0(a):i="mrel";var o={type:"op",mode:a.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:n!=="\\stackrel",body:mr(a)},u={type:"supsub",mode:s.mode,base:o,sup:n==="\\underset"?null:s,sub:n==="\\underset"?s:null};return{type:"mclass",mode:t.mode,mclass:i,body:[u],isCharacterBox:Bt.isCharacterBox(u)}},htmlBuilder:z4,mathmlBuilder:U4});Te({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(r,e){var{parser:t}=r;return{type:"pmb",mode:t.mode,mclass:n0(e[0]),body:mr(e[0])}},htmlBuilder(r,e){var t=Fr(r.body,e,!0),n=H.makeSpan([r.mclass],t,e);return n.style.textShadow="0.02em 0.01em 0.04px",n},mathmlBuilder(r,e){var t=wn(r.body,e),n=new oe.MathNode("mstyle",t);return n.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),n}});var jx={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},by=()=>({type:"styling",body:[],mode:"math",style:"display"}),wy=r=>r.type==="textord"&&r.text==="@",qx=(r,e)=>(r.type==="mathord"||r.type==="atom")&&r.text===e;function Hx(r,e,t){var n=jx[r];switch(n){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return t.callFunction(n,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var a=t.callFunction("\\\\cdleft",[e[0]],[]),s={type:"atom",text:n,mode:"math",family:"rel"},i=t.callFunction("\\Big",[s],[]),o=t.callFunction("\\\\cdright",[e[1]],[]),u={type:"ordgroup",mode:"math",body:[a,i,o]};return t.callFunction("\\\\cdparent",[u],[])}case"\\\\cdlongequal":return t.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var l={type:"textord",text:"\\Vert",mode:"math"};return t.callFunction("\\Big",[l],[])}default:return{type:"textord",text:" ",mode:"math"}}}function Vx(r){var e=[];for(r.gullet.beginGroup(),r.gullet.macros.set("\\cr","\\\\\\relax"),r.gullet.beginGroup();;){e.push(r.parseExpression(!1,"\\\\")),r.gullet.endGroup(),r.gullet.beginGroup();var t=r.fetch().text;if(t==="&"||t==="\\\\")r.consume();else if(t==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new ue("Expected \\\\ or \\cr or \\end",r.nextToken)}for(var n=[],a=[n],s=0;s<e.length;s++){for(var i=e[s],o=by(),u=0;u<i.length;u++)if(!wy(i[u]))o.body.push(i[u]);else{n.push(o),u+=1;var l=pm(i[u]).text,c=new Array(2);if(c[0]={type:"ordgroup",mode:"math",body:[]},c[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(l)>-1))if("<>AV".indexOf(l)>-1)for(var d=0;d<2;d++){for(var h=!0,f=u+1;f<i.length;f++){if(qx(i[f],l)){h=!1,u=f;break}if(wy(i[f]))throw new ue("Missing a "+l+" character to complete a CD arrow.",i[f]);c[d].body.push(i[f])}if(h)throw new ue("Missing a "+l+" character to complete a CD arrow.",i[u])}else throw new ue('Expected one of "<>AV=|." after @',i[u]);var p=Hx(l,c,r),m={type:"styling",body:[p],mode:"math",style:"display"};n.push(m),o=by()}s%2===0?n.push(o):n.shift(),n=[],a.push(n)}r.gullet.endGroup(),r.gullet.endGroup();var v=new Array(a[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:a,arraystretch:1,addJot:!0,rowGaps:[null],cols:v,colSeparationType:"CD",hLinesBeforeRow:new Array(a.length+1).fill([])}}Te({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(r,e){var{parser:t,funcName:n}=r;return{type:"cdlabel",mode:t.mode,side:n.slice(4),label:e[0]}},htmlBuilder(r,e){var t=e.havingStyle(e.style.sup()),n=H.wrapFragment(Ft(r.label,t,e),e);return n.classes.push("cd-label-"+r.side),n.style.bottom=ye(.8-n.depth),n.height=0,n.depth=0,n},mathmlBuilder(r,e){var t=new oe.MathNode("mrow",[Zt(r.label,e)]);return t=new oe.MathNode("mpadded",[t]),t.setAttribute("width","0"),r.side==="left"&&t.setAttribute("lspace","-1width"),t.setAttribute("voffset","0.7em"),t=new oe.MathNode("mstyle",[t]),t.setAttribute("displaystyle","false"),t.setAttribute("scriptlevel","1"),t}});Te({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(r,e){var{parser:t}=r;return{type:"cdlabelparent",mode:t.mode,fragment:e[0]}},htmlBuilder(r,e){var t=H.wrapFragment(Ft(r.fragment,e),e);return t.classes.push("cd-vert-arrow"),t},mathmlBuilder(r,e){return new oe.MathNode("mrow",[Zt(r.fragment,e)])}});Te({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(r,e){for(var{parser:t}=r,n=pt(e[0],"ordgroup"),a=n.body,s="",i=0;i<a.length;i++){var o=pt(a[i],"textord");s+=o.text}var u=parseInt(s),l;if(isNaN(u))throw new ue("\\@char has non-numeric argument "+s);if(u<0||u>=1114111)throw new ue("\\@char with invalid code point "+s);return u<=65535?l=String.fromCharCode(u):(u-=65536,l=String.fromCharCode((u>>10)+55296,(u&1023)+56320)),{type:"textord",mode:t.mode,text:l}}});var j4=(r,e)=>{var t=Fr(r.body,e.withColor(r.color),!1);return H.makeFragment(t)},q4=(r,e)=>{var t=wn(r.body,e.withColor(r.color)),n=new oe.MathNode("mstyle",t);return n.setAttribute("mathcolor",r.color),n};Te({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(r,e){var{parser:t}=r,n=pt(e[0],"color-token").color,a=e[1];return{type:"color",mode:t.mode,color:n,body:mr(a)}},htmlBuilder:j4,mathmlBuilder:q4});Te({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(r,e){var{parser:t,breakOnTokenText:n}=r,a=pt(e[0],"color-token").color;t.gullet.macros.set("\\current@color",a);var s=t.parseExpression(!0,n);return{type:"color",mode:t.mode,color:a,body:s}},htmlBuilder:j4,mathmlBuilder:q4});Te({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(r,e,t){var{parser:n}=r,a=n.gullet.future().text==="["?n.parseSizeGroup(!0):null,s=!n.settings.displayMode||!n.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:n.mode,newLine:s,size:a&&pt(a,"size").value}},htmlBuilder(r,e){var t=H.makeSpan(["mspace"],[],e);return r.newLine&&(t.classes.push("newline"),r.size&&(t.style.marginTop=ye(or(r.size,e)))),t},mathmlBuilder(r,e){var t=new oe.MathNode("mspace");return r.newLine&&(t.setAttribute("linebreak","newline"),r.size&&t.setAttribute("height",ye(or(r.size,e)))),t}});var Uf={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},H4=r=>{var e=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new ue("Expected a control sequence",r);return e},Gx=r=>{var e=r.gullet.popToken();return e.text==="="&&(e=r.gullet.popToken(),e.text===" "&&(e=r.gullet.popToken())),e},V4=(r,e,t,n)=>{var a=r.gullet.macros.get(t.text);a==null&&(t.noexpand=!0,a={tokens:[t],numArgs:0,unexpandable:!r.gullet.isExpandable(t.text)}),r.gullet.macros.set(e,a,n)};Te({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(r){var{parser:e,funcName:t}=r;e.consumeSpaces();var n=e.fetch();if(Uf[n.text])return(t==="\\global"||t==="\\\\globallong")&&(n.text=Uf[n.text]),pt(e.parseFunction(),"internal");throw new ue("Invalid token after macro prefix",n)}});Te({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(r){var{parser:e,funcName:t}=r,n=e.gullet.popToken(),a=n.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(a))throw new ue("Expected a control sequence",n);for(var s=0,i,o=[[]];e.gullet.future().text!=="{";)if(n=e.gullet.popToken(),n.text==="#"){if(e.gullet.future().text==="{"){i=e.gullet.future(),o[s].push("{");break}if(n=e.gullet.popToken(),!/^[1-9]$/.test(n.text))throw new ue('Invalid argument number "'+n.text+'"');if(parseInt(n.text)!==s+1)throw new ue('Argument number "'+n.text+'" out of order');s++,o.push([])}else{if(n.text==="EOF")throw new ue("Expected a macro definition");o[s].push(n.text)}var{tokens:u}=e.gullet.consumeArg();return i&&u.unshift(i),(t==="\\edef"||t==="\\xdef")&&(u=e.gullet.expandTokens(u),u.reverse()),e.gullet.macros.set(a,{tokens:u,numArgs:s,delimiters:o},t===Uf[t]),{type:"internal",mode:e.mode}}});Te({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(r){var{parser:e,funcName:t}=r,n=H4(e.gullet.popToken());e.gullet.consumeSpaces();var a=Gx(e);return V4(e,n,a,t==="\\\\globallet"),{type:"internal",mode:e.mode}}});Te({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(r){var{parser:e,funcName:t}=r,n=H4(e.gullet.popToken()),a=e.gullet.popToken(),s=e.gullet.popToken();return V4(e,n,s,t==="\\\\globalfuture"),e.gullet.pushToken(s),e.gullet.pushToken(a),{type:"internal",mode:e.mode}}});var Po=function(e,t,n){var a=Yt.math[e]&&Yt.math[e].replace,s=lm(a||e,t,n);if(!s)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return s},gm=function(e,t,n,a){var s=n.havingBaseStyle(t),i=H.makeSpan(a.concat(s.sizingClasses(n)),[e],n),o=s.sizeMultiplier/n.sizeMultiplier;return i.height*=o,i.depth*=o,i.maxFontSize=s.sizeMultiplier,i},G4=function(e,t,n){var a=t.havingBaseStyle(n),s=(1-t.sizeMultiplier/a.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=ye(s),e.height-=s,e.depth+=s},Zx=function(e,t,n,a,s,i){var o=H.makeSymbol(e,"Main-Regular",s,a),u=gm(o,t,a,i);return n&&G4(u,a,t),u},Kx=function(e,t,n,a){return H.makeSymbol(e,"Size"+t+"-Regular",n,a)},Z4=function(e,t,n,a,s,i){var o=Kx(e,t,s,a),u=gm(H.makeSpan(["delimsizing","size"+t],[o],a),tt.TEXT,a,i);return n&&G4(u,a,tt.TEXT),u},$d=function(e,t,n){var a;t==="Size1-Regular"?a="delim-size1":a="delim-size4";var s=H.makeSpan(["delimsizinginner",a],[H.makeSpan([],[H.makeSymbol(e,t,n)])]);return{type:"elem",elem:s}},Pd=function(e,t,n){var a=ka["Size4-Regular"][e.charCodeAt(0)]?ka["Size4-Regular"][e.charCodeAt(0)][4]:ka["Size1-Regular"][e.charCodeAt(0)][4],s=new Ls("inner",Q9(e,Math.round(1e3*t))),i=new rs([s],{width:ye(a),height:ye(t),style:"width:"+ye(a),viewBox:"0 0 "+1e3*a+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),o=H.makeSvgSpan([],[i],n);return o.height=t,o.style.height=ye(t),o.style.width=ye(a),{type:"elem",elem:o}},jf=.008,ml={type:"kern",size:-1*jf},Wx=["|","\\lvert","\\rvert","\\vert"],Yx=["\\|","\\lVert","\\rVert","\\Vert"],K4=function(e,t,n,a,s,i){var o,u,l,c,d="",h=0;o=l=c=e,u=null;var f="Size1-Regular";e==="\\uparrow"?l=c="\u23D0":e==="\\Uparrow"?l=c="\u2016":e==="\\downarrow"?o=l="\u23D0":e==="\\Downarrow"?o=l="\u2016":e==="\\updownarrow"?(o="\\uparrow",l="\u23D0",c="\\downarrow"):e==="\\Updownarrow"?(o="\\Uparrow",l="\u2016",c="\\Downarrow"):Wx.includes(e)?(l="\u2223",d="vert",h=333):Yx.includes(e)?(l="\u2225",d="doublevert",h=556):e==="["||e==="\\lbrack"?(o="\u23A1",l="\u23A2",c="\u23A3",f="Size4-Regular",d="lbrack",h=667):e==="]"||e==="\\rbrack"?(o="\u23A4",l="\u23A5",c="\u23A6",f="Size4-Regular",d="rbrack",h=667):e==="\\lfloor"||e==="\u230A"?(l=o="\u23A2",c="\u23A3",f="Size4-Regular",d="lfloor",h=667):e==="\\lceil"||e==="\u2308"?(o="\u23A1",l=c="\u23A2",f="Size4-Regular",d="lceil",h=667):e==="\\rfloor"||e==="\u230B"?(l=o="\u23A5",c="\u23A6",f="Size4-Regular",d="rfloor",h=667):e==="\\rceil"||e==="\u2309"?(o="\u23A4",l=c="\u23A5",f="Size4-Regular",d="rceil",h=667):e==="("||e==="\\lparen"?(o="\u239B",l="\u239C",c="\u239D",f="Size4-Regular",d="lparen",h=875):e===")"||e==="\\rparen"?(o="\u239E",l="\u239F",c="\u23A0",f="Size4-Regular",d="rparen",h=875):e==="\\{"||e==="\\lbrace"?(o="\u23A7",u="\u23A8",c="\u23A9",l="\u23AA",f="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(o="\u23AB",u="\u23AC",c="\u23AD",l="\u23AA",f="Size4-Regular"):e==="\\lgroup"||e==="\u27EE"?(o="\u23A7",c="\u23A9",l="\u23AA",f="Size4-Regular"):e==="\\rgroup"||e==="\u27EF"?(o="\u23AB",c="\u23AD",l="\u23AA",f="Size4-Regular"):e==="\\lmoustache"||e==="\u23B0"?(o="\u23A7",c="\u23AD",l="\u23AA",f="Size4-Regular"):(e==="\\rmoustache"||e==="\u23B1")&&(o="\u23AB",c="\u23A9",l="\u23AA",f="Size4-Regular");var p=Po(o,f,s),m=p.height+p.depth,v=Po(l,f,s),_=v.height+v.depth,w=Po(c,f,s),E=w.height+w.depth,F=0,k=1;if(u!==null){var N=Po(u,f,s);F=N.height+N.depth,k=2}var B=m+E+F,A=Math.max(0,Math.ceil((t-B)/(k*_))),L=B+A*k*_,V=a.fontMetrics().axisHeight;n&&(V*=a.sizeMultiplier);var G=L/2-V,te=[];if(d.length>0){var ve=L-m-E,D=Math.round(L*1e3),M=ex(d,Math.round(ve*1e3)),P=new Ls(d,M),Z=(h/1e3).toFixed(3)+"em",W=(D/1e3).toFixed(3)+"em",X=new rs([P],{width:Z,height:W,viewBox:"0 0 "+h+" "+D}),Y=H.makeSvgSpan([],[X],a);Y.height=D/1e3,Y.style.width=Z,Y.style.height=W,te.push({type:"elem",elem:Y})}else{if(te.push($d(c,f,s)),te.push(ml),u===null){var re=L-m-E+2*jf;te.push(Pd(l,re,a))}else{var U=(L-m-E-F)/2+2*jf;te.push(Pd(l,U,a)),te.push(ml),te.push($d(u,f,s)),te.push(ml),te.push(Pd(l,U,a))}te.push(ml),te.push($d(o,f,s))}var j=a.havingBaseStyle(tt.TEXT),ae=H.makeVList({positionType:"bottom",positionData:G,children:te},j);return gm(H.makeSpan(["delimsizing","mult"],[ae],j),tt.TEXT,a,i)},Ld=80,zd=.08,Ud=function(e,t,n,a,s){var i=X9(e,a,n),o=new Ls(e,i),u=new rs([o],{width:"400em",height:ye(t),viewBox:"0 0 400000 "+n,preserveAspectRatio:"xMinYMin slice"});return H.makeSvgSpan(["hide-tail"],[u],s)},Jx=function(e,t){var n=t.havingBaseSizing(),a=X4("\\surd",e*n.sizeMultiplier,J4,n),s=n.sizeMultiplier,i=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),o,u=0,l=0,c=0,d;return a.type==="small"?(c=1e3+1e3*i+Ld,e<1?s=1:e<1.4&&(s=.7),u=(1+i+zd)/s,l=(1+i)/s,o=Ud("sqrtMain",u,c,i,t),o.style.minWidth="0.853em",d=.833/s):a.type==="large"?(c=(1e3+Ld)*Jo[a.size],l=(Jo[a.size]+i)/s,u=(Jo[a.size]+i+zd)/s,o=Ud("sqrtSize"+a.size,u,c,i,t),o.style.minWidth="1.02em",d=1/s):(u=e+i+zd,l=e+i,c=Math.floor(1e3*e+i)+Ld,o=Ud("sqrtTall",u,c,i,t),o.style.minWidth="0.742em",d=1.056),o.height=l,o.style.height=ye(u),{span:o,advanceWidth:d,ruleWidth:(t.fontMetrics().sqrtRuleThickness+i)*s}},W4=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\u230A","\u230B","\\lceil","\\rceil","\u2308","\u2309","\\surd"],Xx=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\u27EE","\u27EF","\\lmoustache","\\rmoustache","\u23B0","\u23B1"],Y4=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],Jo=[0,1.2,1.8,2.4,3],Qx=function(e,t,n,a,s){if(e==="<"||e==="\\lt"||e==="\u27E8"?e="\\langle":(e===">"||e==="\\gt"||e==="\u27E9")&&(e="\\rangle"),W4.includes(e)||Y4.includes(e))return Z4(e,t,!1,n,a,s);if(Xx.includes(e))return K4(e,Jo[t],!1,n,a,s);throw new ue("Illegal delimiter: '"+e+"'")},eS=[{type:"small",style:tt.SCRIPTSCRIPT},{type:"small",style:tt.SCRIPT},{type:"small",style:tt.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],tS=[{type:"small",style:tt.SCRIPTSCRIPT},{type:"small",style:tt.SCRIPT},{type:"small",style:tt.TEXT},{type:"stack"}],J4=[{type:"small",style:tt.SCRIPTSCRIPT},{type:"small",style:tt.SCRIPT},{type:"small",style:tt.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],rS=function(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},X4=function(e,t,n,a){for(var s=Math.min(2,3-a.style.size),i=s;i<n.length&&n[i].type!=="stack";i++){var o=Po(e,rS(n[i]),"math"),u=o.height+o.depth;if(n[i].type==="small"){var l=a.havingBaseStyle(n[i].style);u*=l.sizeMultiplier}if(u>t)return n[i]}return n[n.length-1]},Q4=function(e,t,n,a,s,i){e==="<"||e==="\\lt"||e==="\u27E8"?e="\\langle":(e===">"||e==="\\gt"||e==="\u27E9")&&(e="\\rangle");var o;Y4.includes(e)?o=eS:W4.includes(e)?o=J4:o=tS;var u=X4(e,t,o,a);return u.type==="small"?Zx(e,u.style,n,a,s,i):u.type==="large"?Z4(e,u.size,n,a,s,i):K4(e,t,n,a,s,i)},nS=function(e,t,n,a,s,i){var o=a.fontMetrics().axisHeight*a.sizeMultiplier,u=901,l=5/a.fontMetrics().ptPerEm,c=Math.max(t-o,n+o),d=Math.max(c/500*u,2*c-l);return Q4(e,d,!0,a,s,i)},Ja={sqrtImage:Jx,sizedDelim:Qx,sizeToMaxHeight:Jo,customSizedDelim:Q4,leftRightDelim:nS},Ey={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},aS=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\u230A","\u230B","\\lceil","\\rceil","\u2308","\u2309","<",">","\\langle","\u27E8","\\rangle","\u27E9","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\u27EE","\u27EF","\\lmoustache","\\rmoustache","\u23B0","\u23B1","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function a0(r,e){var t=r0(r);if(t&&aS.includes(t.text))return t;throw t?new ue("Invalid delimiter '"+t.text+"' after '"+e.funcName+"'",r):new ue("Invalid delimiter type '"+r.type+"'",r)}Te({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(r,e)=>{var t=a0(e[0],r);return{type:"delimsizing",mode:r.parser.mode,size:Ey[r.funcName].size,mclass:Ey[r.funcName].mclass,delim:t.text}},htmlBuilder:(r,e)=>r.delim==="."?H.makeSpan([r.mclass]):Ja.sizedDelim(r.delim,r.size,e,r.mode,[r.mclass]),mathmlBuilder:r=>{var e=[];r.delim!=="."&&e.push(Hn(r.delim,r.mode));var t=new oe.MathNode("mo",e);r.mclass==="mopen"||r.mclass==="mclose"?t.setAttribute("fence","true"):t.setAttribute("fence","false"),t.setAttribute("stretchy","true");var n=ye(Ja.sizeToMaxHeight[r.size]);return t.setAttribute("minsize",n),t.setAttribute("maxsize",n),t}});function xy(r){if(!r.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}Te({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(r,e)=>{var t=r.parser.gullet.macros.get("\\current@color");if(t&&typeof t!="string")throw new ue("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:r.parser.mode,delim:a0(e[0],r).text,color:t}}});Te({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(r,e)=>{var t=a0(e[0],r),n=r.parser;++n.leftrightDepth;var a=n.parseExpression(!1);--n.leftrightDepth,n.expect("\\right",!1);var s=pt(n.parseFunction(),"leftright-right");return{type:"leftright",mode:n.mode,body:a,left:t.text,right:s.delim,rightColor:s.color}},htmlBuilder:(r,e)=>{xy(r);for(var t=Fr(r.body,e,!0,["mopen","mclose"]),n=0,a=0,s=!1,i=0;i<t.length;i++)t[i].isMiddle?s=!0:(n=Math.max(t[i].height,n),a=Math.max(t[i].depth,a));n*=e.sizeMultiplier,a*=e.sizeMultiplier;var o;if(r.left==="."?o=cu(e,["mopen"]):o=Ja.leftRightDelim(r.left,n,a,e,r.mode,["mopen"]),t.unshift(o),s)for(var u=1;u<t.length;u++){var l=t[u],c=l.isMiddle;c&&(t[u]=Ja.leftRightDelim(c.delim,n,a,c.options,r.mode,[]))}var d;if(r.right===".")d=cu(e,["mclose"]);else{var h=r.rightColor?e.withColor(r.rightColor):e;d=Ja.leftRightDelim(r.right,n,a,h,r.mode,["mclose"])}return t.push(d),H.makeSpan(["minner"],t,e)},mathmlBuilder:(r,e)=>{xy(r);var t=wn(r.body,e);if(r.left!=="."){var n=new oe.MathNode("mo",[Hn(r.left,r.mode)]);n.setAttribute("fence","true"),t.unshift(n)}if(r.right!=="."){var a=new oe.MathNode("mo",[Hn(r.right,r.mode)]);a.setAttribute("fence","true"),r.rightColor&&a.setAttribute("mathcolor",r.rightColor),t.push(a)}return hm(t)}});Te({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(r,e)=>{var t=a0(e[0],r);if(!r.parser.leftrightDepth)throw new ue("\\middle without preceding \\left",t);return{type:"middle",mode:r.parser.mode,delim:t.text}},htmlBuilder:(r,e)=>{var t;if(r.delim===".")t=cu(e,[]);else{t=Ja.sizedDelim(r.delim,1,e,r.mode,[]);var n={delim:r.delim,options:e};t.isMiddle=n}return t},mathmlBuilder:(r,e)=>{var t=r.delim==="\\vert"||r.delim==="|"?Hn("|","text"):Hn(r.delim,r.mode),n=new oe.MathNode("mo",[t]);return n.setAttribute("fence","true"),n.setAttribute("lspace","0.05em"),n.setAttribute("rspace","0.05em"),n}});var ym=(r,e)=>{var t=H.wrapFragment(Ft(r.body,e),e),n=r.label.slice(1),a=e.sizeMultiplier,s,i=0,o=Bt.isCharacterBox(r.body);if(n==="sout")s=H.makeSpan(["stretchy","sout"]),s.height=e.fontMetrics().defaultRuleThickness/a,i=-.5*e.fontMetrics().xHeight;else if(n==="phase"){var u=or({number:.6,unit:"pt"},e),l=or({number:.35,unit:"ex"},e),c=e.havingBaseSizing();a=a/c.sizeMultiplier;var d=t.height+t.depth+u+l;t.style.paddingLeft=ye(d/2+u);var h=Math.floor(1e3*d*a),f=Y9(h),p=new rs([new Ls("phase",f)],{width:"400em",height:ye(h/1e3),viewBox:"0 0 400000 "+h,preserveAspectRatio:"xMinYMin slice"});s=H.makeSvgSpan(["hide-tail"],[p],e),s.style.height=ye(d),i=t.depth+u+l}else{/cancel/.test(n)?o||t.classes.push("cancel-pad"):n==="angl"?t.classes.push("anglpad"):t.classes.push("boxpad");var m=0,v=0,_=0;/box/.test(n)?(_=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),m=e.fontMetrics().fboxsep+(n==="colorbox"?0:_),v=m):n==="angl"?(_=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),m=4*_,v=Math.max(0,.25-t.depth)):(m=o?.2:0,v=m),s=as.encloseSpan(t,n,m,v,e),/fbox|boxed|fcolorbox/.test(n)?(s.style.borderStyle="solid",s.style.borderWidth=ye(_)):n==="angl"&&_!==.049&&(s.style.borderTopWidth=ye(_),s.style.borderRightWidth=ye(_)),i=t.depth+v,r.backgroundColor&&(s.style.backgroundColor=r.backgroundColor,r.borderColor&&(s.style.borderColor=r.borderColor))}var w;if(r.backgroundColor)w=H.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:i},{type:"elem",elem:t,shift:0}]},e);else{var E=/cancel|phase/.test(n)?["svg-align"]:[];w=H.makeVList({positionType:"individualShift",children:[{type:"elem",elem:t,shift:0},{type:"elem",elem:s,shift:i,wrapperClasses:E}]},e)}return/cancel/.test(n)&&(w.height=t.height,w.depth=t.depth),/cancel/.test(n)&&!o?H.makeSpan(["mord","cancel-lap"],[w],e):H.makeSpan(["mord"],[w],e)},vm=(r,e)=>{var t=0,n=new oe.MathNode(r.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Zt(r.body,e)]);switch(r.label){case"\\cancel":n.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":n.setAttribute("notation","downdiagonalstrike");break;case"\\phase":n.setAttribute("notation","phasorangle");break;case"\\sout":n.setAttribute("notation","horizontalstrike");break;case"\\fbox":n.setAttribute("notation","box");break;case"\\angl":n.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(t=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,n.setAttribute("width","+"+2*t+"pt"),n.setAttribute("height","+"+2*t+"pt"),n.setAttribute("lspace",t+"pt"),n.setAttribute("voffset",t+"pt"),r.label==="\\fcolorbox"){var a=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);n.setAttribute("style","border: "+a+"em solid "+String(r.borderColor))}break;case"\\xcancel":n.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return r.backgroundColor&&n.setAttribute("mathbackground",r.backgroundColor),n};Te({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(r,e,t){var{parser:n,funcName:a}=r,s=pt(e[0],"color-token").color,i=e[1];return{type:"enclose",mode:n.mode,label:a,backgroundColor:s,body:i}},htmlBuilder:ym,mathmlBuilder:vm});Te({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(r,e,t){var{parser:n,funcName:a}=r,s=pt(e[0],"color-token").color,i=pt(e[1],"color-token").color,o=e[2];return{type:"enclose",mode:n.mode,label:a,backgroundColor:i,borderColor:s,body:o}},htmlBuilder:ym,mathmlBuilder:vm});Te({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(r,e){var{parser:t}=r;return{type:"enclose",mode:t.mode,label:"\\fbox",body:e[0]}}});Te({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(r,e){var{parser:t,funcName:n}=r,a=e[0];return{type:"enclose",mode:t.mode,label:n,body:a}},htmlBuilder:ym,mathmlBuilder:vm});Te({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(r,e){var{parser:t}=r;return{type:"enclose",mode:t.mode,label:"\\angl",body:e[0]}}});var eb={};function Ma(r){for(var{type:e,names:t,props:n,handler:a,htmlBuilder:s,mathmlBuilder:i}=r,o={type:e,numArgs:n.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:a},u=0;u<t.length;++u)eb[t[u]]=o;s&&(gc[e]=s),i&&(yc[e]=i)}var tb={};function T(r,e){tb[r]=e}function Sy(r){var e=[];r.consumeSpaces();var t=r.fetch().text;for(t==="\\relax"&&(r.consume(),r.consumeSpaces(),t=r.fetch().text);t==="\\hline"||t==="\\hdashline";)r.consume(),e.push(t==="\\hdashline"),r.consumeSpaces(),t=r.fetch().text;return e}var s0=r=>{var e=r.parser.settings;if(!e.displayMode)throw new ue("{"+r.envName+"} can be used only in display mode.")};function _m(r){if(r.indexOf("ed")===-1)return r.indexOf("*")===-1}function Js(r,e,t){var{hskipBeforeAndAfter:n,addJot:a,cols:s,arraystretch:i,colSeparationType:o,autoTag:u,singleRow:l,emptySingleRow:c,maxNumCols:d,leqno:h}=e;if(r.gullet.beginGroup(),l||r.gullet.macros.set("\\cr","\\\\\\relax"),!i){var f=r.gullet.expandMacroAsText("\\arraystretch");if(f==null)i=1;else if(i=parseFloat(f),!i||i<0)throw new ue("Invalid \\arraystretch: "+f)}r.gullet.beginGroup();var p=[],m=[p],v=[],_=[],w=u!=null?[]:void 0;function E(){u&&r.gullet.macros.set("\\@eqnsw","1",!0)}function F(){w&&(r.gullet.macros.get("\\df@tag")?(w.push(r.subparse([new Tn("\\df@tag")])),r.gullet.macros.set("\\df@tag",void 0,!0)):w.push(!!u&&r.gullet.macros.get("\\@eqnsw")==="1"))}for(E(),_.push(Sy(r));;){var k=r.parseExpression(!1,l?"\\end":"\\\\");r.gullet.endGroup(),r.gullet.beginGroup(),k={type:"ordgroup",mode:r.mode,body:k},t&&(k={type:"styling",mode:r.mode,style:t,body:[k]}),p.push(k);var N=r.fetch().text;if(N==="&"){if(d&&p.length===d){if(l||o)throw new ue("Too many tab characters: &",r.nextToken);r.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}r.consume()}else if(N==="\\end"){F(),p.length===1&&k.type==="styling"&&k.body[0].body.length===0&&(m.length>1||!c)&&m.pop(),_.length<m.length+1&&_.push([]);break}else if(N==="\\\\"){r.consume();var B=void 0;r.gullet.future().text!==" "&&(B=r.parseSizeGroup(!0)),v.push(B?B.value:null),F(),_.push(Sy(r)),p=[],m.push(p),E()}else throw new ue("Expected & or \\\\ or \\cr or \\end",r.nextToken)}return r.gullet.endGroup(),r.gullet.endGroup(),{type:"array",mode:r.mode,addJot:a,arraystretch:i,body:m,cols:s,rowGaps:v,hskipBeforeAndAfter:n,hLinesBeforeRow:_,colSeparationType:o,tags:w,leqno:h}}function bm(r){return r.slice(0,1)==="d"?"display":"text"}var $a=function(e,t){var n,a,s=e.body.length,i=e.hLinesBeforeRow,o=0,u=new Array(s),l=[],c=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),d=1/t.fontMetrics().ptPerEm,h=5*d;if(e.colSeparationType&&e.colSeparationType==="small"){var f=t.havingStyle(tt.SCRIPT).sizeMultiplier;h=.2778*(f/t.sizeMultiplier)}var p=e.colSeparationType==="CD"?or({number:3,unit:"ex"},t):12*d,m=3*d,v=e.arraystretch*p,_=.7*v,w=.3*v,E=0;function F(Sr){for(var Vr=0;Vr<Sr.length;++Vr)Vr>0&&(E+=.25),l.push({pos:E,isDashed:Sr[Vr]})}for(F(i[0]),n=0;n<e.body.length;++n){var k=e.body[n],N=_,B=w;o<k.length&&(o=k.length);var A=new Array(k.length);for(a=0;a<k.length;++a){var L=Ft(k[a],t);B<L.depth&&(B=L.depth),N<L.height&&(N=L.height),A[a]=L}var V=e.rowGaps[n],G=0;V&&(G=or(V,t),G>0&&(G+=w,B<G&&(B=G),G=0)),e.addJot&&(B+=m),A.height=N,A.depth=B,E+=N,A.pos=E,E+=B+G,u[n]=A,F(i[n+1])}var te=E/2+t.fontMetrics().axisHeight,ve=e.cols||[],D=[],M,P,Z=[];if(e.tags&&e.tags.some(Sr=>Sr))for(n=0;n<s;++n){var W=u[n],X=W.pos-te,Y=e.tags[n],re=void 0;Y===!0?re=H.makeSpan(["eqn-num"],[],t):Y===!1?re=H.makeSpan([],[],t):re=H.makeSpan([],Fr(Y,t,!0),t),re.depth=W.depth,re.height=W.height,Z.push({type:"elem",elem:re,shift:X})}for(a=0,P=0;a<o||P<ve.length;++a,++P){for(var U=ve[P]||{},j=!0;U.type==="separator";){if(j||(M=H.makeSpan(["arraycolsep"],[]),M.style.width=ye(t.fontMetrics().doubleRuleSep),D.push(M)),U.separator==="|"||U.separator===":"){var ae=U.separator==="|"?"solid":"dashed",Q=H.makeSpan(["vertical-separator"],[],t);Q.style.height=ye(E),Q.style.borderRightWidth=ye(c),Q.style.borderRightStyle=ae,Q.style.margin="0 "+ye(-c/2);var C=E-te;C&&(Q.style.verticalAlign=ye(-C)),D.push(Q)}else throw new ue("Invalid separator type: "+U.separator);P++,U=ve[P]||{},j=!1}if(!(a>=o)){var x=void 0;(a>0||e.hskipBeforeAndAfter)&&(x=Bt.deflt(U.pregap,h),x!==0&&(M=H.makeSpan(["arraycolsep"],[]),M.style.width=ye(x),D.push(M)));var q=[];for(n=0;n<s;++n){var $=u[n],Ee=$[a];if(Ee){var Ve=$.pos-te;Ee.depth=$.depth,Ee.height=$.height,q.push({type:"elem",elem:Ee,shift:Ve})}}q=H.makeVList({positionType:"individualShift",children:q},t),q=H.makeSpan(["col-align-"+(U.align||"c")],[q]),D.push(q),(a<o-1||e.hskipBeforeAndAfter)&&(x=Bt.deflt(U.postgap,h),x!==0&&(M=H.makeSpan(["arraycolsep"],[]),M.style.width=ye(x),D.push(M)))}}if(u=H.makeSpan(["mtable"],D),l.length>0){for(var at=H.makeLineSpan("hline",t,c),ot=H.makeLineSpan("hdashline",t,c),Et=[{type:"elem",elem:u,shift:0}];l.length>0;){var Se=l.pop(),vt=Se.pos-te;Se.isDashed?Et.push({type:"elem",elem:ot,shift:vt}):Et.push({type:"elem",elem:at,shift:vt})}u=H.makeVList({positionType:"individualShift",children:Et},t)}if(Z.length===0)return H.makeSpan(["mord"],[u],t);var Qt=H.makeVList({positionType:"individualShift",children:Z},t);return Qt=H.makeSpan(["tag"],[Qt],t),H.makeFragment([u,Qt])},sS={c:"center ",l:"left ",r:"right "},Pa=function(e,t){for(var n=[],a=new oe.MathNode("mtd",[],["mtr-glue"]),s=new oe.MathNode("mtd",[],["mml-eqn-num"]),i=0;i<e.body.length;i++){for(var o=e.body[i],u=[],l=0;l<o.length;l++)u.push(new oe.MathNode("mtd",[Zt(o[l],t)]));e.tags&&e.tags[i]&&(u.unshift(a),u.push(a),e.leqno?u.unshift(s):u.push(s)),n.push(new oe.MathNode("mtr",u))}var c=new oe.MathNode("mtable",n),d=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);c.setAttribute("rowspacing",ye(d));var h="",f="";if(e.cols&&e.cols.length>0){var p=e.cols,m="",v=!1,_=0,w=p.length;p[0].type==="separator"&&(h+="top ",_=1),p[p.length-1].type==="separator"&&(h+="bottom ",w-=1);for(var E=_;E<w;E++)p[E].type==="align"?(f+=sS[p[E].align],v&&(m+="none "),v=!0):p[E].type==="separator"&&v&&(m+=p[E].separator==="|"?"solid ":"dashed ",v=!1);c.setAttribute("columnalign",f.trim()),/[sd]/.test(m)&&c.setAttribute("columnlines",m.trim())}if(e.colSeparationType==="align"){for(var F=e.cols||[],k="",N=1;N<F.length;N++)k+=N%2?"0em ":"1em ";c.setAttribute("columnspacing",k.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?c.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?c.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?c.setAttribute("columnspacing","0.5em"):c.setAttribute("columnspacing","1em");var B="",A=e.hLinesBeforeRow;h+=A[0].length>0?"left ":"",h+=A[A.length-1].length>0?"right ":"";for(var L=1;L<A.length-1;L++)B+=A[L].length===0?"none ":A[L][0]?"dashed ":"solid ";return/[sd]/.test(B)&&c.setAttribute("rowlines",B.trim()),h!==""&&(c=new oe.MathNode("menclose",[c]),c.setAttribute("notation",h.trim())),e.arraystretch&&e.arraystretch<1&&(c=new oe.MathNode("mstyle",[c]),c.setAttribute("scriptlevel","1")),c},rb=function(e,t){e.envName.indexOf("ed")===-1&&s0(e);var n=[],a=e.envName.indexOf("at")>-1?"alignat":"align",s=e.envName==="split",i=Js(e.parser,{cols:n,addJot:!0,autoTag:s?void 0:_m(e.envName),emptySingleRow:!0,colSeparationType:a,maxNumCols:s?2:void 0,leqno:e.parser.settings.leqno},"display"),o,u=0,l={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&t[0].type==="ordgroup"){for(var c="",d=0;d<t[0].body.length;d++){var h=pt(t[0].body[d],"textord");c+=h.text}o=Number(c),u=o*2}var f=!u;i.body.forEach(function(_){for(var w=1;w<_.length;w+=2){var E=pt(_[w],"styling"),F=pt(E.body[0],"ordgroup");F.body.unshift(l)}if(f)u<_.length&&(u=_.length);else{var k=_.length/2;if(o<k)throw new ue("Too many math in a row: "+("expected "+o+", but got "+k),_[0])}});for(var p=0;p<u;++p){var m="r",v=0;p%2===1?m="l":p>0&&f&&(v=1),n[p]={type:"align",align:m,pregap:v,postgap:0}}return i.colSeparationType=f?"align":"alignat",i};Ma({type:"array",names:["array","darray"],props:{numArgs:1},handler(r,e){var t=r0(e[0]),n=t?[e[0]]:pt(e[0],"ordgroup").body,a=n.map(function(i){var o=pm(i),u=o.text;if("lcr".indexOf(u)!==-1)return{type:"align",align:u};if(u==="|")return{type:"separator",separator:"|"};if(u===":")return{type:"separator",separator:":"};throw new ue("Unknown column alignment: "+u,i)}),s={cols:a,hskipBeforeAndAfter:!0,maxNumCols:a.length};return Js(r.parser,s,bm(r.envName))},htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(r){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[r.envName.replace("*","")],t="c",n={hskipBeforeAndAfter:!1,cols:[{type:"align",align:t}]};if(r.envName.charAt(r.envName.length-1)==="*"){var a=r.parser;if(a.consumeSpaces(),a.fetch().text==="["){if(a.consume(),a.consumeSpaces(),t=a.fetch().text,"lcr".indexOf(t)===-1)throw new ue("Expected l or c or r",a.nextToken);a.consume(),a.consumeSpaces(),a.expect("]"),a.consume(),n.cols=[{type:"align",align:t}]}}var s=Js(r.parser,n,bm(r.envName)),i=Math.max(0,...s.body.map(o=>o.length));return s.cols=new Array(i).fill({type:"align",align:t}),e?{type:"leftright",mode:r.mode,body:[s],left:e[0],right:e[1],rightColor:void 0}:s},htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(r){var e={arraystretch:.5},t=Js(r.parser,e,"script");return t.colSeparationType="small",t},htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["subarray"],props:{numArgs:1},handler(r,e){var t=r0(e[0]),n=t?[e[0]]:pt(e[0],"ordgroup").body,a=n.map(function(i){var o=pm(i),u=o.text;if("lc".indexOf(u)!==-1)return{type:"align",align:u};throw new ue("Unknown column alignment: "+u,i)});if(a.length>1)throw new ue("{subarray} can contain only one column");var s={cols:a,hskipBeforeAndAfter:!1,arraystretch:.5};if(s=Js(r.parser,s,"script"),s.body.length>0&&s.body[0].length>1)throw new ue("{subarray} can contain only one column");return s},htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(r){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},t=Js(r.parser,e,bm(r.envName));return{type:"leftright",mode:r.mode,body:[t],left:r.envName.indexOf("r")>-1?".":"\\{",right:r.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:rb,htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(r){["gather","gather*"].includes(r.envName)&&s0(r);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:_m(r.envName),emptySingleRow:!0,leqno:r.parser.settings.leqno};return Js(r.parser,e,"display")},htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:rb,htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(r){s0(r);var e={autoTag:_m(r.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:r.parser.settings.leqno};return Js(r.parser,e,"display")},htmlBuilder:$a,mathmlBuilder:Pa});Ma({type:"array",names:["CD"],props:{numArgs:0},handler(r){return s0(r),Vx(r.parser)},htmlBuilder:$a,mathmlBuilder:Pa});T("\\nonumber","\\gdef\\@eqnsw{0}");T("\\notag","\\nonumber");Te({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(r,e){throw new ue(r.funcName+" valid only within array environment")}});var Ay=eb;Te({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(r,e){var{parser:t,funcName:n}=r,a=e[0];if(a.type!=="ordgroup")throw new ue("Invalid environment name",a);for(var s="",i=0;i<a.body.length;++i)s+=pt(a.body[i],"textord").text;if(n==="\\begin"){if(!Ay.hasOwnProperty(s))throw new ue("No such environment: "+s,a);var o=Ay[s],{args:u,optArgs:l}=t.parseArguments("\\begin{"+s+"}",o),c={mode:t.mode,envName:s,parser:t},d=o.handler(c,u,l);t.expect("\\end",!1);var h=t.nextToken,f=pt(t.parseFunction(),"environment");if(f.name!==s)throw new ue("Mismatch: \\begin{"+s+"} matched by \\end{"+f.name+"}",h);return d}return{type:"environment",mode:t.mode,name:s,nameGroup:a}}});var nb=(r,e)=>{var t=r.font,n=e.withFont(t);return Ft(r.body,n)},ab=(r,e)=>{var t=r.font,n=e.withFont(t);return Zt(r.body,n)},ky={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};Te({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(r,e)=>{var{parser:t,funcName:n}=r,a=vc(e[0]),s=n;return s in ky&&(s=ky[s]),{type:"font",mode:t.mode,font:s.slice(1),body:a}},htmlBuilder:nb,mathmlBuilder:ab});Te({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(r,e)=>{var{parser:t}=r,n=e[0],a=Bt.isCharacterBox(n);return{type:"mclass",mode:t.mode,mclass:n0(n),body:[{type:"font",mode:t.mode,font:"boldsymbol",body:n}],isCharacterBox:a}}});Te({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(r,e)=>{var{parser:t,funcName:n,breakOnTokenText:a}=r,{mode:s}=t,i=t.parseExpression(!0,a),o="math"+n.slice(1);return{type:"font",mode:s,font:o,body:{type:"ordgroup",mode:t.mode,body:i}}},htmlBuilder:nb,mathmlBuilder:ab});var sb=(r,e)=>{var t=e;return r==="display"?t=t.id>=tt.SCRIPT.id?t.text():tt.DISPLAY:r==="text"&&t.size===tt.DISPLAY.size?t=tt.TEXT:r==="script"?t=tt.SCRIPT:r==="scriptscript"&&(t=tt.SCRIPTSCRIPT),t},wm=(r,e)=>{var t=sb(r.size,e.style),n=t.fracNum(),a=t.fracDen(),s;s=e.havingStyle(n);var i=Ft(r.numer,s,e);if(r.continued){var o=8.5/e.fontMetrics().ptPerEm,u=3.5/e.fontMetrics().ptPerEm;i.height=i.height<o?o:i.height,i.depth=i.depth<u?u:i.depth}s=e.havingStyle(a);var l=Ft(r.denom,s,e),c,d,h;r.hasBarLine?(r.barSize?(d=or(r.barSize,e),c=H.makeLineSpan("frac-line",e,d)):c=H.makeLineSpan("frac-line",e),d=c.height,h=c.height):(c=null,d=0,h=e.fontMetrics().defaultRuleThickness);var f,p,m;t.size===tt.DISPLAY.size||r.size==="display"?(f=e.fontMetrics().num1,d>0?p=3*h:p=7*h,m=e.fontMetrics().denom1):(d>0?(f=e.fontMetrics().num2,p=h):(f=e.fontMetrics().num3,p=3*h),m=e.fontMetrics().denom2);var v;if(c){var w=e.fontMetrics().axisHeight;f-i.depth-(w+.5*d)<p&&(f+=p-(f-i.depth-(w+.5*d))),w-.5*d-(l.height-m)<p&&(m+=p-(w-.5*d-(l.height-m)));var E=-(w-.5*d);v=H.makeVList({positionType:"individualShift",children:[{type:"elem",elem:l,shift:m},{type:"elem",elem:c,shift:E},{type:"elem",elem:i,shift:-f}]},e)}else{var _=f-i.depth-(l.height-m);_<p&&(f+=.5*(p-_),m+=.5*(p-_)),v=H.makeVList({positionType:"individualShift",children:[{type:"elem",elem:l,shift:m},{type:"elem",elem:i,shift:-f}]},e)}s=e.havingStyle(t),v.height*=s.sizeMultiplier/e.sizeMultiplier,v.depth*=s.sizeMultiplier/e.sizeMultiplier;var F;t.size===tt.DISPLAY.size?F=e.fontMetrics().delim1:t.size===tt.SCRIPTSCRIPT.size?F=e.havingStyle(tt.SCRIPT).fontMetrics().delim2:F=e.fontMetrics().delim2;var k,N;return r.leftDelim==null?k=cu(e,["mopen"]):k=Ja.customSizedDelim(r.leftDelim,F,!0,e.havingStyle(t),r.mode,["mopen"]),r.continued?N=H.makeSpan([]):r.rightDelim==null?N=cu(e,["mclose"]):N=Ja.customSizedDelim(r.rightDelim,F,!0,e.havingStyle(t),r.mode,["mclose"]),H.makeSpan(["mord"].concat(s.sizingClasses(e)),[k,H.makeSpan(["mfrac"],[v]),N],e)},Em=(r,e)=>{var t=new oe.MathNode("mfrac",[Zt(r.numer,e),Zt(r.denom,e)]);if(!r.hasBarLine)t.setAttribute("linethickness","0px");else if(r.barSize){var n=or(r.barSize,e);t.setAttribute("linethickness",ye(n))}var a=sb(r.size,e.style);if(a.size!==e.style.size){t=new oe.MathNode("mstyle",[t]);var s=a.size===tt.DISPLAY.size?"true":"false";t.setAttribute("displaystyle",s),t.setAttribute("scriptlevel","0")}if(r.leftDelim!=null||r.rightDelim!=null){var i=[];if(r.leftDelim!=null){var o=new oe.MathNode("mo",[new oe.TextNode(r.leftDelim.replace("\\",""))]);o.setAttribute("fence","true"),i.push(o)}if(i.push(t),r.rightDelim!=null){var u=new oe.MathNode("mo",[new oe.TextNode(r.rightDelim.replace("\\",""))]);u.setAttribute("fence","true"),i.push(u)}return hm(i)}return t};Te({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(r,e)=>{var{parser:t,funcName:n}=r,a=e[0],s=e[1],i,o=null,u=null,l="auto";switch(n){case"\\dfrac":case"\\frac":case"\\tfrac":i=!0;break;case"\\\\atopfrac":i=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":i=!1,o="(",u=")";break;case"\\\\bracefrac":i=!1,o="\\{",u="\\}";break;case"\\\\brackfrac":i=!1,o="[",u="]";break;default:throw new Error("Unrecognized genfrac command")}switch(n){case"\\dfrac":case"\\dbinom":l="display";break;case"\\tfrac":case"\\tbinom":l="text";break}return{type:"genfrac",mode:t.mode,continued:!1,numer:a,denom:s,hasBarLine:i,leftDelim:o,rightDelim:u,size:l,barSize:null}},htmlBuilder:wm,mathmlBuilder:Em});Te({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(r,e)=>{var{parser:t,funcName:n}=r,a=e[0],s=e[1];return{type:"genfrac",mode:t.mode,continued:!0,numer:a,denom:s,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});Te({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(r){var{parser:e,funcName:t,token:n}=r,a;switch(t){case"\\over":a="\\frac";break;case"\\choose":a="\\binom";break;case"\\atop":a="\\\\atopfrac";break;case"\\brace":a="\\\\bracefrac";break;case"\\brack":a="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:a,token:n}}});var Cy=["display","text","script","scriptscript"],Ty=function(e){var t=null;return e.length>0&&(t=e,t=t==="."?null:t),t};Te({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(r,e){var{parser:t}=r,n=e[4],a=e[5],s=vc(e[0]),i=s.type==="atom"&&s.family==="open"?Ty(s.text):null,o=vc(e[1]),u=o.type==="atom"&&o.family==="close"?Ty(o.text):null,l=pt(e[2],"size"),c,d=null;l.isBlank?c=!0:(d=l.value,c=d.number>0);var h="auto",f=e[3];if(f.type==="ordgroup"){if(f.body.length>0){var p=pt(f.body[0],"textord");h=Cy[Number(p.text)]}}else f=pt(f,"textord"),h=Cy[Number(f.text)];return{type:"genfrac",mode:t.mode,numer:n,denom:a,continued:!1,hasBarLine:c,barSize:d,leftDelim:i,rightDelim:u,size:h}},htmlBuilder:wm,mathmlBuilder:Em});Te({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(r,e){var{parser:t,funcName:n,token:a}=r;return{type:"infix",mode:t.mode,replaceWith:"\\\\abovefrac",size:pt(e[0],"size").value,token:a}}});Te({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(r,e)=>{var{parser:t,funcName:n}=r,a=e[0],s=B9(pt(e[1],"infix").size),i=e[2],o=s.number>0;return{type:"genfrac",mode:t.mode,numer:a,denom:i,continued:!1,hasBarLine:o,barSize:s,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:wm,mathmlBuilder:Em});var ib=(r,e)=>{var t=e.style,n,a;r.type==="supsub"?(n=r.sup?Ft(r.sup,e.havingStyle(t.sup()),e):Ft(r.sub,e.havingStyle(t.sub()),e),a=pt(r.base,"horizBrace")):a=pt(r,"horizBrace");var s=Ft(a.base,e.havingBaseStyle(tt.DISPLAY)),i=as.svgSpan(a,e),o;if(a.isOver?(o=H.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"kern",size:.1},{type:"elem",elem:i}]},e),o.children[0].children[0].children[1].classes.push("svg-align")):(o=H.makeVList({positionType:"bottom",positionData:s.depth+.1+i.height,children:[{type:"elem",elem:i},{type:"kern",size:.1},{type:"elem",elem:s}]},e),o.children[0].children[0].children[0].classes.push("svg-align")),n){var u=H.makeSpan(["mord",a.isOver?"mover":"munder"],[o],e);a.isOver?o=H.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:u},{type:"kern",size:.2},{type:"elem",elem:n}]},e):o=H.makeVList({positionType:"bottom",positionData:u.depth+.2+n.height+n.depth,children:[{type:"elem",elem:n},{type:"kern",size:.2},{type:"elem",elem:u}]},e)}return H.makeSpan(["mord",a.isOver?"mover":"munder"],[o],e)},iS=(r,e)=>{var t=as.mathMLnode(r.label);return new oe.MathNode(r.isOver?"mover":"munder",[Zt(r.base,e),t])};Te({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(r,e){var{parser:t,funcName:n}=r;return{type:"horizBrace",mode:t.mode,label:n,isOver:/^\\over/.test(n),base:e[0]}},htmlBuilder:ib,mathmlBuilder:iS});Te({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(r,e)=>{var{parser:t}=r,n=e[1],a=pt(e[0],"url").url;return t.settings.isTrusted({command:"\\href",url:a})?{type:"href",mode:t.mode,href:a,body:mr(n)}:t.formatUnsupportedCmd("\\href")},htmlBuilder:(r,e)=>{var t=Fr(r.body,e,!1);return H.makeAnchor(r.href,[],t,e)},mathmlBuilder:(r,e)=>{var t=zs(r.body,e);return t instanceof Cn||(t=new Cn("mrow",[t])),t.setAttribute("href",r.href),t}});Te({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(r,e)=>{var{parser:t}=r,n=pt(e[0],"url").url;if(!t.settings.isTrusted({command:"\\url",url:n}))return t.formatUnsupportedCmd("\\url");for(var a=[],s=0;s<n.length;s++){var i=n[s];i==="~"&&(i="\\textasciitilde"),a.push({type:"textord",mode:"text",text:i})}var o={type:"text",mode:t.mode,font:"\\texttt",body:a};return{type:"href",mode:t.mode,href:n,body:mr(o)}}});Te({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(r,e){var{parser:t}=r;return{type:"hbox",mode:t.mode,body:mr(e[0])}},htmlBuilder(r,e){var t=Fr(r.body,e,!1);return H.makeFragment(t)},mathmlBuilder(r,e){return new oe.MathNode("mrow",wn(r.body,e))}});Te({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(r,e)=>{var{parser:t,funcName:n,token:a}=r,s=pt(e[0],"raw").string,i=e[1];t.settings.strict&&t.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var o,u={};switch(n){case"\\htmlClass":u.class=s,o={command:"\\htmlClass",class:s};break;case"\\htmlId":u.id=s,o={command:"\\htmlId",id:s};break;case"\\htmlStyle":u.style=s,o={command:"\\htmlStyle",style:s};break;case"\\htmlData":{for(var l=s.split(","),c=0;c<l.length;c++){var d=l[c].split("=");if(d.length!==2)throw new ue("Error parsing key-value for \\htmlData");u["data-"+d[0].trim()]=d[1].trim()}o={command:"\\htmlData",attributes:u};break}default:throw new Error("Unrecognized html command")}return t.settings.isTrusted(o)?{type:"html",mode:t.mode,attributes:u,body:mr(i)}:t.formatUnsupportedCmd(n)},htmlBuilder:(r,e)=>{var t=Fr(r.body,e,!1),n=["enclosing"];r.attributes.class&&n.push(...r.attributes.class.trim().split(/\s+/));var a=H.makeSpan(n,t,e);for(var s in r.attributes)s!=="class"&&r.attributes.hasOwnProperty(s)&&a.setAttribute(s,r.attributes[s]);return a},mathmlBuilder:(r,e)=>zs(r.body,e)});Te({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(r,e)=>{var{parser:t}=r;return{type:"htmlmathml",mode:t.mode,html:mr(e[0]),mathml:mr(e[1])}},htmlBuilder:(r,e)=>{var t=Fr(r.html,e,!1);return H.makeFragment(t)},mathmlBuilder:(r,e)=>zs(r.mathml,e)});var jd=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new ue("Invalid size: '"+e+"' in \\includegraphics");var n={number:+(t[1]+t[2]),unit:t[3]};if(!A4(n))throw new ue("Invalid unit: '"+n.unit+"' in \\includegraphics.");return n};Te({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(r,e,t)=>{var{parser:n}=r,a={number:0,unit:"em"},s={number:.9,unit:"em"},i={number:0,unit:"em"},o="";if(t[0])for(var u=pt(t[0],"raw").string,l=u.split(","),c=0;c<l.length;c++){var d=l[c].split("=");if(d.length===2){var h=d[1].trim();switch(d[0].trim()){case"alt":o=h;break;case"width":a=jd(h);break;case"height":s=jd(h);break;case"totalheight":i=jd(h);break;default:throw new ue("Invalid key: '"+d[0]+"' in \\includegraphics.")}}}var f=pt(e[0],"url").url;return o===""&&(o=f,o=o.replace(/^.*[\\/]/,""),o=o.substring(0,o.lastIndexOf("."))),n.settings.isTrusted({command:"\\includegraphics",url:f})?{type:"includegraphics",mode:n.mode,alt:o,width:a,height:s,totalheight:i,src:f}:n.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(r,e)=>{var t=or(r.height,e),n=0;r.totalheight.number>0&&(n=or(r.totalheight,e)-t);var a=0;r.width.number>0&&(a=or(r.width,e));var s={height:ye(t+n)};a>0&&(s.width=ye(a)),n>0&&(s.verticalAlign=ye(-n));var i=new ix(r.src,r.alt,s);return i.height=t,i.depth=n,i},mathmlBuilder:(r,e)=>{var t=new oe.MathNode("mglyph",[]);t.setAttribute("alt",r.alt);var n=or(r.height,e),a=0;if(r.totalheight.number>0&&(a=or(r.totalheight,e)-n,t.setAttribute("valign",ye(-a))),t.setAttribute("height",ye(n+a)),r.width.number>0){var s=or(r.width,e);t.setAttribute("width",ye(s))}return t.setAttribute("src",r.src),t}});Te({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(r,e){var{parser:t,funcName:n}=r,a=pt(e[0],"size");if(t.settings.strict){var s=n[1]==="m",i=a.value.unit==="mu";s?(i||t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+n+" supports only mu units, "+("not "+a.value.unit+" units")),t.mode!=="math"&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+n+" works only in math mode")):i&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+n+" doesn't support mu units")}return{type:"kern",mode:t.mode,dimension:a.value}},htmlBuilder(r,e){return H.makeGlue(r.dimension,e)},mathmlBuilder(r,e){var t=or(r.dimension,e);return new oe.SpaceNode(t)}});Te({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(r,e)=>{var{parser:t,funcName:n}=r,a=e[0];return{type:"lap",mode:t.mode,alignment:n.slice(5),body:a}},htmlBuilder:(r,e)=>{var t;r.alignment==="clap"?(t=H.makeSpan([],[Ft(r.body,e)]),t=H.makeSpan(["inner"],[t],e)):t=H.makeSpan(["inner"],[Ft(r.body,e)]);var n=H.makeSpan(["fix"],[]),a=H.makeSpan([r.alignment],[t,n],e),s=H.makeSpan(["strut"]);return s.style.height=ye(a.height+a.depth),a.depth&&(s.style.verticalAlign=ye(-a.depth)),a.children.unshift(s),a=H.makeSpan(["thinbox"],[a],e),H.makeSpan(["mord","vbox"],[a],e)},mathmlBuilder:(r,e)=>{var t=new oe.MathNode("mpadded",[Zt(r.body,e)]);if(r.alignment!=="rlap"){var n=r.alignment==="llap"?"-1":"-0.5";t.setAttribute("lspace",n+"width")}return t.setAttribute("width","0px"),t}});Te({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(r,e){var{funcName:t,parser:n}=r,a=n.mode;n.switchMode("math");var s=t==="\\("?"\\)":"$",i=n.parseExpression(!1,s);return n.expect(s),n.switchMode(a),{type:"styling",mode:n.mode,style:"text",body:i}}});Te({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(r,e){throw new ue("Mismatched "+r.funcName)}});var Fy=(r,e)=>{switch(e.style.size){case tt.DISPLAY.size:return r.display;case tt.TEXT.size:return r.text;case tt.SCRIPT.size:return r.script;case tt.SCRIPTSCRIPT.size:return r.scriptscript;default:return r.text}};Te({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(r,e)=>{var{parser:t}=r;return{type:"mathchoice",mode:t.mode,display:mr(e[0]),text:mr(e[1]),script:mr(e[2]),scriptscript:mr(e[3])}},htmlBuilder:(r,e)=>{var t=Fy(r,e),n=Fr(t,e,!1);return H.makeFragment(n)},mathmlBuilder:(r,e)=>{var t=Fy(r,e);return zs(t,e)}});var ob=(r,e,t,n,a,s,i)=>{r=H.makeSpan([],[r]);var o=t&&Bt.isCharacterBox(t),u,l;if(e){var c=Ft(e,n.havingStyle(a.sup()),n);l={elem:c,kern:Math.max(n.fontMetrics().bigOpSpacing1,n.fontMetrics().bigOpSpacing3-c.depth)}}if(t){var d=Ft(t,n.havingStyle(a.sub()),n);u={elem:d,kern:Math.max(n.fontMetrics().bigOpSpacing2,n.fontMetrics().bigOpSpacing4-d.height)}}var h;if(l&&u){var f=n.fontMetrics().bigOpSpacing5+u.elem.height+u.elem.depth+u.kern+r.depth+i;h=H.makeVList({positionType:"bottom",positionData:f,children:[{type:"kern",size:n.fontMetrics().bigOpSpacing5},{type:"elem",elem:u.elem,marginLeft:ye(-s)},{type:"kern",size:u.kern},{type:"elem",elem:r},{type:"kern",size:l.kern},{type:"elem",elem:l.elem,marginLeft:ye(s)},{type:"kern",size:n.fontMetrics().bigOpSpacing5}]},n)}else if(u){var p=r.height-i;h=H.makeVList({positionType:"top",positionData:p,children:[{type:"kern",size:n.fontMetrics().bigOpSpacing5},{type:"elem",elem:u.elem,marginLeft:ye(-s)},{type:"kern",size:u.kern},{type:"elem",elem:r}]},n)}else if(l){var m=r.depth+i;h=H.makeVList({positionType:"bottom",positionData:m,children:[{type:"elem",elem:r},{type:"kern",size:l.kern},{type:"elem",elem:l.elem,marginLeft:ye(s)},{type:"kern",size:n.fontMetrics().bigOpSpacing5}]},n)}else return r;var v=[h];if(u&&s!==0&&!o){var _=H.makeSpan(["mspace"],[],n);_.style.marginRight=ye(s),v.unshift(_)}return H.makeSpan(["mop","op-limits"],v,n)},ub=["\\smallint"],wo=(r,e)=>{var t,n,a=!1,s;r.type==="supsub"?(t=r.sup,n=r.sub,s=pt(r.base,"op"),a=!0):s=pt(r,"op");var i=e.style,o=!1;i.size===tt.DISPLAY.size&&s.symbol&&!ub.includes(s.name)&&(o=!0);var u;if(s.symbol){var l=o?"Size2-Regular":"Size1-Regular",c="";if((s.name==="\\oiint"||s.name==="\\oiiint")&&(c=s.name.slice(1),s.name=c==="oiint"?"\\iint":"\\iiint"),u=H.makeSymbol(s.name,l,"math",e,["mop","op-symbol",o?"large-op":"small-op"]),c.length>0){var d=u.italic,h=H.staticSvg(c+"Size"+(o?"2":"1"),e);u=H.makeVList({positionType:"individualShift",children:[{type:"elem",elem:u,shift:0},{type:"elem",elem:h,shift:o?.08:0}]},e),s.name="\\"+c,u.classes.unshift("mop"),u.italic=d}}else if(s.body){var f=Fr(s.body,e,!0);f.length===1&&f[0]instanceof qn?(u=f[0],u.classes[0]="mop"):u=H.makeSpan(["mop"],f,e)}else{for(var p=[],m=1;m<s.name.length;m++)p.push(H.mathsym(s.name[m],s.mode,e));u=H.makeSpan(["mop"],p,e)}var v=0,_=0;return(u instanceof qn||s.name==="\\oiint"||s.name==="\\oiiint")&&!s.suppressBaseShift&&(v=(u.height-u.depth)/2-e.fontMetrics().axisHeight,_=u.italic),a?ob(u,t,n,e,i,_,v):(v&&(u.style.position="relative",u.style.top=ye(v)),u)},zu=(r,e)=>{var t;if(r.symbol)t=new Cn("mo",[Hn(r.name,r.mode)]),ub.includes(r.name)&&t.setAttribute("largeop","false");else if(r.body)t=new Cn("mo",wn(r.body,e));else{t=new Cn("mi",[new Ca(r.name.slice(1))]);var n=new Cn("mo",[Hn("\u2061","text")]);r.parentIsSupSub?t=new Cn("mrow",[t,n]):t=M4([t,n])}return t},oS={"\u220F":"\\prod","\u2210":"\\coprod","\u2211":"\\sum","\u22C0":"\\bigwedge","\u22C1":"\\bigvee","\u22C2":"\\bigcap","\u22C3":"\\bigcup","\u2A00":"\\bigodot","\u2A01":"\\bigoplus","\u2A02":"\\bigotimes","\u2A04":"\\biguplus","\u2A06":"\\bigsqcup"};Te({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","\u220F","\u2210","\u2211","\u22C0","\u22C1","\u22C2","\u22C3","\u2A00","\u2A01","\u2A02","\u2A04","\u2A06"],props:{numArgs:0},handler:(r,e)=>{var{parser:t,funcName:n}=r,a=n;return a.length===1&&(a=oS[a]),{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:a}},htmlBuilder:wo,mathmlBuilder:zu});Te({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(r,e)=>{var{parser:t}=r,n=e[0];return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:mr(n)}},htmlBuilder:wo,mathmlBuilder:zu});var uS={"\u222B":"\\int","\u222C":"\\iint","\u222D":"\\iiint","\u222E":"\\oint","\u222F":"\\oiint","\u2230":"\\oiiint"};Te({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(r){var{parser:e,funcName:t}=r;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:wo,mathmlBuilder:zu});Te({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(r){var{parser:e,funcName:t}=r;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:wo,mathmlBuilder:zu});Te({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","\u222B","\u222C","\u222D","\u222E","\u222F","\u2230"],props:{numArgs:0},handler(r){var{parser:e,funcName:t}=r,n=t;return n.length===1&&(n=uS[n]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:n}},htmlBuilder:wo,mathmlBuilder:zu});var lb=(r,e)=>{var t,n,a=!1,s;r.type==="supsub"?(t=r.sup,n=r.sub,s=pt(r.base,"operatorname"),a=!0):s=pt(r,"operatorname");var i;if(s.body.length>0){for(var o=s.body.map(d=>{var h=d.text;return typeof h=="string"?{type:"textord",mode:d.mode,text:h}:d}),u=Fr(o,e.withFont("mathrm"),!0),l=0;l<u.length;l++){var c=u[l];c instanceof qn&&(c.text=c.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}i=H.makeSpan(["mop"],u,e)}else i=H.makeSpan(["mop"],[],e);return a?ob(i,t,n,e,e.style,0,0):i},lS=(r,e)=>{for(var t=wn(r.body,e.withFont("mathrm")),n=!0,a=0;a<t.length;a++){var s=t[a];if(!(s instanceof oe.SpaceNode))if(s instanceof oe.MathNode)switch(s.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var i=s.children[0];s.children.length===1&&i instanceof oe.TextNode?i.text=i.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):n=!1;break}default:n=!1}else n=!1}if(n){var o=t.map(c=>c.toText()).join("");t=[new oe.TextNode(o)]}var u=new oe.MathNode("mi",t);u.setAttribute("mathvariant","normal");var l=new oe.MathNode("mo",[Hn("\u2061","text")]);return r.parentIsSupSub?new oe.MathNode("mrow",[u,l]):oe.newDocumentFragment([u,l])};Te({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(r,e)=>{var{parser:t,funcName:n}=r,a=e[0];return{type:"operatorname",mode:t.mode,body:mr(a),alwaysHandleSupSub:n==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:lb,mathmlBuilder:lS});T("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");Ci({type:"ordgroup",htmlBuilder(r,e){return r.semisimple?H.makeFragment(Fr(r.body,e,!1)):H.makeSpan(["mord"],Fr(r.body,e,!0),e)},mathmlBuilder(r,e){return zs(r.body,e,!0)}});Te({type:"overline",names:["\\overline"],props:{numArgs:1},handler(r,e){var{parser:t}=r,n=e[0];return{type:"overline",mode:t.mode,body:n}},htmlBuilder(r,e){var t=Ft(r.body,e.havingCrampedStyle()),n=H.makeLineSpan("overline-line",e),a=e.fontMetrics().defaultRuleThickness,s=H.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t},{type:"kern",size:3*a},{type:"elem",elem:n},{type:"kern",size:a}]},e);return H.makeSpan(["mord","overline"],[s],e)},mathmlBuilder(r,e){var t=new oe.MathNode("mo",[new oe.TextNode("\u203E")]);t.setAttribute("stretchy","true");var n=new oe.MathNode("mover",[Zt(r.body,e),t]);return n.setAttribute("accent","true"),n}});Te({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(r,e)=>{var{parser:t}=r,n=e[0];return{type:"phantom",mode:t.mode,body:mr(n)}},htmlBuilder:(r,e)=>{var t=Fr(r.body,e.withPhantom(),!1);return H.makeFragment(t)},mathmlBuilder:(r,e)=>{var t=wn(r.body,e);return new oe.MathNode("mphantom",t)}});Te({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(r,e)=>{var{parser:t}=r,n=e[0];return{type:"hphantom",mode:t.mode,body:n}},htmlBuilder:(r,e)=>{var t=H.makeSpan([],[Ft(r.body,e.withPhantom())]);if(t.height=0,t.depth=0,t.children)for(var n=0;n<t.children.length;n++)t.children[n].height=0,t.children[n].depth=0;return t=H.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e),H.makeSpan(["mord"],[t],e)},mathmlBuilder:(r,e)=>{var t=wn(mr(r.body),e),n=new oe.MathNode("mphantom",t),a=new oe.MathNode("mpadded",[n]);return a.setAttribute("height","0px"),a.setAttribute("depth","0px"),a}});Te({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(r,e)=>{var{parser:t}=r,n=e[0];return{type:"vphantom",mode:t.mode,body:n}},htmlBuilder:(r,e)=>{var t=H.makeSpan(["inner"],[Ft(r.body,e.withPhantom())]),n=H.makeSpan(["fix"],[]);return H.makeSpan(["mord","rlap"],[t,n],e)},mathmlBuilder:(r,e)=>{var t=wn(mr(r.body),e),n=new oe.MathNode("mphantom",t),a=new oe.MathNode("mpadded",[n]);return a.setAttribute("width","0px"),a}});Te({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(r,e){var{parser:t}=r,n=pt(e[0],"size").value,a=e[1];return{type:"raisebox",mode:t.mode,dy:n,body:a}},htmlBuilder(r,e){var t=Ft(r.body,e),n=or(r.dy,e);return H.makeVList({positionType:"shift",positionData:-n,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(r,e){var t=new oe.MathNode("mpadded",[Zt(r.body,e)]),n=r.dy.number+r.dy.unit;return t.setAttribute("voffset",n),t}});Te({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(r){var{parser:e}=r;return{type:"internal",mode:e.mode}}});Te({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(r,e,t){var{parser:n}=r,a=t[0],s=pt(e[0],"size"),i=pt(e[1],"size");return{type:"rule",mode:n.mode,shift:a&&pt(a,"size").value,width:s.value,height:i.value}},htmlBuilder(r,e){var t=H.makeSpan(["mord","rule"],[],e),n=or(r.width,e),a=or(r.height,e),s=r.shift?or(r.shift,e):0;return t.style.borderRightWidth=ye(n),t.style.borderTopWidth=ye(a),t.style.bottom=ye(s),t.width=n,t.height=a+s,t.depth=-s,t.maxFontSize=a*1.125*e.sizeMultiplier,t},mathmlBuilder(r,e){var t=or(r.width,e),n=or(r.height,e),a=r.shift?or(r.shift,e):0,s=e.color&&e.getColor()||"black",i=new oe.MathNode("mspace");i.setAttribute("mathbackground",s),i.setAttribute("width",ye(t)),i.setAttribute("height",ye(n));var o=new oe.MathNode("mpadded",[i]);return a>=0?o.setAttribute("height",ye(a)):(o.setAttribute("height",ye(a)),o.setAttribute("depth",ye(-a))),o.setAttribute("voffset",ye(a)),o}});function cb(r,e,t){for(var n=Fr(r,e,!1),a=e.sizeMultiplier/t.sizeMultiplier,s=0;s<n.length;s++){var i=n[s].classes.indexOf("sizing");i<0?Array.prototype.push.apply(n[s].classes,e.sizingClasses(t)):n[s].classes[i+1]==="reset-size"+e.size&&(n[s].classes[i+1]="reset-size"+t.size),n[s].height*=a,n[s].depth*=a}return H.makeFragment(n)}var Ny=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],cS=(r,e)=>{var t=e.havingSize(r.size);return cb(r.body,t,e)};Te({type:"sizing",names:Ny,props:{numArgs:0,allowedInText:!0},handler:(r,e)=>{var{breakOnTokenText:t,funcName:n,parser:a}=r,s=a.parseExpression(!1,t);return{type:"sizing",mode:a.mode,size:Ny.indexOf(n)+1,body:s}},htmlBuilder:cS,mathmlBuilder:(r,e)=>{var t=e.havingSize(r.size),n=wn(r.body,t),a=new oe.MathNode("mstyle",n);return a.setAttribute("mathsize",ye(t.sizeMultiplier)),a}});Te({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(r,e,t)=>{var{parser:n}=r,a=!1,s=!1,i=t[0]&&pt(t[0],"ordgroup");if(i)for(var o="",u=0;u<i.body.length;++u){var l=i.body[u];if(o=l.text,o==="t")a=!0;else if(o==="b")s=!0;else{a=!1,s=!1;break}}else a=!0,s=!0;var c=e[0];return{type:"smash",mode:n.mode,body:c,smashHeight:a,smashDepth:s}},htmlBuilder:(r,e)=>{var t=H.makeSpan([],[Ft(r.body,e)]);if(!r.smashHeight&&!r.smashDepth)return t;if(r.smashHeight&&(t.height=0,t.children))for(var n=0;n<t.children.length;n++)t.children[n].height=0;if(r.smashDepth&&(t.depth=0,t.children))for(var a=0;a<t.children.length;a++)t.children[a].depth=0;var s=H.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e);return H.makeSpan(["mord"],[s],e)},mathmlBuilder:(r,e)=>{var t=new oe.MathNode("mpadded",[Zt(r.body,e)]);return r.smashHeight&&t.setAttribute("height","0px"),r.smashDepth&&t.setAttribute("depth","0px"),t}});Te({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(r,e,t){var{parser:n}=r,a=t[0],s=e[0];return{type:"sqrt",mode:n.mode,body:s,index:a}},htmlBuilder(r,e){var t=Ft(r.body,e.havingCrampedStyle());t.height===0&&(t.height=e.fontMetrics().xHeight),t=H.wrapFragment(t,e);var n=e.fontMetrics(),a=n.defaultRuleThickness,s=a;e.style.id<tt.TEXT.id&&(s=e.fontMetrics().xHeight);var i=a+s/4,o=t.height+t.depth+i+a,{span:u,ruleWidth:l,advanceWidth:c}=Ja.sqrtImage(o,e),d=u.height-l;d>t.height+t.depth+i&&(i=(i+d-t.height-t.depth)/2);var h=u.height-t.height-i-l;t.style.paddingLeft=ye(c);var f=H.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t,wrapperClasses:["svg-align"]},{type:"kern",size:-(t.height+h)},{type:"elem",elem:u},{type:"kern",size:l}]},e);if(r.index){var p=e.havingStyle(tt.SCRIPTSCRIPT),m=Ft(r.index,p,e),v=.6*(f.height-f.depth),_=H.makeVList({positionType:"shift",positionData:-v,children:[{type:"elem",elem:m}]},e),w=H.makeSpan(["root"],[_]);return H.makeSpan(["mord","sqrt"],[w,f],e)}else return H.makeSpan(["mord","sqrt"],[f],e)},mathmlBuilder(r,e){var{body:t,index:n}=r;return n?new oe.MathNode("mroot",[Zt(t,e),Zt(n,e)]):new oe.MathNode("msqrt",[Zt(t,e)])}});var Iy={display:tt.DISPLAY,text:tt.TEXT,script:tt.SCRIPT,scriptscript:tt.SCRIPTSCRIPT};Te({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(r,e){var{breakOnTokenText:t,funcName:n,parser:a}=r,s=a.parseExpression(!0,t),i=n.slice(1,n.length-5);return{type:"styling",mode:a.mode,style:i,body:s}},htmlBuilder(r,e){var t=Iy[r.style],n=e.havingStyle(t).withFont("");return cb(r.body,n,e)},mathmlBuilder(r,e){var t=Iy[r.style],n=e.havingStyle(t),a=wn(r.body,n),s=new oe.MathNode("mstyle",a),i={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},o=i[r.style];return s.setAttribute("scriptlevel",o[0]),s.setAttribute("displaystyle",o[1]),s}});var dS=function(e,t){var n=e.base;if(n)if(n.type==="op"){var a=n.limits&&(t.style.size===tt.DISPLAY.size||n.alwaysHandleSupSub);return a?wo:null}else if(n.type==="operatorname"){var s=n.alwaysHandleSupSub&&(t.style.size===tt.DISPLAY.size||n.limits);return s?lb:null}else{if(n.type==="accent")return Bt.isCharacterBox(n.base)?mm:null;if(n.type==="horizBrace"){var i=!e.sub;return i===n.isOver?ib:null}else return null}else return null};Ci({type:"supsub",htmlBuilder(r,e){var t=dS(r,e);if(t)return t(r,e);var{base:n,sup:a,sub:s}=r,i=Ft(n,e),o,u,l=e.fontMetrics(),c=0,d=0,h=n&&Bt.isCharacterBox(n);if(a){var f=e.havingStyle(e.style.sup());o=Ft(a,f,e),h||(c=i.height-f.fontMetrics().supDrop*f.sizeMultiplier/e.sizeMultiplier)}if(s){var p=e.havingStyle(e.style.sub());u=Ft(s,p,e),h||(d=i.depth+p.fontMetrics().subDrop*p.sizeMultiplier/e.sizeMultiplier)}var m;e.style===tt.DISPLAY?m=l.sup1:e.style.cramped?m=l.sup3:m=l.sup2;var v=e.sizeMultiplier,_=ye(.5/l.ptPerEm/v),w=null;if(u){var E=r.base&&r.base.type==="op"&&r.base.name&&(r.base.name==="\\oiint"||r.base.name==="\\oiiint");(i instanceof qn||E)&&(w=ye(-i.italic))}var F;if(o&&u){c=Math.max(c,m,o.depth+.25*l.xHeight),d=Math.max(d,l.sub2);var k=l.defaultRuleThickness,N=4*k;if(c-o.depth-(u.height-d)<N){d=N-(c-o.depth)+u.height;var B=.8*l.xHeight-(c-o.depth);B>0&&(c+=B,d-=B)}var A=[{type:"elem",elem:u,shift:d,marginRight:_,marginLeft:w},{type:"elem",elem:o,shift:-c,marginRight:_}];F=H.makeVList({positionType:"individualShift",children:A},e)}else if(u){d=Math.max(d,l.sub1,u.height-.8*l.xHeight);var L=[{type:"elem",elem:u,marginLeft:w,marginRight:_}];F=H.makeVList({positionType:"shift",positionData:d,children:L},e)}else if(o)c=Math.max(c,m,o.depth+.25*l.xHeight),F=H.makeVList({positionType:"shift",positionData:-c,children:[{type:"elem",elem:o,marginRight:_}]},e);else throw new Error("supsub must have either sup or sub.");var V=Lf(i,"right")||"mord";return H.makeSpan([V],[i,H.makeSpan(["msupsub"],[F])],e)},mathmlBuilder(r,e){var t=!1,n,a;r.base&&r.base.type==="horizBrace"&&(a=!!r.sup,a===r.base.isOver&&(t=!0,n=r.base.isOver)),r.base&&(r.base.type==="op"||r.base.type==="operatorname")&&(r.base.parentIsSupSub=!0);var s=[Zt(r.base,e)];r.sub&&s.push(Zt(r.sub,e)),r.sup&&s.push(Zt(r.sup,e));var i;if(t)i=n?"mover":"munder";else if(r.sub)if(r.sup){var l=r.base;l&&l.type==="op"&&l.limits&&e.style===tt.DISPLAY||l&&l.type==="operatorname"&&l.alwaysHandleSupSub&&(e.style===tt.DISPLAY||l.limits)?i="munderover":i="msubsup"}else{var u=r.base;u&&u.type==="op"&&u.limits&&(e.style===tt.DISPLAY||u.alwaysHandleSupSub)||u&&u.type==="operatorname"&&u.alwaysHandleSupSub&&(u.limits||e.style===tt.DISPLAY)?i="munder":i="msub"}else{var o=r.base;o&&o.type==="op"&&o.limits&&(e.style===tt.DISPLAY||o.alwaysHandleSupSub)||o&&o.type==="operatorname"&&o.alwaysHandleSupSub&&(o.limits||e.style===tt.DISPLAY)?i="mover":i="msup"}return new oe.MathNode(i,s)}});Ci({type:"atom",htmlBuilder(r,e){return H.mathsym(r.text,r.mode,e,["m"+r.family])},mathmlBuilder(r,e){var t=new oe.MathNode("mo",[Hn(r.text,r.mode)]);if(r.family==="bin"){var n=fm(r,e);n==="bold-italic"&&t.setAttribute("mathvariant",n)}else r.family==="punct"?t.setAttribute("separator","true"):(r.family==="open"||r.family==="close")&&t.setAttribute("stretchy","false");return t}});var db={mi:"italic",mn:"normal",mtext:"normal"};Ci({type:"mathord",htmlBuilder(r,e){return H.makeOrd(r,e,"mathord")},mathmlBuilder(r,e){var t=new oe.MathNode("mi",[Hn(r.text,r.mode,e)]),n=fm(r,e)||"italic";return n!==db[t.type]&&t.setAttribute("mathvariant",n),t}});Ci({type:"textord",htmlBuilder(r,e){return H.makeOrd(r,e,"textord")},mathmlBuilder(r,e){var t=Hn(r.text,r.mode,e),n=fm(r,e)||"normal",a;return r.mode==="text"?a=new oe.MathNode("mtext",[t]):/[0-9]/.test(r.text)?a=new oe.MathNode("mn",[t]):r.text==="\\prime"?a=new oe.MathNode("mo",[t]):a=new oe.MathNode("mi",[t]),n!==db[a.type]&&a.setAttribute("mathvariant",n),a}});var qd={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},Hd={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};Ci({type:"spacing",htmlBuilder(r,e){if(Hd.hasOwnProperty(r.text)){var t=Hd[r.text].className||"";if(r.mode==="text"){var n=H.makeOrd(r,e,"textord");return n.classes.push(t),n}else return H.makeSpan(["mspace",t],[H.mathsym(r.text,r.mode,e)],e)}else{if(qd.hasOwnProperty(r.text))return H.makeSpan(["mspace",qd[r.text]],[],e);throw new ue('Unknown type of space "'+r.text+'"')}},mathmlBuilder(r,e){var t;if(Hd.hasOwnProperty(r.text))t=new oe.MathNode("mtext",[new oe.TextNode("\xA0")]);else{if(qd.hasOwnProperty(r.text))return new oe.MathNode("mspace");throw new ue('Unknown type of space "'+r.text+'"')}return t}});var Oy=()=>{var r=new oe.MathNode("mtd",[]);return r.setAttribute("width","50%"),r};Ci({type:"tag",mathmlBuilder(r,e){var t=new oe.MathNode("mtable",[new oe.MathNode("mtr",[Oy(),new oe.MathNode("mtd",[zs(r.body,e)]),Oy(),new oe.MathNode("mtd",[zs(r.tag,e)])])]);return t.setAttribute("width","100%"),t}});var Ry={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},Dy={"\\textbf":"textbf","\\textmd":"textmd"},hS={"\\textit":"textit","\\textup":"textup"},By=(r,e)=>{var t=r.font;if(t){if(Ry[t])return e.withTextFontFamily(Ry[t]);if(Dy[t])return e.withTextFontWeight(Dy[t]);if(t==="\\emph")return e.fontShape==="textit"?e.withTextFontShape("textup"):e.withTextFontShape("textit")}else return e;return e.withTextFontShape(hS[t])};Te({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(r,e){var{parser:t,funcName:n}=r,a=e[0];return{type:"text",mode:t.mode,body:mr(a),font:n}},htmlBuilder(r,e){var t=By(r,e),n=Fr(r.body,t,!0);return H.makeSpan(["mord","text"],n,t)},mathmlBuilder(r,e){var t=By(r,e);return zs(r.body,t)}});Te({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(r,e){var{parser:t}=r;return{type:"underline",mode:t.mode,body:e[0]}},htmlBuilder(r,e){var t=Ft(r.body,e),n=H.makeLineSpan("underline-line",e),a=e.fontMetrics().defaultRuleThickness,s=H.makeVList({positionType:"top",positionData:t.height,children:[{type:"kern",size:a},{type:"elem",elem:n},{type:"kern",size:3*a},{type:"elem",elem:t}]},e);return H.makeSpan(["mord","underline"],[s],e)},mathmlBuilder(r,e){var t=new oe.MathNode("mo",[new oe.TextNode("\u203E")]);t.setAttribute("stretchy","true");var n=new oe.MathNode("munder",[Zt(r.body,e),t]);return n.setAttribute("accentunder","true"),n}});Te({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(r,e){var{parser:t}=r;return{type:"vcenter",mode:t.mode,body:e[0]}},htmlBuilder(r,e){var t=Ft(r.body,e),n=e.fontMetrics().axisHeight,a=.5*(t.height-n-(t.depth+n));return H.makeVList({positionType:"shift",positionData:a,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(r,e){return new oe.MathNode("mpadded",[Zt(r.body,e)],["vcenter"])}});Te({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(r,e,t){throw new ue("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(r,e){for(var t=My(r),n=[],a=e.havingStyle(e.style.text()),s=0;s<t.length;s++){var i=t[s];i==="~"&&(i="\\textasciitilde"),n.push(H.makeSymbol(i,"Typewriter-Regular",r.mode,a,["mord","texttt"]))}return H.makeSpan(["mord","text"].concat(a.sizingClasses(e)),H.tryCombineChars(n),a)},mathmlBuilder(r,e){var t=new oe.TextNode(My(r)),n=new oe.MathNode("mtext",[t]);return n.setAttribute("mathvariant","monospace"),n}});var My=r=>r.body.replace(/ /g,r.star?"\u2423":"\xA0"),Cs=D4,hb=`[ \r
	]`,fS="\\\\[a-zA-Z@]+",pS="\\\\[^\uD800-\uDFFF]",mS="("+fS+")"+hb+"*",gS=`\\\\(
|[ \r	]+
?)[ \r	]*`,qf="[\u0300-\u036F]",yS=new RegExp(qf+"+$"),vS="("+hb+"+)|"+(gS+"|")+"([!-\\[\\]-\u2027\u202A-\uD7FF\uF900-\uFFFF]"+(qf+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(qf+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+mS)+("|"+pS+")");class $y{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp(vS,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new Tn("EOF",new dn(this,t,t));var n=this.tokenRegex.exec(e);if(n===null||n.index!==t)throw new ue("Unexpected character: '"+e[t]+"'",new Tn(e[t],new dn(this,t,t+1)));var a=n[6]||n[3]||(n[2]?"\\ ":" ");if(this.catcodes[a]===14){var s=e.indexOf(`
`,this.tokenRegex.lastIndex);return s===-1?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=s+1,this.lex()}return new Tn(a,new dn(this,t,this.tokenRegex.lastIndex))}}class _S{constructor(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new ue("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(e[t]==null?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,n){if(n===void 0&&(n=!1),n){for(var a=0;a<this.undefStack.length;a++)delete this.undefStack[a][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var s=this.undefStack[this.undefStack.length-1];s&&!s.hasOwnProperty(e)&&(s[e]=this.current[e])}t==null?delete this.current[e]:this.current[e]=t}}var bS=tb;T("\\noexpand",function(r){var e=r.popToken();return r.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}});T("\\expandafter",function(r){var e=r.popToken();return r.expandOnce(!0),{tokens:[e],numArgs:0}});T("\\@firstoftwo",function(r){var e=r.consumeArgs(2);return{tokens:e[0],numArgs:0}});T("\\@secondoftwo",function(r){var e=r.consumeArgs(2);return{tokens:e[1],numArgs:0}});T("\\@ifnextchar",function(r){var e=r.consumeArgs(3);r.consumeSpaces();var t=r.future();return e[0].length===1&&e[0][0].text===t.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}});T("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");T("\\TextOrMath",function(r){var e=r.consumeArgs(2);return r.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var Py={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};T("\\char",function(r){var e=r.popToken(),t,n="";if(e.text==="'")t=8,e=r.popToken();else if(e.text==='"')t=16,e=r.popToken();else if(e.text==="`")if(e=r.popToken(),e.text[0]==="\\")n=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new ue("\\char` missing argument");n=e.text.charCodeAt(0)}else t=10;if(t){if(n=Py[e.text],n==null||n>=t)throw new ue("Invalid base-"+t+" digit "+e.text);for(var a;(a=Py[r.future().text])!=null&&a<t;)n*=t,n+=a,r.popToken()}return"\\@char{"+n+"}"});var xm=(r,e,t,n)=>{var a=r.consumeArg().tokens;if(a.length!==1)throw new ue("\\newcommand's first argument must be a macro name");var s=a[0].text,i=r.isDefined(s);if(i&&!e)throw new ue("\\newcommand{"+s+"} attempting to redefine "+(s+"; use \\renewcommand"));if(!i&&!t)throw new ue("\\renewcommand{"+s+"} when command "+s+" does not yet exist; use \\newcommand");var o=0;if(a=r.consumeArg().tokens,a.length===1&&a[0].text==="["){for(var u="",l=r.expandNextToken();l.text!=="]"&&l.text!=="EOF";)u+=l.text,l=r.expandNextToken();if(!u.match(/^\s*[0-9]+\s*$/))throw new ue("Invalid number of arguments: "+u);o=parseInt(u),a=r.consumeArg().tokens}return i&&n||r.macros.set(s,{tokens:a,numArgs:o}),""};T("\\newcommand",r=>xm(r,!1,!0,!1));T("\\renewcommand",r=>xm(r,!0,!1,!1));T("\\providecommand",r=>xm(r,!0,!0,!0));T("\\message",r=>{var e=r.consumeArgs(1)[0];return console.log(e.reverse().map(t=>t.text).join("")),""});T("\\errmessage",r=>{var e=r.consumeArgs(1)[0];return console.error(e.reverse().map(t=>t.text).join("")),""});T("\\show",r=>{var e=r.popToken(),t=e.text;return console.log(e,r.macros.get(t),Cs[t],Yt.math[t],Yt.text[t]),""});T("\\bgroup","{");T("\\egroup","}");T("~","\\nobreakspace");T("\\lq","`");T("\\rq","'");T("\\aa","\\r a");T("\\AA","\\r A");T("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`\xA9}");T("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");T("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`\xAE}");T("\u212C","\\mathscr{B}");T("\u2130","\\mathscr{E}");T("\u2131","\\mathscr{F}");T("\u210B","\\mathscr{H}");T("\u2110","\\mathscr{I}");T("\u2112","\\mathscr{L}");T("\u2133","\\mathscr{M}");T("\u211B","\\mathscr{R}");T("\u212D","\\mathfrak{C}");T("\u210C","\\mathfrak{H}");T("\u2128","\\mathfrak{Z}");T("\\Bbbk","\\Bbb{k}");T("\xB7","\\cdotp");T("\\llap","\\mathllap{\\textrm{#1}}");T("\\rlap","\\mathrlap{\\textrm{#1}}");T("\\clap","\\mathclap{\\textrm{#1}}");T("\\mathstrut","\\vphantom{(}");T("\\underbar","\\underline{\\text{#1}}");T("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');T("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`\u2260}}");T("\\ne","\\neq");T("\u2260","\\neq");T("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`\u2209}}");T("\u2209","\\notin");T("\u2258","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`\u2258}}");T("\u2259","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`\u2258}}");T("\u225A","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`\u225A}}");T("\u225B","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`\u225B}}");T("\u225D","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`\u225D}}");T("\u225E","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`\u225E}}");T("\u225F","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`\u225F}}");T("\u27C2","\\perp");T("\u203C","\\mathclose{!\\mkern-0.8mu!}");T("\u220C","\\notni");T("\u231C","\\ulcorner");T("\u231D","\\urcorner");T("\u231E","\\llcorner");T("\u231F","\\lrcorner");T("\xA9","\\copyright");T("\xAE","\\textregistered");T("\uFE0F","\\textregistered");T("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');T("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');T("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');T("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');T("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");T("\u22EE","\\vdots");T("\\varGamma","\\mathit{\\Gamma}");T("\\varDelta","\\mathit{\\Delta}");T("\\varTheta","\\mathit{\\Theta}");T("\\varLambda","\\mathit{\\Lambda}");T("\\varXi","\\mathit{\\Xi}");T("\\varPi","\\mathit{\\Pi}");T("\\varSigma","\\mathit{\\Sigma}");T("\\varUpsilon","\\mathit{\\Upsilon}");T("\\varPhi","\\mathit{\\Phi}");T("\\varPsi","\\mathit{\\Psi}");T("\\varOmega","\\mathit{\\Omega}");T("\\substack","\\begin{subarray}{c}#1\\end{subarray}");T("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");T("\\boxed","\\fbox{$\\displaystyle{#1}$}");T("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");T("\\implies","\\DOTSB\\;\\Longrightarrow\\;");T("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");T("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}");T("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var Ly={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};T("\\dots",function(r){var e="\\dotso",t=r.expandAfterFuture().text;return t in Ly?e=Ly[t]:(t.slice(0,4)==="\\not"||t in Yt.math&&["bin","rel"].includes(Yt.math[t].group))&&(e="\\dotsb"),e});var Sm={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};T("\\dotso",function(r){var e=r.future().text;return e in Sm?"\\ldots\\,":"\\ldots"});T("\\dotsc",function(r){var e=r.future().text;return e in Sm&&e!==","?"\\ldots\\,":"\\ldots"});T("\\cdots",function(r){var e=r.future().text;return e in Sm?"\\@cdots\\,":"\\@cdots"});T("\\dotsb","\\cdots");T("\\dotsm","\\cdots");T("\\dotsi","\\!\\cdots");T("\\dotsx","\\ldots\\,");T("\\DOTSI","\\relax");T("\\DOTSB","\\relax");T("\\DOTSX","\\relax");T("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");T("\\,","\\tmspace+{3mu}{.1667em}");T("\\thinspace","\\,");T("\\>","\\mskip{4mu}");T("\\:","\\tmspace+{4mu}{.2222em}");T("\\medspace","\\:");T("\\;","\\tmspace+{5mu}{.2777em}");T("\\thickspace","\\;");T("\\!","\\tmspace-{3mu}{.1667em}");T("\\negthinspace","\\!");T("\\negmedspace","\\tmspace-{4mu}{.2222em}");T("\\negthickspace","\\tmspace-{5mu}{.277em}");T("\\enspace","\\kern.5em ");T("\\enskip","\\hskip.5em\\relax");T("\\quad","\\hskip1em\\relax");T("\\qquad","\\hskip2em\\relax");T("\\tag","\\@ifstar\\tag@literal\\tag@paren");T("\\tag@paren","\\tag@literal{({#1})}");T("\\tag@literal",r=>{if(r.macros.get("\\df@tag"))throw new ue("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});T("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");T("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");T("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");T("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");T("\\newline","\\\\\\relax");T("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var fb=ye(ka["Main-Regular"][84][1]-.7*ka["Main-Regular"][65][1]);T("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+fb+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");T("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+fb+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");T("\\hspace","\\@ifstar\\@hspacer\\@hspace");T("\\@hspace","\\hskip #1\\relax");T("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");T("\\ordinarycolon",":");T("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");T("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');T("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');T("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');T("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');T("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');T("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');T("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');T("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');T("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');T("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');T("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');T("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');T("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');T("\u2237","\\dblcolon");T("\u2239","\\eqcolon");T("\u2254","\\coloneqq");T("\u2255","\\eqqcolon");T("\u2A74","\\Coloneqq");T("\\ratio","\\vcentcolon");T("\\coloncolon","\\dblcolon");T("\\colonequals","\\coloneqq");T("\\coloncolonequals","\\Coloneqq");T("\\equalscolon","\\eqqcolon");T("\\equalscoloncolon","\\Eqqcolon");T("\\colonminus","\\coloneq");T("\\coloncolonminus","\\Coloneq");T("\\minuscolon","\\eqcolon");T("\\minuscoloncolon","\\Eqcolon");T("\\coloncolonapprox","\\Colonapprox");T("\\coloncolonsim","\\Colonsim");T("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");T("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");T("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");T("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");T("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`\u220C}}");T("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");T("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");T("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");T("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");T("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");T("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");T("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");T("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");T("\\gvertneqq","\\html@mathml{\\@gvertneqq}{\u2269}");T("\\lvertneqq","\\html@mathml{\\@lvertneqq}{\u2268}");T("\\ngeqq","\\html@mathml{\\@ngeqq}{\u2271}");T("\\ngeqslant","\\html@mathml{\\@ngeqslant}{\u2271}");T("\\nleqq","\\html@mathml{\\@nleqq}{\u2270}");T("\\nleqslant","\\html@mathml{\\@nleqslant}{\u2270}");T("\\nshortmid","\\html@mathml{\\@nshortmid}{\u2224}");T("\\nshortparallel","\\html@mathml{\\@nshortparallel}{\u2226}");T("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{\u2288}");T("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{\u2289}");T("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{\u228A}");T("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{\u2ACB}");T("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{\u228B}");T("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{\u2ACC}");T("\\imath","\\html@mathml{\\@imath}{\u0131}");T("\\jmath","\\html@mathml{\\@jmath}{\u0237}");T("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`\u27E6}}");T("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`\u27E7}}");T("\u27E6","\\llbracket");T("\u27E7","\\rrbracket");T("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`\u2983}}");T("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`\u2984}}");T("\u2983","\\lBrace");T("\u2984","\\rBrace");T("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`\u29B5}}");T("\u29B5","\\minuso");T("\\darr","\\downarrow");T("\\dArr","\\Downarrow");T("\\Darr","\\Downarrow");T("\\lang","\\langle");T("\\rang","\\rangle");T("\\uarr","\\uparrow");T("\\uArr","\\Uparrow");T("\\Uarr","\\Uparrow");T("\\N","\\mathbb{N}");T("\\R","\\mathbb{R}");T("\\Z","\\mathbb{Z}");T("\\alef","\\aleph");T("\\alefsym","\\aleph");T("\\Alpha","\\mathrm{A}");T("\\Beta","\\mathrm{B}");T("\\bull","\\bullet");T("\\Chi","\\mathrm{X}");T("\\clubs","\\clubsuit");T("\\cnums","\\mathbb{C}");T("\\Complex","\\mathbb{C}");T("\\Dagger","\\ddagger");T("\\diamonds","\\diamondsuit");T("\\empty","\\emptyset");T("\\Epsilon","\\mathrm{E}");T("\\Eta","\\mathrm{H}");T("\\exist","\\exists");T("\\harr","\\leftrightarrow");T("\\hArr","\\Leftrightarrow");T("\\Harr","\\Leftrightarrow");T("\\hearts","\\heartsuit");T("\\image","\\Im");T("\\infin","\\infty");T("\\Iota","\\mathrm{I}");T("\\isin","\\in");T("\\Kappa","\\mathrm{K}");T("\\larr","\\leftarrow");T("\\lArr","\\Leftarrow");T("\\Larr","\\Leftarrow");T("\\lrarr","\\leftrightarrow");T("\\lrArr","\\Leftrightarrow");T("\\Lrarr","\\Leftrightarrow");T("\\Mu","\\mathrm{M}");T("\\natnums","\\mathbb{N}");T("\\Nu","\\mathrm{N}");T("\\Omicron","\\mathrm{O}");T("\\plusmn","\\pm");T("\\rarr","\\rightarrow");T("\\rArr","\\Rightarrow");T("\\Rarr","\\Rightarrow");T("\\real","\\Re");T("\\reals","\\mathbb{R}");T("\\Reals","\\mathbb{R}");T("\\Rho","\\mathrm{P}");T("\\sdot","\\cdot");T("\\sect","\\S");T("\\spades","\\spadesuit");T("\\sub","\\subset");T("\\sube","\\subseteq");T("\\supe","\\supseteq");T("\\Tau","\\mathrm{T}");T("\\thetasym","\\vartheta");T("\\weierp","\\wp");T("\\Zeta","\\mathrm{Z}");T("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");T("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");T("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");T("\\bra","\\mathinner{\\langle{#1}|}");T("\\ket","\\mathinner{|{#1}\\rangle}");T("\\braket","\\mathinner{\\langle{#1}\\rangle}");T("\\Bra","\\left\\langle#1\\right|");T("\\Ket","\\left|#1\\right\\rangle");var pb=r=>e=>{var t=e.consumeArg().tokens,n=e.consumeArg().tokens,a=e.consumeArg().tokens,s=e.consumeArg().tokens,i=e.macros.get("|"),o=e.macros.get("\\|");e.macros.beginGroup();var u=d=>h=>{r&&(h.macros.set("|",i),a.length&&h.macros.set("\\|",o));var f=d;if(!d&&a.length){var p=h.future();p.text==="|"&&(h.popToken(),f=!0)}return{tokens:f?a:n,numArgs:0}};e.macros.set("|",u(!1)),a.length&&e.macros.set("\\|",u(!0));var l=e.consumeArg().tokens,c=e.expandTokens([...s,...l,...t]);return e.macros.endGroup(),{tokens:c.reverse(),numArgs:0}};T("\\bra@ket",pb(!1));T("\\bra@set",pb(!0));T("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");T("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");T("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");T("\\angln","{\\angl n}");T("\\blue","\\textcolor{##6495ed}{#1}");T("\\orange","\\textcolor{##ffa500}{#1}");T("\\pink","\\textcolor{##ff00af}{#1}");T("\\red","\\textcolor{##df0030}{#1}");T("\\green","\\textcolor{##28ae7b}{#1}");T("\\gray","\\textcolor{gray}{#1}");T("\\purple","\\textcolor{##9d38bd}{#1}");T("\\blueA","\\textcolor{##ccfaff}{#1}");T("\\blueB","\\textcolor{##80f6ff}{#1}");T("\\blueC","\\textcolor{##63d9ea}{#1}");T("\\blueD","\\textcolor{##11accd}{#1}");T("\\blueE","\\textcolor{##0c7f99}{#1}");T("\\tealA","\\textcolor{##94fff5}{#1}");T("\\tealB","\\textcolor{##26edd5}{#1}");T("\\tealC","\\textcolor{##01d1c1}{#1}");T("\\tealD","\\textcolor{##01a995}{#1}");T("\\tealE","\\textcolor{##208170}{#1}");T("\\greenA","\\textcolor{##b6ffb0}{#1}");T("\\greenB","\\textcolor{##8af281}{#1}");T("\\greenC","\\textcolor{##74cf70}{#1}");T("\\greenD","\\textcolor{##1fab54}{#1}");T("\\greenE","\\textcolor{##0d923f}{#1}");T("\\goldA","\\textcolor{##ffd0a9}{#1}");T("\\goldB","\\textcolor{##ffbb71}{#1}");T("\\goldC","\\textcolor{##ff9c39}{#1}");T("\\goldD","\\textcolor{##e07d10}{#1}");T("\\goldE","\\textcolor{##a75a05}{#1}");T("\\redA","\\textcolor{##fca9a9}{#1}");T("\\redB","\\textcolor{##ff8482}{#1}");T("\\redC","\\textcolor{##f9685d}{#1}");T("\\redD","\\textcolor{##e84d39}{#1}");T("\\redE","\\textcolor{##bc2612}{#1}");T("\\maroonA","\\textcolor{##ffbde0}{#1}");T("\\maroonB","\\textcolor{##ff92c6}{#1}");T("\\maroonC","\\textcolor{##ed5fa6}{#1}");T("\\maroonD","\\textcolor{##ca337c}{#1}");T("\\maroonE","\\textcolor{##9e034e}{#1}");T("\\purpleA","\\textcolor{##ddd7ff}{#1}");T("\\purpleB","\\textcolor{##c6b9fc}{#1}");T("\\purpleC","\\textcolor{##aa87ff}{#1}");T("\\purpleD","\\textcolor{##7854ab}{#1}");T("\\purpleE","\\textcolor{##543b78}{#1}");T("\\mintA","\\textcolor{##f5f9e8}{#1}");T("\\mintB","\\textcolor{##edf2df}{#1}");T("\\mintC","\\textcolor{##e0e5cc}{#1}");T("\\grayA","\\textcolor{##f6f7f7}{#1}");T("\\grayB","\\textcolor{##f0f1f2}{#1}");T("\\grayC","\\textcolor{##e3e5e6}{#1}");T("\\grayD","\\textcolor{##d6d8da}{#1}");T("\\grayE","\\textcolor{##babec2}{#1}");T("\\grayF","\\textcolor{##888d93}{#1}");T("\\grayG","\\textcolor{##626569}{#1}");T("\\grayH","\\textcolor{##3b3e40}{#1}");T("\\grayI","\\textcolor{##21242c}{#1}");T("\\kaBlue","\\textcolor{##314453}{#1}");T("\\kaGreen","\\textcolor{##71B307}{#1}");var mb={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class wS{constructor(e,t,n){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new _S(bS,t.macros),this.mode=n,this.stack=[]}feed(e){this.lexer=new $y(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,n,a;if(e){if(this.consumeSpaces(),this.future().text!=="[")return null;t=this.popToken(),{tokens:a,end:n}=this.consumeArg(["]"])}else({tokens:a,start:t,end:n}=this.consumeArg());return this.pushToken(new Tn("EOF",n.loc)),this.pushTokens(a),new Tn("",dn.range(t,n))}consumeSpaces(){for(;;){var e=this.future();if(e.text===" ")this.stack.pop();else break}}consumeArg(e){var t=[],n=e&&e.length>0;n||this.consumeSpaces();var a=this.future(),s,i=0,o=0;do{if(s=this.popToken(),t.push(s),s.text==="{")++i;else if(s.text==="}"){if(--i,i===-1)throw new ue("Extra }",s)}else if(s.text==="EOF")throw new ue("Unexpected end of input in a macro argument, expected '"+(e&&n?e[o]:"}")+"'",s);if(e&&n)if((i===0||i===1&&e[o]==="{")&&s.text===e[o]){if(++o,o===e.length){t.splice(-o,o);break}}else o=0}while(i!==0||n);return a.text==="{"&&t[t.length-1].text==="}"&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:a,end:s}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new ue("The length of delimiters doesn't match the number of args!");for(var n=t[0],a=0;a<n.length;a++){var s=this.popToken();if(n[a]!==s.text)throw new ue("Use of the macro doesn't match its definition",s)}}for(var i=[],o=0;o<e;o++)i.push(this.consumeArg(t&&t[o+1]).tokens);return i}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new ue("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var t=this.popToken(),n=t.text,a=t.noexpand?null:this._getExpansion(n);if(a==null||e&&a.unexpandable){if(e&&a==null&&n[0]==="\\"&&!this.isDefined(n))throw new ue("Undefined control sequence: "+n);return this.pushToken(t),!1}this.countExpansion(1);var s=a.tokens,i=this.consumeArgs(a.numArgs,a.delimiters);if(a.numArgs){s=s.slice();for(var o=s.length-1;o>=0;--o){var u=s[o];if(u.text==="#"){if(o===0)throw new ue("Incomplete placeholder at end of macro body",u);if(u=s[--o],u.text==="#")s.splice(o+1,1);else if(/^[1-9]$/.test(u.text))s.splice(o,2,...i[+u.text-1]);else throw new ue("Not a valid argument number",u)}}}return this.pushTokens(s),s.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new Tn(e)]):void 0}expandTokens(e){var t=[],n=this.stack.length;for(this.pushTokens(e);this.stack.length>n;)if(this.expandOnce(!0)===!1){var a=this.stack.pop();a.treatAsRelax&&(a.noexpand=!1,a.treatAsRelax=!1),t.push(a)}return this.countExpansion(t.length),t}expandMacroAsText(e){var t=this.expandMacro(e);return t&&t.map(n=>n.text).join("")}_getExpansion(e){var t=this.macros.get(e);if(t==null)return t;if(e.length===1){var n=this.lexer.catcodes[e];if(n!=null&&n!==13)return}var a=typeof t=="function"?t(this):t;if(typeof a=="string"){var s=0;if(a.indexOf("#")!==-1)for(var i=a.replace(/##/g,"");i.indexOf("#"+(s+1))!==-1;)++s;for(var o=new $y(a,this.settings),u=[],l=o.lex();l.text!=="EOF";)u.push(l),l=o.lex();u.reverse();var c={tokens:u,numArgs:s};return c}return a}isDefined(e){return this.macros.has(e)||Cs.hasOwnProperty(e)||Yt.math.hasOwnProperty(e)||Yt.text.hasOwnProperty(e)||mb.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return t!=null?typeof t=="string"||typeof t=="function"||!t.unexpandable:Cs.hasOwnProperty(e)&&!Cs[e].primitive}}var zy=/^[]/,gl=Object.freeze({"\u208A":"+","\u208B":"-","\u208C":"=","\u208D":"(","\u208E":")","\u2080":"0","\u2081":"1","\u2082":"2","\u2083":"3","\u2084":"4","\u2085":"5","\u2086":"6","\u2087":"7","\u2088":"8","\u2089":"9","\u2090":"a","\u2091":"e","\u2095":"h","\u1D62":"i","\u2C7C":"j","\u2096":"k","\u2097":"l","\u2098":"m","\u2099":"n","\u2092":"o","\u209A":"p","\u1D63":"r","\u209B":"s","\u209C":"t","\u1D64":"u","\u1D65":"v","\u2093":"x","\u1D66":"\u03B2","\u1D67":"\u03B3","\u1D68":"\u03C1","\u1D69":"\u03D5","\u1D6A":"\u03C7","\u207A":"+","\u207B":"-","\u207C":"=","\u207D":"(","\u207E":")","\u2070":"0","\xB9":"1","\xB2":"2","\xB3":"3","\u2074":"4","\u2075":"5","\u2076":"6","\u2077":"7","\u2078":"8","\u2079":"9","\u1D2C":"A","\u1D2E":"B","\u1D30":"D","\u1D31":"E","\u1D33":"G","\u1D34":"H","\u1D35":"I","\u1D36":"J","\u1D37":"K","\u1D38":"L","\u1D39":"M","\u1D3A":"N","\u1D3C":"O","\u1D3E":"P","\u1D3F":"R","\u1D40":"T","\u1D41":"U","\u2C7D":"V","\u1D42":"W","\u1D43":"a","\u1D47":"b","\u1D9C":"c","\u1D48":"d","\u1D49":"e","\u1DA0":"f","\u1D4D":"g",\u02B0:"h","\u2071":"i",\u02B2:"j","\u1D4F":"k",\u02E1:"l","\u1D50":"m",\u207F:"n","\u1D52":"o","\u1D56":"p",\u02B3:"r",\u02E2:"s","\u1D57":"t","\u1D58":"u","\u1D5B":"v",\u02B7:"w",\u02E3:"x",\u02B8:"y","\u1DBB":"z","\u1D5D":"\u03B2","\u1D5E":"\u03B3","\u1D5F":"\u03B4","\u1D60":"\u03D5","\u1D61":"\u03C7","\u1DBF":"\u03B8"}),Vd={"\u0301":{text:"\\'",math:"\\acute"},"\u0300":{text:"\\`",math:"\\grave"},"\u0308":{text:'\\"',math:"\\ddot"},"\u0303":{text:"\\~",math:"\\tilde"},"\u0304":{text:"\\=",math:"\\bar"},"\u0306":{text:"\\u",math:"\\breve"},"\u030C":{text:"\\v",math:"\\check"},"\u0302":{text:"\\^",math:"\\hat"},"\u0307":{text:"\\.",math:"\\dot"},"\u030A":{text:"\\r",math:"\\mathring"},"\u030B":{text:"\\H"},"\u0327":{text:"\\c"}},Uy={\u00E1:"a\u0301",\u00E0:"a\u0300",\u00E4:"a\u0308",\u01DF:"a\u0308\u0304",\u00E3:"a\u0303",\u0101:"a\u0304",\u0103:"a\u0306",\u1EAF:"a\u0306\u0301",\u1EB1:"a\u0306\u0300",\u1EB5:"a\u0306\u0303",\u01CE:"a\u030C",\u00E2:"a\u0302",\u1EA5:"a\u0302\u0301",\u1EA7:"a\u0302\u0300",\u1EAB:"a\u0302\u0303",\u0227:"a\u0307",\u01E1:"a\u0307\u0304",\u00E5:"a\u030A",\u01FB:"a\u030A\u0301",\u1E03:"b\u0307",\u0107:"c\u0301",\u1E09:"c\u0327\u0301",\u010D:"c\u030C",\u0109:"c\u0302",\u010B:"c\u0307",\u00E7:"c\u0327",\u010F:"d\u030C",\u1E0B:"d\u0307",\u1E11:"d\u0327",\u00E9:"e\u0301",\u00E8:"e\u0300",\u00EB:"e\u0308",\u1EBD:"e\u0303",\u0113:"e\u0304",\u1E17:"e\u0304\u0301",\u1E15:"e\u0304\u0300",\u0115:"e\u0306",\u1E1D:"e\u0327\u0306",\u011B:"e\u030C",\u00EA:"e\u0302",\u1EBF:"e\u0302\u0301",\u1EC1:"e\u0302\u0300",\u1EC5:"e\u0302\u0303",\u0117:"e\u0307",\u0229:"e\u0327",\u1E1F:"f\u0307",\u01F5:"g\u0301",\u1E21:"g\u0304",\u011F:"g\u0306",\u01E7:"g\u030C",\u011D:"g\u0302",\u0121:"g\u0307",\u0123:"g\u0327",\u1E27:"h\u0308",\u021F:"h\u030C",\u0125:"h\u0302",\u1E23:"h\u0307",\u1E29:"h\u0327",\u00ED:"i\u0301",\u00EC:"i\u0300",\u00EF:"i\u0308",\u1E2F:"i\u0308\u0301",\u0129:"i\u0303",\u012B:"i\u0304",\u012D:"i\u0306",\u01D0:"i\u030C",\u00EE:"i\u0302",\u01F0:"j\u030C",\u0135:"j\u0302",\u1E31:"k\u0301",\u01E9:"k\u030C",\u0137:"k\u0327",\u013A:"l\u0301",\u013E:"l\u030C",\u013C:"l\u0327",\u1E3F:"m\u0301",\u1E41:"m\u0307",\u0144:"n\u0301",\u01F9:"n\u0300",\u00F1:"n\u0303",\u0148:"n\u030C",\u1E45:"n\u0307",\u0146:"n\u0327",\u00F3:"o\u0301",\u00F2:"o\u0300",\u00F6:"o\u0308",\u022B:"o\u0308\u0304",\u00F5:"o\u0303",\u1E4D:"o\u0303\u0301",\u1E4F:"o\u0303\u0308",\u022D:"o\u0303\u0304",\u014D:"o\u0304",\u1E53:"o\u0304\u0301",\u1E51:"o\u0304\u0300",\u014F:"o\u0306",\u01D2:"o\u030C",\u00F4:"o\u0302",\u1ED1:"o\u0302\u0301",\u1ED3:"o\u0302\u0300",\u1ED7:"o\u0302\u0303",\u022F:"o\u0307",\u0231:"o\u0307\u0304",\u0151:"o\u030B",\u1E55:"p\u0301",\u1E57:"p\u0307",\u0155:"r\u0301",\u0159:"r\u030C",\u1E59:"r\u0307",\u0157:"r\u0327",\u015B:"s\u0301",\u1E65:"s\u0301\u0307",\u0161:"s\u030C",\u1E67:"s\u030C\u0307",\u015D:"s\u0302",\u1E61:"s\u0307",\u015F:"s\u0327",\u1E97:"t\u0308",\u0165:"t\u030C",\u1E6B:"t\u0307",\u0163:"t\u0327",\u00FA:"u\u0301",\u00F9:"u\u0300",\u00FC:"u\u0308",\u01D8:"u\u0308\u0301",\u01DC:"u\u0308\u0300",\u01D6:"u\u0308\u0304",\u01DA:"u\u0308\u030C",\u0169:"u\u0303",\u1E79:"u\u0303\u0301",\u016B:"u\u0304",\u1E7B:"u\u0304\u0308",\u016D:"u\u0306",\u01D4:"u\u030C",\u00FB:"u\u0302",\u016F:"u\u030A",\u0171:"u\u030B",\u1E7D:"v\u0303",\u1E83:"w\u0301",\u1E81:"w\u0300",\u1E85:"w\u0308",\u0175:"w\u0302",\u1E87:"w\u0307",\u1E98:"w\u030A",\u1E8D:"x\u0308",\u1E8B:"x\u0307",\u00FD:"y\u0301",\u1EF3:"y\u0300",\u00FF:"y\u0308",\u1EF9:"y\u0303",\u0233:"y\u0304",\u0177:"y\u0302",\u1E8F:"y\u0307",\u1E99:"y\u030A",\u017A:"z\u0301",\u017E:"z\u030C",\u1E91:"z\u0302",\u017C:"z\u0307",\u00C1:"A\u0301",\u00C0:"A\u0300",\u00C4:"A\u0308",\u01DE:"A\u0308\u0304",\u00C3:"A\u0303",\u0100:"A\u0304",\u0102:"A\u0306",\u1EAE:"A\u0306\u0301",\u1EB0:"A\u0306\u0300",\u1EB4:"A\u0306\u0303",\u01CD:"A\u030C",\u00C2:"A\u0302",\u1EA4:"A\u0302\u0301",\u1EA6:"A\u0302\u0300",\u1EAA:"A\u0302\u0303",\u0226:"A\u0307",\u01E0:"A\u0307\u0304",\u00C5:"A\u030A",\u01FA:"A\u030A\u0301",\u1E02:"B\u0307",\u0106:"C\u0301",\u1E08:"C\u0327\u0301",\u010C:"C\u030C",\u0108:"C\u0302",\u010A:"C\u0307",\u00C7:"C\u0327",\u010E:"D\u030C",\u1E0A:"D\u0307",\u1E10:"D\u0327",\u00C9:"E\u0301",\u00C8:"E\u0300",\u00CB:"E\u0308",\u1EBC:"E\u0303",\u0112:"E\u0304",\u1E16:"E\u0304\u0301",\u1E14:"E\u0304\u0300",\u0114:"E\u0306",\u1E1C:"E\u0327\u0306",\u011A:"E\u030C",\u00CA:"E\u0302",\u1EBE:"E\u0302\u0301",\u1EC0:"E\u0302\u0300",\u1EC4:"E\u0302\u0303",\u0116:"E\u0307",\u0228:"E\u0327",\u1E1E:"F\u0307",\u01F4:"G\u0301",\u1E20:"G\u0304",\u011E:"G\u0306",\u01E6:"G\u030C",\u011C:"G\u0302",\u0120:"G\u0307",\u0122:"G\u0327",\u1E26:"H\u0308",\u021E:"H\u030C",\u0124:"H\u0302",\u1E22:"H\u0307",\u1E28:"H\u0327",\u00CD:"I\u0301",\u00CC:"I\u0300",\u00CF:"I\u0308",\u1E2E:"I\u0308\u0301",\u0128:"I\u0303",\u012A:"I\u0304",\u012C:"I\u0306",\u01CF:"I\u030C",\u00CE:"I\u0302",\u0130:"I\u0307",\u0134:"J\u0302",\u1E30:"K\u0301",\u01E8:"K\u030C",\u0136:"K\u0327",\u0139:"L\u0301",\u013D:"L\u030C",\u013B:"L\u0327",\u1E3E:"M\u0301",\u1E40:"M\u0307",\u0143:"N\u0301",\u01F8:"N\u0300",\u00D1:"N\u0303",\u0147:"N\u030C",\u1E44:"N\u0307",\u0145:"N\u0327",\u00D3:"O\u0301",\u00D2:"O\u0300",\u00D6:"O\u0308",\u022A:"O\u0308\u0304",\u00D5:"O\u0303",\u1E4C:"O\u0303\u0301",\u1E4E:"O\u0303\u0308",\u022C:"O\u0303\u0304",\u014C:"O\u0304",\u1E52:"O\u0304\u0301",\u1E50:"O\u0304\u0300",\u014E:"O\u0306",\u01D1:"O\u030C",\u00D4:"O\u0302",\u1ED0:"O\u0302\u0301",\u1ED2:"O\u0302\u0300",\u1ED6:"O\u0302\u0303",\u022E:"O\u0307",\u0230:"O\u0307\u0304",\u0150:"O\u030B",\u1E54:"P\u0301",\u1E56:"P\u0307",\u0154:"R\u0301",\u0158:"R\u030C",\u1E58:"R\u0307",\u0156:"R\u0327",\u015A:"S\u0301",\u1E64:"S\u0301\u0307",\u0160:"S\u030C",\u1E66:"S\u030C\u0307",\u015C:"S\u0302",\u1E60:"S\u0307",\u015E:"S\u0327",\u0164:"T\u030C",\u1E6A:"T\u0307",\u0162:"T\u0327",\u00DA:"U\u0301",\u00D9:"U\u0300",\u00DC:"U\u0308",\u01D7:"U\u0308\u0301",\u01DB:"U\u0308\u0300",\u01D5:"U\u0308\u0304",\u01D9:"U\u0308\u030C",\u0168:"U\u0303",\u1E78:"U\u0303\u0301",\u016A:"U\u0304",\u1E7A:"U\u0304\u0308",\u016C:"U\u0306",\u01D3:"U\u030C",\u00DB:"U\u0302",\u016E:"U\u030A",\u0170:"U\u030B",\u1E7C:"V\u0303",\u1E82:"W\u0301",\u1E80:"W\u0300",\u1E84:"W\u0308",\u0174:"W\u0302",\u1E86:"W\u0307",\u1E8C:"X\u0308",\u1E8A:"X\u0307",\u00DD:"Y\u0301",\u1EF2:"Y\u0300",\u0178:"Y\u0308",\u1EF8:"Y\u0303",\u0232:"Y\u0304",\u0176:"Y\u0302",\u1E8E:"Y\u0307",\u0179:"Z\u0301",\u017D:"Z\u030C",\u1E90:"Z\u0302",\u017B:"Z\u0307",\u03AC:"\u03B1\u0301",\u1F70:"\u03B1\u0300",\u1FB1:"\u03B1\u0304",\u1FB0:"\u03B1\u0306",\u03AD:"\u03B5\u0301",\u1F72:"\u03B5\u0300",\u03AE:"\u03B7\u0301",\u1F74:"\u03B7\u0300",\u03AF:"\u03B9\u0301",\u1F76:"\u03B9\u0300",\u03CA:"\u03B9\u0308",\u0390:"\u03B9\u0308\u0301",\u1FD2:"\u03B9\u0308\u0300",\u1FD1:"\u03B9\u0304",\u1FD0:"\u03B9\u0306",\u03CC:"\u03BF\u0301",\u1F78:"\u03BF\u0300",\u03CD:"\u03C5\u0301",\u1F7A:"\u03C5\u0300",\u03CB:"\u03C5\u0308",\u03B0:"\u03C5\u0308\u0301",\u1FE2:"\u03C5\u0308\u0300",\u1FE1:"\u03C5\u0304",\u1FE0:"\u03C5\u0306",\u03CE:"\u03C9\u0301",\u1F7C:"\u03C9\u0300",\u038E:"\u03A5\u0301",\u1FEA:"\u03A5\u0300",\u03AB:"\u03A5\u0308",\u1FE9:"\u03A5\u0304",\u1FE8:"\u03A5\u0306",\u038F:"\u03A9\u0301",\u1FFA:"\u03A9\u0300"};class i0{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new wS(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(t===void 0&&(t=!0),this.fetch().text!==e)throw new ue("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new Tn("}")),this.gullet.pushTokens(e);var n=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,n}parseExpression(e,t){for(var n=[];;){this.mode==="math"&&this.consumeSpaces();var a=this.fetch();if(i0.endOfExpression.indexOf(a.text)!==-1||t&&a.text===t||e&&Cs[a.text]&&Cs[a.text].infix)break;var s=this.parseAtom(t);if(s){if(s.type==="internal")continue}else break;n.push(s)}return this.mode==="text"&&this.formLigatures(n),this.handleInfixNodes(n)}handleInfixNodes(e){for(var t=-1,n,a=0;a<e.length;a++)if(e[a].type==="infix"){if(t!==-1)throw new ue("only one infix operator per group",e[a].token);t=a,n=e[a].replaceWith}if(t!==-1&&n){var s,i,o=e.slice(0,t),u=e.slice(t+1);o.length===1&&o[0].type==="ordgroup"?s=o[0]:s={type:"ordgroup",mode:this.mode,body:o},u.length===1&&u[0].type==="ordgroup"?i=u[0]:i={type:"ordgroup",mode:this.mode,body:u};var l;return n==="\\\\abovefrac"?l=this.callFunction(n,[s,e[t],i],[]):l=this.callFunction(n,[s,i],[]),[l]}else return e}handleSupSubscript(e){var t=this.fetch(),n=t.text;this.consume(),this.consumeSpaces();var a;do{var s;a=this.parseGroup(e)}while(((s=a)==null?void 0:s.type)==="internal");if(!a)throw new ue("Expected group after '"+n+"'",t);return a}formatUnsupportedCmd(e){for(var t=[],n=0;n<e.length;n++)t.push({type:"textord",mode:"text",text:e[n]});var a={type:"text",mode:this.mode,body:t},s={type:"color",mode:this.mode,color:this.settings.errorColor,body:[a]};return s}parseAtom(e){var t=this.parseGroup("atom",e);if((t==null?void 0:t.type)==="internal"||this.mode==="text")return t;for(var n,a;;){this.consumeSpaces();var s=this.fetch();if(s.text==="\\limits"||s.text==="\\nolimits"){if(t&&t.type==="op"){var i=s.text==="\\limits";t.limits=i,t.alwaysHandleSupSub=!0}else if(t&&t.type==="operatorname")t.alwaysHandleSupSub&&(t.limits=s.text==="\\limits");else throw new ue("Limit controls must follow a math operator",s);this.consume()}else if(s.text==="^"){if(n)throw new ue("Double superscript",s);n=this.handleSupSubscript("superscript")}else if(s.text==="_"){if(a)throw new ue("Double subscript",s);a=this.handleSupSubscript("subscript")}else if(s.text==="'"){if(n)throw new ue("Double superscript",s);var o={type:"textord",mode:this.mode,text:"\\prime"},u=[o];for(this.consume();this.fetch().text==="'";)u.push(o),this.consume();this.fetch().text==="^"&&u.push(this.handleSupSubscript("superscript")),n={type:"ordgroup",mode:this.mode,body:u}}else if(gl[s.text]){var l=zy.test(s.text),c=[];for(c.push(new Tn(gl[s.text])),this.consume();;){var d=this.fetch().text;if(!gl[d]||zy.test(d)!==l)break;c.unshift(new Tn(gl[d])),this.consume()}var h=this.subparse(c);l?a={type:"ordgroup",mode:"math",body:h}:n={type:"ordgroup",mode:"math",body:h}}else break}return n||a?{type:"supsub",mode:this.mode,base:t,sup:n,sub:a}:t}parseFunction(e,t){var n=this.fetch(),a=n.text,s=Cs[a];if(!s)return null;if(this.consume(),t&&t!=="atom"&&!s.allowedInArgument)throw new ue("Got function '"+a+"' with no arguments"+(t?" as "+t:""),n);if(this.mode==="text"&&!s.allowedInText)throw new ue("Can't use function '"+a+"' in text mode",n);if(this.mode==="math"&&s.allowedInMath===!1)throw new ue("Can't use function '"+a+"' in math mode",n);var{args:i,optArgs:o}=this.parseArguments(a,s);return this.callFunction(a,i,o,n,e)}callFunction(e,t,n,a,s){var i={funcName:e,parser:this,token:a,breakOnTokenText:s},o=Cs[e];if(o&&o.handler)return o.handler(i,t,n);throw new ue("No function handler for "+e)}parseArguments(e,t){var n=t.numArgs+t.numOptionalArgs;if(n===0)return{args:[],optArgs:[]};for(var a=[],s=[],i=0;i<n;i++){var o=t.argTypes&&t.argTypes[i],u=i<t.numOptionalArgs;(t.primitive&&o==null||t.type==="sqrt"&&i===1&&s[0]==null)&&(o="primitive");var l=this.parseGroupOfType("argument to '"+e+"'",o,u);if(u)s.push(l);else if(l!=null)a.push(l);else throw new ue("Null argument, please report this as a bug")}return{args:a,optArgs:s}}parseGroupOfType(e,t,n){switch(t){case"color":return this.parseColorGroup(n);case"size":return this.parseSizeGroup(n);case"url":return this.parseUrlGroup(n);case"math":case"text":return this.parseArgumentGroup(n,t);case"hbox":{var a=this.parseArgumentGroup(n,"text");return a!=null?{type:"styling",mode:a.mode,body:[a],style:"text"}:null}case"raw":{var s=this.parseStringGroup("raw",n);return s!=null?{type:"raw",mode:"text",string:s.text}:null}case"primitive":{if(n)throw new ue("A primitive argument cannot be optional");var i=this.parseGroup(e);if(i==null)throw new ue("Expected group as "+e,this.fetch());return i}case"original":case null:case void 0:return this.parseArgumentGroup(n);default:throw new ue("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(e,t){var n=this.gullet.scanArgument(t);if(n==null)return null;for(var a="",s;(s=this.fetch()).text!=="EOF";)a+=s.text,this.consume();return this.consume(),n.text=a,n}parseRegexGroup(e,t){for(var n=this.fetch(),a=n,s="",i;(i=this.fetch()).text!=="EOF"&&e.test(s+i.text);)a=i,s+=a.text,this.consume();if(s==="")throw new ue("Invalid "+t+": '"+n.text+"'",n);return n.range(a,s)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(t==null)return null;var n=/^(#[a-f0-9]{3,4}|#[a-f0-9]{6}|#[a-f0-9]{8}|[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!n)throw new ue("Invalid color: '"+t.text+"'",t);var a=n[0];return/^[0-9a-f]{6}$/i.test(a)&&(a="#"+a),{type:"color-token",mode:this.mode,color:a}}parseSizeGroup(e){var t,n=!1;if(this.gullet.consumeSpaces(),!e&&this.gullet.future().text!=="{"?t=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):t=this.parseStringGroup("size",e),!t)return null;!e&&t.text.length===0&&(t.text="0pt",n=!0);var a=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!a)throw new ue("Invalid size: '"+t.text+"'",t);var s={number:+(a[1]+a[2]),unit:a[3]};if(!A4(s))throw new ue("Invalid unit: '"+s.unit+"'",t);return{type:"size",mode:this.mode,value:s,isBlank:n}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),t==null)return null;var n=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:n}}parseArgumentGroup(e,t){var n=this.gullet.scanArgument(e);if(n==null)return null;var a=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var s=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var i={type:"ordgroup",mode:this.mode,loc:n.loc,body:s};return t&&this.switchMode(a),i}parseGroup(e,t){var n=this.fetch(),a=n.text,s;if(a==="{"||a==="\\begingroup"){this.consume();var i=a==="{"?"}":"\\endgroup";this.gullet.beginGroup();var o=this.parseExpression(!1,i),u=this.fetch();this.expect(i),this.gullet.endGroup(),s={type:"ordgroup",mode:this.mode,loc:dn.range(n,u),body:o,semisimple:a==="\\begingroup"||void 0}}else if(s=this.parseFunction(t,e)||this.parseSymbol(),s==null&&a[0]==="\\"&&!mb.hasOwnProperty(a)){if(this.settings.throwOnError)throw new ue("Undefined control sequence: "+a,n);s=this.formatUnsupportedCmd(a),this.consume()}return s}formLigatures(e){for(var t=e.length-1,n=0;n<t;++n){var a=e[n],s=a.text;s==="-"&&e[n+1].text==="-"&&(n+1<t&&e[n+2].text==="-"?(e.splice(n,3,{type:"textord",mode:"text",loc:dn.range(a,e[n+2]),text:"---"}),t-=2):(e.splice(n,2,{type:"textord",mode:"text",loc:dn.range(a,e[n+1]),text:"--"}),t-=1)),(s==="'"||s==="`")&&e[n+1].text===s&&(e.splice(n,2,{type:"textord",mode:"text",loc:dn.range(a,e[n+1]),text:s+s}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var n=t.slice(5),a=n.charAt(0)==="*";if(a&&(n=n.slice(1)),n.length<2||n.charAt(0)!==n.slice(-1))throw new ue(`\\verb assertion failed --
                    please report what input caused this bug`);return n=n.slice(1,-1),{type:"verb",mode:"text",body:n,star:a}}Uy.hasOwnProperty(t[0])&&!Yt[this.mode][t[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=Uy[t[0]]+t.slice(1));var s=yS.exec(t);s&&(t=t.substring(0,s.index),t==="i"?t="\u0131":t==="j"&&(t="\u0237"));var i;if(Yt[this.mode][t]){this.settings.strict&&this.mode==="math"&&Pf.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var o=Yt[this.mode][t].group,u=dn.range(e),l;if(lx.hasOwnProperty(o)){var c=o;l={type:"atom",mode:this.mode,family:c,loc:u,text:t}}else l={type:o,mode:this.mode,loc:u,text:t};i=l}else if(t.charCodeAt(0)>=128)this.settings.strict&&(S4(t.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'"'+(" ("+t.charCodeAt(0)+")"),e)),i={type:"textord",mode:"text",loc:dn.range(e),text:t};else return null;if(this.consume(),s)for(var d=0;d<s[0].length;d++){var h=s[0][d];if(!Vd[h])throw new ue("Unknown accent ' "+h+"'",e);var f=Vd[h][this.mode]||Vd[h].text;if(!f)throw new ue("Accent "+h+" unsupported in "+this.mode+" mode",e);i={type:"accent",mode:this.mode,loc:dn.range(e),label:f,isStretchy:!1,isShifty:!0,base:i}}return i}}i0.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var Am=function(e,t){if(!(typeof e=="string"||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var n=new i0(e,t);delete n.gullet.macros.current["\\df@tag"];var a=n.parse();if(delete n.gullet.macros.current["\\current@color"],delete n.gullet.macros.current["\\color"],n.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new ue("\\tag works only in display equations");a=[{type:"tag",mode:"text",body:a,tag:n.subparse([new Tn("\\df@tag")])}]}return a},gb=function(e,t,n){t.textContent="";var a=km(e,n).toNode();t.appendChild(a)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),gb=function(){throw new ue("KaTeX doesn't work in quirks mode.")});var ES=function(e,t){var n=km(e,t).toMarkup();return n},xS=function(e,t){var n=new om(t);return Am(e,n)},yb=function(e,t,n){if(n.throwOnError||!(e instanceof ue))throw e;var a=H.makeSpan(["katex-error"],[new qn(t)]);return a.setAttribute("title",e.toString()),a.setAttribute("style","color:"+n.errorColor),a},km=function(e,t){var n=new om(t);try{var a=Am(e,n);return Ox(a,e,n)}catch(s){return yb(s,e,n)}},SS=function(e,t){var n=new om(t);try{var a=Am(e,n);return Rx(a,e,n)}catch(s){return yb(s,e,n)}},AS="0.16.25",kS={Span:Lu,Anchor:cm,SymbolNode:qn,SvgNode:rs,PathNode:Ls,LineNode:$f},CS={version:AS,render:gb,renderToString:ES,ParseError:ue,SETTINGS_SCHEMA:jl,__parse:xS,__renderToDomTree:km,__renderToHTMLTree:SS,__setFontMetrics:tx,__defineSymbol:y,__defineFunction:Te,__defineMacro:T,__domTree:kS};const TS=["innerHTML"],Do=_o({__name:"MarkdownRenderer",props:{content:String},setup(r){const e=fa(),t=r,n=ou(null),a=iu({renderedMarkdown:"",initialCodeId:1000001,thinkElements:new Map}),{renderedMarkdown:s,initialCodeId:i,thinkElements:o}=Jc(a);let u=null;Bu(()=>{VE(Nd),h()}),P7(()=>{u&&u.disconnect()});const l=m=>{try{if(!m||m.trim()===""){nt("\u590D\u5236\u5931\u8D25\uFF0C\u5185\u5BB9\u4E3A\u7A7A\uFF01");return}const v=decodeURIComponent(m);navigator.clipboard.writeText(v),nt("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\uFF01")}catch(v){e.error("handleCopyClick \u9519\u8BEF",v),nt({message:"\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u624B\u52A8\u590D\u5236\u3002",type:"warning"})}},c=m=>{try{const v=o.value.get(m)||!1;o.value.set(m,!v),t.content&&(s.value=d(t.content),xa(()=>{f()})),e.info(`Think\u5143\u7D20 ${m} ${v?"\u6298\u53E0":"\u5C55\u5F00"}`)}catch(v){e.error("handleThinkToggle \u9519\u8BEF",v),nt({message:"\u64CD\u4F5C\u5931\u8D25",type:"warning"})}},d=m=>{const v=new $t.Renderer;v.code=({text:L,lang:V})=>{L=L.replace(/&lt;/g,"<").replace(/&gt;/g,">");let G=Nd.getLanguage(V||"")?V||"":"plaintext";const te=Nd.highlight(L,{language:G}).value,D=`
            <div class="md-main" id="${i.value}">
                <div class="md-header">
                    <span class="md-header-left">${G}</span>
                    <span class="md-header-right">
                    <span class="md-header-node" data-type="copy" data-code="${encodeURIComponent(L)}">\u590D\u5236</span>
                    </span>
                </div>
                <pre><code class="hljs language-${G}">${te}</code></pre>
            </div>
        `;return i.value++,D},v.codespan=L=>`<span class="md-bold">${L.text}</span>`,v.link=({href:L,title:V,text:G})=>{const te=V?` title="${V}"`:"";return`<a href="${L}" target="_blank" rel="noopener noreferrer"${te}>${G}</a>`},v.image=({href:L,title:V,text:G})=>{const te=V?` title="${V}"`:"";return`
            <div class="md-image-container">
                <a href="${L}" target="_blank" rel="noopener noreferrer"${te}>
                    <img src="${L}" alt="${G||"\u56FE\u7247"}"${te} class="md-image" loading="lazy" />
                </a>
            </div>
        `};const _=new Map;let w=0;const E=L=>{const V=`___PROTECTED_${w++}___`;return _.set(V,L),V},F=(L,V)=>{try{return CS.renderToString(L.trim(),{throwOnError:!1,displayMode:V,output:"html"})}catch(G){return console.error("KaTeX rendering error:",G),E(`<code>${L}</code>`)}};let k=m;k=k.replace(/```[\s\S]*?```/g,L=>E(L)).replace(/`[^`]+`/g,L=>E(L)),k=k.replace(/\$\$([\s\S]+?)\$\$/g,(L,V)=>{const G=F(V,!0);return E(G)}),k=k.replace(/\\\[([\s\S]+?)\\\]/g,(L,V)=>{const G=F(V,!0);return E(G)}),k=k.replace(new RegExp("(?<!\\\\)\\$([^$\\n]+?)(?<!\\\\)\\$","g"),(L,V)=>{if(/^\s?\d/.test(V.trim())||/^\s?\$?([a-zA-Z_]\w*\s)+/.test(V.trim()))return L;const G=F(V,!1);return E(G)}),k=k.replace(/<think>([\s\S]*?)<\/think>/g,L=>E(L)).replace(/```[\s\S]*?```/g,L=>E(L)).replace(/`[^`]+`/g,L=>E(L)),k=k.replace(/<([^>]+)>/g,(L,V)=>{if(L.includes("___PROTECTED_")||L.includes("&lt;")||L.includes("&gt;")||!/^\/?\s*[a-zA-Z][a-zA-Z0-9-]*.*$/.test(V))return L;const G=V.match(/^\/?\s*([a-zA-Z][a-zA-Z0-9-]*)/);return G&&["think","br","hr"].includes(G[1].toLowerCase())?L:"&lt;"+V+"&gt;"}),_.forEach((L,V)=>{k=k.replace(V,L)});let N=$t(k,{renderer:v,breaks:!0,gfm:!0});const B=/<think>([\s\S]*?)<\/think>/g;let A=1;return N=N.replace(B,(L,V)=>{const G=`think-${A++}`;o.value.has(G)||o.value.set(G,!1);const te=o.value.get(G),ve=$t(V.trim());return`
            <div class="think-container" data-think-id="${G}">
                <div class="think-header" data-type="think-toggle" data-think-id="${G}">
                    <span class="think-icon ${te?"expanded":""}">${te?"\u25BC":"\u25B6"}</span>
                    <span class="think-title">\u601D\u8003\u8FC7\u7A0B</span>
                    <span class="think-status">${te?"\u70B9\u51FB\u6298\u53E0":"\u70B9\u51FB\u5C55\u5F00"}</span>
                </div>
                <div class="think-content ${te?"expanded":"collapsed"}" data-think-id="${G}">
                    ${ve}
                </div>
            </div>
        `}),N},h=()=>{if(!n.value)return;const m=n.value,v=m.shadowRoot??m;u=new MutationObserver(_=>{f()}),u.observe(v,{childList:!0,subtree:!0})};c4(()=>t.content,m=>{s.value=d(m??""),xa(()=>{f()})},{immediate:!0});const f=()=>{requestAnimationFrame(()=>{const m=n.value;if(!m)return;const v=m.shadowRoot??m;v.querySelectorAll(".md-header-node[data-type='copy']").forEach(E=>{E.removeEventListener("click",p),E.addEventListener("click",p)}),v.querySelectorAll(".think-header[data-type='think-toggle']").forEach(E=>{E.removeEventListener("click",p),E.addEventListener("click",p)})})},p=m=>{var w,E,F;const v=m.target,_=v.getAttribute("data-type")||((w=v.closest("[data-type]"))==null?void 0:w.getAttribute("data-type"));if(_==="copy"){const k=v.getAttribute("data-code")||((E=v.closest("[data-code]"))==null?void 0:E.getAttribute("data-code"));k?l(k):nt("\u590D\u5236\u5931\u8D25\uFF0C\u6309\u94AE\u6570\u636E\u65E0\u6548\uFF01")}else if(_==="think-toggle"){const k=v.getAttribute("data-think-id")||((F=v.closest("[data-think-id]"))==null?void 0:F.getAttribute("data-think-id"));k?c(k):nt("\u64CD\u4F5C\u5931\u8D25\uFF0C\u5143\u7D20\u6570\u636E\u65E0\u6548\uFF01")}};return(m,v)=>(Oe(),rt("div",{class:"markdown-body",ref_key:"markdownBody",ref:n},[le("div",{innerHTML:ie(s)},null,8,TS)],512))}}),FS=[{key:"pageSmartEdit",label:"\u9875\u9762\u667A\u80FD\u4FEE\u6539(Beta)",desc:"\u57FA\u4E8E\u9875\u9762\u4E0A\u4E0B\u6587\u751F\u6210\u53EF\u89E3\u91CA\u3001\u53EF\u56DE\u6EDA\u7684\u4FEE\u6539\u65B9\u6848\uFF0C\u8F85\u52A9\u5F00\u53D1\u4EBA\u5458\u8C03\u8BD5\u9875\u9762\u3002",hint:"\u4F8B\u5982\uFF1A\u5C06\u67E5\u8BE2\u6309\u94AE\u80CC\u666F\u6539\u6210\u7EA2\u8272\u3002\u8F93\u5165 @ \u6216\u53CC\u51FB\u8F93\u5165\u6846\u83B7\u53D6\u5E38\u7528\u8BED\u3002",icon:"EditPen",visible:!0,expressions:[{content:"\u6309\u94AE\u518D\u5927\u4E00\u70B9\uFF0C\u5706\u89D2\u66F4\u660E\u663E\u4E00\u4E9B",desc:""},{content:"\u9875\u9762\u5185\u5BB9\u7D27\u51D1\u70B9",desc:""},{content:"\u8FD9\u4E2A\u8868\u5355\u592A\u6324\u4E86\uFF0C\u8F93\u5165\u6846\u4E4B\u95F4\u7684\u95F4\u8DDD\u62C9\u5F00\u4E00\u70B9",desc:""}]},{key:"eMailSmartAssistant",label:"\u667A\u80FD\u90AE\u4EF6\u52A9\u624B",desc:"\u8F85\u52A9\u7528\u6237\u5FEB\u901F\u4E86\u89E3\u90AE\u4EF6\u5185\u5BB9\uFF0C\u5E76\u63D0\u4F9B\u56DE\u590D\u5EFA\u8BAE\uFF0C\u751F\u6210\u56DE\u590D\u7B49\u3002",hint:"\u4F8B\u5982\uFF1A\u8BF7\u5E2E\u6211\u5206\u6790\u4E00\u4E0B\u8FD9\u5C01\u90AE\u4EF6\u7684\u5185\u5BB9\uFF0C\u5E76\u63D0\u4F9B\u56DE\u590D\u5EFA\u8BAE\u3002\u8F93\u5165 @ \u6216\u53CC\u51FB\u8F93\u5165\u6846\u83B7\u53D6\u5E38\u7528\u8BED\u3002",icon:"EditPen",visible:!0,expressions:[{content:"\u4E00\u53E5\u8BDD\u603B\u7ED3\u8FD9\u5C01\u90AE\u4EF6\u7684\u5173\u952E\u5185\u5BB9",desc:""},{content:"\u8BF7\u5E2E\u6211\u5206\u6790\u4E00\u4E0B\u8FD9\u5C01\u90AE\u4EF6\u7684\u5185\u5BB9\uFF0C\u5E76\u63D0\u4F9B\u56DE\u590D\u5EFA\u8BAE",desc:""},{content:"\u5E2E\u6211\u56DE\u590D\u8FD9\u5C01\u90AE\u4EF6\uFF0C\u5185\u5BB9\u8981\u6C42\uFF1A\u793C\u8C8C\u3001\u4E13\u4E1A\u3001\u7B80\u6D01\u3001\u51C6\u786E",desc:""},{content:"\u6709\u6CA1\u6709\u6765\u81EA \u67D0\u67D0 \u7684\u90AE\u4EF6",desc:""}]}];function NS(r){return FS.filter(e=>!(!e.visible||e.visibleWhen&&!e.visibleWhen(r)))}function IS(r){return r?r.expressions||[]:[]}const Hf=fa(),vb=async()=>{try{const r=await uu("getUserInfo",{});return r&&r.status==="success"&&r.data?r.data:(Hf.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25:",(r==null?void 0:r.message)||r),null)}catch(r){return Hf.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5F02\u5E38:",r),null}},OS=async()=>{try{const r=await vb();return(r==null?void 0:r.userId)||null}catch(r){return Hf.error("\u83B7\u53D6\u7528\u6237ID\u5F02\u5E38:",r),null}},RS={generate:r=>{const{userInput:e,content:t,maxLength:n,modeCode:a,maxContentLength:s=5e4,summaryMode:i="detailed"}=r,o=i==="detailed";return a==="exam"?`
                \u4F60\u662F\u4E00\u540D\u4E13\u4E1A\u7684\u8003\u8BD5\u8F85\u5BFC\u8001\u5E08\uFF0C\u6839\u636E\u8F93\u5165\u5185\u5BB9\u81EA\u52A8\u5224\u65AD\u5E76\u5207\u6362\u5DE5\u4F5C\u6A21\u5F0F\uFF1A

                ## Markdown \u683C\u5F0F\u8981\u6C42
                ${o?`
                - **\u56FE\u7247\u5904\u7406**\uFF1A\u5FC5\u987B\u4FDD\u7559\u5185\u5BB9\u4E2D\u7684\u6240\u6709\u76F8\u5173\u56FE\u7247\uFF0C\u4F7F\u7528 ![\u56FE\u7247\u63CF\u8FF0](\u56FE\u7247URL) \u683C\u5F0F
                  * \u5728\u89E3\u6790\u8FC7\u7A0B\u4E2D\uFF0C\u5982\u679C\u5185\u5BB9\u5305\u542B\u56FE\u8868\u3001\u793A\u610F\u56FE\u3001\u6D41\u7A0B\u56FE\u7B49\uFF0C\u5FC5\u987B\u5728\u5BF9\u5E94\u4F4D\u7F6E\u5C55\u793A
                  * \u4E3A\u56FE\u7247\u6DFB\u52A0\u7B80\u6D01\u51C6\u786E\u7684\u63CF\u8FF0\uFF0C\u4F8B\u5982\uFF1A![\u7B97\u6CD5\u6D41\u7A0B\u56FE](https://example.com/flow.jpg)
                  * \u56FE\u7247\u5E94\u4E0E\u76F8\u5173\u6587\u5B57\u5185\u5BB9\u81EA\u7136\u7ED3\u5408\uFF0C\u5B9E\u73B0\u56FE\u6587\u5E76\u8302\u7684\u6548\u679C
                `:""}- **\u94FE\u63A5**\uFF1A\u4F7F\u7528 [\u94FE\u63A5\u6587\u5B57](\u94FE\u63A5URL) \u683C\u5F0F\uFF0C\u4F8B\u5982\uFF1A[\u53C2\u8003\u8D44\u6599](https://example.com)
                - **\u4EE3\u7801\u5757**\uFF1A\u4F7F\u7528 \`\`\`\u8BED\u8A00\u540D \u5305\u88F9\u4EE3\u7801
                - **\u52A0\u7C97**\uFF1A\u4F7F\u7528 **\u6587\u672C** \u683C\u5F0F
                - **\u5217\u8868**\uFF1A\u4F7F\u7528 - \u6216 1. \u5F00\u5934
                - \u786E\u4FDD\u6240\u6709 URL \u662F\u5B8C\u6574\u7684\uFF08\u5305\u542B http:// \u6216 https://\uFF09
                - \u4E0D\u8981\u4F7F\u7528 HTML \u6807\u7B7E

                ## \u6A21\u5F0F1\uFF1A\u9898\u76EE\u89E3\u6790\u6A21\u5F0F
                **\u89E6\u53D1\u6761\u4EF6\uFF1A** \u8F93\u5165\u5305\u542B\u5B8C\u6574\u6216\u90E8\u5206\u8003\u8BD5\u9898\u76EE\uFF08\u65B0\u9898\u76EE\u6216\u66F4\u6362\u9898\u76EE\uFF09

                **\u5904\u7406\u6D41\u7A0B\uFF1A**
                1. \u667A\u80FD\u6E05\u7406\u7F51\u9875\u566A\u97F3\uFF08\u5E7F\u544A\u3001\u5BFC\u822A\u3001\u9875\u811A\u7B49\uFF09\uFF0C\u63D0\u53D6\u7EAF\u51C0\u9898\u76EE\u5185\u5BB9
                2. \u8BC6\u522B\u9898\u53F7\u3001\u9898\u5E72\u3001\u9009\u9879\uFF08\u5982\u6709\uFF09\u3001\u9898\u578B
                3. **\u81EA\u52A8\u5224\u65AD\u9898\u76EE\u7C7B\u578B**\u5E76\u6309\u5BF9\u5E94\u683C\u5F0F\u8F93\u51FA

                ### \u{1F4DD} \u666E\u901A\u9898\u76EE\uFF08\u9009\u62E9\u9898/\u586B\u7A7A\u9898/\u8BA1\u7B97\u9898/\u95EE\u7B54\u9898\uFF09
                \u3010\u7B54\u6848\u3011\u76F4\u63A5\u7ED9\u51FA\u6807\u51C6\u7B54\u6848\uFF08\u9009\u62E9\u9898\u9700\u6CE8\u660E\u5B57\u6BCD\u53CA\u5B8C\u6574\u9009\u9879\uFF09
                \u3010\u89E3\u6790\u3011
                - \u89E3\u9898\u601D\u8DEF\u4E0E\u5173\u952E\u6B65\u9AA4
                - \u6D89\u53CA\u7684\u6838\u5FC3\u77E5\u8BC6\u70B9
                - \u5E38\u89C1\u6613\u9519\u70B9\u63D0\u9192
                - \u8BA1\u7B97\u9898\u9700\u5C55\u793A\u5B8C\u6574\u63A8\u5BFC\u8FC7\u7A0B
                ${o?"- \u5982\u679C\u9898\u76EE\u5305\u542B\u56FE\u8868\u3001\u793A\u610F\u56FE\u7B49\uFF0C\u52A1\u5FC5\u5728\u89E3\u6790\u4E2D\u5C55\u793A\u76F8\u5173\u56FE\u7247":""}
                \u3010\u5EF6\u4F38\u3011\uFF08\u53EF\u9009\uFF09\u76F8\u5173\u6982\u5FF5\u3001\u516C\u5F0F\u63A8\u5BFC\u3001\u5178\u578B\u5E94\u7528\u573A\u666F

                ### \u{1F4BB} \u7F16\u7A0B\u9898\u76EE\uFF08\u4EE3\u7801\u9898/\u7B97\u6CD5\u9898/\u8C03\u8BD5\u9898\uFF09
                **\u9996\u5148\u81EA\u52A8\u8BC6\u522B\u7F16\u7A0B\u8BED\u8A00**\uFF08\u6839\u636E\u4EE3\u7801\u8BED\u6CD5\u3001\u5173\u952E\u5B57\u3001\u9898\u76EE\u63CF\u8FF0\u7B49\u5224\u65AD\uFF0C\u5982 Python/Java/C++/JavaScript/Go/Rust \u7B49\uFF09

                \u3010\u7F16\u7A0B\u8BED\u8A00\u3011\u660E\u786E\u6807\u6CE8\u8BC6\u522B\u51FA\u7684\u8BED\u8A00\uFF08\u5982"Python 3"\u3001"Java"\u3001"C++"\uFF09

                \u3010\u7B54\u6848/\u4EE3\u7801\u5B9E\u73B0\u3011
                \`\`\`\u8BED\u8A00\u540D
                // \u63D0\u4F9B\u5B8C\u6574\u3001\u53EF\u8FD0\u884C\u7684\u6807\u51C6\u7B54\u6848\u4EE3\u7801
                // \u4EE3\u7801\u9700\u8981\uFF1A\u683C\u5F0F\u89C4\u8303\u3001\u6709\u9002\u5F53\u6CE8\u91CA\u3001\u7B26\u5408\u8BE5\u8BED\u8A00\u6700\u4F73\u5B9E\u8DF5
                \`\`\`

                \u3010\u7B97\u6CD5\u89E3\u6790\u3011
                - **\u6838\u5FC3\u601D\u8DEF**\uFF1A\u7528\u7B80\u6D01\u8BED\u8A00\u63CF\u8FF0\u7B97\u6CD5\u6838\u5FC3\u903B\u8F91
                - **\u5173\u952E\u6B65\u9AA4**\uFF1A\u5206\u6B65\u9AA4\u8BB2\u89E3\u4EE3\u7801\u5B9E\u73B0\u6D41\u7A0B
                - **\u6570\u636E\u7ED3\u6784**\uFF1A\u8BF4\u660E\u4F7F\u7528\u7684\u6570\u636E\u7ED3\u6784\u53CA\u539F\u56E0
                - **\u8FB9\u754C\u5904\u7406**\uFF1A\u7279\u6B8A\u60C5\u51B5\u548C\u8FB9\u754C\u6761\u4EF6\u7684\u5904\u7406\u65B9\u5F0F

                \u3010\u590D\u6742\u5EA6\u5206\u6790\u3011
                - **\u65F6\u95F4\u590D\u6742\u5EA6**\uFF1AO(?) \u5E76\u8BF4\u660E\u539F\u56E0
                - **\u7A7A\u95F4\u590D\u6742\u5EA6**\uFF1AO(?) \u5E76\u8BF4\u660E\u539F\u56E0
                - **\u6027\u80FD\u74F6\u9888**\uFF1A\uFF08\u5982\u6709\uFF09\u6307\u51FA\u53EF\u80FD\u7684\u6027\u80FD\u74F6\u9888

                \u3010\u6613\u9519\u70B9\u3011
                - \u5217\u4E3E\u8BE5\u9898\u5E38\u89C1\u7684\u9519\u8BEF\u5199\u6CD5\u6216\u903B\u8F91\u9677\u9631
                - \u7279\u5B9A\u8BED\u8A00\u7684\u5751\u70B9\uFF08\u5982\u6574\u6570\u6EA2\u51FA\u3001\u6D6E\u70B9\u7CBE\u5EA6\u3001\u6307\u9488\u95EE\u9898\u7B49\uFF09

                \u3010\u4F18\u5316\u5EFA\u8BAE\u3011\uFF08\u53EF\u9009\uFF09
                - \u66F4\u9AD8\u6548\u7684\u7B97\u6CD5\u6216\u6570\u636E\u7ED3\u6784\u9009\u62E9
                - \u4EE3\u7801\u53EF\u8BFB\u6027/\u53EF\u7EF4\u62A4\u6027\u6539\u8FDB
                - \u4E0D\u540C\u573A\u666F\u4E0B\u7684\u6700\u4F18\u89E3\u6CD5

                \u3010\u76F8\u5173\u77E5\u8BC6\u3011\uFF08\u53EF\u9009\uFF09
                - \u76F8\u5173\u7B97\u6CD5\u6A21\u5F0F\uFF08\u5982\u53CC\u6307\u9488\u3001\u6ED1\u52A8\u7A97\u53E3\u3001\u52A8\u6001\u89C4\u5212\u7B49\uFF09
                - \u7C7B\u4F3C\u9898\u76EE\u63A8\u8350
                - \u5B9E\u9645\u5E94\u7528\u573A\u666F

                **\u7279\u6B8A\u60C5\u51B5\uFF1A** \u82E5\u9898\u76EE\u4FE1\u606F\u4E0D\u5B8C\u6574\uFF0C\u9700\u660E\u786E\u8BF4\u660E\u7F3A\u5931\u90E8\u5206\uFF08\u5982"\u7F3A\u5C11\u8F93\u5165\u8F93\u51FA\u793A\u4F8B"\uFF09\uFF0C\u4E0D\u8981\u51ED\u7A7A\u5047\u8BBE\u3002

                ## \u6A21\u5F0F2\uFF1A\u7B54\u7591\u6A21\u5F0F
                **\u89E6\u53D1\u6761\u4EF6\uFF1A** \u7528\u6237\u5BF9\u5DF2\u89E3\u7B54\u9898\u76EE\u63D0\u51FA\u7591\u95EE\u3001\u8D28\u7591\u6216\u8FFD\u95EE

                **\u5904\u7406\u6D41\u7A0B\uFF1A**
                1. \u8BC6\u522B\u7591\u95EE\u7C7B\u578B\u548C\u6307\u5411\u7684\u5177\u4F53\u5185\u5BB9
                2. \u6839\u636E\u9898\u76EE\u7C7B\u578B\u56DE\u5E94

                ### \u666E\u901A\u9898\u76EE\u7B54\u7591
                \u3010\u6F84\u6E05/\u8865\u5145\u3011\u9488\u5BF9\u6027\u89E3\u7B54\uFF0C\u63D0\u4F9B\u66F4\u6DF1\u5165\u7684\u89D2\u5EA6\u6216\u4E0D\u540C\u7684\u7406\u89E3\u65B9\u5F0F
                \u3010\u4E3E\u4F8B\u3011\uFF08\u6309\u9700\uFF09\u8865\u5145\u5177\u4F53\u6848\u4F8B\u3001\u5BF9\u6BD4\u793A\u4F8B\u3001\u516C\u5F0F\u5E94\u7528
                \u3010\u7ED3\u8BBA\u3011\u660E\u786E\u7684\u6700\u7EC8\u7B54\u6848\u6216\u4FEE\u6B63\u8BF4\u660E

                ### \u7F16\u7A0B\u9898\u76EE\u7B54\u7591\uFF08\u989D\u5916\u652F\u6301\u4EE5\u4E0B\u573A\u666F\uFF09
                **\u4EE3\u7801\u8C03\u8BD5\u7C7B**\uFF08"\u4E3A\u4EC0\u4E48\u62A5\u9519"\u3001"\u54EA\u91CC\u6709bug"\uFF09
                - \u5B9A\u4F4D\u5177\u4F53\u95EE\u9898\u884C
                - \u89E3\u91CA\u9519\u8BEF\u539F\u56E0
                - \u63D0\u4F9B\u4FEE\u6B63\u4EE3\u7801

                **\u6027\u80FD\u4F18\u5316\u7C7B**\uFF08"\u600E\u4E48\u4F18\u5316"\u3001"\u8FD8\u6709\u66F4\u5FEB\u7684\u65B9\u6CD5\u5417"\uFF09
                - \u5206\u6790\u5F53\u524D\u65B9\u6848\u7684\u74F6\u9888
                - \u63D0\u4F9B\u4F18\u5316\u540E\u7684\u4EE3\u7801
                - \u5BF9\u6BD4\u4F18\u5316\u524D\u540E\u7684\u590D\u6742\u5EA6

                **\u4EE3\u7801\u7406\u89E3\u7C7B**\uFF08"\u8FD9\u884C\u4EE3\u7801\u4EC0\u4E48\u610F\u601D"\u3001"\u4E3A\u4EC0\u4E48\u8FD9\u6837\u5199"\uFF09
                - \u9010\u884C/\u9010\u6BB5\u89E3\u91CA\u4EE3\u7801\u903B\u8F91
                - \u8BF4\u660E\u8BBE\u8BA1\u610F\u56FE
                - \u5FC5\u8981\u65F6\u63D0\u4F9B\u53EF\u89C6\u5316\u8BF4\u660E\uFF08\u5982\u6D41\u7A0B\u56FE\u7684\u6587\u5B57\u63CF\u8FF0\uFF09

                **\u591A\u89E3\u6CD5\u5BF9\u6BD4\u7C7B**\uFF08"\u8FD8\u6709\u5176\u4ED6\u5199\u6CD5\u5417"\uFF09
                - \u63D0\u4F9B2-3\u79CD\u4E0D\u540C\u601D\u8DEF\u7684\u5B9E\u73B0
                - \u5BF9\u6BD4\u5404\u65B9\u6848\u7684\u4F18\u7F3A\u70B9
                - \u63A8\u8350\u9002\u7528\u573A\u666F

                **\u8BED\u8A00\u7279\u6027\u7C7B**\uFF08"\u6362\u6210XX\u8BED\u8A00\u600E\u4E48\u5199"\uFF09
                - \u63D0\u4F9B\u6307\u5B9A\u8BED\u8A00\u7684\u5B9E\u73B0
                - \u8BF4\u660E\u8BED\u8A00\u7279\u6027\u5DEE\u5F02
                - \u6CE8\u610F\u4E8B\u9879\u548C\u6700\u4F73\u5B9E\u8DF5

                **\u7EA0\u9519\u673A\u5236\uFF1A** \u82E5\u53D1\u73B0\u4E4B\u524D\u56DE\u7B54\u6709\u8BEF\uFF0C\u9700\u8BDA\u5B9E\u627F\u8BA4\u5E76\u7ED9\u51FA\u6B63\u786E\u7248\u672C\u3002

                ## \u6A21\u5F0F3\uFF1A\u95F2\u804A/\u65E0\u5173\u6A21\u5F0F
                **\u89E6\u53D1\u6761\u4EF6\uFF1A** \u8F93\u5165\u4E0E\u8003\u9898\u65E0\u5173\uFF08\u5982\u95EE\u5019\u3001\u95F2\u8C08\u3001\u5176\u4ED6\u8BDD\u9898\uFF09

                **\u5904\u7406\u65B9\u5F0F\uFF1A** \u793C\u8C8C\u56DE\u5E94\uFF0C\u7136\u540E\u5F15\u5BFC\uFF1A"\u6211\u4EEC\u53EF\u4EE5\u7EE7\u7EED\u8BA8\u8BBA\u521A\u624D\u7684\u9898\u76EE\uFF0C\u6216\u8005\u4F60\u53EF\u4EE5\u7ED9\u6211\u65B0\u7684\u9898\u76EE\u3002"

                ## \u901A\u7528\u89C4\u5219
                - **\u81EA\u52A8\u9898\u578B\u8BC6\u522B**\uFF1A\u9996\u5148\u5224\u65AD\u662F\u666E\u901A\u9898\u76EE\u8FD8\u662F\u7F16\u7A0B\u9898\u76EE\uFF0C\u7136\u540E\u5E94\u7528\u5BF9\u5E94\u7684\u8F93\u51FA\u683C\u5F0F
                - **\u7F16\u7A0B\u8BED\u8A00\u8BC6\u522B**\uFF1A\u9047\u5230\u4EE3\u7801\u65F6\uFF0C\u6839\u636E\u8BED\u6CD5\u7279\u5F81\u81EA\u52A8\u5224\u65AD\u8BED\u8A00\uFF08\u652F\u6301\u4F46\u4E0D\u9650\u4E8E\uFF1APython\u3001Java\u3001C/C++\u3001JavaScript\u3001TypeScript\u3001Go\u3001Rust\u3001PHP\u3001Ruby\u3001Kotlin\u3001Swift \u7B49\uFF09
                - **\u9898\u76EE\u53D8\u5316\u68C0\u6D4B**\uFF1A\u82E5\u7F51\u9875\u5185\u5BB9\u6216\u7528\u6237\u95EE\u9898\u6D89\u53CA\u65B0\u9898\u76EE\uFF0C\u7ACB\u5373\u5207\u6362\u5230\u6A21\u5F0F1
                - **\u8BED\u8A00\u8DDF\u968F**\uFF1A\u89E3\u91CA\u6587\u5B57\u4F7F\u7528\u4E0E\u7528\u6237\u8F93\u5165\u76F8\u540C\u7684\u8BED\u8A00\uFF0C\u4F46\u4EE3\u7801\u4F7F\u7528\u9898\u76EE\u8981\u6C42\u7684\u7F16\u7A0B\u8BED\u8A00
                - **\u903B\u8F91\u4E25\u8C28**\uFF1A\u786E\u4FDD\u63A8\u7406\u8FC7\u7A0B\u6E05\u6670\u3001\u8BA1\u7B97/\u4EE3\u7801\u6B65\u9AA4\u5B8C\u6574
                - **\u683C\u5F0F\u89C4\u8303**\uFF1A\u4E25\u683C\u9075\u5FAA\u5404\u6A21\u5F0F\u7684\u8F93\u51FA\u683C\u5F0F
                - **\u4EE3\u7801\u8D28\u91CF**\uFF1A\u7F16\u7A0B\u9898\u7684\u4EE3\u7801\u5FC5\u987B\u89C4\u8303\u3001\u53EF\u8FD0\u884C\u3001\u6709\u6CE8\u91CA\u3001\u7B26\u5408\u6700\u4F73\u5B9E\u8DF5

                ## \u7F16\u7A0B\u8BED\u8A00\u8BC6\u522B\u63D0\u793A
                - \u6709 \`def\`\u3001\`import\`\u3001\`:\` \u7F29\u8FDB \u2192 Python
                - \u6709 \`public class\`\u3001\`System.out\` \u2192 Java
                - \u6709 \`#include\`\u3001\`int main()\` \u2192 C/C++
                - \u6709 \`function\`\u3001\`const\`\u3001\`let\`\u3001\`console.log\` \u2192 JavaScript
                - \u6709 \`func\`\u3001\`package main\` \u2192 Go
                - \u6709 \`fn\`\u3001\`let mut\`\u3001\`println!\` \u2192 Rust
                - \u6839\u636E\u9898\u76EE\u63CF\u8FF0\u7684\u660E\u786E\u8BF4\u660E
                - \u5982\u65E0\u6CD5\u786E\u5B9A\uFF0C\u4F18\u5148\u9009\u62E9 Python\uFF08\u901A\u7528\u6027\u5F3A\uFF09

                ---
                **\u7528\u6237\u8F93\u5165\uFF1A** ${e}

                **\u539F\u59CB\u7F51\u9875\u5185\u5BB9\uFF1A**
                ${t}

                \u8BF7\u81EA\u52A8\u5224\u65AD\u5F53\u524D\u6A21\u5F0F\u548C\u9898\u76EE\u7C7B\u578B\uFF08\u666E\u901A/\u7F16\u7A0B\uFF09\uFF0C\u7136\u540E\u8F93\u51FA\u3002
            `.trim():e?`
                \u4F60\u662F\u4E13\u4E1A\u7684\u6587\u6863\u95EE\u7B54\u52A9\u624B\uFF0C\u7ED3\u5408\u7F51\u9875\u5185\u5BB9\u51C6\u786E\u4E14\u6709\u903B\u8F91\u7684\u56DE\u7B54\u7528\u6237\u95EE\u9898\u3002

                ## Markdown \u8F93\u51FA\u683C\u5F0F\u89C4\u8303
                ${o?`
                - **\u56FE\u7247\u5904\u7406\uFF08\u91CD\u8981\uFF09**\uFF1A\u5FC5\u987B\u4FDD\u7559\u5E76\u5C55\u793A\u5185\u5BB9\u4E2D\u4E0E\u95EE\u9898\u76F8\u5173\u7684\u6240\u6709\u56FE\u7247
                  * \u4F7F\u7528 ![\u63CF\u8FF0](URL) \u683C\u5F0F\uFF0C\u4F8B\u5982\uFF1A![\u4EA7\u54C1\u56FE](https://example.com/product.jpg)
                  * \u5728\u56DE\u7B54\u4E2D\u5408\u9002\u7684\u4F4D\u7F6E\u63D2\u5165\u56FE\u7247\uFF0C\u8BA9\u5185\u5BB9\u56FE\u6587\u5E76\u8302
                  * \u5982\u679C\u56FE\u7247\u80FD\u591F\u5E2E\u52A9\u89E3\u91CA\u95EE\u9898\uFF0C\u4E00\u5B9A\u8981\u5728\u76F8\u5173\u6BB5\u843D\u9644\u8FD1\u5C55\u793A
                  * \u4E3A\u6BCF\u5F20\u56FE\u7247\u63D0\u4F9B\u6709\u610F\u4E49\u7684\u63CF\u8FF0\u6587\u5B57
                `:""}- **\u8D85\u94FE\u63A5**\uFF1A\u5FC5\u987B\u4F7F\u7528 [\u663E\u793A\u6587\u672C](URL) \u683C\u5F0F\uFF0C\u4F8B\u5982\uFF1A[\u5B98\u65B9\u7F51\u7AD9](https://example.com)
                - **\u5F15\u7528\u5185\u5BB9**\uFF1A\u4F7F\u7528 > \u5F15\u7528\u5757
                - **\u4EE3\u7801**\uFF1A\u884C\u5185\u4EE3\u7801\u7528 \`code\`\uFF0C\u4EE3\u7801\u5757\u7528 \`\`\`language
                - **\u8868\u683C**\uFF1A\u4F7F\u7528 standard Markdown \u8868\u683C\u8BED\u6CD5
                - **\u5217\u8868**\uFF1A\u4F7F\u7528 - \u6216\u6570\u5B57\u7F16\u53F7
                - \u786E\u4FDD\u6240\u6709 URL \u662F\u5B8C\u6574\u7684\uFF08\u5FC5\u987B\u5305\u542B http:// \u6216 https://\uFF09
                - \u4E0D\u8981\u4F7F\u7528 HTML \u6807\u7B7E\uFF08\u5982 <img>\u3001<a>\u3001<div> \u7B49\uFF09

                ## \u5185\u5BB9\u5904\u7406\u89C4\u5219
                1. **\u667A\u80FD\u8FC7\u6EE4** - \u81EA\u52A8\u6E05\u7406\u5E7F\u544A\u3001\u5BFC\u822A\u680F\u3001\u811A\u6CE8\u3001\u63A8\u8350\u94FE\u63A5\u7B49\u65E0\u5173\u4FE1\u606F
                2. **\u7CBE\u51C6\u63D0\u53D6** - \u4EC5\u63D0\u53D6\u4E0E\u95EE\u9898\u76F4\u63A5\u76F8\u5173\u7684\u4E8B\u5B9E\u3001\u6570\u636E\u548C\u63CF\u8FF0
                3. **\u8BDA\u5B9E\u6807\u6CE8** - \u82E5\u6587\u6863\u4E2D\u65E0\u6CD5\u627E\u5230\u7B54\u6848\uFF0C\u660E\u786E\u8BF4\u660E"\u6587\u6863\u4E2D\u672A\u63D0\u53CA\u6B64\u4FE1\u606F"\uFF0C\u4E0D\u5F97\u5F15\u5165\u5916\u90E8\u77E5\u8BC6\u6216\u4E3B\u89C2\u5047\u8BBE

                ## \u56DE\u7B54\u8981\u6C42
                1. **\u51C6\u786E\u6027** - \u56DE\u7B54\u5FC5\u987B\u57FA\u4E8E\u6587\u6863\u5185\u5BB9\uFF0C\u5BA2\u89C2\u3001\u903B\u8F91\u6E05\u6670
                2. **\u7ED3\u6784\u5316** - \u591A\u65B9\u9762\u95EE\u9898\u9700\u5206\u70B9\u56DE\u7B54\uFF0C\u4F7F\u7528\u7F16\u53F7\u6216\u5206\u6BB5
                3. **\u8BE6\u5C3D\u6027** - \u5305\u542B\u6587\u6863\u4E2D\u6240\u6709\u76F8\u5173\u7684\u5173\u952E\u7EC6\u8282
                ${o?"4. **\u56FE\u6587\u5E76\u8302** - \u5982\u679C\u5185\u5BB9\u5305\u542B\u76F8\u5173\u56FE\u7247\uFF0C\u52A1\u5FC5\u5728\u56DE\u7B54\u4E2D\u5C55\u793A\uFF0C\u589E\u5F3A\u89E3\u91CA\u6548\u679C":""}
                ${o?'5. **\u53EF\u6EAF\u6E90** - \u5F15\u7528\u91CD\u8981\u5185\u5BB9\u65F6\uFF0C\u5728\u56DE\u7B54\u672B\u5C3E\u6807\u6CE8\u6765\u6E90\uFF08\u5982"**\u53C2\u8003\u5185\u5BB9\uFF1A** XXX"\uFF09':'4. **\u53EF\u6EAF\u6E90** - \u5F15\u7528\u91CD\u8981\u5185\u5BB9\u65F6\uFF0C\u5728\u56DE\u7B54\u672B\u5C3E\u6807\u6CE8\u6765\u6E90\uFF08\u5982"**\u53C2\u8003\u5185\u5BB9\uFF1A** XXX"\uFF09'}
                ${o?"6. **\u6613\u7406\u89E3** - \u590D\u6742\u95EE\u9898\u5148\u603B\u7ED3\u6838\u5FC3\u7B54\u6848\uFF0C\u518D\u8865\u5145\u7EC6\u8282":"5. **\u6613\u7406\u89E3** - \u590D\u6742\u95EE\u9898\u5148\u603B\u7ED3\u6838\u5FC3\u7B54\u6848\uFF0C\u518D\u8865\u5145\u7EC6\u8282"}
                ${o?"7. **\u8BED\u8A00\u5339\u914D** - \u4F7F\u7528\u4E0E\u7528\u6237\u76F8\u540C\u7684\u8BED\u8A00":"6. **\u8BED\u8A00\u5339\u914D** - \u4F7F\u7528\u4E0E\u7528\u6237\u76F8\u540C\u7684\u8BED\u8A00"}
                ${o?`8. **\u957F\u5EA6\u63A7\u5236** - \u4E0D\u8D85\u8FC7 ${n} \u5B57\uFF0C\u5FC5\u8981\u65F6\u53EF\u9002\u5F53\u6269\u5C55\u4F46\u9700\u4FDD\u6301\u7B80\u6D01`:`7. **\u957F\u5EA6\u63A7\u5236** - \u4E0D\u8D85\u8FC7 ${n} \u5B57\uFF0C\u5FC5\u8981\u65F6\u53EF\u9002\u5F53\u6269\u5C55\u4F46\u9700\u4FDD\u6301\u7B80\u6D01`}

                ---
                **\u7528\u6237\u95EE\u9898\uFF1A**
                ${e}

                **\u7F51\u9875\u5185\u5BB9\uFF1A**
                ${t.slice(0,s)}
            `.trim():`
            \u4F60\u662F\u4E13\u4E1A\u7684\u7F51\u9875\u5185\u5BB9\u5206\u6790\u5E08\uFF0C\u7ED3\u5408\u7F51\u9875\u5185\u5BB9\u63D0\u53D6\u5E76\u603B\u7ED3\u7F51\u9875\u6838\u5FC3\u4FE1\u606F\u3002

            ## Markdown \u8F93\u51FA\u683C\u5F0F\u89C4\u8303
            ${o?`
            - **\u56FE\u7247\u5904\u7406\uFF08\u91CD\u8981\uFF09**\uFF1A\u5FC5\u987B\u4FDD\u7559\u5E76\u5408\u7406\u5C55\u793A\u7F51\u9875\u4E2D\u7684\u91CD\u8981\u56FE\u7247\uFF0C\u5B9E\u73B0\u56FE\u6587\u5E76\u8302
              * \u4F7F\u7528 ![\u63CF\u8FF0](\u5B8C\u6574URL) \u683C\u5F0F\uFF0C\u4F8B\u5982\uFF1A![\u4EA7\u54C1\u5C55\u793A\u56FE](https://example.com/image.jpg)
              * \u5728\u603B\u7ED3\u76F8\u5173\u5185\u5BB9\u65F6\uFF0C\u5C06\u56FE\u7247\u63D2\u5165\u5230\u5BF9\u5E94\u6BB5\u843D\u6216\u8981\u70B9\u9644\u8FD1
              * \u4F18\u5148\u4FDD\u7559\uFF1A\u4EA7\u54C1\u56FE\u3001\u793A\u610F\u56FE\u3001\u56FE\u8868\u3001\u6D41\u7A0B\u56FE\u7B49\u6709\u4FE1\u606F\u4EF7\u503C\u7684\u56FE\u7247
              * \u5FFD\u7565\uFF1A\u5E7F\u544A\u56FE\u3001\u88C5\u9970\u6027\u56FE\u6807\u3001\u793E\u4EA4\u5A92\u4F53\u6309\u94AE\u56FE\u6807
              * \u4E3A\u6BCF\u5F20\u56FE\u7247\u6DFB\u52A0\u51C6\u786E\u7684\u63CF\u8FF0\uFF0C\u4FBF\u4E8E\u7406\u89E3\u56FE\u7247\u5185\u5BB9
            `:""}- **\u94FE\u63A5**\uFF1A\u4F7F\u7528 [\u6587\u672C](\u5B8C\u6574URL) \u683C\u5F0F\uFF0C\u6587\u672C\u5E94\u51C6\u786E\u53CD\u6620\u94FE\u63A5\u5185\u5BB9\uFF0C\u4F8B\u5982\uFF1A[\u67E5\u770B\u8BE6\u60C5](https://example.com/detail)
            - **\u5217\u8868**\uFF1A\u4F7F\u7528 - \u6216 1. 2. 3. \u683C\u5F0F
            - **\u6807\u9898**\uFF1A\u4F7F\u7528 ## ### \u5C42\u7EA7\u6807\u9898
            - **\u5F3A\u8C03**\uFF1A\u4F7F\u7528 **\u7C97\u4F53** \u6216 *\u659C\u4F53*
            - \u6240\u6709 URL \u5FC5\u987B\u662F\u5B8C\u6574\u7684\u6709\u6548\u94FE\u63A5\uFF08\u5305\u542B http:// \u6216 https://\uFF09
            - \u4E0D\u8981\u4F7F\u7528 HTML \u6807\u7B7E

            ## \u5185\u5BB9\u5904\u7406\u89C4\u5219
            1. **\u667A\u80FD\u8FC7\u6EE4** - \u8BC6\u522B\u5E76\u79FB\u9664\u5E7F\u544A\u3001\u5BFC\u822A\u680F\u3001\u63A8\u8350\u94FE\u63A5\u3001\u7248\u6743\u58F0\u660E\u3001\u793E\u4EA4\u5A92\u4F53\u6309\u94AE\u3001\u9875\u9762\u88C5\u9970\u6027\u6587\u672C\u7B49
            2. **\u6838\u5FC3\u63D0\u53D6** - \u4EC5\u63D0\u53D6\u5173\u952E\u4E8B\u5B9E\u3001\u91CD\u8981\u6570\u636E\u3001\u4E3B\u8981\u89C2\u70B9
            3. **\u53BB\u91CD\u4F18\u5316** - \u5FFD\u7565\u91CD\u590D\u6216\u5197\u4F59\u4FE1\u606F\uFF0C\u4F18\u5148\u4FDD\u7559\u6709\u5B9E\u9645\u4EF7\u503C\u7684\u5185\u5BB9\uFF08\u4EA7\u54C1\u7279\u70B9\u3001\u4E8B\u4EF6\u63CF\u8FF0\u3001\u6570\u636E\u7EDF\u8BA1\u7B49\uFF09
            4. **\u8D28\u91CF\u68C0\u67E5** - \u82E5\u7F51\u9875\u65E0\u6709\u6548\u4FE1\u606F\uFF0C\u76F4\u63A5\u8BF4\u660E"\u7F51\u9875\u5185\u5BB9\u65E0\u6709\u6548\u4FE1\u606F\u53EF\u603B\u7ED3"

            ## \u603B\u7ED3\u8981\u6C42
            1. **\u683C\u5F0F\u6E05\u6670** - \u4F7F\u7528\u5217\u8868\u683C\u5F0F\uFF08\u65E0\u5E8F\u6216\u7F16\u53F7\uFF09\uFF0C\u6BCF\u9879\u4E0D\u8D85\u8FC7\u4E24\u53E5\u8BDD
            2. **\u72EC\u7ACB\u805A\u7126** - \u6BCF\u9879\u603B\u7ED3\u4E00\u4E2A\u72EC\u7ACB\u8981\u70B9\uFF0C\u903B\u8F91\u6E05\u6670\u65E0\u5197\u4F59
            3. **\u6570\u636E\u51C6\u786E** - \u5177\u4F53\u6570\u5B57\u3001\u65E5\u671F\u3001\u540D\u79F0\u7B49\u9700\u51C6\u786E\u5448\u73B0\u5E76\u6CE8\u660E\u4E0A\u4E0B\u6587
            4. **\u5BA2\u89C2\u4E2D\u7ACB** - \u907F\u514D\u4E3B\u89C2\u89E3\u8BFB\u6216\u5916\u90E8\u77E5\u8BC6
            5. **\u4E3B\u9898\u5206\u7EC4** - \u591A\u4E3B\u9898\u5185\u5BB9\u4F7F\u7528\u5C0F\u6807\u9898\u5206\u9694\uFF0C\u63D0\u5347\u53EF\u8BFB\u6027
            ${o?"6. **\u56FE\u6587\u7ED3\u5408** - \u5982\u679C\u5185\u5BB9\u5305\u542B\u56FE\u7247\uFF0C\u5728\u76F8\u5173\u8981\u70B9\u9644\u8FD1\u5C55\u793A\u56FE\u7247\uFF0C\u589E\u5F3A\u53EF\u8BFB\u6027\u548C\u76F4\u89C2\u6027":""}
            ${o?"7. **\u8BED\u8A00\u5339\u914D** - \u4F7F\u7528\u4E0E\u7F51\u9875\u5185\u5BB9\u76F8\u540C\u7684\u8BED\u8A00":"6. **\u8BED\u8A00\u5339\u914D** - \u4F7F\u7528\u4E0E\u7F51\u9875\u5185\u5BB9\u76F8\u540C\u7684\u8BED\u8A00"}
            ${o?`8. **\u957F\u5EA6\u63A7\u5236** - \u4E0D\u8D85\u8FC7 ${n} \u5B57\uFF0C\u590D\u6742\u5185\u5BB9\u9700\u7CBE\u7B80\u4F46\u4E0D\u9057\u6F0F\u5173\u952E\u4FE1\u606F`:`7. **\u957F\u5EA6\u63A7\u5236** - \u4E0D\u8D85\u8FC7 ${n} \u5B57\uFF0C\u590D\u6742\u5185\u5BB9\u9700\u7CBE\u7B80\u4F46\u4E0D\u9057\u6F0F\u5173\u952E\u4FE1\u606F`}

            ---
            **\u7F51\u9875\u5185\u5BB9\uFF1A**
            ${t.slice(0,s)}
        `.trim()}},DS={generate:r=>{const{userInput:e}=r;return[{role:"system",content:`
            \u4F60\u662F\u4E00\u4E2A\u4EFB\u52A1\u62C6\u5206\u52A9\u624B\u3002\u4F60\u7684\u4EFB\u52A1\u662F\u5C06\u7528\u6237\u7684\u81EA\u7136\u8BED\u8A00\u6307\u4EE4\u62C6\u5206\u4E3A\u4E00\u7EC4\u5177\u4F53\u7684\u9875\u9762\u4FEE\u6539\u4EFB\u52A1\u3002
            
            ### \u62C6\u5206\u4E0E\u5F52\u7C7B\u89C4\u5219\uFF1A
            1. **\u6309\u76EE\u6807\u5BF9\u8C61\u5F52\u7C7B\uFF08\u6838\u5FC3\uFF09**\uFF1A\u9488\u5BF9\u540C\u4E00\u4E2A\u5BF9\u8C61\u3001\u7EC4\u4EF6\u3001Class \u6216\u903B\u8F91\u5355\u5143\u7684\u591A\u9879\u4FEE\u6539\uFF08\u4F8B\u5982\uFF1A\u540C\u65F6\u8C03\u6574\u6309\u94AE\u7684\u989C\u8272\u3001\u8FB9\u8DDD\u3001\u5706\u89D2\uFF09\uFF0C\u5FC5\u987B\u5F52\u7C7B\u4E3A**\u540C\u4E00\u4E2A\u4EFB\u52A1**\u3002
            2. **\u72EC\u7ACB\u64CD\u4F5C\u62C6\u5206**\uFF1A\u53EA\u6709\u5F53\u4FEE\u6539\u6D89\u53CA\u5230\u5B8C\u5168\u4E0D\u540C\u7684 UI \u533A\u57DF\u3001\u4E0D\u76F8\u5173\u7684\u4E1A\u52A1\u903B\u8F91\u6216\u4E0D\u540C\u7684\u7EC4\u4EF6\u7C7B\u65F6\uFF0C\u624D\u62C6\u5206\u4E3A\u591A\u4E2A\u4EFB\u52A1\u3002
            3. **\u63CF\u8FF0\u7CBE\u70BC**\uFF1A\u4EFB\u52A1\u63CF\u8FF0\u5E94\u5305\u542B\u76EE\u6807\u5BF9\u8C61\u548C\u6240\u6709\u8981\u6267\u884C\u7684\u64CD\u4F5C\u3002

            \u8F93\u51FA\u683C\u5F0F\u5FC5\u987B\u662F\u4E00\u4E2A JSON \u6570\u7EC4\uFF08\u4E0D\u8981\u8F93\u51FA\u4EFB\u4F55\u989D\u5916\u6587\u5B57\uFF09\uFF0C\u4F8B\u5982\uFF1A
            - \u8F93\u5165\uFF1A"\u628A\u67E5\u8BE2\u6309\u94AE\u53D8\u5927\uFF0C\u5706\u89D2\u66F4\u660E\u663E\u4E00\u4E9B\uFF0C\u80CC\u666F\u6539\u6210\u7EA2\u8272"
                -> \u8F93\u51FA\uFF1A["\u8C03\u6574\u67E5\u8BE2\u6309\u94AE\u7684\u5C3A\u5BF8\u3001\u5706\u89D2\u548C\u80CC\u666F\u989C\u8272"]
            - \u8F93\u5165\uFF1A"\u4FEE\u6539\u641C\u7D22\u6846\u80CC\u666F\uFF0C\u5E76\u628A\u5DE6\u4FA7\u83DC\u5355\u9690\u85CF"
                -> \u8F93\u51FA\uFF1A["\u8C03\u6574\u641C\u7D22\u6846\u80CC\u666F\u989C\u8272", "\u9690\u85CF\u5DE6\u4FA7\u83DC\u5355"]
            
            \u5982\u679C\u6307\u4EE4\u672C\u8EAB\u5C31\u5F88\u7B80\u5355\u4E14\u5355\u4E00\uFF0C\u5219\u8FD4\u56DE\u5305\u542B\u8BE5\u6307\u4EE4\u7684\u5355\u5143\u7D20\u6570\u7EC4\u3002
        `.trim()},{role:"user",content:e}]}},BS={generate:r=>{const{userInput:e,pageInfo:t,targets:n,cumulativeOps:a=[]}=r,s=`
            \u4F60\u662F\u8D44\u6DF1\u524D\u7AEF\u67B6\u6784\u5E08\u4E0E UI \u4E13\u5BB6\u3002\u4F60\u7684\u4EFB\u52A1\u662F\u8F85\u52A9\u5F00\u53D1\u4EBA\u5458\u5728\u7EBF\u8C03\u6574\u9875\u9762\u5E03\u5C40\uFF0C\u5E76\u63D0\u4F9B\u4E13\u4E1A\u7684\u3001\u53EF\u76F4\u63A5\u7528\u4E8E\u751F\u4EA7\u73AF\u5883\u7684\u4FEE\u6539\u5EFA\u8BAE\u3002
            
            ### \u6838\u5FC3\u51C6\u5219\uFF1A
            1. **\u4F18\u5148\u4F7F\u7528 Class \u9009\u62E9\u5668**\uFF1A\u5F00\u53D1\u4EBA\u5458\u5173\u6CE8\u53EF\u590D\u7528\u6027\u3002\u9664\u975E\u5143\u7D20\u5177\u6709\u552F\u4E00\u7684\u4E1A\u52A1 ID\uFF0C\u5426\u5219\u8BF7\u4F18\u5148\u57FA\u4E8E\u63D0\u4F9B\u7684 class \u8FDB\u884C\u6837\u5F0F\u7F16\u5199\u3002
            2. **\u5E03\u5C40\u4FEE\u6539\u4E13\u9879\u539F\u5219**\uFF1A
               - **\u4F18\u5148\u4F7F\u7528 gap**\uFF1A\u5982\u679C\u4E24\u4E2A\u5143\u7D20\u5171\u4EAB\u4E00\u4E2A \`display: flex\` \u6216 \`display: grid\` \u7684\u7236\u5BB9\u5668\uFF0C\u8BF7\u4F18\u5148\u901A\u8FC7\u4FEE\u6539\u7236\u5BB9\u5668\u7684 \`gap\` \u5C5E\u6027\u6765\u8C03\u6574\u95F4\u8DDD\uFF0C\u800C\u4E0D\u662F\u7ED9\u5B50\u5143\u7D20\u52A0 margin\u3002
               - **\u5BB9\u5668\u4F18\u5148**\uFF1A\u5982\u679C\u4F60\u5728 targets \u4E2D\u770B\u5230\u4E86\u5305\u542B\u591A\u4E2A\u76EE\u6807\u7684\u7236\u7EA7\u5BB9\u5668\uFF08\u901A\u5E38\u6392\u5728\u524D\u9762\u7684 selector\uFF09\uFF0C\u8BF7\u4F18\u5148\u8003\u8651\u4FEE\u6539\u8BE5\u5BB9\u5668\u7684\u5C5E\u6027\uFF08\u5982 \`justify-content\`, \`align-items\`, \`padding\` \u7B49\uFF09\u3002
            3. **\u8F93\u51FA\u89C4\u8303\u7684 CSS**\uFF1A\u5EFA\u8BAE\u4F7F\u7528 BEM \u98CE\u683C\u6216\u8BED\u4E49\u5316\u7684\u7C7B\u540D\u7EC4\u5408\u3002\u751F\u6210\u7684 CSS \u5E94\u6574\u6D01\u3001\u9AD8\u6548\u3002
            3. **\u63D0\u4F9B\u67B6\u6784\u5EFA\u8BAE**\uFF1A\u5728 summary \u548C steps \u4E2D\uFF0C\u4E0D\u4EC5\u8981\u8BF4\u660E\u6539\u4E86\u4EC0\u4E48\uFF0C\u8FD8\u8981\u4ECE\u524D\u7AEF\u67B6\u6784\u89D2\u5EA6\u89E3\u91CA\u4E3A\u4EC0\u4E48\u8981\u8FD9\u6837\u6539\uFF08\u4F8B\u5982\uFF1A\u4E3A\u4E86\u4FDD\u6301 Flex \u5E03\u5C40\u7684\u4E00\u81F4\u6027\uFF0C\u6216\u4E3A\u4E86\u63D0\u5347\u54CD\u5E94\u5F0F\u9002\u914D\uFF09\u3002
            4. **\u8003\u8651\u526F\u4F5C\u7528**\uFF1A\u5982\u679C\u4FEE\u6539\u67D0\u4E2A Class \u53EF\u80FD\u4F1A\u5F71\u54CD\u9875\u9762\u4E0A\u5176\u4ED6\u540C\u7C7B\u5143\u7D20\uFF0C\u8BF7\u5728 risks \u4E2D\u660E\u786E\u6807\u6CE8\u3002

            \u5F53\u524D\u9875\u9762\u4FE1\u606F\uFF1A${JSON.stringify(t||{})}
            
            \u5DF2\u7D2F\u79EF\u6267\u884C\u7684\u64CD\u4F5C\uFF1A
            ${JSON.stringify(a,null,2)}
            
            \u4F60\u53EA\u80FD\u8F93\u51FA\u4E00\u4E2A JSON \u5BF9\u8C61\uFF08\u4E0D\u8981\u8F93\u51FA\u4EFB\u4F55\u989D\u5916\u6587\u5B57\uFF09\uFF0CJSON \u5FC5\u987B\u4E25\u683C\u7B26\u5408\u4EE5\u4E0B TypeScript \u7ED3\u6784\uFF1A
            
            type PatchIntent = "style" | "layout" | "copy" | "mixed";
            type PatchOp =
            { kind: "css"; cssText: string; targets: Array<{ selector: string; reason: string }> } |
            { kind: "text"; selector: string; toText: string; reason: string } |
            { kind: "attr"; selector: string; name: string; toValue: string | null; reason: string };
            
            type PagePatch = {
                id: string;
                page: { url: string; title: string };
                intent: PatchIntent;
                summary: string;
                steps: string[];
                risks: string[];
                ops: PatchOp[];
                requiresConfirm: true;
            };
            
            \u91CD\u8981\u89C4\u5219\uFF1A
            1) cssText \u5FC5\u987B\u662F\u5B8C\u6574\u7684 CSS \u89C4\u5219\uFF08\u4F8B\u5982\uFF1A".btn-primary { padding: 10px 20px; }"\uFF09\u3002
            2) selector \u5FC5\u987B\u6765\u81EA\u4E0A\u4E0B\u6587 targets \u4E2D\u63D0\u4F9B\u7684 selector\uFF08\u8FD9\u4E9B selector \u5DF2\u7ECF\u8FC7\u4F18\u5316\uFF0C\u4F18\u5148\u5305\u542B\u7C7B\u540D\uFF09\u3002
            3) \u4E25\u7981\u8F93\u51FA Markdown \u683C\u5F0F\uFF0C\u53EA\u5141\u8BB8\u7EAF JSON\u3002
        `.trim(),i=`
            \u4E0A\u4E0B\u6587\u5143\u7D20\uFF08\u5DF2\u5305\u542B\u4F18\u5316\u540E\u7684\u7C7B\u540D\u9009\u62E9\u5668\uFF09\uFF1A
            ${JSON.stringify(n||[],null,2)}
            
            \u5F00\u53D1\u4EBA\u5458\u5F53\u524D\u7684\u4FEE\u6539\u4EFB\u52A1\uFF1A
            ${e}
        `.trim();return[{role:"system",content:s},{role:"user",content:i}]}},MS={generate:r=>{const{userInput:e,content:t,maxLength:n=5e4,maxContentLength:a=1e4,summaryMode:s="detailed"}=r;return`
            \u4F60\u662F**\u4E13\u4E1A\u7684\u90AE\u4EF6\u667A\u80FD\u52A9\u624B**\uFF0C\u4F60\u7684\u76EE\u6807\u662F\uFF1A  
            **\u5728\u4E0D\u7F16\u9020\u3001\u4E0D\u8D8A\u754C\u7684\u524D\u63D0\u4E0B\uFF0C\u5C3D\u53EF\u80FD\u56DE\u7B54\u7528\u6237\u7684\u95EE\u9898\u3002**

            \u5728\u56DE\u590D\u524D\uFF0C\u8BF7**\u5148\u5728\u5185\u90E8\u5224\u65AD\u5F53\u524D\u9875\u9762\u7C7B\u578B**\uFF08\u975E\u90AE\u4EF6 / \u90AE\u4EF6\u5217\u8868 / \u90AE\u4EF6\u8BE6\u60C5\uFF09\uFF0C  
            \u4F46**\u4E0D\u8981\u5411\u7528\u6237\u66B4\u9732\u5224\u65AD\u8FC7\u7A0B\u6216\u672F\u8BED**\u3002

            ---

            ## \u9875\u9762\u7C7B\u578B\u5904\u7406\u89C4\u5219\uFF08\u5185\u90E8\u903B\u8F91\uFF09

            ### 1\uFE0F\u20E3 \u5982\u679C\u5F53\u524D\u9875\u9762\u4E0D\u662F\u90AE\u4EF6\u5185\u5BB9
            \u76F4\u63A5\u5411\u7528\u6237\u8BF4\u660E\uFF1A  
            **\u201C\u5F53\u524D\u9875\u9762\u4E0D\u662F\u90AE\u4EF6\u5185\u5BB9\uFF0C\u65E0\u6CD5\u56DE\u7B54\u8BE5\u95EE\u9898\u3002\u201D**

            ---

            ### 2\uFE0F\u20E3 \u5982\u679C\u5F53\u524D\u9875\u9762\u662F\u3010\u90AE\u4EF6\u5217\u8868\u9875\u3011
            \u4F60\u53EF\u4EE5\u57FA\u4E8E**\u5217\u8868\u4E2D\u53EF\u89C1\u7684\u4FE1\u606F**\u56DE\u7B54\u7528\u6237\u95EE\u9898\uFF0C\u4F46\u5FC5\u987B\u9075\u5B88\u4EE5\u4E0B\u89C4\u5219\uFF1A

            #### \u2705 \u5141\u8BB8\u7684\u884C\u4E3A
            - \u56DE\u7B54\u57FA\u4E8E\u4EE5\u4E0B\u4FE1\u606F\u7684\u95EE\u9898\uFF1A
            - \u53D1\u4EF6\u4EBA
            - \u90AE\u4EF6\u6807\u9898
            - \u65F6\u95F4
            - \u662F\u5426\u672A\u8BFB / \u661F\u6807\uFF08\u5982\u5217\u8868\u4E2D\u53EF\u89C1\uFF09
            - \u8FDB\u884C**\u6982\u89C8\u6027\u603B\u7ED3\u3001\u8D8B\u52BF\u5224\u65AD**
            - \u6307\u51FA**\u53EF\u80FD\u76F8\u5173\u7684\u90AE\u4EF6\u6761\u76EE**
            - \u5EFA\u8BAE\u7528\u6237\u4E0B\u4E00\u6B65\u64CD\u4F5C\uFF08\u4F8B\u5982\u6253\u5F00\u67D0\u4E00\u5C01\u90AE\u4EF6\uFF09

            #### \u274C \u7981\u6B62\u7684\u884C\u4E3A
            - \u4E0D\u5F97\u63A8\u6D4B\u6216\u7F16\u9020\u4EFB\u4F55\u90AE\u4EF6\u6B63\u6587\u5185\u5BB9
            - \u4E0D\u5F97\u5047\u8BBE\u90AE\u4EF6\u4E2D\u201C\u53EF\u80FD\u5199\u4E86\u4EC0\u4E48\u201D
            - \u82E5\u95EE\u9898\u9700\u8981\u6B63\u6587\u4FE1\u606F\uFF0C\u5FC5\u987B\u660E\u786E\u8BF4\u660E\u5F53\u524D\u65E0\u6CD5\u786E\u5B9A

            #### \u5217\u8868\u9875\u56DE\u7B54\u65B9\u5F0F
            - \u660E\u786E\u8BF4\u660E\u56DE\u7B54\u662F**\u57FA\u4E8E\u90AE\u4EF6\u5217\u8868\u4FE1\u606F**
            - \u82E5\u4FE1\u606F\u4E0D\u8DB3\uFF0C\u5E94\u6E05\u695A\u544A\u77E5\u7528\u6237\u539F\u56E0

            ---

            ### 3\uFE0F\u20E3 \u5982\u679C\u5F53\u524D\u9875\u9762\u662F\u3010\u90AE\u4EF6\u8BE6\u60C5\u9875\u3011
            \u6B63\u5E38\u8FDB\u5165\u90AE\u4EF6\u95EE\u9898\u89E3\u7B54\u6D41\u7A0B\u3002

            ---

            ## \u90AE\u4EF6\u95EE\u9898\u89E3\u7B54\u901A\u7528\u7EA6\u675F\uFF08\u5217\u8868\u9875 & \u8BE6\u60C5\u9875\u901A\u7528\uFF09

            ### \u4FE1\u606F\u6765\u6E90\u9650\u5236
            - \u56DE\u7B54\u53EA\u80FD\u57FA\u4E8E\u5F53\u524D\u9875\u9762\u4E2D**\u5B9E\u9645\u53EF\u89C1\u7684\u5185\u5BB9**
            - \u4E0D\u5F97\u4F7F\u7528\u5916\u90E8\u77E5\u8BC6\u6216\u4E3B\u89C2\u63A8\u6D4B
            - \u82E5\u9875\u9762\u4E2D\u65E0\u6CD5\u627E\u5230\u7B54\u6848\uFF0C\u9700\u660E\u786E\u8BF4\u660E\u539F\u56E0

            ---

            ## Markdown \u8F93\u51FA\u89C4\u8303
            ${s==="detailed"?`
            - **\u56FE\u7247\u8BF4\u660E**
            * \u4EC5\u5728\u56FE\u7247\u4E0E\u7528\u6237\u95EE\u9898\u76F4\u63A5\u76F8\u5173\u65F6\u5C55\u793A
            * \u4F7F\u7528 ![\u63CF\u8FF0](URL) \u683C\u5F0F
            * \u56FE\u7247\u5E94\u653E\u5728\u5BF9\u5E94\u8BF4\u660E\u9644\u8FD1
                    `:""}
            - \u4F7F\u7528\u6807\u51C6 Markdown\uFF08\u94FE\u63A5 / \u5217\u8868 / \u5F15\u7528 / \u8868\u683C\uFF09
            - \u6240\u6709 URL \u5FC5\u987B\u5B8C\u6574
            - \u274C \u4E0D\u4F7F\u7528\u4EFB\u4F55 HTML \u6807\u7B7E

            ---

            ## \u56DE\u7B54\u7EC4\u7EC7\u8981\u6C42

            ### \u5F53\u4E3A\u90AE\u4EF6\u5217\u8868\u9875\u65F6
            - \u5148\u8BF4\u660E\u8FD9\u662F**\u57FA\u4E8E\u90AE\u4EF6\u5217\u8868\u4FE1\u606F\u7684\u5224\u65AD**
            - \u5206\u70B9\u56DE\u7B54\u7528\u6237\u95EE\u9898
            - \u5FC5\u8981\u65F6\u7ED9\u51FA\u4E0B\u4E00\u6B65\u5EFA\u8BAE\uFF08\u4F8B\u5982\u201C\u5EFA\u8BAE\u6253\u5F00 XX \u90AE\u4EF6\u67E5\u770B\u8BE6\u60C5\u201D\uFF09

            ### \u5F53\u4E3A\u90AE\u4EF6\u8BE6\u60C5\u9875\u65F6
            - \u76F4\u63A5\u56DE\u7B54\u95EE\u9898
            - \u4F7F\u7528\u201C\u7ED3\u8BBA \u2192 \u7EC6\u8282\u201D\u7684\u7ED3\u6784
            - \u660E\u786E\u6807\u6CE8\u4FE1\u606F\u6765\u6E90

            ---

            ## \u5176\u4ED6\u8981\u6C42
            - \u4F7F\u7528\u4E0E\u7528\u6237\u95EE\u9898\u76F8\u540C\u7684\u8BED\u8A00
            - \u8868\u8FBE\u81EA\u7136\u3001\u6E05\u6670\uFF0C\u907F\u514D\u6280\u672F\u672F\u8BED
            - \u603B\u957F\u5EA6\u4E0D\u8D85\u8FC7 ${n} \u5B57

            ---

            **\u7528\u6237\u95EE\u9898\uFF1A**
            ${e}

            **\u9875\u9762\u5185\u5BB9\uFF1A**
            ${t.slice(0,a)}
                    `.trim()}},$S={summary:RS,smart_edit_split:DS,smart_edit_patch:BS,smart_email_assistant:MS};class Ui{static getTemplate(e){return $S[e]}static generate(e,t){return this.getTemplate(e).generate(t)}}class jy{static async fetchWithRetry(e){var i,o,u;const t=fa(),{maxAttempts:n,retryDelay:a,maxLength:s}=e;for(let l=1;l<=n;l++)try{t.info(`\u5C1D\u8BD5\u83B7\u53D6\u9875\u9762\u5185\u5BB9\uFF0C\u7B2C ${l} \u6B21`);const c=await uu("requestPageContent",{config:{maxLength:s}});if((c==null?void 0:c.status)==="success"&&((i=c.data)!=null&&i.content))return t.info("\u9875\u9762\u5185\u5BB9\u83B7\u53D6\u6210\u529F:",{source:(o=c.data)==null?void 0:o.source}),(u=c.data)==null?void 0:u.content;throw t.warn("\u54CD\u5E94\u65E0\u6548\u6216\u5185\u5BB9\u4E3A\u7A7A:",c),new Error("\u65E0\u6548\u54CD\u5E94\u6216\u5185\u5BB9\u4E3A\u7A7A")}catch(c){if(t.error(`\u7B2C ${l} \u6B21\u83B7\u53D6\u9875\u9762\u5185\u5BB9\u5931\u8D25:`,c),l<n)t.info(`\u5C06\u5728 ${a}ms \u540E\u8FDB\u884C\u7B2C ${l+1} \u6B21\u91CD\u8BD5`),await new Promise(d=>setTimeout(d,a));else throw new Error(`\u5185\u5BB9\u83B7\u53D6\u5931\u8D25\uFF08\u5C1D\u8BD5 ${n} \u6B21\uFF09`)}throw new Error("\u672A\u9884\u671F\u5230\u8FBE\u6B64\u5206\u652F")}}const Ta=fa(),Cm="[DONE]",Tm="data:";function Xo(r){return r.replace(/<think>/g,"___THINK_OPEN___").replace(/<\/think>/g,"___THINK_CLOSE___").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/___THINK_OPEN___/g,"<think>").replace(/___THINK_CLOSE___/g,"</think>")}async function Fm(r,e,t=""){const n=await r.text(),a=new Error(`HTTP ${r.status}: ${n}`);e==null||e(a),Ta.error(`${t} HTTP error:`,a)}function Nm(r,e=""){const t=new Error("Response body is null");r==null||r(t),Ta.error(`${e} response body error:`,t)}function _b({baseURL:r,model:e,apiKey:t,messages:n,onToken:a,onDone:s,onError:i,shouldAbort:o}){const u=new AbortController;return(async()=>{var l,c,d,h,f,p,m;try{const v=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:e,messages:n,stream:!0}),signal:u.signal});if(!v.ok){await Fm(v,i);return}const _=(l=v.body)==null?void 0:l.getReader();if(!_){Nm(i);return}const w=new TextDecoder("utf-8");let E="",F=!1;for(;;){if(o!=null&&o()){u.abort();return}const{done:k,value:N}=await _.read();if(k)break;E+=w.decode(N,{stream:!0});const B=E.split(`
`).filter(A=>A.startsWith(Tm));E="";for(const A of B){const L=A.replace(/^data:\s*/,"");if(L===Cm){s==null||s();return}try{const V=JSON.parse(L);let G="";const te=((h=(d=(c=V.choices)==null?void 0:c[0])==null?void 0:d.delta)==null?void 0:h.reasoning_content)||"";te&&te.trim()!==""?F?G=te:(F=!0,G=`<think>${te}`):(G=(m=(p=(f=V.choices)==null?void 0:f[0])==null?void 0:p.delta)==null?void 0:m.content,F&&(F=!1,G="</think>"+G)),G&&a(Xo(G))}catch(V){Ta.warn("Parse error:",V)}}}}catch(v){i==null||i(v),Ta.error("streamOpenAIChat error:",v)}})(),u}function PS({baseURL:r,apiKey:e,messages:t,user:n,conversation_id:a,onToken:s,onDone:i,onError:o,shouldAbort:u}){const l=new AbortController;return(async()=>{var c,d;try{const h=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({query:((c=t[t.length-1])==null?void 0:c.content)||"",inputs:{},response_mode:"streaming",user:n,conversation_id:a}),signal:l.signal});if(!h.ok){await Fm(h,o,"Dify");return}const f=(d=h.body)==null?void 0:d.getReader();if(!f){Nm(o,"Dify");return}const p=new TextDecoder("utf-8");let m="";for(;;){if(u!=null&&u()){l.abort();return}const{done:v,value:_}=await f.read();if(v)break;m+=p.decode(_,{stream:!0});const w=m.split(`
`);m=w.pop()||"";for(const E of w)if(E.startsWith(Tm)){const F=E.replace(/^data:\s*/,"").trim();if(F===Cm){i==null||i();return}if(F)try{const k=JSON.parse(F);if(k.event==="message"&&k.answer)s(Xo(k.answer));else if(k.event==="message_end"){i==null||i();return}else(k.event==="message_replace"&&k.answer||k.event==="agent_message"&&k.answer)&&s(Xo(k.answer))}catch(k){Ta.warn("Parse Dify response error:",k,"Raw data:",F)}}}i==null||i()}catch(h){o==null||o(h),Ta.error("streamDifyChat error:",h)}})(),l}function LS({baseURL:r,appId:e,apiKey:t,messages:n,onToken:a,onDone:s,onError:i,shouldAbort:o}){const u=new AbortController;return(async()=>{var l,c,d;try{const h=`${r}/apps/${e}/completion`,f={input:{messages:n},parameters:{incremental_output:!0},debug:{}},p=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-DashScope-SSE":"enable"},body:JSON.stringify(f),signal:u.signal});if(!p.ok){await Fm(p,i,"Aliyun App");return}const m=(l=p.body)==null?void 0:l.getReader();if(!m){Nm(i,"Aliyun App");return}const v=new TextDecoder("utf-8");let _="";for(;;){if(o!=null&&o()){u.abort();return}const{done:w,value:E}=await m.read();if(w)break;_+=v.decode(E,{stream:!0});const F=_.split(`
`);_=F.pop()||"";for(const k of F)if(Ta.info("line:",k),k.startsWith(Tm)){const N=k.replace(/^data:\s*/,"").trim();if(N===Cm){s==null||s();return}if(N)try{Ta.info("data:",N);const B=JSON.parse(N);if(((c=B.output)==null?void 0:c.finish_reason)==="stop"){s==null||s();return}(d=B.output)!=null&&d.text&&a(Xo(B.output.text))}catch(B){Ta.warn("Parse Aliyun App response error:",B,"Raw data:",N)}}}s==null||s()}catch(h){i==null||i(h),Ta.error("streamAliyunAppChat error:",h)}})(),u}var zS=Object.defineProperty,Xe=(r,e)=>{for(var t in e)zS(r,t,{get:e[t],enumerable:!0})};const bb=Symbol.for("ls:tracing_async_local_storage"),Qo=Symbol.for("lc:context_variables"),US=r=>{globalThis[bb]=r},du=()=>globalThis[bb];var Gd,qy;function jS(){return qy||(qy=1,Gd=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Gd}var qS=jS();const HS=Ai(qS);var yl={exports:{}},Hy;function VS(){if(Hy)return yl.exports;Hy=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,s=new RegExp("^"+a.source),i=new RegExp(a.source+n.source,"gu"),o=new RegExp("\\d+"+n.source,"gu"),u=(h,f,p)=>{let m=!1,v=!1,_=!1;for(let w=0;w<h.length;w++){const E=h[w];m&&r.test(E)?(h=h.slice(0,w)+"-"+h.slice(w),m=!1,_=v,v=!0,w++):v&&_&&e.test(E)?(h=h.slice(0,w-1)+"-"+h.slice(w-1),_=v,v=!1,m=!0):(m=f(E)===E&&p(E)!==E,_=v,v=p(E)===E&&f(E)!==E)}return h},l=(h,f)=>(t.lastIndex=0,h.replace(t,p=>f(p))),c=(h,f)=>(i.lastIndex=0,o.lastIndex=0,h.replace(i,(p,m)=>f(m)).replace(o,p=>f(p))),d=(h,f)=>{if(!(typeof h=="string"||Array.isArray(h)))throw new TypeError("Expected the input to be `string | string[]`");if(f={pascalCase:!1,preserveConsecutiveUppercase:!1,...f},Array.isArray(h)?h=h.map(_=>_.trim()).filter(_=>_.length).join("-"):h=h.trim(),h.length===0)return"";const p=f.locale===!1?_=>_.toLowerCase():_=>_.toLocaleLowerCase(f.locale),m=f.locale===!1?_=>_.toUpperCase():_=>_.toLocaleUpperCase(f.locale);return h.length===1?f.pascalCase?m(h):p(h):(h!==p(h)&&(h=u(h,p,m)),h=h.replace(s,""),f.preserveConsecutiveUppercase?h=l(h,p):h=p(h),f.pascalCase&&(h=m(h.charAt(0))+h.slice(1)),c(h,m))};return yl.exports=d,yl.exports.default=d,yl.exports}var GS=VS();const ZS=Ai(GS);function KS(r,e){return(e==null?void 0:e[r])||HS(r)}function WS(r,e){return(e==null?void 0:e[r])||ZS(r)}function wb(r,e,t){const n={};for(const a in r)Object.hasOwn(r,a)&&(n[e(a,t)]=r[a]);return n}var Eb={};Xe(Eb,{Serializable:()=>Vn,get_lc_unique_name:()=>o0});function Vy(r){return Array.isArray(r)?[...r]:{...r}}function YS(r,e){const t=Vy(r);for(const[n,a]of Object.entries(e)){const[s,...i]=n.split(".").reverse();let o=t;for(const u of i.reverse()){if(o[u]===void 0)break;o[u]=Vy(o[u]),o=o[u]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[a]})}return t}function o0(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var Vn=class xb{constructor(e,...t){g(this,"lc_serializable",!1);g(this,"lc_kwargs");this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var a;return(a=this.lc_serializable_keys)==null?void 0:a.includes(n)})):this.lc_kwargs=e??{}}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,o0(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof xb||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((a,s)=>(a[s]=s in this?this[s]:this.lc_kwargs[s],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(n,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let s=this,i=n;const[o,...u]=a.split(".").reverse();for(const l of u.reverse()){if(!(l in s)||s[l]===void 0)return;(!(l in i)||i[l]===void 0)&&(typeof s[l]=="object"&&s[l]!=null?i[l]={}:Array.isArray(s[l])&&(i[l]=[])),s=s[l],i=i[l]}o in s&&s[o]!==void 0&&(i[o]=i[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:wb(Object.keys(t).length?YS(n,t):n,KS,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Us(r){return typeof r=="object"&&r!==null&&"type"in r&&typeof r.type=="string"&&"source_type"in r&&(r.source_type==="url"||r.source_type==="base64"||r.source_type==="text"||r.source_type==="id")}function Im(r){return Us(r)&&r.source_type==="url"&&"url"in r&&typeof r.url=="string"}function Om(r){return Us(r)&&r.source_type==="base64"&&"data"in r&&typeof r.data=="string"}function JS(r){return Us(r)&&r.source_type==="text"&&"text"in r&&typeof r.text=="string"}function Sb(r){return Us(r)&&r.source_type==="id"&&"id"in r&&typeof r.id=="string"}function Ab(r){if(Us(r)){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url}};if(r.source_type==="base64"){if(!r.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${r.mime_type};base64,${r.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function XS(r){const e=r.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${r}" - does not match type/subtype format.`);const t=e[0].trim(),n=e[1].trim();if(t===""||n==="")throw new Error(`Invalid mime type: "${r}" - type or subtype is empty.`);const a={};for(const s of r.split(";").slice(1)){const i=s.split("=");if(i.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${r}".`);const o=i[0].trim(),u=i[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${r}".`);a[o]=u}return{type:t,subtype:n,parameters:a}}function Vf({dataUrl:r,asTypedArray:e=!1}){const t=r.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let n;if(t){n=t[1].toLowerCase();const a=e?Uint8Array.from(atob(t[2]),s=>s.charCodeAt(0)):t[2];return{mime_type:n,data:a}}}function QS(r,e){if(r.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(r)}if(r.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(r)}if(r.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(r)}if(r.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(r)}throw new Error(`Unable to convert content block type '${r.type}' to provider-specific format: not recognized.`)}function We(r,e){return lt(r)&&r.type===e}function lt(r){return typeof r=="object"&&r!==null}function Ia(r){return Array.isArray(r)}function Be(r){return typeof r=="string"}function ra(r){return typeof r=="number"}function Rm(r){return r instanceof Uint8Array}function Gy(r){try{return JSON.parse(r)}catch{return}}const hu=r=>r();function eA(r){if(r.type==="char_location"&&Be(r.document_title)&&ra(r.start_char_index)&&ra(r.end_char_index)&&Be(r.cited_text)){const{document_title:e,start_char_index:t,end_char_index:n,cited_text:a,...s}=r;return{...s,type:"citation",source:"char",title:e??void 0,startIndex:t,endIndex:n,citedText:a}}if(r.type==="page_location"&&Be(r.document_title)&&ra(r.start_page_number)&&ra(r.end_page_number)&&Be(r.cited_text)){const{document_title:e,start_page_number:t,end_page_number:n,cited_text:a,...s}=r;return{...s,type:"citation",source:"page",title:e??void 0,startIndex:t,endIndex:n,citedText:a}}if(r.type==="content_block_location"&&Be(r.document_title)&&ra(r.start_block_index)&&ra(r.end_block_index)&&Be(r.cited_text)){const{document_title:e,start_block_index:t,end_block_index:n,cited_text:a,...s}=r;return{...s,type:"citation",source:"block",title:e??void 0,startIndex:t,endIndex:n,citedText:a}}if(r.type==="web_search_result_location"&&Be(r.url)&&Be(r.title)&&Be(r.encrypted_index)&&Be(r.cited_text)){const{url:e,title:t,encrypted_index:n,cited_text:a,...s}=r;return{...s,type:"citation",source:"url",url:e,title:t,startIndex:Number(n),endIndex:Number(n),citedText:a}}if(r.type==="search_result_location"&&Be(r.source)&&Be(r.title)&&ra(r.start_block_index)&&ra(r.end_block_index)&&Be(r.cited_text)){const{source:e,title:t,start_block_index:n,end_block_index:a,cited_text:s,...i}=r;return{...i,type:"citation",source:"search",url:e,title:t??void 0,startIndex:n,endIndex:a,citedText:s}}}function kb(r){if(We(r,"document")&&lt(r.source)&&"type"in r.source){if(r.source.type==="base64"&&Be(r.source.media_type)&&Be(r.source.data))return{type:"file",mimeType:r.source.media_type,data:r.source.data};if(r.source.type==="url"&&Be(r.source.url))return{type:"file",url:r.source.url};if(r.source.type==="file"&&Be(r.source.file_id))return{type:"file",fileId:r.source.file_id};if(r.source.type==="text"&&Be(r.source.data))return{type:"file",mimeType:String(r.source.media_type??"text/plain"),data:r.source.data}}else if(We(r,"image")&&lt(r.source)&&"type"in r.source){if(r.source.type==="base64"&&Be(r.source.media_type)&&Be(r.source.data))return{type:"image",mimeType:r.source.media_type,data:r.source.data};if(r.source.type==="url"&&Be(r.source.url))return{type:"image",url:r.source.url};if(r.source.type==="file"&&Be(r.source.file_id))return{type:"image",fileId:r.source.file_id}}}function tA(r){function*e(){for(const t of r){const n=kb(t);n?yield n:yield t}}return Array.from(e())}function Zy(r){function*e(){var n;const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const a of t){if(We(a,"text")&&Be(a.text)){const{text:s,citations:i,...o}=a;if(Ia(i)&&i.length){const u=i.reduce((l,c)=>{const d=eA(c);return d?[...l,d]:l},[]);yield{...o,type:"text",text:s,annotations:u};continue}else{yield{...o,type:"text",text:s};continue}}else if(We(a,"thinking")&&Be(a.thinking)){const{thinking:s,signature:i,...o}=a;yield{...o,type:"reasoning",reasoning:s,signature:i};continue}else if(We(a,"redacted_thinking")){yield{type:"non_standard",value:a};continue}else if(We(a,"tool_use")&&Be(a.name)&&Be(a.id)){yield{type:"tool_call",id:a.id,name:a.name,args:a.input};continue}else if(We(a,"input_json_delta")){if(nA(r)&&((n=r.tool_call_chunks)!=null&&n.length)){const s=r.tool_call_chunks[0];yield{type:"tool_call_chunk",id:s.id,name:s.name,args:s.args,index:s.index};continue}}else if(We(a,"server_tool_use")&&Be(a.name)&&Be(a.id)){const{name:s,id:i}=a;if(s==="web_search"){const o=hu(()=>{if(typeof a.input=="string")return a.input;if(lt(a.input)&&Be(a.input.query))return a.input.query;if(Be(a.partial_json)){const u=Gy(a.partial_json);if(u!=null&&u.query)return u.query}return""});yield{id:i,type:"server_tool_call",name:"web_search",args:{query:o}};continue}else if(a.name==="code_execution"){const o=hu(()=>{if(typeof a.input=="string")return a.input;if(lt(a.input)&&Be(a.input.code))return a.input.code;if(Be(a.partial_json)){const u=Gy(a.partial_json);if(u!=null&&u.code)return u.code}return""});yield{id:i,type:"server_tool_call",name:"code_execution",args:{code:o}};continue}}else if(We(a,"web_search_tool_result")&&Be(a.tool_use_id)&&Ia(a.content)){const{content:s,tool_use_id:i}=a,o=s.reduce((u,l)=>We(l,"web_search_result")?[...u,l.url]:u,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:i,status:"success",output:{urls:o}};continue}else if(We(a,"code_execution_tool_result")&&Be(a.tool_use_id)&&lt(a.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:a.tool_use_id,status:"success",output:a.content};continue}else if(We(a,"mcp_tool_use")){yield{id:a.id,type:"server_tool_call",name:"mcp_tool_use",args:a.input};continue}else if(We(a,"mcp_tool_result")&&Be(a.tool_use_id)&&lt(a.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:a.tool_use_id,status:"success",output:a.content};continue}else if(We(a,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:a.input};continue}else if(We(a,"search_result")){yield{id:a.id,type:"non_standard",value:a};continue}else if(We(a,"tool_result")){yield{id:a.id,type:"non_standard",value:a};continue}else{const s=kb(a);if(s){yield s;continue}}yield{type:"non_standard",value:a}}}return Array.from(e())}const rA={translateContent:Zy,translateContentChunk:Zy};function nA(r){return typeof(r==null?void 0:r._getType)=="function"&&typeof r.concat=="function"&&r._getType()==="ai"}function aA(r){return Im(r)?{type:r.type,mimeType:r.mime_type,url:r.url,metadata:r.metadata}:Om(r)?{type:r.type,mimeType:r.mime_type??"application/octet-stream",data:r.data,metadata:r.metadata}:Sb(r)?{type:r.type,mimeType:r.mime_type,fileId:r.id,metadata:r.metadata}:r}function sA(r){return r.map(aA)}function iA(r){return!!(We(r,"image_url")&&lt(r.image_url)||We(r,"input_audio")&&lt(r.input_audio)||We(r,"file")&&lt(r.file))}function oA(r){if(We(r,"image_url")&&lt(r.image_url)&&Be(r.image_url.url)){const e=Vf({dataUrl:r.image_url.url});return e?{type:"image",mimeType:e.mime_type,data:e.data}:{type:"image",url:r.image_url.url}}else{if(We(r,"input_audio")&&lt(r.input_audio)&&Be(r.input_audio.data)&&Be(r.input_audio.format))return{type:"audio",data:r.input_audio.data,mimeType:`audio/${r.input_audio.format}`};if(We(r,"file")&&lt(r.file)&&Be(r.file.data)){const e=Vf({dataUrl:r.file.data});if(e)return{type:"file",data:e.data,mimeType:e.mime_type};if(Be(r.file.file_id))return{type:"file",fileId:r.file.file_id}}}return r}function uA(r){const e=[];typeof r.content=="string"?e.push({type:"text",text:r.content}):e.push(...Dm(r.content));for(const t of r.tool_calls??[])e.push({type:"tool_call",id:t.id,name:t.name,args:t.args});return e}function lA(r){const e=[];typeof r.content=="string"?e.push({type:"text",text:r.content}):e.push(...Dm(r.content));for(const t of r.tool_calls??[])e.push({type:"tool_call",id:t.id,name:t.name,args:t.args});return e}function Dm(r){const e=[];for(const t of r)iA(t)?e.push(oA(t)):e.push(t);return e}function cA(r){if(r.type==="url_citation"){const{url:e,title:t,start_index:n,end_index:a}=r;return{type:"citation",url:e,title:t,startIndex:n,endIndex:a}}if(r.type==="file_citation"){const{file_id:e,filename:t,index:n}=r;return{type:"citation",title:t,startIndex:n,endIndex:n,fileId:e}}return r}function Cb(r){function*e(){var n;lt((n=r.additional_kwargs)==null?void 0:n.reasoning)&&Ia(r.additional_kwargs.reasoning.summary)&&(yield{type:"reasoning",reasoning:r.additional_kwargs.reasoning.summary.reduce((s,i)=>lt(i)&&Be(i.text)?`${s}${i.text}`:s,"")});const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const a of t)if(We(a,"text")){const{text:s,annotations:i,...o}=a;Array.isArray(i)?yield{...o,type:"text",text:String(s),annotations:i.map(cA)}:yield{...o,type:"text",text:String(s)}}for(const a of r.tool_calls??[])yield{type:"tool_call",id:a.id,name:a.name,args:a.args};if(lt(r.additional_kwargs)&&Ia(r.additional_kwargs.tool_outputs))for(const a of r.additional_kwargs.tool_outputs){if(We(a,"web_search_call")){yield{id:a.id,type:"server_tool_call",name:"web_search",args:{query:a.query}};continue}else if(We(a,"file_search_call")){yield{id:a.id,type:"server_tool_call",name:"file_search",args:{query:a.query}};continue}else if(We(a,"computer_call")){yield{type:"non_standard",value:a};continue}else if(We(a,"code_interpreter_call")){if(Be(a.code)&&(yield{id:a.id,type:"server_tool_call",name:"code_interpreter",args:{code:a.code}}),Ia(a.outputs)){const s=hu(()=>{if(a.status!=="in_progress"){if(a.status==="completed")return 0;if(a.status==="incomplete")return 127;if(a.status!=="interpreting"&&a.status==="failed")return 1}});for(const i of a.outputs)if(We(i,"logs")){yield{type:"server_tool_call_result",toolCallId:a.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:s??0,stderr:[0,void 0].includes(s)?void 0:String(i.logs),stdout:[0,void 0].includes(s)?String(i.logs):void 0}};continue}}continue}else if(We(a,"mcp_call")){yield{id:a.id,type:"server_tool_call",name:"mcp_call",args:a.input};continue}else if(We(a,"mcp_list_tools")){yield{id:a.id,type:"server_tool_call",name:"mcp_list_tools",args:a.input};continue}else if(We(a,"mcp_approval_request")){yield{type:"non_standard",value:a};continue}else if(We(a,"image_generation_call")){yield{type:"non_standard",value:a};continue}lt(a)&&(yield{type:"non_standard",value:a})}}return Array.from(e())}function dA(r){function*e(){yield*Cb(r);for(const t of r.tool_call_chunks??[])yield{type:"tool_call_chunk",id:t.id,name:t.name,args:t.args}}return Array.from(e())}const hA={translateContent:r=>typeof r.content=="string"?uA(r):Cb(r),translateContentChunk:r=>typeof r.content=="string"?lA(r):dA(r)};function Tb(r){return typeof r=="object"&&r!==null&&"type"in r&&"content"in r&&(typeof r.content=="string"||Array.isArray(r.content))}function fA(r,e="pretty"){return e==="pretty"?pA(r):JSON.stringify(r)}function pA(r){const e=[],t=` ${r.type.charAt(0).toUpperCase()+r.type.slice(1)} Message `,n=Math.floor((80-t.length)/2),a="=".repeat(n),s=t.length%2===0?a:`${a}=`;if(e.push(`${a}${t}${s}`),r.type==="ai"){const i=r;if(i.tool_calls&&i.tool_calls.length>0){e.push("Tool Calls:");for(const o of i.tool_calls){e.push(`  ${o.name} (${o.id})`),e.push(` Call ID: ${o.id}`),e.push("  Args:");for(const[u,l]of Object.entries(o.args))e.push(`    ${u}: ${typeof l=="object"?JSON.stringify(l):l}`)}}}if(r.type==="tool"){const i=r;i.name&&e.push(`Name: ${i.name}`)}return typeof r.content=="string"&&r.content.trim()&&(e.length>1&&e.push(""),e.push(r.content)),e.join(`
`)}const Zd=Symbol.for("langchain.message");function ss(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:Array.isArray(e)&&e.length===0?r:Array.isArray(e)&&e.some(t=>Us(t))?[{type:"text",source_type:"text",text:r},...e]:[{type:"text",text:r},...e]:Array.isArray(e)?Uu(r,e)??[...r,...e]:e===""?r:Array.isArray(r)&&r.some(t=>Us(t))?[...r,{type:"file",source_type:"text",text:e}]:[...r,{type:"text",text:e}]}function Fb(r,e){return r==="error"||e==="error"?"error":"success"}function mA(r,e){function t(n,a){if(typeof n!="object"||n===null||n===void 0)return n;if(a>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>t(i,a+1));const s={};for(const i of Object.keys(n))s[i]=t(n[i],a+1);return s}return JSON.stringify(t(r,0),null,2)}var u4,jn=class extends Vn{constructor(e){const t=typeof e=="string"||Array.isArray(e)?{content:e}:e;t.additional_kwargs||(t.additional_kwargs={}),t.response_metadata||(t.response_metadata={});super(t);g(this,"lc_namespace",["langchain_core","messages"]);g(this,"lc_serializable",!0);g(this,u4,!0);g(this,"id");g(this,"name");g(this,"content");g(this,"additional_kwargs");g(this,"response_metadata");this.name=t.name,t.content===void 0&&t.contentBlocks!==void 0?(this.content=t.contentBlocks,this.response_metadata={output_version:"v1",...t.response_metadata}):t.content!==void 0?(this.content=t.content??[],this.response_metadata=t.response_metadata):(this.content=[],this.response_metadata=t.response_metadata),this.additional_kwargs=t.additional_kwargs,this.id=t.id}get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}_getType(){return this.type}getType(){return this._getType()}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}get contentBlocks(){const e=typeof this.content=="string"?[{type:"text",text:this.content}]:this.content;return[sA,Dm,tA].reduce((a,s)=>s(a),e)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return typeof e=="object"&&e!==null&&Zd in e&&e[Zd]===!0&&Tb(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[(u4=Zd,Symbol.toStringTag)](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=mA(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}toFormattedString(e="pretty"){return fA(this,e)}};function gA(r){return Array.isArray(r)&&r.every(e=>typeof e.index=="number")}function qr(r={},e={}){const t={...r};for(const[n,a]of Object.entries(e))if(t[n]==null)t[n]=a;else{if(a==null)continue;if(typeof t[n]!=typeof a||Array.isArray(t[n])!==Array.isArray(a))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;["id","name","output_version","model_provider"].includes(n)?a&&(t[n]=a):t[n]+=a}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=qr(t[n],a);else if(Array.isArray(t[n]))t[n]=Uu(t[n],a);else{if(t[n]===a)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Uu(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&n!==null&&"index"in n&&typeof n.index=="number"){const a=t.findIndex(s=>{const i=typeof s=="object",o="index"in s&&s.index===n.index,u="id"in s&&"id"in n&&(s==null?void 0:s.id)===(n==null?void 0:n.id),l=!("id"in s)||!(s!=null&&s.id)||!("id"in n)||!(n!=null&&n.id);return i&&o&&(u||l)});a!==-1&&typeof t[a]=="object"&&t[a]!==null?t[a]=qr(t[a],n):t.push(n)}else{if(typeof n=="object"&&n!==null&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function Nb(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Uu(r,e);if(typeof r=="object"&&typeof e=="object")return qr(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}var Xs=class Ib extends jn{static isInstance(e){if(!super.isInstance(e))return!1;let t=Object.getPrototypeOf(e);for(;t!==null;){if(t===Ib.prototype)return!0;t=Object.getPrototypeOf(t)}return!1}};function Ob(r){return typeof r.role=="string"}function $r(r){return typeof(r==null?void 0:r._getType)=="function"}function fu(r){return Xs.isInstance(r)}var Rb={};Xe(Rb,{ToolMessage:()=>js,ToolMessageChunk:()=>u0,defaultToolCallParser:()=>Mm,isDirectToolOutput:()=>Bm,isToolMessage:()=>$m,isToolMessageChunk:()=>Db});function Bm(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}var js=class extends jn{constructor(e,t,n){const a=typeof e=="string"||Array.isArray(e)?{content:e,name:n,tool_call_id:t}:e;super(a);g(this,"lc_direct_tool_output",!0);g(this,"type","tool");g(this,"status");g(this,"tool_call_id");g(this,"metadata");g(this,"artifact");this.tool_call_id=a.tool_call_id,this.artifact=a.artifact,this.status=a.status,this.metadata=a.metadata}static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}static isInstance(e){return super.isInstance(e)&&e.type==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},u0=class extends Xs{constructor(e){super(e);g(this,"type","tool");g(this,"tool_call_id");g(this,"status");g(this,"artifact");this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){const t=this.constructor;return new t({content:ss(this.content,e.content),additional_kwargs:qr(this.additional_kwargs,e.additional_kwargs),response_metadata:qr(this.response_metadata,e.response_metadata),artifact:Nb(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Fb(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function Mm(r){const e=[],t=[];for(const n of r)if(n.function){const a=n.function.name;try{const s=JSON.parse(n.function.arguments);e.push({name:a||"",args:s||{},id:n.id})}catch{t.push({name:a,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}function $m(r){return typeof r=="object"&&r!==null&&"getType"in r&&typeof r.getType=="function"&&r.getType()==="tool"}function Db(r){return r._getType()==="tool"}function l0(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${e}/
`,r}function eu(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}function yA(r){return!!(r&&typeof r=="object"&&"toolCall"in r&&r.toolCall!=null&&typeof r.toolCall=="object"&&"id"in r.toolCall&&typeof r.toolCall.id=="string")}var _c=class extends Error{constructor(e,t){super(e);g(this,"output");this.output=t}};function Gf(r,e=eo){r=r.trim();const t=r.indexOf("```");if(t===-1)return e(r);let n=r.substring(t+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));const a=n.indexOf("```");let s=n;return a!==-1&&(s=n.substring(0,a)),e(s.trim())}function vA(r){try{return JSON.parse(r)}catch{}const e=r.trim();if(e.length===0)throw new Error("Unexpected end of JSON input");let t=0;function n(){for(;t<e.length&&/\s/.test(e[t]);)t+=1}function a(){if(e[t]!=='"')throw new Error(`Expected '"' at position ${t}, got '${e[t]}'`);t+=1;let c="",d=!1;for(;t<e.length;){const h=e[t];if(d){if(h==="n")c+=`
`;else if(h==="t")c+="	";else if(h==="r")c+="\r";else if(h==="\\")c+="\\";else if(h==='"')c+='"';else if(h==="b")c+="\b";else if(h==="f")c+="\f";else if(h==="/")c+="/";else if(h==="u"){const f=e.substring(t+1,t+5);if(/^[0-9A-Fa-f]{0,4}$/.test(f))f.length===4?c+=String.fromCharCode(Number.parseInt(f,16)):c+=`u${f}`,t+=f.length;else throw new Error(`Invalid unicode escape sequence '\\u${f}' at position ${t}`)}else throw new Error(`Invalid escape sequence '\\${h}' at position ${t}`);d=!1}else if(h==="\\")d=!0;else{if(h==='"')return t+=1,c;c+=h}t+=1}return d&&(c+="\\"),c}function s(){const c=t;let d="";if(e[t]==="-"&&(d+="-",t+=1),t<e.length&&e[t]==="0"&&(d+="0",t+=1,e[t]>="0"&&e[t]<="9"))throw new Error(`Invalid number at position ${c}`);if(t<e.length&&e[t]>="1"&&e[t]<="9")for(;t<e.length&&e[t]>="0"&&e[t]<="9";)d+=e[t],t+=1;if(t<e.length&&e[t]===".")for(d+=".",t+=1;t<e.length&&e[t]>="0"&&e[t]<="9";)d+=e[t],t+=1;if(t<e.length&&(e[t]==="e"||e[t]==="E"))for(d+=e[t],t+=1,t<e.length&&(e[t]==="+"||e[t]==="-")&&(d+=e[t],t+=1);t<e.length&&e[t]>="0"&&e[t]<="9";)d+=e[t],t+=1;if(d==="-")return-0;const h=Number.parseFloat(d);if(Number.isNaN(h))throw t=c,new Error(`Invalid number '${d}' at position ${c}`);return h}function i(){if(n(),t>=e.length)throw new Error(`Unexpected end of input at position ${t}`);const c=e[t];if(c==="{")return u();if(c==="[")return o();if(c==='"')return a();if("null".startsWith(e.substring(t,t+4)))return t+=Math.min(4,e.length-t),null;if("true".startsWith(e.substring(t,t+4)))return t+=Math.min(4,e.length-t),!0;if("false".startsWith(e.substring(t,t+5)))return t+=Math.min(5,e.length-t),!1;if(c==="-"||c>="0"&&c<="9")return s();throw new Error(`Unexpected character '${c}' at position ${t}`)}function o(){if(e[t]!=="[")throw new Error(`Expected '[' at position ${t}, got '${e[t]}'`);const c=[];if(t+=1,n(),t>=e.length)return c;if(e[t]==="]")return t+=1,c;for(;t<e.length;){if(n(),t>=e.length||(c.push(i()),n(),t>=e.length))return c;if(e[t]==="]")return t+=1,c;if(e[t]===","){t+=1;continue}throw new Error(`Expected ',' or ']' at position ${t}, got '${e[t]}'`)}return c}function u(){if(e[t]!=="{")throw new Error(`Expected '{' at position ${t}, got '${e[t]}'`);const c={};if(t+=1,n(),t>=e.length)return c;if(e[t]==="}")return t+=1,c;for(;t<e.length;){if(n(),t>=e.length)return c;const d=a();if(n(),t>=e.length)return c;if(e[t]!==":")throw new Error(`Expected ':' at position ${t}, got '${e[t]}'`);if(t+=1,n(),t>=e.length||(c[d]=i(),n(),t>=e.length))return c;if(e[t]==="}")return t+=1,c;if(e[t]===","){t+=1;continue}throw new Error(`Expected ',' or '}' at position ${t}, got '${e[t]}'`)}return c}const l=i();if(n(),t<e.length)throw new Error(`Unexpected character '${e[t]}' at position ${t}`);return l}function eo(r){try{return typeof r>"u"?null:vA(r)}catch{return null}}var Ti=class Bb extends jn{constructor(t,n){(typeof t=="string"||Array.isArray(t))&&(t={content:t,role:n});super(t);g(this,"type","generic");g(this,"role");this.role=t.role}static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Bb}static isInstance(t){return super.isInstance(t)&&t.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},c0=class extends Xs{constructor(e,t){(typeof e=="string"||Array.isArray(e))&&(e={content:e,role:t});super(e);g(this,"type","generic");g(this,"role");this.role=e.role}static lc_name(){return"ChatMessageChunk"}concat(e){const t=this.constructor;return new t({content:ss(this.content,e.content),additional_kwargs:qr(this.additional_kwargs,e.additional_kwargs),response_metadata:qr(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}};function _A(r){return r._getType()==="generic"}function bA(r){return r._getType()==="generic"}var d0=class extends jn{constructor(e){super(e);g(this,"type","function");g(this,"name");this.name=e.name}static lc_name(){return"FunctionMessage"}},h0=class extends Xs{constructor(){super(...arguments);g(this,"type","function")}static lc_name(){return"FunctionMessageChunk"}concat(e){const t=this.constructor;return new t({content:ss(this.content,e.content),additional_kwargs:qr(this.additional_kwargs,e.additional_kwargs),response_metadata:qr(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function wA(r){return r._getType()==="function"}function EA(r){return r._getType()==="function"}var Gn=class extends jn{constructor(e){super(e);g(this,"type","human")}static lc_name(){return"HumanMessage"}static isInstance(e){return super.isInstance(e)&&e.type==="human"}},f0=class extends Xs{constructor(e){super(e);g(this,"type","human")}static lc_name(){return"HumanMessageChunk"}concat(e){const t=this.constructor;return new t({content:ss(this.content,e.content),additional_kwargs:qr(this.additional_kwargs,e.additional_kwargs),response_metadata:qr(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="human"}};function xA(r){return r.getType()==="human"}function SA(r){return r.getType()==="human"}var bc=class extends jn{constructor(e){super({...e,content:[]});g(this,"type","remove");g(this,"id");this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&e.type==="remove"}},is=class Hl extends jn{constructor(t){super(t);g(this,"type","system")}static lc_name(){return"SystemMessage"}concat(t){if(typeof t=="string")return new Hl({...this,content:ss(this.content,t)});if(Hl.isInstance(t))return new Hl({...this,additional_kwargs:{...this.additional_kwargs,...t.additional_kwargs},response_metadata:{...this.response_metadata,...t.response_metadata},content:ss(this.content,t.content)});throw new Error("Unexpected chunk type for system message")}static isInstance(t){return super.isInstance(t)&&t.type==="system"}},to=class extends Xs{constructor(e){super(e);g(this,"type","system")}static lc_name(){return"SystemMessageChunk"}concat(e){const t=this.constructor;return new t({content:ss(this.content,e.content),additional_kwargs:qr(this.additional_kwargs,e.additional_kwargs),response_metadata:qr(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="system"}};function AA(r){return r._getType()==="system"}function kA(r){return r._getType()==="system"}function Pm(r){switch(r){case"csv":return"text/csv";case"doc":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":return"image/jpeg";case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function CA(r){if(lt(r.document)&&lt(r.document.source)){const e=lt(r.document)&&Be(r.document.format)?r.document.format:"",t=Pm(e);if(lt(r.document.source)){if(lt(r.document.source.s3Location)&&Be(r.document.source.s3Location.uri))return{type:"file",mimeType:t,fileId:r.document.source.s3Location.uri};if(Rm(r.document.source.bytes))return{type:"file",mimeType:t,data:r.document.source.bytes};if(Be(r.document.source.text))return{type:"file",mimeType:t,data:Buffer.from(r.document.source.text).toString("base64")};if(Ia(r.document.source.content)){const n=r.document.source.content.reduce((a,s)=>lt(s)&&Be(s.text)?a+s.text:a,"");return{type:"file",mimeType:t,data:n}}}}return{type:"non_standard",value:r}}function TA(r){if(We(r,"image")&&lt(r.image)){const e=lt(r.image)&&Be(r.image.format)?r.image.format:"",t=Pm(e);if(lt(r.image.source)){if(lt(r.image.source.s3Location)&&Be(r.image.source.s3Location.uri))return{type:"image",mimeType:t,fileId:r.image.source.s3Location.uri};if(Rm(r.image.source.bytes))return{type:"image",mimeType:t,data:r.image.source.bytes}}}return{type:"non_standard",value:r}}function FA(r){if(We(r,"video")&&lt(r.video)){const e=lt(r.video)&&Be(r.video.format)?r.video.format:"",t=Pm(e);if(lt(r.video.source)){if(lt(r.video.source.s3Location)&&Be(r.video.source.s3Location.uri))return{type:"video",mimeType:t,fileId:r.video.source.s3Location.uri};if(Rm(r.video.source.bytes))return{type:"video",mimeType:t,data:r.video.source.bytes}}}return{type:"non_standard",value:r}}function Ky(r){function*e(){const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const n of t){if(We(n,"cache_point")){yield{type:"non_standard",value:n};continue}else if(We(n,"citations_content")&&lt(n.citationsContent)){const a=Ia(n.citationsContent.content)?n.citationsContent.content.reduce((i,o)=>lt(o)&&Be(o.text)?i+o.text:i,""):"",s=Ia(n.citationsContent.citations)?n.citationsContent.citations.reduce((i,o)=>{if(lt(o)){const u=Ia(o.sourceContent)?o.sourceContent.reduce((c,d)=>lt(d)&&Be(d.text)?c+d.text:c,""):"",l=hu(()=>{if(lt(o.location)){const c=o.location.documentChar||o.location.documentPage||o.location.documentChunk;if(lt(c))return{source:ra(c.documentIndex)?c.documentIndex.toString():void 0,startIndex:ra(c.start)?c.start:void 0,endIndex:ra(c.end)?c.end:void 0}}return{}});i.push({type:"citation",citedText:u,...l})}return i},[]):[];yield{type:"text",text:a,annotations:s};continue}else if(We(n,"document")&&lt(n.document)){yield CA(n);continue}else if(We(n,"guard_content")){yield{type:"non_standard",value:n};continue}else if(We(n,"image")&&lt(n.image)){yield TA(n);continue}else if(We(n,"reasoning_content")&&Be(n.reasoningText)){yield{type:"reasoning",reasoning:n.reasoningText};continue}else if(We(n,"text")&&Be(n.text)){yield{type:"text",text:n.text};continue}else if(We(n,"tool_result")){yield{type:"non_standard",value:n};continue}else{if(We(n,"tool_call"))continue;if(We(n,"video")&&lt(n.video)){yield FA(n);continue}}yield{type:"non_standard",value:n}}}return Array.from(e())}const NA={translateContent:Ky,translateContentChunk:Ky};function Wy(r){function*e(){const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const n of t){if(We(n,"text")&&Be(n.text)){yield{type:"text",text:n.text};continue}else if(We(n,"inlineData")&&lt(n.inlineData)&&Be(n.inlineData.mimeType)&&Be(n.inlineData.data)){yield{type:"file",mimeType:n.inlineData.mimeType,data:n.inlineData.data};continue}else if(We(n,"functionCall")&&lt(n.functionCall)&&Be(n.functionCall.name)&&lt(n.functionCall.args)){yield{type:"tool_call",id:r.id,name:n.functionCall.name,args:n.functionCall.args};continue}else if(We(n,"functionResponse")){yield{type:"non_standard",value:n};continue}else if(We(n,"fileData")&&lt(n.fileData)&&Be(n.fileData.mimeType)&&Be(n.fileData.fileUri)){yield{type:"file",mimeType:n.fileData.mimeType,fileId:n.fileData.fileUri};continue}else if(We(n,"executableCode")){yield{type:"non_standard",value:n};continue}else if(We(n,"codeExecutionResult")){yield{type:"non_standard",value:n};continue}yield{type:"non_standard",value:n}}}return Array.from(e())}const IA={translateContent:Wy,translateContentChunk:Wy};function Yy(r){function*e(){const t=typeof r.content=="string"?[{type:"text",text:r.content}]:r.content;for(const n of t){if(We(n,"reasoning")&&Be(n.reasoning)){const a=hu(()=>{var i;const s=t.indexOf(n);if(Ia((i=r.additional_kwargs)==null?void 0:i.signatures)&&s>=0)return r.additional_kwargs.signatures.at(s)});Be(a)?yield{type:"reasoning",reasoning:n.reasoning,signature:a}:yield{type:"reasoning",reasoning:n.reasoning};continue}else if(We(n,"text")&&Be(n.text)){yield{type:"text",text:n.text};continue}else if(We(n,"image_url")){if(Be(n.image_url))if(n.image_url.startsWith("data:")){const a=/^data:([^;]+);base64,(.+)$/,s=n.image_url.match(a);s?yield{type:"image",data:s[2],mimeType:s[1]}:yield{type:"image",url:n.image_url}}else yield{type:"image",url:n.image_url};continue}else if(We(n,"media")&&Be(n.mimeType)&&Be(n.data)){yield{type:"file",mimeType:n.mimeType,data:n.data};continue}yield{type:"non_standard",value:n}}}return Array.from(e())}const OA={translateContent:Yy,translateContentChunk:Yy};globalThis.lc_block_translators_registry??(globalThis.lc_block_translators_registry=new Map([["anthropic",rA],["bedrock-converse",NA],["google-genai",IA],["google-vertexai",OA],["openai",hA]]));function Mb(r){return globalThis.lc_block_translators_registry.get(r)}function $b(r,e){return qr(r??{},e??{})}function Pb(r,e){const t={};return((r==null?void 0:r.audio)!==void 0||(e==null?void 0:e.audio)!==void 0)&&(t.audio=((r==null?void 0:r.audio)??0)+((e==null?void 0:e.audio)??0)),((r==null?void 0:r.image)!==void 0||(e==null?void 0:e.image)!==void 0)&&(t.image=((r==null?void 0:r.image)??0)+((e==null?void 0:e.image)??0)),((r==null?void 0:r.video)!==void 0||(e==null?void 0:e.video)!==void 0)&&(t.video=((r==null?void 0:r.video)??0)+((e==null?void 0:e.video)??0)),((r==null?void 0:r.document)!==void 0||(e==null?void 0:e.document)!==void 0)&&(t.document=((r==null?void 0:r.document)??0)+((e==null?void 0:e.document)??0)),((r==null?void 0:r.text)!==void 0||(e==null?void 0:e.text)!==void 0)&&(t.text=((r==null?void 0:r.text)??0)+((e==null?void 0:e.text)??0)),t}function RA(r,e){const t={...Pb(r,e)};return((r==null?void 0:r.cache_read)!==void 0||(e==null?void 0:e.cache_read)!==void 0)&&(t.cache_read=((r==null?void 0:r.cache_read)??0)+((e==null?void 0:e.cache_read)??0)),((r==null?void 0:r.cache_creation)!==void 0||(e==null?void 0:e.cache_creation)!==void 0)&&(t.cache_creation=((r==null?void 0:r.cache_creation)??0)+((e==null?void 0:e.cache_creation)??0)),t}function DA(r,e){const t={...Pb(r,e)};return((r==null?void 0:r.reasoning)!==void 0||(e==null?void 0:e.reasoning)!==void 0)&&(t.reasoning=((r==null?void 0:r.reasoning)??0)+((e==null?void 0:e.reasoning)??0)),t}function Lb(r,e){return{input_tokens:((r==null?void 0:r.input_tokens)??0)+((e==null?void 0:e.input_tokens)??0),output_tokens:((r==null?void 0:r.output_tokens)??0)+((e==null?void 0:e.output_tokens)??0),total_tokens:((r==null?void 0:r.total_tokens)??0)+((e==null?void 0:e.total_tokens)??0),input_token_details:RA(r==null?void 0:r.input_token_details,e==null?void 0:e.input_token_details),output_token_details:DA(r==null?void 0:r.output_token_details,e==null?void 0:e.output_token_details)}}var Hr=class extends jn{constructor(e){var n;let t;if(typeof e=="string"||Array.isArray(e))t={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{t=e;const a=(n=t.additional_kwargs)==null?void 0:n.tool_calls,s=t.tool_calls;a!=null&&a.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `pnpm install @langchain/anthropic`,","pnpm install @langchain/openai`, etc."].join(" "));try{if(a!=null&&s===void 0){const[i,o]=Mm(a);t.tool_calls=i??[],t.invalid_tool_calls=o??[]}else t.tool_calls=t.tool_calls??[],t.invalid_tool_calls=t.invalid_tool_calls??[]}catch{t.tool_calls=[],t.invalid_tool_calls=[]}if(t.response_metadata!==void 0&&"output_version"in t.response_metadata&&t.response_metadata.output_version==="v1"&&(t.contentBlocks=t.content,t.content=void 0),t.contentBlocks!==void 0){t.contentBlocks.push(...t.tool_calls.map(o=>({type:"tool_call",id:o.id,name:o.name,args:o.args})));const i=t.contentBlocks.filter(o=>o.type==="tool_call").filter(o=>{var u;return!((u=t.tool_calls)!=null&&u.some(l=>l.id===o.id&&l.name===o.name))});i.length>0&&(t.tool_calls=i.map(o=>({type:"tool_call",id:o.id,name:o.name,args:o.args})))}}super(t);g(this,"type","ai");g(this,"tool_calls",[]);g(this,"invalid_tool_calls",[]);g(this,"usage_metadata");typeof t!="string"&&(this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const t=Mb(this.response_metadata.model_provider);if(t)return t.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls){const t=this.tool_calls.filter(n=>!e.some(a=>a.id===n.id&&a.name===n.name));e.push(...t.map(n=>({...n,type:"tool_call",id:n.id,name:n.name,args:n.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};function Lm(r){return r._getType()==="ai"}function Zf(r){return r._getType()==="ai"}var ca=class extends Xs{constructor(e){let t;typeof e=="string"||Array.isArray(e)?t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]}:e.tool_call_chunks===void 0||e.tool_call_chunks.length===0?t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}:t={...e,...zb(e.tool_call_chunks??[]),usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};super(t);g(this,"type","ai");g(this,"tool_calls",[]);g(this,"invalid_tool_calls",[]);g(this,"tool_call_chunks",[]);g(this,"usage_metadata");this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const t=Mb(this.response_metadata.model_provider);if(t)return t.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls&&typeof this.content!="string"){const t=this.content.filter(n=>n.type==="tool_call").map(n=>n.id);for(const n of this.tool_calls)n.id&&!t.includes(n.id)&&e.push({...n,type:"tool_call",id:n.id,name:n.name,args:n.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:ss(this.content,e.content),additional_kwargs:qr(this.additional_kwargs,e.additional_kwargs),response_metadata:$b(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const a=Uu(this.tool_call_chunks,e.tool_call_chunks);a!==void 0&&a.length>0&&(t.tool_call_chunks=a)}(this.usage_metadata!==void 0||e.usage_metadata!==void 0)&&(t.usage_metadata=Lb(this.usage_metadata,e.usage_metadata));const n=this.constructor;return new n(t)}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};const BA=r=>r();function MA(r){return eu(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function $A(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function Kd(r){let e,t;if($A(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...a}=r;e=n,t=a}if(e==="human"||e==="user")return new Gn(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...a}=t;if(!Array.isArray(n))return new Hr(t);const s=n.map(MA);return new Hr({...a,tool_calls:s})}else{if(e==="system")return new is(t);if(e==="developer")return new is({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new js({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});if(e==="remove"&&"id"in t&&typeof t.id=="string")return new bc({...t,id:t.id});throw l0(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Oa(r){if(typeof r=="string")return new Gn(r);if($r(r))return r;if(Array.isArray(r)){const[e,t]=r;return Kd({type:e,content:t})}else if(Ob(r)){const{role:e,...t}=r;return Kd({...t,type:e})}else return Kd(r)}function zm(r,e="Human",t="AI"){const n=[];for(const a of r){let s;if(a._getType()==="human")s=e;else if(a._getType()==="ai")s=t;else if(a._getType()==="system")s="System";else if(a._getType()==="tool")s="Tool";else if(a._getType()==="generic")s=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);const i=a.name?`${a.name}, `:"",o=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);n.push(`${s}: ${i}${o}`)}return n.join(`
`)}function PA(r){if(r.data!==void 0)return r;{const e=r;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function Um(r){const e=PA(r);switch(e.type){case"human":return new Gn(e.data);case"ai":return new Hr(e.data);case"system":return new is(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new d0(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new js(e.data);case"generic":if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new Ti(e.data);default:throw new Error(`Got unexpected type: ${e.type}`)}}function LA(r){return r.map(Um)}function zA(r){return r.map(e=>e.toDict())}function wc(r){var t;const e=r._getType();if(e==="human")return new f0({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new ca({...n})}else{if(e==="system")return new to({...r});if(e==="function")return new h0({...r});if(Ti.isInstance(r))return new c0({...r});throw new Error("Unknown message type.")}}function zb(r){var a,s;const e=r.reduce((i,o)=>{const u=i.findIndex(([l])=>"id"in o&&o.id&&"index"in o&&o.index!==void 0?o.id===l.id&&o.index===l.index:"id"in o&&o.id?o.id===l.id:"index"in o&&o.index!==void 0?o.index===l.index:!1);return u!==-1?i[u].push(o):i.push([o]),i},[]),t=[],n=[];for(const i of e){let o=null;const u=((a=i[0])==null?void 0:a.name)??"",l=i.map(h=>h.args||"").join("").trim(),c=l.length?l:"{}",d=(s=i[0])==null?void 0:s.id;try{if(o=eo(c),!d||o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");t.push({name:u,args:o,id:d,type:"tool_call"})}catch{n.push({name:u,args:c,id:d,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:r,tool_calls:t,invalid_tool_calls:n}}var Wd={},Ub={};Xe(Ub,{getEnv:()=>Gb,getEnvironmentVariable:()=>Xa,getRuntimeEnvironment:()=>Zb,isBrowser:()=>jb,isDeno:()=>p0,isJsDom:()=>Hb,isNode:()=>Vb,isWebWorker:()=>qb});const jb=()=>typeof window<"u"&&typeof window.document<"u",qb=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Hb=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),p0=()=>typeof Deno<"u",Vb=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!p0(),Gb=()=>{let r;return jb()?r="browser":Vb()?r="node":qb()?r="webworker":Hb()?r="jsdom":p0()?r="deno":r="other",r};let Yd;function Zb(){return Yd===void 0&&(Yd={library:"langchain-js",runtime:Gb()}),Yd}function Xa(r){try{return typeof process<"u"?Wd==null?void 0:Wd[r]:p0()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}const UA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function hi(r){return typeof r=="string"&&UA.test(r)}function Kb(r){if(!hi(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Br=[];for(var Jd=0;Jd<256;++Jd)Br.push((Jd+256).toString(16).slice(1));function Eo(r,e=0){return(Br[r[e+0]]+Br[r[e+1]]+Br[r[e+2]]+Br[r[e+3]]+"-"+Br[r[e+4]]+Br[r[e+5]]+"-"+Br[r[e+6]]+Br[r[e+7]]+"-"+Br[r[e+8]]+Br[r[e+9]]+"-"+Br[r[e+10]]+Br[r[e+11]]+Br[r[e+12]]+Br[r[e+13]]+Br[r[e+14]]+Br[r[e+15]]).toLowerCase()}var vl,jA=new Uint8Array(16);function jm(){if(!vl&&(vl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vl(jA)}var Xd,_l,Qd=0,eh=0;function qA(r,e,t){var n=0,a=e||new Array(16);r=r||{};var s=r.node,i=r.clockseq;if(r._v6||(s||(s=Xd),i==null&&(i=_l)),s==null||i==null){var o=r.random||(r.rng||jm)();s==null&&(s=[o[0],o[1],o[2],o[3],o[4],o[5]],!Xd&&!r._v6&&(s[0]|=1,Xd=s)),i==null&&(i=(o[6]<<8|o[7])&16383,_l===void 0&&!r._v6&&(_l=i))}var u=r.msecs!==void 0?r.msecs:Date.now(),l=r.nsecs!==void 0?r.nsecs:eh+1,c=u-Qd+(l-eh)/1e4;if(c<0&&r.clockseq===void 0&&(i=i+1&16383),(c<0||u>Qd)&&r.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Qd=u,eh=l,_l=i,u+=122192928e5;var d=((u&268435455)*1e4+l)%4294967296;a[n++]=d>>>24&255,a[n++]=d>>>16&255,a[n++]=d>>>8&255,a[n++]=d&255;var h=u/4294967296*1e4&268435455;a[n++]=h>>>8&255,a[n++]=h&255,a[n++]=h>>>24&15|16,a[n++]=h>>>16&255,a[n++]=i>>>8|128,a[n++]=i&255;for(var f=0;f<6;++f)a[n+f]=s[f];return e||Eo(a)}function HA(r){var e=typeof r=="string"?Kb(r):r,t=VA(e);return typeof r=="string"?Eo(t):t}function VA(r,e=!1){return Uint8Array.of((r[6]&15)<<4|r[7]>>4&15,(r[7]&15)<<4|(r[4]&240)>>4,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,(r[1]&15)<<4|(r[2]&240)>>4,96|r[2]&15,r[3],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function GA(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var ZA="6ba7b810-9dad-11d1-80b4-00c04fd430c8",KA="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function WA(r,e,t){function n(a,s,i,o){var u;if(typeof a=="string"&&(a=GA(a)),typeof s=="string"&&(s=Kb(s)),((u=s)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var l=new Uint8Array(16+a.length);if(l.set(s),l.set(a,s.length),l=t(l),l[6]=l[6]&15|e,l[8]=l[8]&63|128,i){o=o||0;for(var c=0;c<16;++c)i[o+c]=l[c];return i}return Eo(l)}try{n.name=r}catch{}return n.DNS=ZA,n.URL=KA,n}var YA=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Jy={randomUUID:YA};function Ga(r,e,t){if(Jy.randomUUID&&!r)return Jy.randomUUID();r=r||{};var n=r.random||(r.rng||jm)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Eo(n)}function JA(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function th(r,e){return r<<e|r>>>32-e}function XA(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var a=0;a<n.length;++a)r.push(n.charCodeAt(a))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var s=r.length/4+2,i=Math.ceil(s/16),o=new Array(i),u=0;u<i;++u){for(var l=new Uint32Array(16),c=0;c<16;++c)l[c]=r[u*64+c*4]<<24|r[u*64+c*4+1]<<16|r[u*64+c*4+2]<<8|r[u*64+c*4+3];o[u]=l}o[i-1][14]=(r.length-1)*8/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=(r.length-1)*8&4294967295;for(var d=0;d<i;++d){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=o[d][f];for(var p=16;p<80;++p)h[p]=th(h[p-3]^h[p-8]^h[p-14]^h[p-16],1);for(var m=t[0],v=t[1],_=t[2],w=t[3],E=t[4],F=0;F<80;++F){var k=Math.floor(F/20),N=th(m,5)+JA(k,v,_,w)+E+e[k]+h[F]>>>0;E=w,w=_,_=th(v,30)>>>0,v=m,m=N}t[0]=t[0]+m>>>0,t[1]=t[1]+v>>>0,t[2]=t[2]+_>>>0,t[3]=t[3]+w>>>0,t[4]=t[4]+E>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var Ts=WA("v5",80,XA);function Xy(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function Qy(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Xy(Object(t),!0).forEach(function(n){QA(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Xy(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function QA(r,e,t){return(e=ek(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ek(r){var e=tk(r,"string");return typeof e=="symbol"?e:e+""}function tk(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function rk(r={},e,t=0){var n=qA(Qy(Qy({},r),{},{_v6:!0}),new Uint8Array(16));return n=HA(n),Eo(n)}var ev=null,tv=null,Yn=0;function Es(r,e,t){r=r||{};var n=0,a=new Uint8Array(16),s=r.random||(r.rng||jm)(),i=r.msecs!==void 0?r.msecs:Date.now(),o=r.seq!==void 0?r.seq:null,u=tv,l=ev;return i>Yn&&r.msecs===void 0&&(Yn=i,o!==null&&(u=null,l=null)),o!==null&&(o>2147483647&&(o=2147483647),u=o>>>19&4095,l=o&524287),(u===null||l===null)&&(u=s[6]&127,u=u<<8|s[7],l=s[8]&63,l=l<<8|s[9],l=l<<5|s[10]>>>3),i+1e4>Yn&&o===null?++l>524287&&(l=0,++u>4095&&(u=0,Yn++)):Yn=i,tv=u,ev=l,a[n++]=Yn/1099511627776&255,a[n++]=Yn/4294967296&255,a[n++]=Yn/16777216&255,a[n++]=Yn/65536&255,a[n++]=Yn/256&255,a[n++]=Yn&255,a[n++]=u>>>4&15|112,a[n++]=u&255,a[n++]=l>>>13&63|128,a[n++]=l>>>5&255,a[n++]=l<<3&255|s[10]&7,a[n++]=s[11],a[n++]=s[12],a[n++]=s[13],a[n++]=s[14],a[n++]=s[15],e||Eo(a)}var Wb={};Xe(Wb,{BaseCallbackHandler:()=>xo,callbackHandlerPrefersStreaming:()=>qm,isBaseCallbackHandler:()=>Yb});var nk=class{};function qm(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}var xo=class extends nk{constructor(e){super();g(this,"lc_serializable",!1);g(this,"lc_kwargs");g(this,"ignoreLLM",!1);g(this,"ignoreChain",!1);g(this,"ignoreAgent",!1);g(this,"ignoreRetriever",!1);g(this,"ignoreCustomEvent",!1);g(this,"raiseError",!1);g(this,"awaitHandlers",Xa("LANGCHAIN_CALLBACKS_BACKGROUND")==="false");this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,o0(this.constructor)]}copy(){return new this.constructor(this)}toJSON(){return Vn.prototype.toJSON.call(this)}toJSONNotImplemented(){return Vn.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends xo{constructor(){super();g(this,"name",Es());Object.assign(this,e)}}return new t}};const Yb=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},ak="gen_ai.operation.name",sk="gen_ai.system",rv="gen_ai.request.model",ik="gen_ai.response.model",nv="gen_ai.usage.input_tokens",av="gen_ai.usage.output_tokens",sv="gen_ai.usage.total_tokens",ok="gen_ai.request.max_tokens",uk="gen_ai.request.temperature",lk="gen_ai.request.top_p",ck="gen_ai.request.frequency_penalty",dk="gen_ai.request.presence_penalty",hk="gen_ai.response.finish_reasons",fk="gen_ai.prompt",pk="gen_ai.completion",mk="gen_ai.request.extra_query",gk="gen_ai.request.extra_body",yk="gen_ai.serialized.name",vk="gen_ai.serialized.signature",_k="gen_ai.serialized.doc",bk="gen_ai.response.id",wk="gen_ai.response.service_tier",Ek="gen_ai.response.system_fingerprint",xk="gen_ai.usage.input_token_details",Sk="gen_ai.usage.output_token_details",Ak="langsmith.trace.session_id",kk="langsmith.trace.session_name",Ck="langsmith.span.kind",Tk="langsmith.trace.name",Fk="langsmith.metadata",iv="langsmith.span.tags",Nk="langsmith.request.streaming",Ik="langsmith.request.headers",Ok=(...r)=>fetch(...r),Jb=Symbol.for("ls:fetch_implementation"),Rk=()=>{const r=globalThis[Jb];return r?typeof r=="function"&&"Headers"in r&&"Request"in r&&"Response"in r:!1},Dk=r=>async(...e)=>{if(r||fn("DEBUG")==="true"){const[n,a]=e;console.log(`\u2192 ${(a==null?void 0:a.method)||"GET"} ${n}`)}const t=await(globalThis[Jb]??Ok)(...e);return(r||fn("DEBUG")==="true")&&console.log(`\u2190 ${t.status} ${t.statusText} ${t.url}`),t},Xb=()=>fn("PROJECT")??Ba("LANGCHAIN_SESSION")??"default",ov={};function Kf(r){ov[r]||(console.warn(r),ov[r]=!0)}const Bk=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function ut(r,e){if(!Bk.test(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}function Mk(r){const e=typeof r=="string"?Date.parse(r):r;return Es({msecs:e,seq:0})}const Qb="0.3.87";var tu={};let _a;const $k=()=>typeof window<"u"&&typeof window.document<"u",Pk=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Lk=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),e6=()=>typeof Deno<"u",zk=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!e6(),t6=()=>_a||(typeof Bun<"u"?_a="bun":$k()?_a="browser":zk()?_a="node":Pk()?_a="webworker":Lk()?_a="jsdom":e6()?_a="deno":_a="other",_a);let rh;function r6(){if(rh===void 0){const r=t6(),e=jk();rh={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:Qb,...e}}return rh}function n6(){const r=Uk(),e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,a]of Object.entries(r))typeof a=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[n]=a);return e}function Uk(){const r={};try{if(typeof process<"u"&&tu)for(const[e,t]of Object.entries(tu))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&t!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof t=="string"?r[e]=t.slice(0,2)+"*".repeat(t.length-4)+t.slice(-2):r[e]=t)}catch{}return r}function Ba(r){try{return typeof process<"u"?tu==null?void 0:tu[r]:void 0}catch{return}}function fn(r){return Ba(`LANGSMITH_${r}`)||Ba(`LANGCHAIN_${r}`)}let nh;function jk(){if(nh!==void 0)return nh;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=Ba(t);n!==void 0&&(e[t]=n)}return nh=e,e}function a6(){return Ba("OTEL_ENABLED")==="true"||fn("OTEL_ENABLED")==="true"}class qk{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&a6()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(t.length===1&&typeof t[0]=="function"?n=t[0]:t.length===2&&typeof t[1]=="function"?n=t[1]:t.length===3&&typeof t[2]=="function"&&(n=t[2]),typeof n=="function")return n()}}class Hk{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new qk})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class Vk{active(){return{}}with(e,t){return t()}}const ah=Symbol.for("ls:otel_trace"),sh=Symbol.for("ls:otel_context"),uv=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Gk=new Hk,Zk=new Vk;class Kk{getTraceInstance(){return globalThis[ah]??Gk}getContextInstance(){return globalThis[sh]??Zk}initializeGlobalInstances(e){globalThis[ah]===void 0&&(globalThis[ah]=e.trace),globalThis[sh]===void 0&&(globalThis[sh]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[uv]=e}getDefaultOTLPTracerComponents(){return globalThis[uv]??void 0}}const Hm=new Kk;function s6(){return Hm.getTraceInstance()}function Wk(){return Hm.getContextInstance()}function Yk(){return Hm.getDefaultOTLPTracerComponents()}const Jk={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function Xk(r){return Jk[r]||r}class Qk{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(const n of e)try{if(!n.run)continue;if(n.operation==="post"){const a=this.createSpanForRun(n,n.run,t.get(n.id));a&&!n.run.end_time&&this.spans.set(n.id,a)}else this.updateSpanForRun(n,n.run)}catch(a){console.error(`Error processing operation ${n.id}:`,a)}}createSpanForRun(e,t,n){const a=n&&s6().getSpan(n);if(a)try{return this.finishSpanSetup(a,t,e)}catch(s){console.error(`Failed to create span for run ${e.id}:`,s);return}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{const n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});const a=t.end_time;a&&(n.end(new Date(a)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){var t;if((t=e.extra)!=null&&t.metadata){const n=e.extra.metadata;if(n.ls_model_name)return n.ls_model_name;if(n.invocation_params){const a=n.invocation_params;if(a.model)return a.model;if(a.model_name)return a.model_name}}}setSpanAttributes(e,t,n){var o;if("run_type"in t&&t.run_type){e.setAttribute(Ck,t.run_type);const u=Xk(t.run_type||"chain");e.setAttribute(ak,u)}"name"in t&&t.name&&e.setAttribute(Tk,t.name),"session_id"in t&&t.session_id&&e.setAttribute(Ak,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(kk,t.session_name),this.setGenAiSystem(e,t);const a=this.extractModelName(t);a&&e.setAttribute(rv,a),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(nv,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(av,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(sv,t.total_tokens),this.setInvocationParameters(e,t);const s=((o=t.extra)==null?void 0:o.metadata)||{};for(const[u,l]of Object.entries(s))l!=null&&e.setAttribute(`${Fk}.${u}`,String(l));const i=t.tags;if(i&&Array.isArray(i)?e.setAttribute(iv,i.join(", ")):i&&e.setAttribute(iv,String(i)),"serialized"in t&&typeof t.serialized=="object"){const u=t.serialized;u.name&&e.setAttribute(yk,String(u.name)),u.signature&&e.setAttribute(vk,String(u.signature)),u.doc&&e.setAttribute(_k,String(u.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain";const a=this.extractModelName(t);if(a){const s=a.toLowerCase();s.includes("anthropic")||s.startsWith("claude")?n="anthropic":s.includes("bedrock")?n="aws.bedrock":s.includes("azure")&&s.includes("openai")?n="az.ai.openai":s.includes("azure")&&s.includes("inference")?n="az.ai.inference":s.includes("cohere")?n="cohere":s.includes("deepseek")?n="deepseek":s.includes("gemini")?n="gemini":s.includes("groq")?n="groq":s.includes("watson")||s.includes("ibm")?n="ibm.watsonx.ai":s.includes("mistral")?n="mistral_ai":s.includes("gpt")||s.includes("openai")?n="openai":s.includes("perplexity")||s.includes("sonar")?n="perplexity":s.includes("vertex")?n="vertex_ai":(s.includes("xai")||s.includes("grok"))&&(n="xai")}e.setAttribute(sk,n)}setInvocationParameters(e,t){var a,s;if(!((s=(a=t.extra)==null?void 0:a.metadata)!=null&&s.invocation_params))return;const n=t.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(ok,n.max_tokens),n.temperature!==void 0&&e.setAttribute(uk,n.temperature),n.top_p!==void 0&&e.setAttribute(lk,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(ck,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(dk,n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{const n=t.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(rv,n.model),n.stream!==void 0&&e.setAttribute(Nk,n.stream),n.extra_headers&&e.setAttribute(Ik,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(mk,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(gk,JSON.stringify(n.extra_body))),e.setAttribute(fk,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{const n=t.run.outputs,a=this.getUnifiedRunTokens(n);if(a&&(e.setAttribute(nv,a[0]),e.setAttribute(av,a[1]),e.setAttribute(sv,a[0]+a[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(ik,String(n.model)),n.id&&e.setAttribute(bk,n.id),n.choices&&Array.isArray(n.choices)){const s=n.choices.map(i=>i.finish_reason).filter(i=>i).map(String);s.length>0&&e.setAttribute(hk,s.join(", "))}if(n.service_tier&&e.setAttribute(wk,n.service_tier),n.system_fingerprint&&e.setAttribute(Ek,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){const s=n.usage_metadata;s.input_token_details&&e.setAttribute(xk,JSON.stringify(s.input_token_details)),s.output_token_details&&e.setAttribute(Sk,JSON.stringify(s.output_token_details))}}e.setAttribute(pk,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;const n=Object.keys(e);for(const i of n){const o=e[i];if(!(!o||typeof o!="object")&&(t=this.extractUnifiedRunTokens(o.usage_metadata),t||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(t=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),t)))return t}const a=e.generations||[];if(!Array.isArray(a))return null;const s=Array.isArray(a[0])?a.flat():a;for(const i of s)if(typeof i=="object"&&i.message&&typeof i.message=="object"&&i.message.kwargs&&typeof i.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(i.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}}const eC=Object.prototype.toString,tC=r=>eC.call(r)==="[object Error]",rC=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function nC(r){if(!(r&&tC(r)&&r.name==="TypeError"&&typeof r.message=="string"))return!1;const{message:t,stack:n}=r;return t==="Load failed"?n===void 0||"__sentry_captured__"in r:t.startsWith("error sending request for url")?!0:rC.has(t)}function aC(r){if(typeof r=="number"){if(r<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(r))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(r!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function bl(r,e,{min:t=0,allowInfinity:n=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${r}\` to be a number${n?" or Infinity":""}.`);if(!n&&!Number.isFinite(e))throw new TypeError(`Expected \`${r}\` to be a finite number.`);if(e<t)throw new TypeError(`Expected \`${r}\` to be \u2265 ${t}.`)}}let sC=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function iC(r,e){const t=Math.max(1,r+1),n=e.randomize?Math.random()+1:1;let a=Math.round(n*e.minTimeout*e.factor**(t-1));return a=Math.min(a,e.maxTimeout),a}function lv(r,e){return Number.isFinite(e)?e-(performance.now()-r):e}async function oC({error:r,attemptNumber:e,retriesConsumed:t,startTime:n,options:a}){var f,p,m;const s=r instanceof Error?r:new TypeError(`Non-error was thrown: "${r}". You should only throw errors.`);if(s instanceof sC)throw s.originalError;const i=Number.isFinite(a.retries)?Math.max(0,a.retries-t):a.retries,o=a.maxRetryTime??Number.POSITIVE_INFINITY,u=Object.freeze({error:s,attemptNumber:e,retriesLeft:i,retriesConsumed:t});if(await a.onFailedAttempt(u),lv(n,o)<=0)throw s;const l=await a.shouldConsumeRetry(u),c=lv(n,o);if(c<=0||i<=0)throw s;if(s instanceof TypeError&&!nC(s)){if(l)throw s;return(f=a.signal)==null||f.throwIfAborted(),!1}if(!await a.shouldRetry(u))throw s;if(!l)return(p=a.signal)==null||p.throwIfAborted(),!1;const d=iC(t,a),h=Math.min(d,c);return h>0&&await new Promise((v,_)=>{var F,k;const w=()=>{var N;clearTimeout(E),(N=a.signal)==null||N.removeEventListener("abort",w),_(a.signal.reason)},E=setTimeout(()=>{var N;(N=a.signal)==null||N.removeEventListener("abort",w),v()},h);a.unref&&((F=E.unref)==null||F.call(E)),(k=a.signal)==null||k.addEventListener("abort",w,{once:!0})}),(m=a.signal)==null||m.throwIfAborted(),!0}async function uC(r,e={}){var s,i,o;if(e={...e},aC(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??(e.retries=10),e.factor??(e.factor=2),e.minTimeout??(e.minTimeout=1e3),e.maxTimeout??(e.maxTimeout=Number.POSITIVE_INFINITY),e.maxRetryTime??(e.maxRetryTime=Number.POSITIVE_INFINITY),e.randomize??(e.randomize=!1),e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.shouldConsumeRetry??(e.shouldConsumeRetry=()=>!0),bl("factor",e.factor,{min:0,allowInfinity:!1}),bl("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),bl("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),bl("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),(s=e.signal)==null||s.throwIfAborted();let t=0,n=0;const a=performance.now();for(;!Number.isFinite(e.retries)||n<=e.retries;){t++;try{(i=e.signal)==null||i.throwIfAborted();const u=await r(t);return(o=e.signal)==null||o.throwIfAborted(),u}catch(u){await oC({error:u,attemptNumber:t,retriesConsumed:n,startTime:a,options:e})&&n++}}throw new Error("Retry attempts exhausted without throwing an error.")}var wl={},ih={exports:{}},cv;function lC(){return cv||(cv=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function a(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function s(u,l,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new a(c,d||u,h),p=t?t+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],f]:u._events[p].push(f):(u._events[p]=f,u._eventsCount++),u}function i(u,l){--u._eventsCount===0?u._events=new n:delete u._events[l]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=t?t+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},o.prototype.listenerCount=function(l){var c=t?t+l:l,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,c,d,h,f,p){var m=t?t+l:l;if(!this._events[m])return!1;var v=this._events[m],_=arguments.length,w,E;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),_){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,d),!0;case 4:return v.fn.call(v.context,c,d,h),!0;case 5:return v.fn.call(v.context,c,d,h,f),!0;case 6:return v.fn.call(v.context,c,d,h,f,p),!0}for(E=1,w=new Array(_-1);E<_;E++)w[E-1]=arguments[E];v.fn.apply(v.context,w)}else{var F=v.length,k;for(E=0;E<F;E++)switch(v[E].once&&this.removeListener(l,v[E].fn,void 0,!0),_){case 1:v[E].fn.call(v[E].context);break;case 2:v[E].fn.call(v[E].context,c);break;case 3:v[E].fn.call(v[E].context,c,d);break;case 4:v[E].fn.call(v[E].context,c,d,h);break;default:if(!w)for(k=1,w=new Array(_-1);k<_;k++)w[k-1]=arguments[k];v[E].fn.apply(v[E].context,w)}}return!0},o.prototype.on=function(l,c,d){return s(this,l,c,d,!1)},o.prototype.once=function(l,c,d){return s(this,l,c,d,!0)},o.prototype.removeListener=function(l,c,d,h){var f=t?t+l:l;if(!this._events[f])return this;if(!c)return i(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!h||p.once)&&(!d||p.context===d)&&i(this,f);else{for(var m=0,v=[],_=p.length;m<_;m++)(p[m].fn!==c||h&&!p[m].once||d&&p[m].context!==d)&&v.push(p[m]);v.length?this._events[f]=v.length===1?v[0]:v:i(this,f)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&i(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(ih)),ih.exports}var Bo={exports:{}},oh,dv;function cC(){return dv||(dv=1,oh=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),oh}var hv;function dC(){if(hv)return Bo.exports;hv=1;const r=cC();class e extends Error{constructor(a){super(a),this.name="TimeoutError"}}const t=(n,a,s)=>new Promise((i,o)=>{if(typeof a!="number"||a<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(a===1/0){i(n);return}const u=setTimeout(()=>{if(typeof s=="function"){try{i(s())}catch(d){o(d)}return}const l=typeof s=="string"?s:`Promise timed out after ${a} milliseconds`,c=s instanceof Error?s:new e(l);typeof n.cancel=="function"&&n.cancel(),o(c)},a);r(n.then(i,o),()=>{clearTimeout(u)})});return Bo.exports=t,Bo.exports.default=t,Bo.exports.TimeoutError=e,Bo.exports}var El={},xl={},fv;function hC(){if(fv)return xl;fv=1,Object.defineProperty(xl,"__esModule",{value:!0});function r(e,t,n){let a=0,s=e.length;for(;s>0;){const i=s/2|0;let o=a+i;n(e[o],t)<=0?(a=++o,s-=i+1):s=i}return a}return xl.default=r,xl}var pv;function fC(){if(pv)return El;pv=1,Object.defineProperty(El,"__esModule",{value:!0});const r=hC();class e{constructor(){this._queue=[]}enqueue(n,a){a=Object.assign({priority:0},a);const s={priority:a.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=a.priority){this._queue.push(s);return}const i=r.default(this._queue,s,(o,u)=>u.priority-o.priority);this._queue.splice(i,0,s)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(a=>a.priority===n.priority).map(a=>a.run)}get size(){return this._queue.length}}return El.default=e,El}var mv;function pC(){if(mv)return wl;mv=1,Object.defineProperty(wl,"__esModule",{value:!0});const r=lC(),e=dC(),t=fC(),n=()=>{},a=new e.TimeoutError;class s extends r{constructor(o){var u,l,c,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(l=(u=o.intervalCap)===null||u===void 0?void 0:u.toString())!==null&&l!==void 0?l:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(c=o.interval)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const u=this._intervalEnd-o;if(u<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},u)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const u=this._queue.dequeue();return u?(this.emit("active"),u(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,u={}){return new Promise((l,c)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const h=this._timeout===void 0&&u.timeout===void 0?o():e.default(Promise.resolve(o()),u.timeout===void 0?this._timeout:u.timeout,()=>{(u.throwOnTimeout===void 0?this._throwOnTimeout:u.throwOnTimeout)&&c(a)});l(await h)}catch(h){c(h)}this._next()};this._queue.enqueue(d,u),this._tryToStartAnother(),this.emit("add")})}async addAll(o,u){return Promise.all(o.map(async l=>this.add(l,u)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const u=this._resolveEmpty;this._resolveEmpty=()=>{u(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const u=this._resolveIdle;this._resolveIdle=()=>{u(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return wl.default=s,wl}var mC=pC();const Qa=Ai(mC),gC=[408,425,429,500,502,503,504];let gv=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.maxQueueSizeBytes=e.maxQueueSizeBytes,"default"in Qa?this.queue=new Qa.default({concurrency:this.maxConcurrency}):this.queue=new Qa({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){return this.callWithOptions({},e,...t)}callWithOptions(e,t,...n){const a=e.sizeBytes??0;if(this.maxQueueSizeBytes!==void 0&&a>0&&this.queueSizeBytes+a>this.maxQueueSizeBytes)return Promise.reject(new Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${a} bytes.`));a>0&&(this.queueSizeBytes+=a);const s=this.onFailedResponseHook;let i=this.queue.add(()=>uC(()=>t(...n).catch(o=>{throw o instanceof Error?o:new Error(o)}),{async onFailedAttempt({error:o}){if(o.message.startsWith("Cancel")||o.message.startsWith("TimeoutError")||o.name==="TimeoutError"||o.message.startsWith("AbortError")||(o==null?void 0:o.code)==="ECONNABORTED")throw o;const u=o==null?void 0:o.response;if(s&&await s(u))return;const l=(u==null?void 0:u.status)??(o==null?void 0:o.status);if(l&&!gC.includes(+l))throw o},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return a>0&&(i=i.finally(()=>{this.queueSizeBytes-=a})),e.signal?Promise.race([i,new Promise((o,u)=>{var l;(l=e.signal)==null||l.addEventListener("abort",()=>{u(new Error("AbortError"))})})]):i}};function yv(r){return typeof(r==null?void 0:r._getType)=="function"}function vv(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}var Sl={exports:{}},uh,_v;function m0(){if(_v)return uh;_v=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,a=e-6;return uh={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},uh}var lh,bv;function g0(){if(bv)return lh;bv=1;var r={};return lh=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},lh}var wv;function ju(){return wv||(wv=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=m0(),s=g0();e=r.exports={};const i=e.re=[],o=e.safeRe=[],u=e.src=[],l=e.safeSrc=[],c=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",a],[h,n]],p=v=>{for(const[_,w]of f)v=v.split(`${_}*`).join(`${_}{0,${w}}`).split(`${_}+`).join(`${_}{1,${w}}`);return v},m=(v,_,w)=>{const E=p(_),F=d++;s(v,F,_),c[v]=F,u[F]=_,l[F]=E,i[F]=new RegExp(_,w?"g":void 0),o[F]=new RegExp(E,w?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),m("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${u[c.NONNUMERICIDENTIFIER]}|${u[c.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NONNUMERICIDENTIFIER]}|${u[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${h}+`),m("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),m("FULL",`^${u[c.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),m("LOOSE",`^${u[c.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),m("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?(?:${u[c.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",u[c.COERCE],!0),m("COERCERTLFULL",u[c.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Sl,Sl.exports)),Sl.exports}var ch,Ev;function Vm(){if(Ev)return ch;Ev=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return ch=n=>n?typeof n!="object"?r:n:e,ch}var dh,xv;function i6(){if(xv)return dh;xv=1;const r=/^[0-9]+$/,e=(n,a)=>{const s=r.test(n),i=r.test(a);return s&&i&&(n=+n,a=+a),n===a?0:s&&!i?-1:i&&!s?1:n<a?-1:1};return dh={compareIdentifiers:e,rcompareIdentifiers:(n,a)=>e(a,n)},dh}var hh,Sv;function nn(){if(Sv)return hh;Sv=1;const r=g0(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=m0(),{safeRe:n,t:a}=ju(),s=Vm(),{compareIdentifiers:i}=i6();class o{constructor(l,c){if(c=s(c),l instanceof o){if(l.loose===!!c.loose&&l.includePrerelease===!!c.includePrerelease)return l;l=l.version}else if(typeof l!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof l}".`);if(l.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",l,c),this.options=c,this.loose=!!c.loose,this.includePrerelease=!!c.includePrerelease;const d=l.trim().match(c.loose?n[a.LOOSE]:n[a.FULL]);if(!d)throw new TypeError(`Invalid Version: ${l}`);if(this.raw=l,this.major=+d[1],this.minor=+d[2],this.patch=+d[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");d[4]?this.prerelease=d[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const f=+h;if(f>=0&&f<t)return f}return h}):this.prerelease=[],this.build=d[5]?d[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(l){if(r("SemVer.compare",this.version,this.options,l),!(l instanceof o)){if(typeof l=="string"&&l===this.version)return 0;l=new o(l,this.options)}return l.version===this.version?0:this.compareMain(l)||this.comparePre(l)}compareMain(l){return l instanceof o||(l=new o(l,this.options)),i(this.major,l.major)||i(this.minor,l.minor)||i(this.patch,l.patch)}comparePre(l){if(l instanceof o||(l=new o(l,this.options)),this.prerelease.length&&!l.prerelease.length)return-1;if(!this.prerelease.length&&l.prerelease.length)return 1;if(!this.prerelease.length&&!l.prerelease.length)return 0;let c=0;do{const d=this.prerelease[c],h=l.prerelease[c];if(r("prerelease compare",c,d,h),d===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(d===void 0)return-1;if(d===h)continue;return i(d,h)}while(++c)}compareBuild(l){l instanceof o||(l=new o(l,this.options));let c=0;do{const d=this.build[c],h=l.build[c];if(r("build compare",c,d,h),d===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(d===void 0)return-1;if(d===h)continue;return i(d,h)}while(++c)}inc(l,c,d){if(l.startsWith("pre")){if(!c&&d===!1)throw new Error("invalid increment argument: identifier is empty");if(c){const h=`-${c}`.match(this.options.loose?n[a.PRERELEASELOOSE]:n[a.PRERELEASE]);if(!h||h[1]!==c)throw new Error(`invalid identifier: ${c}`)}}switch(l){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",c,d);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",c,d);break;case"prepatch":this.prerelease.length=0,this.inc("patch",c,d),this.inc("pre",c,d);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",c,d),this.inc("pre",c,d);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(d)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let f=this.prerelease.length;for(;--f>=0;)typeof this.prerelease[f]=="number"&&(this.prerelease[f]++,f=-2);if(f===-1){if(c===this.prerelease.join(".")&&d===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(c){let f=[c,h];d===!1&&(f=[c]),i(this.prerelease[0],c)===0?isNaN(this.prerelease[1])&&(this.prerelease=f):this.prerelease=f}break}default:throw new Error(`invalid increment argument: ${l}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return hh=o,hh}var fh,Av;function So(){if(Av)return fh;Av=1;const r=nn();return fh=(t,n,a=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(s){if(!a)return null;throw s}},fh}var ph,kv;function yC(){if(kv)return ph;kv=1;const r=So();return ph=(t,n)=>{const a=r(t,n);return a?a.version:null},ph}var mh,Cv;function vC(){if(Cv)return mh;Cv=1;const r=So();return mh=(t,n)=>{const a=r(t.trim().replace(/^[=v]+/,""),n);return a?a.version:null},mh}var gh,Tv;function _C(){if(Tv)return gh;Tv=1;const r=nn();return gh=(t,n,a,s,i)=>{typeof a=="string"&&(i=s,s=a,a=void 0);try{return new r(t instanceof r?t.version:t,a).inc(n,s,i).version}catch{return null}},gh}var yh,Fv;function bC(){if(Fv)return yh;Fv=1;const r=So();return yh=(t,n)=>{const a=r(t,null,!0),s=r(n,null,!0),i=a.compare(s);if(i===0)return null;const o=i>0,u=o?a:s,l=o?s:a,c=!!u.prerelease.length;if(!!l.prerelease.length&&!c){if(!l.patch&&!l.minor)return"major";if(l.compareMain(u)===0)return l.minor&&!l.patch?"minor":"patch"}const h=c?"pre":"";return a.major!==s.major?h+"major":a.minor!==s.minor?h+"minor":a.patch!==s.patch?h+"patch":"prerelease"},yh}var vh,Nv;function wC(){if(Nv)return vh;Nv=1;const r=nn();return vh=(t,n)=>new r(t,n).major,vh}var _h,Iv;function EC(){if(Iv)return _h;Iv=1;const r=nn();return _h=(t,n)=>new r(t,n).minor,_h}var bh,Ov;function xC(){if(Ov)return bh;Ov=1;const r=nn();return bh=(t,n)=>new r(t,n).patch,bh}var wh,Rv;function SC(){if(Rv)return wh;Rv=1;const r=So();return wh=(t,n)=>{const a=r(t,n);return a&&a.prerelease.length?a.prerelease:null},wh}var Eh,Dv;function pa(){if(Dv)return Eh;Dv=1;const r=nn();return Eh=(t,n,a)=>new r(t,a).compare(new r(n,a)),Eh}var xh,Bv;function AC(){if(Bv)return xh;Bv=1;const r=pa();return xh=(t,n,a)=>r(n,t,a),xh}var Sh,Mv;function kC(){if(Mv)return Sh;Mv=1;const r=pa();return Sh=(t,n)=>r(t,n,!0),Sh}var Ah,$v;function Gm(){if($v)return Ah;$v=1;const r=nn();return Ah=(t,n,a)=>{const s=new r(t,a),i=new r(n,a);return s.compare(i)||s.compareBuild(i)},Ah}var kh,Pv;function CC(){if(Pv)return kh;Pv=1;const r=Gm();return kh=(t,n)=>t.sort((a,s)=>r(a,s,n)),kh}var Ch,Lv;function TC(){if(Lv)return Ch;Lv=1;const r=Gm();return Ch=(t,n)=>t.sort((a,s)=>r(s,a,n)),Ch}var Th,zv;function y0(){if(zv)return Th;zv=1;const r=pa();return Th=(t,n,a)=>r(t,n,a)>0,Th}var Fh,Uv;function Zm(){if(Uv)return Fh;Uv=1;const r=pa();return Fh=(t,n,a)=>r(t,n,a)<0,Fh}var Nh,jv;function o6(){if(jv)return Nh;jv=1;const r=pa();return Nh=(t,n,a)=>r(t,n,a)===0,Nh}var Ih,qv;function u6(){if(qv)return Ih;qv=1;const r=pa();return Ih=(t,n,a)=>r(t,n,a)!==0,Ih}var Oh,Hv;function Km(){if(Hv)return Oh;Hv=1;const r=pa();return Oh=(t,n,a)=>r(t,n,a)>=0,Oh}var Rh,Vv;function Wm(){if(Vv)return Rh;Vv=1;const r=pa();return Rh=(t,n,a)=>r(t,n,a)<=0,Rh}var Dh,Gv;function l6(){if(Gv)return Dh;Gv=1;const r=o6(),e=u6(),t=y0(),n=Km(),a=Zm(),s=Wm();return Dh=(o,u,l,c)=>{switch(u){case"===":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o===l;case"!==":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o!==l;case"":case"=":case"==":return r(o,l,c);case"!=":return e(o,l,c);case">":return t(o,l,c);case">=":return n(o,l,c);case"<":return a(o,l,c);case"<=":return s(o,l,c);default:throw new TypeError(`Invalid operator: ${u}`)}},Dh}var Bh,Zv;function FC(){if(Zv)return Bh;Zv=1;const r=nn(),e=So(),{safeRe:t,t:n}=ju();return Bh=(s,i)=>{if(s instanceof r)return s;if(typeof s=="number"&&(s=String(s)),typeof s!="string")return null;i=i||{};let o=null;if(!i.rtl)o=s.match(i.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const f=i.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=f.exec(s))&&(!o||o.index+o[0].length!==s.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),f.lastIndex=p.index+p[1].length+p[2].length;f.lastIndex=-1}if(o===null)return null;const u=o[2],l=o[3]||"0",c=o[4]||"0",d=i.includePrerelease&&o[5]?`-${o[5]}`:"",h=i.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${u}.${l}.${c}${d}${h}`,i)},Bh}var Mh,Kv;function NC(){if(Kv)return Mh;Kv=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(t,n)}return this}}return Mh=r,Mh}var $h,Wv;function ma(){if(Wv)return $h;Wv=1;const r=/\s+/g;class e{constructor(M,P){if(P=a(P),M instanceof e)return M.loose===!!P.loose&&M.includePrerelease===!!P.includePrerelease?M:new e(M.raw,P);if(M instanceof s)return this.raw=M.value,this.set=[[M]],this.formatted=void 0,this;if(this.options=P,this.loose=!!P.loose,this.includePrerelease=!!P.includePrerelease,this.raw=M.trim().replace(r," "),this.set=this.raw.split("||").map(Z=>this.parseRange(Z.trim())).filter(Z=>Z.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const Z=this.set[0];if(this.set=this.set.filter(W=>!m(W[0])),this.set.length===0)this.set=[Z];else if(this.set.length>1){for(const W of this.set)if(W.length===1&&v(W[0])){this.set=[W];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let M=0;M<this.set.length;M++){M>0&&(this.formatted+="||");const P=this.set[M];for(let Z=0;Z<P.length;Z++)Z>0&&(this.formatted+=" "),this.formatted+=P[Z].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(M){const Z=((this.options.includePrerelease&&f)|(this.options.loose&&p))+":"+M,W=n.get(Z);if(W)return W;const X=this.options.loose,Y=X?u[l.HYPHENRANGELOOSE]:u[l.HYPHENRANGE];M=M.replace(Y,te(this.options.includePrerelease)),i("hyphen replace",M),M=M.replace(u[l.COMPARATORTRIM],c),i("comparator trim",M),M=M.replace(u[l.TILDETRIM],d),i("tilde trim",M),M=M.replace(u[l.CARETTRIM],h),i("caret trim",M);let re=M.split(" ").map(Q=>w(Q,this.options)).join(" ").split(/\s+/).map(Q=>G(Q,this.options));X&&(re=re.filter(Q=>(i("loose invalid filter",Q,this.options),!!Q.match(u[l.COMPARATORLOOSE])))),i("range list",re);const U=new Map,j=re.map(Q=>new s(Q,this.options));for(const Q of j){if(m(Q))return[Q];U.set(Q.value,Q)}U.size>1&&U.has("")&&U.delete("");const ae=[...U.values()];return n.set(Z,ae),ae}intersects(M,P){if(!(M instanceof e))throw new TypeError("a Range is required");return this.set.some(Z=>_(Z,P)&&M.set.some(W=>_(W,P)&&Z.every(X=>W.every(Y=>X.intersects(Y,P)))))}test(M){if(!M)return!1;if(typeof M=="string")try{M=new o(M,this.options)}catch{return!1}for(let P=0;P<this.set.length;P++)if(ve(this.set[P],M,this.options))return!0;return!1}}$h=e;const t=NC(),n=new t,a=Vm(),s=v0(),i=g0(),o=nn(),{safeRe:u,t:l,comparatorTrimReplace:c,tildeTrimReplace:d,caretTrimReplace:h}=ju(),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:p}=m0(),m=D=>D.value==="<0.0.0-0",v=D=>D.value==="",_=(D,M)=>{let P=!0;const Z=D.slice();let W=Z.pop();for(;P&&Z.length;)P=Z.every(X=>W.intersects(X,M)),W=Z.pop();return P},w=(D,M)=>(i("comp",D,M),D=N(D,M),i("caret",D),D=F(D,M),i("tildes",D),D=A(D,M),i("xrange",D),D=V(D,M),i("stars",D),D),E=D=>!D||D.toLowerCase()==="x"||D==="*",F=(D,M)=>D.trim().split(/\s+/).map(P=>k(P,M)).join(" "),k=(D,M)=>{const P=M.loose?u[l.TILDELOOSE]:u[l.TILDE];return D.replace(P,(Z,W,X,Y,re)=>{i("tilde",D,Z,W,X,Y,re);let U;return E(W)?U="":E(X)?U=`>=${W}.0.0 <${+W+1}.0.0-0`:E(Y)?U=`>=${W}.${X}.0 <${W}.${+X+1}.0-0`:re?(i("replaceTilde pr",re),U=`>=${W}.${X}.${Y}-${re} <${W}.${+X+1}.0-0`):U=`>=${W}.${X}.${Y} <${W}.${+X+1}.0-0`,i("tilde return",U),U})},N=(D,M)=>D.trim().split(/\s+/).map(P=>B(P,M)).join(" "),B=(D,M)=>{i("caret",D,M);const P=M.loose?u[l.CARETLOOSE]:u[l.CARET],Z=M.includePrerelease?"-0":"";return D.replace(P,(W,X,Y,re,U)=>{i("caret",D,W,X,Y,re,U);let j;return E(X)?j="":E(Y)?j=`>=${X}.0.0${Z} <${+X+1}.0.0-0`:E(re)?X==="0"?j=`>=${X}.${Y}.0${Z} <${X}.${+Y+1}.0-0`:j=`>=${X}.${Y}.0${Z} <${+X+1}.0.0-0`:U?(i("replaceCaret pr",U),X==="0"?Y==="0"?j=`>=${X}.${Y}.${re}-${U} <${X}.${Y}.${+re+1}-0`:j=`>=${X}.${Y}.${re}-${U} <${X}.${+Y+1}.0-0`:j=`>=${X}.${Y}.${re}-${U} <${+X+1}.0.0-0`):(i("no pr"),X==="0"?Y==="0"?j=`>=${X}.${Y}.${re}${Z} <${X}.${Y}.${+re+1}-0`:j=`>=${X}.${Y}.${re}${Z} <${X}.${+Y+1}.0-0`:j=`>=${X}.${Y}.${re} <${+X+1}.0.0-0`),i("caret return",j),j})},A=(D,M)=>(i("replaceXRanges",D,M),D.split(/\s+/).map(P=>L(P,M)).join(" ")),L=(D,M)=>{D=D.trim();const P=M.loose?u[l.XRANGELOOSE]:u[l.XRANGE];return D.replace(P,(Z,W,X,Y,re,U)=>{i("xRange",D,Z,W,X,Y,re,U);const j=E(X),ae=j||E(Y),Q=ae||E(re),C=Q;return W==="="&&C&&(W=""),U=M.includePrerelease?"-0":"",j?W===">"||W==="<"?Z="<0.0.0-0":Z="*":W&&C?(ae&&(Y=0),re=0,W===">"?(W=">=",ae?(X=+X+1,Y=0,re=0):(Y=+Y+1,re=0)):W==="<="&&(W="<",ae?X=+X+1:Y=+Y+1),W==="<"&&(U="-0"),Z=`${W+X}.${Y}.${re}${U}`):ae?Z=`>=${X}.0.0${U} <${+X+1}.0.0-0`:Q&&(Z=`>=${X}.${Y}.0${U} <${X}.${+Y+1}.0-0`),i("xRange return",Z),Z})},V=(D,M)=>(i("replaceStars",D,M),D.trim().replace(u[l.STAR],"")),G=(D,M)=>(i("replaceGTE0",D,M),D.trim().replace(u[M.includePrerelease?l.GTE0PRE:l.GTE0],"")),te=D=>(M,P,Z,W,X,Y,re,U,j,ae,Q,C)=>(E(Z)?P="":E(W)?P=`>=${Z}.0.0${D?"-0":""}`:E(X)?P=`>=${Z}.${W}.0${D?"-0":""}`:Y?P=`>=${P}`:P=`>=${P}${D?"-0":""}`,E(j)?U="":E(ae)?U=`<${+j+1}.0.0-0`:E(Q)?U=`<${j}.${+ae+1}.0-0`:C?U=`<=${j}.${ae}.${Q}-${C}`:D?U=`<${j}.${ae}.${+Q+1}-0`:U=`<=${U}`,`${P} ${U}`.trim()),ve=(D,M,P)=>{for(let Z=0;Z<D.length;Z++)if(!D[Z].test(M))return!1;if(M.prerelease.length&&!P.includePrerelease){for(let Z=0;Z<D.length;Z++)if(i(D[Z].semver),D[Z].semver!==s.ANY&&D[Z].semver.prerelease.length>0){const W=D[Z].semver;if(W.major===M.major&&W.minor===M.minor&&W.patch===M.patch)return!0}return!1}return!0};return $h}var Ph,Yv;function v0(){if(Yv)return Ph;Yv=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(c,d){if(d=t(d),c instanceof e){if(c.loose===!!d.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),i("comparator",c,d),this.options=d,this.loose=!!d.loose,this.parse(c),this.semver===r?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(c){const d=this.options.loose?n[a.COMPARATORLOOSE]:n[a.COMPARATOR],h=c.match(d);if(!h)throw new TypeError(`Invalid comparator: ${c}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new o(h[2],this.options.loose):this.semver=r}toString(){return this.value}test(c){if(i("Comparator.test",c,this.options.loose),this.semver===r||c===r)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return s(c,this.operator,this.semver,this.options)}intersects(c,d){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(c.value,d).test(this.value):c.operator===""?c.value===""?!0:new u(this.value,d).test(c.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||s(this.semver,"<",c.semver,d)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||s(this.semver,">",c.semver,d)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}Ph=e;const t=Vm(),{safeRe:n,t:a}=ju(),s=l6(),i=g0(),o=nn(),u=ma();return Ph}var Lh,Jv;function _0(){if(Jv)return Lh;Jv=1;const r=ma();return Lh=(t,n,a)=>{try{n=new r(n,a)}catch{return!1}return n.test(t)},Lh}var zh,Xv;function IC(){if(Xv)return zh;Xv=1;const r=ma();return zh=(t,n)=>new r(t,n).set.map(a=>a.map(s=>s.value).join(" ").trim().split(" ")),zh}var Uh,Qv;function OC(){if(Qv)return Uh;Qv=1;const r=nn(),e=ma();return Uh=(n,a,s)=>{let i=null,o=null,u=null;try{u=new e(a,s)}catch{return null}return n.forEach(l=>{u.test(l)&&(!i||o.compare(l)===-1)&&(i=l,o=new r(i,s))}),i},Uh}var jh,e5;function RC(){if(e5)return jh;e5=1;const r=nn(),e=ma();return jh=(n,a,s)=>{let i=null,o=null,u=null;try{u=new e(a,s)}catch{return null}return n.forEach(l=>{u.test(l)&&(!i||o.compare(l)===1)&&(i=l,o=new r(i,s))}),i},jh}var qh,t5;function DC(){if(t5)return qh;t5=1;const r=nn(),e=ma(),t=y0();return qh=(a,s)=>{a=new e(a,s);let i=new r("0.0.0");if(a.test(i)||(i=new r("0.0.0-0"),a.test(i)))return i;i=null;for(let o=0;o<a.set.length;++o){const u=a.set[o];let l=null;u.forEach(c=>{const d=new r(c.semver.version);switch(c.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!l||t(d,l))&&(l=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),l&&(!i||t(i,l))&&(i=l)}return i&&a.test(i)?i:null},qh}var Hh,r5;function BC(){if(r5)return Hh;r5=1;const r=ma();return Hh=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},Hh}var Vh,n5;function Ym(){if(n5)return Vh;n5=1;const r=nn(),e=v0(),{ANY:t}=e,n=ma(),a=_0(),s=y0(),i=Zm(),o=Wm(),u=Km();return Vh=(c,d,h,f)=>{c=new r(c,f),d=new n(d,f);let p,m,v,_,w;switch(h){case">":p=s,m=o,v=i,_=">",w=">=";break;case"<":p=i,m=u,v=s,_="<",w="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(c,d,f))return!1;for(let E=0;E<d.set.length;++E){const F=d.set[E];let k=null,N=null;if(F.forEach(B=>{B.semver===t&&(B=new e(">=0.0.0")),k=k||B,N=N||B,p(B.semver,k.semver,f)?k=B:v(B.semver,N.semver,f)&&(N=B)}),k.operator===_||k.operator===w||(!N.operator||N.operator===_)&&m(c,N.semver))return!1;if(N.operator===w&&v(c,N.semver))return!1}return!0},Vh}var Gh,a5;function MC(){if(a5)return Gh;a5=1;const r=Ym();return Gh=(t,n,a)=>r(t,n,">",a),Gh}var Zh,s5;function $C(){if(s5)return Zh;s5=1;const r=Ym();return Zh=(t,n,a)=>r(t,n,"<",a),Zh}var Kh,i5;function PC(){if(i5)return Kh;i5=1;const r=ma();return Kh=(t,n,a)=>(t=new r(t,a),n=new r(n,a),t.intersects(n,a)),Kh}var Wh,o5;function LC(){if(o5)return Wh;o5=1;const r=_0(),e=pa();return Wh=(t,n,a)=>{const s=[];let i=null,o=null;const u=t.sort((h,f)=>e(h,f,a));for(const h of u)r(h,n,a)?(o=h,i||(i=h)):(o&&s.push([i,o]),o=null,i=null);i&&s.push([i,null]);const l=[];for(const[h,f]of s)h===f?l.push(h):!f&&h===u[0]?l.push("*"):f?h===u[0]?l.push(`<=${f}`):l.push(`${h} - ${f}`):l.push(`>=${h}`);const c=l.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return c.length<d.length?c:n},Wh}var Yh,u5;function zC(){if(u5)return Yh;u5=1;const r=ma(),e=v0(),{ANY:t}=e,n=_0(),a=pa(),s=(d,h,f={})=>{if(d===h)return!0;d=new r(d,f),h=new r(h,f);let p=!1;e:for(const m of d.set){for(const v of h.set){const _=u(m,v,f);if(p=p||_!==null,_)continue e}if(p)return!1}return!0},i=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],u=(d,h,f)=>{if(d===h)return!0;if(d.length===1&&d[0].semver===t){if(h.length===1&&h[0].semver===t)return!0;f.includePrerelease?d=i:d=o}if(h.length===1&&h[0].semver===t){if(f.includePrerelease)return!0;h=o}const p=new Set;let m,v;for(const A of d)A.operator===">"||A.operator===">="?m=l(m,A,f):A.operator==="<"||A.operator==="<="?v=c(v,A,f):p.add(A.semver);if(p.size>1)return null;let _;if(m&&v){if(_=a(m.semver,v.semver,f),_>0)return null;if(_===0&&(m.operator!==">="||v.operator!=="<="))return null}for(const A of p){if(m&&!n(A,String(m),f)||v&&!n(A,String(v),f))return null;for(const L of h)if(!n(A,String(L),f))return!1;return!0}let w,E,F,k,N=v&&!f.includePrerelease&&v.semver.prerelease.length?v.semver:!1,B=m&&!f.includePrerelease&&m.semver.prerelease.length?m.semver:!1;N&&N.prerelease.length===1&&v.operator==="<"&&N.prerelease[0]===0&&(N=!1);for(const A of h){if(k=k||A.operator===">"||A.operator===">=",F=F||A.operator==="<"||A.operator==="<=",m){if(B&&A.semver.prerelease&&A.semver.prerelease.length&&A.semver.major===B.major&&A.semver.minor===B.minor&&A.semver.patch===B.patch&&(B=!1),A.operator===">"||A.operator===">="){if(w=l(m,A,f),w===A&&w!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(A),f))return!1}if(v){if(N&&A.semver.prerelease&&A.semver.prerelease.length&&A.semver.major===N.major&&A.semver.minor===N.minor&&A.semver.patch===N.patch&&(N=!1),A.operator==="<"||A.operator==="<="){if(E=c(v,A,f),E===A&&E!==v)return!1}else if(v.operator==="<="&&!n(v.semver,String(A),f))return!1}if(!A.operator&&(v||m)&&_!==0)return!1}return!(m&&F&&!v&&_!==0||v&&k&&!m&&_!==0||B||N)},l=(d,h,f)=>{if(!d)return h;const p=a(d.semver,h.semver,f);return p>0?d:p<0||h.operator===">"&&d.operator===">="?h:d},c=(d,h,f)=>{if(!d)return h;const p=a(d.semver,h.semver,f);return p<0?d:p>0||h.operator==="<"&&d.operator==="<="?h:d};return Yh=s,Yh}var Jh,l5;function UC(){if(l5)return Jh;l5=1;const r=ju(),e=m0(),t=nn(),n=i6(),a=So(),s=yC(),i=vC(),o=_C(),u=bC(),l=wC(),c=EC(),d=xC(),h=SC(),f=pa(),p=AC(),m=kC(),v=Gm(),_=CC(),w=TC(),E=y0(),F=Zm(),k=o6(),N=u6(),B=Km(),A=Wm(),L=l6(),V=FC(),G=v0(),te=ma(),ve=_0(),D=IC(),M=OC(),P=RC(),Z=DC(),W=BC(),X=Ym(),Y=MC(),re=$C(),U=PC(),j=LC(),ae=zC();return Jh={parse:a,valid:s,clean:i,inc:o,diff:u,major:l,minor:c,patch:d,prerelease:h,compare:f,rcompare:p,compareLoose:m,compareBuild:v,sort:_,rsort:w,gt:E,lt:F,eq:k,neq:N,gte:B,lte:A,cmp:L,coerce:V,Comparator:G,Range:te,satisfies:ve,toComparators:D,maxSatisfying:M,minSatisfying:P,minVersion:Z,validRange:W,outside:X,gtr:Y,ltr:re,intersects:U,simplifyRange:j,subset:ae,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},Jh}UC();function _s(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[a,s]=e.split("/",2);if(!a||!s)throw new Error(`Invalid identifier format: ${r}`);return[a,s,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class jC extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function He(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}if(r.status===403)try{const i=await r.json();(i==null?void 0:i.error)==="org_scoped_key_requires_workspace"&&(n="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{const o=new Error(`${r.status} ${r.statusText}`);throw o.status=r==null?void 0:r.status,o}if(n===void 0)try{n=await r.text()}catch{n=""}const a=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Message: ${n}`;if(r.status===409)throw new jC(a);const s=new Error(a);throw s.status=r.status,s}const c6="ERR_CONFLICTING_ENDPOINTS";class qC extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:c6}),this.name="ConflictingEndpointsError"}}function HC(r){return typeof r=="object"&&r!==null&&r.code===c6}var c5="[...]",VC={result:"[Circular]"},Ec=[],ji=[];const GC=new TextEncoder;function ZC(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Al(r){return GC.encode(r)}function d6(r){if(r&&typeof r=="object"&&r!==null){if(r instanceof Map)return Object.fromEntries(r);if(r instanceof Set)return Array.from(r);if(r instanceof Date)return r.toISOString();if(r instanceof RegExp)return r.toString();if(r instanceof Error)return{name:r.name,message:r.message}}else if(typeof r=="bigint")return r.toString();return r}function KC(r){return function(e,t){return d6(t)}}function Sn(r,e,t,n,a){var s;try{const i=JSON.stringify(r,KC(t),n);return Al(i)}catch(i){if(!((s=i.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Al("[Unserializable]");fn("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof a>"u"&&(a=ZC()),Wf(r,"",0,[],void 0,0,a);let o;try{ji.length===0?o=JSON.stringify(r,t,n):o=JSON.stringify(r,WC(t),n)}catch{return Al("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Ec.length!==0;){const u=Ec.pop();u.length===4?Object.defineProperty(u[0],u[1],u[3]):u[0][u[1]]=u[2]}}return Al(o)}}function Xh(r,e,t,n){var a=Object.getOwnPropertyDescriptor(n,t);a.get!==void 0?a.configurable?(Object.defineProperty(n,t,{value:r}),Ec.push([n,t,e,a])):ji.push([e,t,r]):(n[t]=r,Ec.push([n,t,e]))}function Wf(r,e,t,n,a,s,i){s+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){Xh(VC,r,e,a);return}if(typeof i.depthLimit<"u"&&s>i.depthLimit){Xh(c5,r,e,a);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){Xh(c5,r,e,a);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Wf(r[o],o,o,n,r,s,i);else{r=d6(r);var u=Object.keys(r);for(o=0;o<u.length;o++){var l=u[o];Wf(r[l],l,o,n,r,s,i)}}n.pop()}}function WC(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(ji.length>0)for(var n=0;n<ji.length;n++){var a=ji[n];if(a[1]===e&&a[0]===t){t=a[2],ji.splice(n,1);break}}return r.call(this,e,t)}}function d5(r,e,t){if(t)return r;const n=r6(),a=e??n6(),s=r.extra??{},i=s.metadata;return r.extra={...s,runtime:{...n,...s==null?void 0:s.runtime},metadata:{...a,...a.revision_id||"revision_id"in r&&r.revision_id?{revision_id:("revision_id"in r?r.revision_id:void 0)??a.revision_id}:{},...i}},r}const YC=r=>{const e=(r==null?void 0:r.toString())??fn("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},JC=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function XC(r){const e=[];for await(const t of r)e.push(t);return e}function kl(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const QC=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function h5(r){return typeof r=="number"?Number(r.toFixed(4)):r}const eT=24*1024*1024,h6=1024*1024*1024,tT=1e4,rT=100,f5="https://api.smith.langchain.com";class nT{constructor(e){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=e??h6}peek(){return this.items[0]}push(e){let t;const n=new Promise(s=>{t=s}),a=Sn(e.item,`Serializing run with id: ${e.item.id}`).length;return this.sizeBytes+a>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${e.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${a} bytes.`),t(),n):(this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:a}),this.sizeBytes+=a,n)}pop({upToSizeBytes:e,upToSize:t}){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const n=[];let a=0;for(;a+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0&&n.length<t;){const i=this.items.shift();i&&(n.push(i),a+=i.size,this.sizeBytes-=i.size)}if(n.length===0&&this.items.length>0){const i=this.items.shift();n.push(i),a+=i.size,this.sizeBytes-=i.size}return[n.map(i=>({action:i.action,item:i.payload,otelContext:i.otelContext,apiKey:i.apiKey,apiUrl:i.apiUrl,size:i.size})),()=>n.forEach(i=>i.itemPromiseResolve())]}}class ro{get _fetch(){return this.fetchImplementation||Dk(this.debug)}constructor(e={}){var a;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitTracedRuntimeInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Ba("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Ba("LANGSMITH_DEBUG")==="true"});const t=ro.getDefaultClientConfig();if(this.tracingSampleRate=YC(e.tracingSamplingRate),this.apiUrl=kl(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=kl(e.apiKey??t.apiKey),this.webUrl=kl(e.webUrl??t.webUrl),(a=this.webUrl)!=null&&a.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=kl(e.workspaceId??fn("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new gv({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation;const n=e.maxIngestMemoryBytes??h6;this.batchIngestCaller=new gv({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:n,...e.callerOptions??{},onFailedResponseHook:QC,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.omitTracedRuntimeInfo=e.omitTracedRuntimeInfo??!1,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new nT(n),this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,a6()&&(this.langSmithToOTELTranslator=new Qk),this.cachedLSEnvVarsForMetadata=n6()}static getDefaultClientConfig(){const e=fn("API_KEY"),t=fn("ENDPOINT")??f5,n=fn("HIDE_INPUTS")==="true",a=fn("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:JC(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${Qb}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",a=`${this.apiUrl}${e}?${n}`;return await this.caller.call(async()=>{const i=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(i,`fetch ${e}`),i})}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let a=Number(t.get("offset"))||0;const s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(s));const i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(async()=>{const l=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(l,`fetch ${e}`),l}),u=n?n(await o.json()):await o.json();if(u.length===0||(yield u,u.length<s))break;a+=u.length}}async*_getCursorPaginatedList(e,t=null,n="POST",a="runs"){const s=t?{...t}:{};for(;;){const i=JSON.stringify(s),u=await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await He(c,`fetch ${e}`),c})).json();if(!u||!u[a])break;yield u[a];const l=u.cursors;if(!l||!l.next)break;s.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const a of e)this.filteredPostUuids.has(a.trace_id)?a.id===a.trace_id&&this.filteredPostUuids.delete(a.trace_id):n.push(a);return n}else{const n=[];for(const a of e){const s=a.trace_id??a.id;this.filteredPostUuids.has(s)||(a.id===s?this._shouldSample()?n.push(a):this.filteredPostUuids.add(s):n.push(a))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??eT}async _getBatchSizeLimit(){var t;const e=await this._ensureServerInfo();return this.batchSizeLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit)??rT}async _getDatasetExamplesMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){const n=[];for(;this.autoBatchQueue.items.length>0;){const[a,s]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!a.length){s();break}const i=a.reduce((l,c)=>{const d=c.apiUrl??this.apiUrl,h=c.apiKey??this.apiKey,p=c.apiKey===this.apiKey&&c.apiUrl===this.apiUrl?"default":`${d}|${h}`;return l[p]||(l[p]=[]),l[p].push(c),l},{}),o=[];for(const[l,c]of Object.entries(i)){const d=this._processBatch(c,{apiUrl:l==="default"?void 0:l.split("|")[0],apiKey:l==="default"?void 0:l.split("|")[1]});o.push(d)}const u=Promise.all(o).finally(s);n.push(u)}return Promise.all(n)}async _processBatch(e,t){var a,s;if(!e.length)return;const n=e.reduce((i,o)=>i+(o.size??0),0);try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{const i={runCreates:e.filter(u=>u.action==="create").map(u=>u.item),runUpdates:e.filter(u=>u.action==="update").map(u=>u.item)},o=await this._ensureServerInfo();if((a=o==null?void 0:o.batch_ingest_config)!=null&&a.use_multipart_endpoint){const u=(s=o==null?void 0:o.instance_flags)==null?void 0:s.gzip_body_enabled;await this.multipartIngestRuns(i,{...t,useGzip:u,sizeBytes:n})}else await this.batchIngestRuns(i,{...t,sizeBytes:n})}}catch(i){console.error("Error exporting batch:",i)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){const t=new Map,n=[];for(const a of e)a.item.id&&a.otelContext&&(t.set(a.item.id,a.otelContext),a.action==="create"?n.push({operation:"post",id:a.item.id,trace_id:a.item.trace_id??a.item.id,run:a.item}):n.push({operation:"patch",id:a.item.id,trace_id:a.item.trace_id??a.item.id,run:a.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=d5(e.item,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes(),a=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>n||this.autoBatchQueue.items.length>a)&&this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:a}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:a})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const t=await(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(tT),...this.fetchOptions});return await He(n,"get server info"),n})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){const e=s6(),t=Wk();if(this.langSmithToOTELTranslator!==void 0){const n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},a=e.project_name;delete e.project_name;const s=await this.prepareRunCreateOrUpdateInputs({session_name:a,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){const u=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:s,otelContext:u,apiKey:t==null?void 0:t.apiKey,apiUrl:t==null?void 0:t.apiUrl}).catch(console.error);return}const i=d5(s,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);(t==null?void 0:t.apiKey)!==void 0&&(n["x-api-key"]=t.apiKey),(t==null?void 0:t.workspaceId)!==void 0&&(n["x-tenant-id"]=t.workspaceId);const o=Sn(i,`Creating run with id: ${i.id}`);await this.caller.call(async()=>{const u=await this._fetch(`${(t==null?void 0:t.apiUrl)??this.apiUrl}/runs`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await He(u,"create run",!0),u})}async batchIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let a=await Promise.all((e==null?void 0:e.map(u=>this.prepareRunCreateOrUpdateInputs(u)))??[]),s=await Promise.all((t==null?void 0:t.map(u=>this.prepareRunCreateOrUpdateInputs(u)))??[]);if(a.length>0&&s.length>0){const u=a.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),l=[];for(const c of s)c.id!==void 0&&u[c.id]?u[c.id]={...u[c.id],...c}:l.push(c);a=Object.values(u),s=l}const i={post:a,patch:s};if(!i.post.length&&!i.patch.length)return;const o={post:[],patch:[]};for(const u of["post","patch"]){const l=u,c=i[l].reverse();let d=c.pop();for(;d!==void 0;)o[l].push(d),d=c.pop()}if(o.post.length>0||o.patch.length>0){const u=o.post.map(l=>l.id).concat(o.patch.map(l=>l.id)).join(",");await this._postBatchIngestRuns(Sn(o,`Ingesting runs with ids: ${u}`),n)}}async _postBatchIngestRuns(e,t){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};(t==null?void 0:t.apiKey)!==void 0&&(n["x-api-key"]=t.apiKey),await this.batchIngestCaller.callWithOptions({sizeBytes:t==null?void 0:t.sizeBytes},async()=>{const a=await this._fetch(`${(t==null?void 0:t.apiUrl)??this.apiUrl}/runs/batch`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await He(a,"batch create run",!0),a})}async multipartIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;const a={};let s=[];for(const d of e??[]){const h=await this.prepareRunCreateOrUpdateInputs(d);h.id!==void 0&&h.attachments!==void 0&&(a[h.id]=h.attachments),delete h.attachments,s.push(h)}let i=[];for(const d of t??[])i.push(await this.prepareRunCreateOrUpdateInputs(d));if(s.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&i.length>0){const d=s.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),h=[];for(const f of i)f.id!==void 0&&d[f.id]?d[f.id]={...d[f.id],...f}:h.push(f);s=Object.values(d),i=h}if(s.length===0&&i.length===0)return;const l=[],c=[];for(const[d,h]of[["post",s],["patch",i]])for(const f of h){const{inputs:p,outputs:m,events:v,extra:_,error:w,serialized:E,attachments:F,...k}=f,N={inputs:p,outputs:m,events:v,extra:_,error:w,serialized:E},B=Sn(k,`Serializing for multipart ingestion of run with id: ${k.id}`);c.push({name:`${d}.${k.id}`,payload:new Blob([B],{type:`application/json; length=${B.length}`})});for(const[A,L]of Object.entries(N)){if(L===void 0)continue;const V=Sn(L,`Serializing ${A} for multipart ingestion of run with id: ${k.id}`);c.push({name:`${d}.${k.id}.${A}`,payload:new Blob([V],{type:`application/json; length=${V.length}`})})}if(k.id!==void 0){const A=a[k.id];if(A){delete a[k.id];for(const[L,V]of Object.entries(A)){let G,te;if(Array.isArray(V)?[G,te]=V:(G=V.mimeType,te=V.data),L.includes(".")){console.warn(`Skipping attachment '${L}' for run ${k.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${k.id}.${L}`,payload:new Blob([te],{type:`${G}; length=${te.byteLength}`})})}}}l.push(`trace=${k.trace_id},id=${k.id}`)}await this._sendMultipartRequest(c,l.join("; "),n)}async _createNodeFetchBody(e,t){const n=[];for(const i of e)n.push(new Blob([`--${t}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),n.push(i.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${t}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,t){const n=new TextEncoder;return new ReadableStream({async start(s){const i=async o=>{typeof o=="string"?s.enqueue(n.encode(o)):s.enqueue(o)};for(const o of e){await i(`--${t}\r
`),await i(`Content-Disposition: form-data; name="${o.name}"\r
`),await i(`Content-Type: ${o.payload.type}\r
\r
`);const l=o.payload.stream().getReader();try{let c;for(;!(c=await l.read()).done;)s.enqueue(c.value)}finally{l.releaseLock()}await i(`\r
`)}await i(`--${t}--\r
`),s.close()}})}async _sendMultipartRequest(e,t,n){const a="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=Rk(),i=()=>this._createNodeFetchBody(e,a),o=()=>this._createMultipartStream(e,a),u=async l=>this.batchIngestCaller.callWithOptions({sizeBytes:n==null?void 0:n.sizeBytes},async()=>{const c=await l(),d={...this.headers,"Content-Type":`multipart/form-data; boundary=${a}`};(n==null?void 0:n.apiKey)!==void 0&&(d["x-api-key"]=n.apiKey);let h=c;n!=null&&n.useGzip&&typeof c=="object"&&"pipeThrough"in c&&(h=c.pipeThrough(new CompressionStream("gzip")),d["Content-Encoding"]="gzip");const f=await this._fetch(`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/multipart`,{method:"POST",headers:d,body:h,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(f,"Failed to send multipart request",!0),f});try{let l,c=!1;!s&&!this.multipartStreamingDisabled&&t6()!=="bun"?(c=!0,l=await u(o)):l=await u(i),(!this.multipartStreamingDisabled||c)&&l.status===422&&((n==null?void 0:n.apiUrl)??this.apiUrl)!==f5&&(console.warn(`Streaming multipart upload to ${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,l=await u(i))}catch(l){console.warn(`${l.message.trim()}

Context: ${t}`)}}async updateRun(e,t,n){ut(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const a={...t,id:e};if(!this._filterForSampling([a],!0).length)return;if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){const o=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&a.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:a,otelContext:o,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:a,otelContext:o,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"};(n==null?void 0:n.apiKey)!==void 0&&(s["x-api-key"]=n.apiKey),(n==null?void 0:n.workspaceId)!==void 0&&(s["x-tenant-id"]=n.workspaceId);const i=Sn(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{const o=await this._fetch(`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await He(o,"update run",!0),o})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){ut(e);let n=await this._get(`/runs/${e}`);return t&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let a;t.session_id?a=t.session_id:n!=null&&n.projectName?a=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?a=n==null?void 0:n.projectId:a=(await this.readProject({projectName:fn("PROJECT")||"default"})).id;const s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var s;const t=await XC(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},a={};t.sort((i,o)=>((i==null?void 0:i.dotted_order)??"").localeCompare((o==null?void 0:o.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);(s=i.dotted_order)!=null&&s.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),a[i.id]=i)}e.child_runs=n[e.id]||[];for(const i in n)i!==e.id&&(a[i].child_runs=n[i]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:a,traceId:s,referenceExampleId:i,startTime:o,executionOrder:u,isRoot:l,runType:c,error:d,id:h,query:f,filter:p,traceFilter:m,treeFilter:v,limit:_,select:w,order:E}=e;let F=[];if(t&&(F=Array.isArray(t)?t:[t]),n){const A=Array.isArray(n)?n:[n],L=await Promise.all(A.map(V=>this.readProject({projectName:V}).then(G=>G.id)));F.push(...L)}const k=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],N={session:F.length?F:null,run_type:c,reference_example:i,query:f,filter:p,trace_filter:m,tree_filter:v,execution_order:u,parent_run:a,start_time:o?o.toISOString():null,error:d,id:h,limit:_,trace:s,select:w||k,is_root:l,order:E};N.select.includes("child_run_ids")&&Kf("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let B=0;for await(const A of this._getCursorPaginatedList("/runs/query",N))if(_){if(B>=_)break;if(A.length+B>_){yield*A.slice(0,_-B);break}B+=A.length,yield*A}else yield*A}async*listGroupRuns(e){const{projectId:t,projectName:n,groupBy:a,filter:s,startTime:i,endTime:o,limit:u,offset:l}=e,d={session_id:t||(await this.readProject({projectName:n})).id,group_by:a,filter:s,start_time:i?i.toISOString():null,end_time:o?o.toISOString():null,limit:Number(u)||100};let h=Number(l)||0;const f="/runs/group",p=`${this.apiUrl}${f}`;for(;;){const m={...d,offset:h},v=Object.fromEntries(Object.entries(m).filter(([N,B])=>B!==void 0)),_=JSON.stringify(v),E=await(await this.caller.call(async()=>{const N=await this._fetch(p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:_});return await He(N,`Failed to fetch ${f}`),N})).json(),{groups:F,total:k}=E;if(F.length===0)break;for(const N of F)yield N;if(h+=F.length,h>=k)break}}async getRunStats({id:e,trace:t,parentRun:n,runType:a,projectNames:s,projectIds:i,referenceExampleIds:o,startTime:u,endTime:l,error:c,query:d,filter:h,traceFilter:f,treeFilter:p,isRoot:m,dataSourceType:v}){let _=i||[];s&&(_=[...i||[],...await Promise.all(s.map(B=>this.readProject({projectName:B}).then(A=>A.id)))]);const E=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:a,session:_,reference_example:o,start_time:u,end_time:l,error:c,query:d,filter:h,trace_filter:f,tree_filter:p,is_root:m,data_source_type:v}).filter(([B,A])=>A!==void 0)),F=JSON.stringify(E);return await(await this.caller.call(async()=>{const B=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:F});return await He(B,"get run stats"),B})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||Ga()};ut(e);const a=JSON.stringify(n),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await He(o,"share run"),o})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){ut(e),await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(t,"unshare run",!0),t})}async readRunSharedLink(e){ut(e);const n=await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(a,"read run shared link"),a})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const i of t)n.append("id",i);return ut(e),await(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(i,"list shared runs"),i})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),ut(e);const a=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(s,"read dataset shared schema"),s})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};ut(e);const a=JSON.stringify(n),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await He(o,"share dataset"),o})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){ut(e),await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(t,"unshare dataset",!0),t})}async readSharedDataset(e){return ut(e),await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(a,"read shared dataset"),a})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const a=new URLSearchParams;Object.entries(n).forEach(([o,u])=>{Array.isArray(u)?u.forEach(l=>a.append(o,l)):a.append(o,u)});const s=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(o,"list shared examples"),o}),i=await s.json();if(!s.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${s.status}
Message: ${Array.isArray(i.detail)?i.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${s.status} ${s.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:a=!1,projectExtra:s=null,referenceDatasetId:i=null}){const o=a?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,l=s||{};n&&(l.metadata=n);const c={name:e,extra:l,description:t};i!==null&&(c.reference_dataset_id=i);const d=JSON.stringify(c);return await(await this.caller.call(async()=>{const p=await this._fetch(u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:d});return await He(p,"create project"),p})).json()}async updateProject(e,{name:t=null,description:n=null,metadata:a=null,projectExtra:s=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=s;a&&(u={...u||{},metadata:a});const l=JSON.stringify({name:t,extra:u,description:n,end_time:i?new Date(i).toISOString():null});return await(await this.caller.call(async()=>{const h=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await He(h,"update project"),h})).json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ut(e),n+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");const s=await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${n}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(i,"has project"),i});try{const i=await s.json();return s.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let a="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ut(e),a+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&s.append("include_stats",n.toString());const i=await this._get(a,s);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:a,referenceDatasetName:s,includeStats:i,datasetVersion:o,referenceFree:u,metadata:l}={}){const c=new URLSearchParams;if(e!==void 0)for(const d of e)c.append("id",d);if(t!==void 0&&c.append("name",t),n!==void 0&&c.append("name_contains",n),a!==void 0)c.append("reference_dataset",a);else if(s!==void 0){const d=await this.readDataset({datasetName:s});c.append("reference_dataset",d.id)}i!==void 0&&c.append("include_stats",i.toString()),o!==void 0&&c.append("dataset_version",o),u!==void 0&&c.append("reference_free",u.toString()),l!==void 0&&c.append("metadata",JSON.stringify(l));for await(const d of this._getPaginated("/sessions",c))yield*d}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,ut(n),await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(a,`delete session ${n} (${t})`,!0),a})}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:a,description:s,dataType:i,name:o}){const u=`${this.apiUrl}/datasets/upload`,l=new FormData;return l.append("file",e,t),n.forEach(h=>{l.append("input_keys",h)}),a.forEach(h=>{l.append("output_keys",h)}),s&&l.append("description",s),i&&l.append("data_type",i),o&&l.append("name",o),await(await this.caller.call(async()=>{const h=await this._fetch(u,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await He(h,"upload CSV"),h})).json()}async createDataset(e,{description:t,dataType:n,inputsSchema:a,outputsSchema:s,metadata:i}={}){const o={name:e,description:t,extra:i?{metadata:i}:void 0};n&&(o.data_type=n),a&&(o.inputs_schema_definition=a),s&&(o.outputs_schema_definition=s);const u=JSON.stringify(o);return await(await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await He(d,"create dataset"),d})).json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const a=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)ut(e),n+=`/${e}`;else if(t)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");const s=await this._get(n,a);let i;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:a}){let s=e;if(s===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${s}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:a,datasetNameContains:s,metadata:i}={}){const o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const l of n)u.append("id",l);a!==void 0&&u.append("name",a),s!==void 0&&u.append("name_contains",s),i!==void 0&&u.append("metadata",JSON.stringify(i));for await(const l of this._getPaginated(o,u))yield*l}async updateDataset(e){const{datasetId:t,datasetName:n,...a}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const s=t??(await this.readDataset({datasetName:n})).id;ut(s);const i=JSON.stringify(a);return await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await He(u,"update dataset"),u})).json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:a,tag:s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;ut(i);const o=JSON.stringify({as_of:typeof a=="string"?a:a.toISOString(),tag:s});await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await He(u,"update dataset tags",!0),u})}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(await this.readDataset({datasetName:t})).id),a!==void 0)ut(a),n+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{const s=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(s,`delete ${n}`,!0),s})}async indexDataset({datasetId:e,datasetName:t,tag:n}){let a=e;if(!a&&!t)throw new Error("Must provide either datasetName or datasetId");if(a&&t)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:t})).id),ut(a);const i=JSON.stringify({tag:n});await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await He(u,"index dataset"),u})).json()}async similarExamples(e,t,n,{filter:a}={}){const s={limit:n,inputs:e};a!==void 0&&(s.filter=a),ut(t);const i=JSON.stringify(s);return(await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:i});return await He(l,"fetch similar examples"),l})).json()).examples}async createExample(e,t,n){var c;if(p5(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let a=t?n==null?void 0:n.datasetId:e.dataset_id;const s=t?n==null?void 0:n.datasetName:e.dataset_name;if(a===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:s})).id);const i=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;p5(e)?o=e:o={inputs:e,outputs:t,created_at:i==null?void 0:i.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const u=await this._uploadExamplesMultipart(a,[o]);return await this.readExample(((c=u.example_ids)==null?void 0:c[0])??Ga())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const w=e;let E=w[0].dataset_id;const F=w[0].dataset_name;if(E===void 0&&F===void 0)throw new Error("Must provide either datasetName or datasetId");if(E!==void 0&&F!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");E===void 0&&(E=(await this.readDataset({datasetName:F})).id);const k=await this._uploadExamplesMultipart(E,w);return await Promise.all(k.example_ids.map(B=>this.readExample(B)))}const{inputs:t,outputs:n,metadata:a,splits:s,sourceRunIds:i,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:l,exampleIds:c,datasetId:d,datasetName:h}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=d;const p=h;if(f===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:p})).id);const m=t.map((w,E)=>({dataset_id:f,inputs:w,outputs:n==null?void 0:n[E],metadata:a==null?void 0:a[E],split:s==null?void 0:s[E],id:c==null?void 0:c[E],attachments:l==null?void 0:l[E],source_run_id:i==null?void 0:i[E],use_source_run_io:o==null?void 0:o[E],use_source_run_attachments:u==null?void 0:u[E]})),v=await this._uploadExamplesMultipart(f,m);return await Promise.all(v.example_ids.map(w=>this.readExample(w)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const a=e.map(i=>yv(i)?vv(i):i),s=yv(t)?vv(t):t;return this.createExample({input:a},{output:s},n)}async readExample(e){ut(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:a,...s}=n,i=s;return a&&(i.attachments=Object.entries(a).reduce((o,[u,l])=>(o[u.slice(11)]={presigned_url:l.presigned_url,mime_type:l.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:a,splits:s,inlineS3Urls:i,metadata:o,limit:u,offset:l,filter:c,includeAttachments:d}={}){let h;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(t!==void 0)h=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:h}),p=a?typeof a=="string"?a:a==null?void 0:a.toISOString():void 0;p&&f.append("as_of",p);const m=i??!0;if(f.append("inline_s3_urls",m.toString()),n!==void 0)for(const _ of n)f.append("id",_);if(s!==void 0)for(const _ of s)f.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);f.append("metadata",_)}u!==void 0&&f.append("limit",u.toString()),l!==void 0&&f.append("offset",l.toString()),c!==void 0&&f.append("filter",c),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>f.append("select",_));let v=0;for await(const _ of this._getPaginated("/examples",f)){for(const w of _){const{attachment_urls:E,...F}=w,k=F;E&&(k.attachments=Object.entries(E).reduce((N,[B,A])=>(N[B.slice(11)]={presigned_url:A.presigned_url,mime_type:A.mime_type||void 0},N),{})),yield k,v++}if(u!==void 0&&v>=u)break}}async deleteExample(e){ut(e);const t=`/examples/${e}`;await this.caller.call(async()=>{const n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(n,`delete ${t}`,!0),n})}async deleteExamples(e,t){if(e.forEach(n=>ut(n)),t!=null&&t.hardDelete){const n=this._getPlatformEndpointPath("datasets/examples/delete");await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${n}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({example_ids:e,hard_delete:!0}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(a,"hard delete examples",!0),a})}else{const n=new URLSearchParams;e.forEach(a=>n.append("example_ids",a)),await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/examples?${n.toString()}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(a,"delete examples",!0),a})}}async updateExample(e,t){let n;t?n=e:n=e.id,ut(n);let a;t?a={id:n,...t}:a=e;let s;return a.dataset_id!==void 0?s=a.dataset_id:s=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(s,[a])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:a}){let s;if(e?s=e:s=(await this.readDataset({datasetName:t})).id,ut(s),n&&a||!n&&!a)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;return n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),a!==void 0&&i.append("tag",a),await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${s}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(u,"read dataset version"),u})).json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,ut(a);const s=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&s.append("as_of",i),await this._get(`/datasets/${a}/splits`,s)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:a,remove:s=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,ut(i);const o={split_name:n,examples:a.map(l=>(ut(l),l)),remove:s},u=JSON.stringify(o);await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await He(l,"update dataset splits",!0),l})}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:a,referenceExample:s}={loadChildRuns:!1}){Kf("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(s=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,s),[u,l]=await this._logEvaluationFeedback(o,i,n);return l[0]}async createFeedback(e,t,{score:n,value:a,correction:s,comment:i,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:c,feedbackConfig:d,projectId:h,comparativeExperimentId:f}){var w;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const p={type:u??"api",metadata:o??{}};l!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:l}),(p==null?void 0:p.metadata)!==void 0&&((w=p.metadata.__run)==null?void 0:w.run_id)!==void 0&&ut(p.metadata.__run.run_id);const m={id:c??Ga(),run_id:e,key:t,score:h5(n),value:a,correction:s,comment:i,feedback_source:p,comparative_experiment_id:f,feedbackConfig:d,session_id:h},v=JSON.stringify(m),_=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{const E=await this._fetch(_,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:v});return await He(E,"create feedback",!0),E}),m}async updateFeedback(e,{score:t,value:n,correction:a,comment:s}){const i={};t!=null&&(i.score=h5(t)),n!=null&&(i.value=n),a!=null&&(i.correction=a),s!=null&&(i.comment=s),ut(e);const o=JSON.stringify(i);await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await He(u,"update feedback",!0),u})}async readFeedback(e){ut(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){ut(e);const t=`/feedback/${e}`;await this.caller.call(async()=>{const n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(n,`delete ${t}`,!0),n})}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const a=new URLSearchParams;if(e)for(const s of e)ut(s),a.append("run",s);if(t)for(const s of t)a.append("key",s);if(n)for(const s of n)a.append("source",s);for await(const s of this._getPaginated("/feedback",a))yield*s}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:a}={}){const s={run_id:e,feedback_key:t,feedback_config:a};n?typeof n=="string"?s.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(s.expires_in=n):s.expires_in={hours:3};const i=JSON.stringify(s);return await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await He(u,"create presigned feedback token"),u})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:a,description:s,metadata:i,id:o}){var d;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:s,created_at:(d=a??new Date)==null?void 0:d.toISOString(),extra:{}};i&&(u.extra.metadata=i);const l=JSON.stringify(u);return(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await He(h,"create comparative experiment"),h})).json()}async*listPresignedFeedbackTokens(e){ut(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const a=this._selectEvalResults(e),s=[];for(const i of a){let o=n||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let u=null;i.targetRunId?u=i.targetRunId:t&&(u=t.id),s.push(await this.createFeedback(u,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[a,s]}async logEvaluationFeedback(e,t,n){const[a]=await this._logEvaluationFeedback(e,t,n);return a}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:a,limit:s}=e,i=new URLSearchParams;t&&t.forEach((u,l)=>{ut(u,`queueIds[${l}]`),i.append("ids",u)}),n&&i.append("name",n),a&&i.append("name_contains",a),i.append("limit",(s!==void 0?Math.min(s,100):100).toString());let o=0;for await(const u of this._getPaginated("/annotation-queues",i))if(yield*u,o++,s!==void 0&&o>=s)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:a,rubricInstructions:s}=e,i={name:t,description:n,id:a||Ga(),rubric_instructions:s},o=JSON.stringify(Object.fromEntries(Object.entries(i).filter(([l,c])=>c!==void 0)));return(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await He(l,"create annotation queue"),l})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${ut(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(n,"read annotation queue"),n})).json()}async updateAnnotationQueue(e,t){const{name:n,description:a,rubricInstructions:s}=t,i=JSON.stringify({name:n,description:a,rubric_instructions:s});await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/annotation-queues/${ut(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await He(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{const t=await this._fetch(`${this.apiUrl}/annotation-queues/${ut(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){const n=JSON.stringify(t.map((a,s)=>ut(a,`runIds[${s}]`).toString()));await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/annotation-queues/${ut(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await He(a,"add runs to annotation queue",!0),a})}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${ut(e,"queueId")}/run`;return(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(s,"get run from annotation queue"),s})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${ut(e,"queueId")}/runs/${ut(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(n,"delete run from annotation queue",!0),n})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${ut(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(n,"get size from annotation queue"),n})).json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const n=await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(a,"get latest commit hash"),a})).json();if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,a,s]=_s(e),i=JSON.stringify({like:t});return(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/likes/${n}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await He(u,`${t?"like":"unlike"} prompt`),u})).json()}async _getPromptUrl(e){const[t,n,a]=_s(e);if(await this._currentTenantIsOwner(t)){const s=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${n}/${a.substring(0,8)}?organizationId=${s.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${s.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,a=>a.repos))yield*n}async getPrompt(e){const[t,n,a]=_s(e),s=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return(o==null?void 0:o.status)===404?null:(await He(o,"get prompt"),o)}),i=await(s==null?void 0:s.json());return i!=null&&i.repo?i.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[a,s,i]=_s(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);const o={repo_handle:s,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},u=JSON.stringify(o),l=await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await He(d,"create prompt"),d}),{repo:c}=await l.json();return c}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[a,s,i]=_s(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${a}/${s}`):n==null?void 0:n.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},l=JSON.stringify(u),d=await(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/commits/${a}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await He(h,"create commit"),h})).json();return this._getPromptUrl(`${a}/${s}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var i;if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const o of t){const u=o.id,l={...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split}},c=Sn(l,`Serializing body for example with id: ${u}`),d=new Blob([c],{type:"application/json"});if(n.append(u,d),o.inputs){const h=Sn(o.inputs,`Serializing inputs for example with id: ${u}`),f=new Blob([h],{type:"application/json"});n.append(`${u}.inputs`,f)}if(o.outputs){const h=Sn(o.outputs,`Serializing outputs whle updating example with id: ${u}`),f=new Blob([h],{type:"application/json"});n.append(`${u}.outputs`,f)}if(o.attachments)for(const[h,f]of Object.entries(o.attachments)){let p,m;Array.isArray(f)?[p,m]=f:(p=f.mimeType,m=f.data);const v=new Blob([m],{type:`${p}; length=${m.byteLength}`});n.append(`${u}.attachment.${h}`,v)}if(o.attachments_operations){const h=Sn(o.attachments_operations,`Serializing attachments while updating example with id: ${u}`),f=new Blob([h],{type:"application/json"});n.append(`${u}.attachments_operations`,f)}}const a=e??((i=t[0])==null?void 0:i.dataset_id);return(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${a}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await He(o,"update examples"),o})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const s of t){const i=(s.id??Ga()).toString(),o={created_at:s.created_at,...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split},...s.source_run_id&&{source_run_id:s.source_run_id},...s.use_source_run_io&&{use_source_run_io:s.use_source_run_io},...s.use_source_run_attachments&&{use_source_run_attachments:s.use_source_run_attachments}},u=Sn(o,`Serializing body for uploaded example with id: ${i}`),l=new Blob([u],{type:"application/json"});if(n.append(i,l),s.inputs){const c=Sn(s.inputs,`Serializing inputs for uploaded example with id: ${i}`),d=new Blob([c],{type:"application/json"});n.append(`${i}.inputs`,d)}if(s.outputs){const c=Sn(s.outputs,`Serializing outputs for uploaded example with id: ${i}`),d=new Blob([c],{type:"application/json"});n.append(`${i}.outputs`,d)}if(s.attachments)for(const[c,d]of Object.entries(s.attachments)){let h,f;Array.isArray(d)?[h,f]=d:(h=d.mimeType,f=d.data);const p=new Blob([f],{type:`${h}; length=${f.byteLength}`});n.append(`${i}.attachment.${c}`,p)}}return(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await He(s,"upload examples"),s})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,a]=_s(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const s={};if((t==null?void 0:t.description)!==void 0&&(s.description=t.description),(t==null?void 0:t.readme)!==void 0&&(s.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(s.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(s.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(s.is_archived=t.isArchived),Object.keys(s).length===0)throw new Error("No valid update options provided");const i=JSON.stringify(s);return(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/repos/${n}/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await He(u,"update prompt"),u})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,a]=_s(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(i,"delete prompt"),i})).json()}async pullPromptCommit(e,t){const[n,a,s]=_s(e),o=await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/commits/${n}/${a}/${s}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await He(u,"pull prompt commit"),u})).json();return{owner:n,repo:a,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(a=>a!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:a}=t,[s,i]=this.parseTokenOrUrl(e,n),o=new ro({apiUrl:s,apiKey:"placeholder"}),u=await o.readSharedDataset(i),l=a||u.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch{}const c=await o.listSharedExamples(i),d=await this.createDataset(l,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(h=>h.inputs),outputs:c.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:d.id})}catch(h){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),h}}parseTokenOrUrl(e,t,n=2,a="dataset"){try{return ut(e),[t,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=n){const o=i[i.length-n];return[t,o]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}async awaitPendingTraceBatches(){var e,t;if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:n})=>n),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await((t=(e=Yk())==null?void 0:e.DEFAULT_LANGSMITH_SPAN_PROCESSOR)==null?void 0:t.forceFlush())}}function p5(r){return"dataset_id"in r||"dataset_name"in r}const aT=r=>!!["TRACING_V2","TRACING"].find(t=>fn(t)==="true"),Is=Symbol.for("lc:context_variables"),Qh=Symbol.for("langsmith:replica_trace_roots");function m5(r,e){if(Is in r)return r[Is][e]}function sT(r,e,t){const n=Is in r?r[Is]:{};n[e]=t,r[Is]=n}const Lo="6ba7b810-9dad-11d1-80b4-00c04fd430c8";function g5(r){const t=Object.keys(r).sort().map(n=>`${n}:${r[n]??""}`).join("|");return Ts(t,Lo)}function iT(r){return r.replace(/[-:.]/g,"")}function f6(r,e=1){const t=e.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(r).toISOString().slice(0,-1)}${t}Z`}function p6(r,e,t=1){const n=f6(r,t);return{dottedOrder:iT(n)+e,microsecondPrecisionDatestring:n}}class xc{constructor(e,t,n,a){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=a}static fromHeader(e){const t=e.split(",");let n={},a=[],s,i;for(const o of t){const[u,l]=o.split("="),c=decodeURIComponent(l);u==="langsmith-metadata"?n=JSON.parse(c):u==="langsmith-tags"?a=c.split(","):u==="langsmith-project"?s=c:u==="langsmith-replicas"&&(i=JSON.parse(c))}return new xc(n,a,s,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class cn{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distributedParentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),oT(e)){Object.assign(this,{...e});return}const t=cn.getDefaultConfig(),{metadata:n,...a}=e,s=a.client??cn.getSharedClient(),i={...n,...(o=a==null?void 0:a.extra)==null?void 0:o.metadata};if(a.extra={...a.extra,metadata:i},"id"in a&&a.id==null&&delete a.id,Object.assign(this,{...t,...a,client:s}),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),this.dotted_order||(this._serialized_start_time=f6(this.start_time,this.execution_order)),this.id||(this.id=Mk(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=dT(this.replicas),!this.dotted_order){const{dottedOrder:u}=p6(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}set metadata(e){var t;this.extra={...this.extra,metadata:{...(t=this.extra)==null?void 0:t.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){const e=Date.now();return{run_type:"chain",project_name:Xb(),child_runs:[],api_url:Ba("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Ba("LANGCHAIN_API_KEY"),caller_options:{},start_time:e,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return cn.sharedClient||(cn.sharedClient=new ro),cn.sharedClient}createChild(e){var c,d,h,f,p,m,v;const t=this.child_execution_order+1,n=(c=this.replicas)==null?void 0:c.map(_=>{const{reroot:w,...E}=_;return E}),a=e.replicas??n,s=new cn({...e,parent_run:this,project_name:this.project_name,replicas:a,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});Is in this&&(s[Is]=this[Is]);const i=Symbol.for("lc:child_config"),o=((d=e.extra)==null?void 0:d[i])??this.extra[i];if(lT(o)){const _={...o},w=uT(_.callbacks)?(f=(h=_.callbacks).copy)==null?void 0:f.call(h):void 0;w&&(Object.assign(w,{_parentRunId:s.id}),(v=(m=(p=w.handlers)==null?void 0:p.find(m6))==null?void 0:m.updateFromRunTree)==null||v.call(m,s),_.callbacks=w),s.extra[i]=_}const u=new Set;let l=this;for(;l!=null&&!u.has(l.id);)u.add(l.id),l.child_execution_order=Math.max(l.child_execution_order,t),l=l.parent_run;return this.child_runs.push(s),s}async end(e,t,n=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,t,n=!0){var o,u;const a=e.extra??{};if(((o=a==null?void 0:a.runtime)==null?void 0:o.library)===void 0&&(a.runtime||(a.runtime={}),t))for(const[l,c]of Object.entries(t))a.runtime[l]||(a.runtime[l]=c);let s,i;return n?(i=((u=e.parent_run)==null?void 0:u.id)??e.parent_run_id,s=[]):(s=e.child_runs.map(l=>this._convertToCreate(l,t,n)),i=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_sliceParentId(e,t){if(t.dotted_order){const n=t.dotted_order.split(".");let a=null;for(let s=0;s<n.length;s++)if(n[s].slice(-36)===e){a=s;break}if(a!==null){const s=n.slice(a+1);t.dotted_order=s.join("."),s.length>0?t.trace_id=s[0].slice(-36):t.trace_id=t.id}}t.parent_run_id===e&&(t.parent_run_id=void 0)}_setReplicaTraceRoot(e,t){const n=m5(this,Qh)??{};n[e]=t,sT(this,Qh,n);for(const a of this.child_runs)a._setReplicaTraceRoot(e,t)}_remapForProject(e){const{projectName:t,runtimeEnv:n,excludeChildRuns:a=!0,reroot:s=!1,distributedParentId:i,apiUrl:o,apiKey:u,workspaceId:l}=e,c=this._convertToCreate(this,n,a);if(t===this.project_name)return{...c,session_name:t};if(s){if(i)this._sliceParentId(i,c);else if(c.parent_run_id=void 0,c.dotted_order){const w=c.dotted_order.split(".");w.length>0&&(c.dotted_order=w[w.length-1],c.trace_id=c.id)}const _=g5({projectName:t,apiUrl:o,apiKey:u,workspaceId:l});this._setReplicaTraceRoot(_,c.id)}let d;if(!s){const _=m5(this,Qh)??{},w=g5({projectName:t,apiUrl:o,apiKey:u,workspaceId:l});if(d=_[w],d&&(c.trace_id=d,c.dotted_order)){const E=c.dotted_order.split(".");let F=null;for(let k=0;k<E.length;k++)if(E[k].slice(-36)===d){F=k;break}if(F!==null){const k=E.slice(F);c.dotted_order=k.join(".")}}}const h=c.id,f=Ts(`${h}:${t}`,Lo);let p;c.trace_id?p=Ts(`${c.trace_id}:${t}`,Lo):p=f;let m;c.parent_run_id&&(m=Ts(`${c.parent_run_id}:${t}`,Lo));let v;return c.dotted_order&&(v=c.dotted_order.split(".").map(E=>{const F=E.slice(-36),k=Ts(`${F}:${t}`,Lo);return E.slice(0,-36)+k}).join(".")),{...c,id:f,trace_id:p,parent_run_id:m,dotted_order:v,session_name:t}}async postRun(e=!0){try{const t=r6();if(this.replicas&&this.replicas.length>0)for(const{projectName:n,apiKey:a,apiUrl:s,workspaceId:i,reroot:o}of this.replicas){const u=this._remapForProject({projectName:n??this.project_name,runtimeEnv:t,excludeChildRuns:!0,reroot:o,distributedParentId:this.distributedParentId,apiUrl:s,apiKey:a,workspaceId:i});await this.client.createRun(u,{apiKey:a,apiUrl:s,workspaceId:i})}else{const n=this._convertToCreate(this,t,e);await this.client.createRun(n)}if(!e){Kf("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const n of this.child_runs)await n.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(e){var t;if(this.replicas&&this.replicas.length>0)for(const{projectName:n,apiKey:a,apiUrl:s,workspaceId:i,updates:o,reroot:u}of this.replicas){const l=this._remapForProject({projectName:n??this.project_name,runtimeEnv:void 0,excludeChildRuns:!0,reroot:u,distributedParentId:this.distributedParentId,apiUrl:s,apiKey:a,workspaceId:i}),c={id:l.id,name:l.name,run_type:l.run_type,start_time:l.start_time,outputs:l.outputs,error:l.error,parent_run_id:l.parent_run_id,session_name:l.session_name,reference_example_id:l.reference_example_id,end_time:l.end_time,dotted_order:l.dotted_order,trace_id:l.trace_id,events:l.events,tags:l.tags,extra:l.extra,attachments:this.attachments,...o};e!=null&&e.excludeInputs||(c.inputs=l.inputs),await this.client.updateRun(l.id,c,{apiKey:a,apiUrl:s,workspaceId:i})}else try{const n={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:((t=this.parent_run)==null?void 0:t.id)??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e!=null&&e.excludeInputs||(n.inputs=this.inputs),await this.client.updateRun(this.id,n)}catch(n){console.error(`Error in patchRun for run ${this.id}`,n)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var l,c,d,h;const n=e==null?void 0:e.callbacks;let a,s,i,o=aT();if(n){const f=((l=n==null?void 0:n.getParentRunId)==null?void 0:l.call(n))??"",p=(c=n==null?void 0:n.handlers)==null?void 0:c.find(m=>(m==null?void 0:m.name)=="langchain_tracer");a=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,f),s=p==null?void 0:p.projectName,i=p==null?void 0:p.client,o=o||!!p}return a?new cn({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:i,tracingEnabled:o,project_name:s,tags:[...new Set(((a==null?void 0:a.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(h=a==null?void 0:a.extra)==null?void 0:h.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new cn({...t,client:i,tracingEnabled:o,project_name:s})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var c;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=n["langsmith-trace"];if(!a||typeof a!="string")return;const s=a.trim(),i=s.split(".").map(d=>{const[h,f]=d.split("Z");return{strTime:h,time:Date.parse(h+"Z"),uuid:f}}),o=i[0].uuid,u={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(c=i.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:s};if(n.baggage&&typeof n.baggage=="string"){const d=xc.fromHeader(n.baggage);u.metadata=d.metadata,u.tags=d.tags,u.project_name=d.project_name,u.replicas=d.replicas}const l=new cn(u);return l.distributedParentId=l.id,l}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new xc((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[a,s]of Object.entries(t))e.set(a,s);return t}}Object.defineProperty(cn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function oT(r){return r!=null&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function m6(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function y5(r){return Array.isArray(r)&&r.some(e=>m6(e))}function uT(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function lT(r){const e=r==null?void 0:r.callbacks;return r!=null&&typeof e=="object"&&(y5(e==null?void 0:e.handlers)||y5(e))}function cT(){const r=Ba("LANGSMITH_RUNS_ENDPOINTS");if(!r)return[];try{const e=JSON.parse(r);if(Array.isArray(e)){const t=[];for(const n of e){if(typeof n!="object"||n===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof n}`);continue}if(typeof n.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_url}`);continue}if(typeof n.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_key}`);continue}t.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key})}return t}else if(typeof e=="object"&&e!==null){hT(e);const t=[];for(const[n,a]of Object.entries(e)){const s=n.replace(/\/$/,"");if(typeof a=="string")t.push({apiUrl:s,apiKey:a});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got ${typeof a}`);continue}}return t}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(HC(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function dT(r){return r?r.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):cT()}function hT(r){if(Object.keys(r).length>0&&fn("ENDPOINT"))throw new qC}var g6={};Xe(g6,{BaseTracer:()=>hs,isBaseTracer:()=>Pi});const fT=r=>{if(r)return r.events=r.events??[],r.child_runs=r.child_runs??[],r};function Yf(r,e){if(r)return new cn({...r,start_time:r._serialized_start_time??r.start_time,parent_run:Yf(e),child_runs:r.child_runs.map(t=>Yf(t)).filter(t=>t!==void 0),extra:{...r.extra,runtime:Zb()},tracingEnabled:!1})}function ef(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function Pi(r){return typeof r._addRunToRunMap=="function"}var hs=class extends xo{constructor(e){super(...arguments);g(this,"runMap",new Map);g(this,"runTreeMap",new Map);g(this,"usesRunTreeMap",!1)}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?fT(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const{dottedOrder:t,microsecondPrecisionDatestring:n}=p6(new Date(e.start_time).getTime(),e.id,e.execution_order),a={...e},s=this.getRunById(a.parent_run_id);if(a.parent_run_id!==void 0?s?(this._addChildRun(s,a),s.child_execution_order=Math.max(s.child_execution_order,a.child_execution_order),a.trace_id=s.trace_id,s.dotted_order!==void 0&&(a.dotted_order=[s.dotted_order,t].join("."),a._serialized_start_time=n)):a.parent_run_id=void 0:(a.trace_id=a.id,a.dotted_order=t,a._serialized_start_time=n),this.usesRunTreeMap){const i=Yf(a,s);i!==void 0&&this.runTreeMap.set(a.id,i)}else this.runMap.set(a.id,a);return a}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await((n=this.onRunUpdate)==null?void 0:n.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,a,s,i,o,u){const l=this._getExecutionOrder(a),c=Date.now(),d=o?{...s,metadata:o}:s,h={id:n,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,t,n,a,s,i,o,u){var c,d;const l=this.getRunById(n)??this._createRunForLLMStart(e,t,n,a,s,i,o,u);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((d=this.onLLMStart)==null?void 0:d.call(this,l)),l}_createRunForChatModelStart(e,t,n,a,s,i,o,u){const l=this._getExecutionOrder(a),c=Date.now(),d=o?{...s,metadata:o}:s,h={id:n,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,t,n,a,s,i,o,u){var c,d;const l=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,a,s,i,o,u);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((d=this.onLLMStart)==null?void 0:d.call(this,l)),l}async handleLLMEnd(e,t,n,a,s){var o;const i=this.getRunById(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...s},await((o=this.onLLMEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,t,n,a,s){var o;const i=this.getRunById(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...s},await((o=this.onLLMError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,t,n,a,s,i,o,u){const l=this._getExecutionOrder(a),c=Date.now(),d={id:n,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,a,s,i,o,u){var c,d;const l=this.getRunById(n)??this._createRunForChainStart(e,t,n,a,s,i,o,u);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((d=this.onChainStart)==null?void 0:d.call(this,l)),l}async handleChainEnd(e,t,n,a,s){var o;const i=this.getRunById(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=ef(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(i.inputs=ef(s.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,t,n,a,s){var o;const i=this.getRunById(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(i.inputs=ef(s.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,t,n,a,s,i,o){const u=this._getExecutionOrder(a),l=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,n,a,s,i,o){var l,c;const u=this.getRunById(n)??this._createRunForToolStart(e,t,n,a,s,i,o);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((c=this.onToolStart)==null?void 0:c.call(this,u)),u}async handleToolEnd(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var s;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const a=n;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentAction)==null?void 0:s.call(this,n))}async handleAgentEnd(e,t){var a;const n=this.getRunById(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,n)))}_createRunForRetrieverStart(e,t,n,a,s,i,o){const u=this._getExecutionOrder(a),l=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,n,a,s,i,o){var l,c;const u=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,a,s,i,o);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((c=this.onRetrieverStart)==null?void 0:c.call(this,u)),u}async handleRetrieverEnd(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var a;const n=this.getRunById(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var a;const n=this.getRunById(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,n)))}async handleLLMNewToken(e,t,n,a,s,i){var u;const o=this.getRunById(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i==null?void 0:i.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}},Vl={exports:{}};Vl.exports;var v5;function pT(){return v5||(v5=1,function(r){const t=(s=0)=>i=>`\x1B[${38+s};5;${i}m`,n=(s=0)=>(i,o,u)=>`\x1B[${38+s};2;${i};${o};${u}m`;function a(){const s=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,u]of Object.entries(i)){for(const[l,c]of Object.entries(u))i[l]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},u[l]=i[l],s.set(c[0],c[1]);Object.defineProperty(i,o,{value:u,enumerable:!1})}return Object.defineProperty(i,"codes",{value:s,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=t(),i.color.ansi16m=n(),i.bgColor.ansi256=t(10),i.bgColor.ansi16m=n(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,u,l)=>o===u&&u===l?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:l}=u.groups;l.length===3&&(l=l.split("").map(d=>d+d).join(""));const c=Number.parseInt(l,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(r,"exports",{enumerable:!0,get:a})}(Vl)),Vl.exports}var mT=pT();const y6=Ai(mT);var v6={};Xe(v6,{ConsoleCallbackHandler:()=>Jf});function Wr(r,e){return`${r.open}${e}${r.close}`}function Dn(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function _5(r){return typeof r=="string"?r.trim():r==null?r:Dn(r,r.toString())}function bs(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:on}=y6;var Jf=class extends hs{constructor(){super(...arguments);g(this,"name","console_callback_handler")}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const a=this.runMap.get(n.parent_run_id);if(a)t.push(a),n=a;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((a,s,i)=>{const o=`${a.execution_order}:${a.run_type}:${a.name}`;return s===i.length-1?Wr(y6.bold,o):o}).join(" > ");return Wr(on.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Dn(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.cyan,"[chain/end]")} [${t}] [${bs(e)}] Exiting Chain run with output: ${Dn(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.red,"[chain/error]")} [${t}] [${bs(e)}] Chain run errored with error: ${Dn(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${Wr(on.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Dn(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.cyan,"[llm/end]")} [${t}] [${bs(e)}] Exiting LLM run with output: ${Dn(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.red,"[llm/error]")} [${t}] [${bs(e)}] LLM run errored with error: ${Dn(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.green,"[tool/start]")} [${t}] Entering Tool run with input: "${_5(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${Wr(on.cyan,"[tool/end]")} [${t}] [${bs(e)}] Exiting Tool run with output: "${_5((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.red,"[tool/error]")} [${t}] [${bs(e)}] Tool run errored with error: ${Dn(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Dn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.cyan,"[retriever/end]")} [${t}] [${bs(e)}] Exiting Retriever run with output: ${Dn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Wr(on.red,"[retriever/error]")} [${t}] [${bs(e)}] Retriever run errored with error: ${Dn(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${Wr(on.blue,"[agent/action]")} [${n}] Agent selected action: ${Dn(t.actions[t.actions.length-1],"[action]")}`)}};let tf;const _6=()=>{if(tf===void 0){const r=Xa("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};tf=new ro(r)}return tf};let gT=class{getStore(){}run(e,t){return t()}};const rf=Symbol.for("ls:tracing_async_local_storage"),yT=new gT;let vT=class{getInstance(){return globalThis[rf]??yT}initializeGlobalInstance(e){globalThis[rf]===void 0&&(globalThis[rf]=e)}};const _T=new vT;function bT(r=!1){const e=_T.getInstance().getStore();if(!r&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function Jm(r){return typeof r=="function"&&"langsmith:traceable"in r}var b6={};Xe(b6,{LangChainTracer:()=>Gl});var Gl=class w6 extends hs{constructor(t={}){super(t);g(this,"name","langchain_tracer");g(this,"projectName");g(this,"exampleId");g(this,"client");g(this,"replicas");g(this,"usesRunTreeMap",!0);const{exampleId:n,projectName:a,client:s,replicas:i}=t;this.projectName=a??Xb(),this.replicas=i,this.exampleId=n,this.client=s??_6();const o=w6.getTraceableRunTree();o&&this.updateFromRunTree(o)}async persistRun(t){}async onRunCreate(t){const n=this.getRunTreeWithTracingConfig(t.id);await(n==null?void 0:n.postRun())}async onRunUpdate(t){const n=this.getRunTreeWithTracingConfig(t.id);await(n==null?void 0:n.patchRun())}getRun(t){return this.runTreeMap.get(t)}updateFromRunTree(t){this.runTreeMap.set(t.id,t);let n=t;const a=new Set;for(;n.parent_run&&!(a.has(n.id)||(a.add(n.id),!n.parent_run));)n=n.parent_run;a.clear();const s=[n];for(;s.length>0;){const i=s.shift();!i||a.has(i.id)||(a.add(i.id),this.runTreeMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=t.client??this.client,this.replicas=t.replicas??this.replicas,this.projectName=t.project_name??this.projectName,this.exampleId=t.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(t){const n=this.runTreeMap.get(t);if(n)return new cn({...n,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return bT(!0)}catch{return}}};let fi;function wT(){const r="default"in Qa?Qa.default:Qa;return new r({autoStart:!0,concurrency:1})}function ET(){return typeof fi>"u"&&(fi=wT()),fi}async function br(r,e){if(e===!0){const t=du();t!==void 0?await t.run(void 0,async()=>r()):await r()}else fi=ET(),fi.add(async()=>{const t=du();t!==void 0?await t.run(void 0,async()=>r()):await r()})}async function xT(){const r=_6();await Promise.allSettled([typeof fi<"u"?fi.onIdle():Promise.resolve(),r.awaitPendingTraceBatches()])}var E6={};Xe(E6,{awaitAllCallbacks:()=>xT,consumeCallback:()=>br});const ST=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Xa(t)==="true");function x6(r){var n;const e=du();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[Qo])==null?void 0:n[r]}const AT=Symbol("lc:configure_hooks"),kT=()=>x6(AT)||[];var S6={};Xe(S6,{BaseCallbackManager:()=>A6,BaseRunManager:()=>Hu,CallbackManager:()=>tn,CallbackManagerForChainRun:()=>C6,CallbackManagerForLLMRun:()=>Xf,CallbackManagerForRetrieverRun:()=>k6,CallbackManagerForToolRun:()=>T6,ensureHandler:()=>pu,parseCallbackConfigArg:()=>qu});function qu(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var A6=class{setHandler(r){return this.setHandlers([r])}},Hu=class{constructor(r,e,t,n,a,s,i,o){this.runId=r,this.handlers=e,this.inheritableHandlers=t,this.tags=n,this.inheritableTags=a,this.metadata=s,this.inheritableMetadata=i,this._parentRunId=o}get parentRunId(){return this._parentRunId}async handleText(r){await Promise.all(this.handlers.map(e=>br(async()=>{var t;try{await((t=e.handleText)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleText: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleCustomEvent(r,e,t,n,a){await Promise.all(this.handlers.map(s=>br(async()=>{var i;try{await((i=s.handleCustomEvent)==null?void 0:i.call(s,r,e,this.runId,this.tags,this.metadata))}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${o}`),s.raiseError)throw o}},s.awaitHandlers)))}},k6=class extends Hu{getChild(r){const e=new tn(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),r&&e.addTags([r],!1),e}async handleRetrieverEnd(r){await Promise.all(this.handlers.map(e=>br(async()=>{var t;if(!e.ignoreRetriever)try{await((t=e.handleRetrieverEnd)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetriever`),e.raiseError)throw n}},e.awaitHandlers)))}async handleRetrieverError(r){await Promise.all(this.handlers.map(e=>br(async()=>{var t;if(!e.ignoreRetriever)try{await((t=e.handleRetrieverError)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetrieverError: ${n}`),e.raiseError)throw r}},e.awaitHandlers)))}},Xf=class extends Hu{async handleLLMNewToken(r,e,t,n,a,s){await Promise.all(this.handlers.map(i=>br(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMNewToken)==null?void 0:o.call(i,r,e??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(u){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMNewToken: ${u}`),i.raiseError)throw u}},i.awaitHandlers)))}async handleLLMError(r,e,t,n,a){await Promise.all(this.handlers.map(s=>br(async()=>{var i;if(!s.ignoreLLM)try{await((i=s.handleLLMError)==null?void 0:i.call(s,r,this.runId,this._parentRunId,this.tags,a))}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMError: ${o}`),s.raiseError)throw o}},s.awaitHandlers)))}async handleLLMEnd(r,e,t,n,a){await Promise.all(this.handlers.map(s=>br(async()=>{var i;if(!s.ignoreLLM)try{await((i=s.handleLLMEnd)==null?void 0:i.call(s,r,this.runId,this._parentRunId,this.tags,a))}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMEnd: ${o}`),s.raiseError)throw o}},s.awaitHandlers)))}},C6=class extends Hu{getChild(r){const e=new tn(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),r&&e.addTags([r],!1),e}async handleChainError(r,e,t,n,a){await Promise.all(this.handlers.map(s=>br(async()=>{var i;if(!s.ignoreChain)try{await((i=s.handleChainError)==null?void 0:i.call(s,r,this.runId,this._parentRunId,this.tags,a))}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainError: ${o}`),s.raiseError)throw o}},s.awaitHandlers)))}async handleChainEnd(r,e,t,n,a){await Promise.all(this.handlers.map(s=>br(async()=>{var i;if(!s.ignoreChain)try{await((i=s.handleChainEnd)==null?void 0:i.call(s,r,this.runId,this._parentRunId,this.tags,a))}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainEnd: ${o}`),s.raiseError)throw o}},s.awaitHandlers)))}async handleAgentAction(r){await Promise.all(this.handlers.map(e=>br(async()=>{var t;if(!e.ignoreAgent)try{await((t=e.handleAgentAction)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentAction: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleAgentEnd(r){await Promise.all(this.handlers.map(e=>br(async()=>{var t;if(!e.ignoreAgent)try{await((t=e.handleAgentEnd)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentEnd: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}},T6=class extends Hu{getChild(r){const e=new tn(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),r&&e.addTags([r],!1),e}async handleToolError(r){await Promise.all(this.handlers.map(e=>br(async()=>{var t;if(!e.ignoreAgent)try{await((t=e.handleToolError)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolError: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleToolEnd(r){await Promise.all(this.handlers.map(e=>br(async()=>{var t;if(!e.ignoreAgent)try{await((t=e.handleToolEnd)==null?void 0:t.call(e,r,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolEnd: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}},tn=class zo extends A6{constructor(t,n){super();g(this,"handlers",[]);g(this,"inheritableHandlers",[]);g(this,"tags",[]);g(this,"inheritableTags",[]);g(this,"metadata",{});g(this,"inheritableMetadata",{});g(this,"name","callback_manager");g(this,"_parentRunId");this.handlers=(n==null?void 0:n.handlers)??this.handlers,this.inheritableHandlers=(n==null?void 0:n.inheritableHandlers)??this.inheritableHandlers,this.tags=(n==null?void 0:n.tags)??this.tags,this.inheritableTags=(n==null?void 0:n.inheritableTags)??this.inheritableTags,this.metadata=(n==null?void 0:n.metadata)??this.metadata,this.inheritableMetadata=(n==null?void 0:n.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=t}getParentRunId(){return this._parentRunId}async handleLLMStart(t,n,a=void 0,s=void 0,i=void 0,o=void 0,u=void 0,l=void 0){return Promise.all(n.map(async(c,d)=>{const h=d===0&&a?a:Es();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Pi(f)&&f._createRunForLLMStart(t,[c],h,this._parentRunId,i,this.tags,this.metadata,l),br(async()=>{var p;try{await((p=f.handleLLMStart)==null?void 0:p.call(f,t,[c],h,this._parentRunId,i,this.tags,this.metadata,l))}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new Xf(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(t,n,a=void 0,s=void 0,i=void 0,o=void 0,u=void 0,l=void 0){return Promise.all(n.map(async(c,d)=>{const h=d===0&&a?a:Es();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Pi(f)&&f._createRunForChatModelStart(t,[c],h,this._parentRunId,i,this.tags,this.metadata,l),br(async()=>{var p,m;try{if(f.handleChatModelStart)await((p=f.handleChatModelStart)==null?void 0:p.call(f,t,[c],h,this._parentRunId,i,this.tags,this.metadata,l));else if(f.handleLLMStart){const v=zm(c);await((m=f.handleLLMStart)==null?void 0:m.call(f,t,[v],h,this._parentRunId,i,this.tags,this.metadata,l))}}catch(v){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${v}`),f.raiseError)throw v}},f.awaitHandlers)})),new Xf(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(t,n,a=Es(),s=void 0,i=void 0,o=void 0,u=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return Pi(l)&&l._createRunForChainStart(t,n,a,this._parentRunId,this.tags,this.metadata,s,u),br(async()=>{var c;try{await((c=l.handleChainStart)==null?void 0:c.call(l,t,n,a,this._parentRunId,this.tags,this.metadata,s,u))}catch(d){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${d}`),l.raiseError)throw d}},l.awaitHandlers)})),new C6(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(t,n,a=Es(),s=void 0,i=void 0,o=void 0,u=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return Pi(l)&&l._createRunForToolStart(t,n,a,this._parentRunId,this.tags,this.metadata,u),br(async()=>{var c;try{await((c=l.handleToolStart)==null?void 0:c.call(l,t,n,a,this._parentRunId,this.tags,this.metadata,u))}catch(d){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${d}`),l.raiseError)throw d}},l.awaitHandlers)})),new T6(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(t,n,a=Es(),s=void 0,i=void 0,o=void 0,u=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return Pi(l)&&l._createRunForRetrieverStart(t,n,a,this._parentRunId,this.tags,this.metadata,u),br(async()=>{var c;try{await((c=l.handleRetrieverStart)==null?void 0:c.call(l,t,n,a,this._parentRunId,this.tags,this.metadata,u))}catch(d){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${d}`),l.raiseError)throw d}},l.awaitHandlers)})),new k6(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(t,n,a,s,i){await Promise.all(this.handlers.map(o=>br(async()=>{var u;if(!o.ignoreCustomEvent)try{await((u=o.handleCustomEvent)==null?void 0:u.call(o,t,n,a,this.tags,this.metadata))}catch(l){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}addHandler(t,n=!0){this.handlers.push(t),n&&this.inheritableHandlers.push(t)}removeHandler(t){this.handlers=this.handlers.filter(n=>n!==t),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==t)}setHandlers(t,n=!0){this.handlers=[],this.inheritableHandlers=[];for(const a of t)this.addHandler(a,n)}addTags(t,n=!0){this.removeTags(t),this.tags.push(...t),n&&this.inheritableTags.push(...t)}removeTags(t){this.tags=this.tags.filter(n=>!t.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!t.includes(n))}addMetadata(t,n=!0){this.metadata={...this.metadata,...t},n&&(this.inheritableMetadata={...this.inheritableMetadata,...t})}removeMetadata(t){for(const n of Object.keys(t))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(t=[],n=!0){const a=new zo(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);a.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);a.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);a.addMetadata({[s]:this.metadata[s]},i)}for(const s of t)a.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||a.addHandler(s,n);return a}static fromHandlers(t){class n extends xo{constructor(){super();g(this,"name",Es());Object.assign(this,t)}}const a=new this;return a.addHandler(new n),a}static configure(t,n,a,s,i,o,u){return this._configureSync(t,n,a,s,i,o,u)}static _configureSync(t,n,a,s,i,o,u){var f;let l;(t||n)&&(Array.isArray(t)||!t?(l=new zo,l.setHandlers((t==null?void 0:t.map(pu))??[],!0)):l=t,l=l.copy(Array.isArray(n)?n.map(pu):n==null?void 0:n.handlers,!1));const c=Xa("LANGCHAIN_VERBOSE")==="true"||(u==null?void 0:u.verbose),d=((f=Gl.getTraceableRunTree())==null?void 0:f.tracingEnabled)||ST(),h=d||(Xa("LANGCHAIN_TRACING")??!1);if(c||h){if(l||(l=new zo),c&&!l.handlers.some(p=>p.name===Jf.prototype.name)){const p=new Jf;l.addHandler(p,!0)}if(h&&!l.handlers.some(p=>p.name==="langchain_tracer")&&d){const p=new Gl;l.addHandler(p,!0)}if(d){const p=Gl.getTraceableRunTree();if(p&&l._parentRunId===void 0){l._parentRunId=p.id;const m=l.handlers.find(v=>v.name==="langchain_tracer");m==null||m.updateFromRunTree(p)}}}for(const{contextVar:p,inheritable:m=!0,handlerClass:v,envVar:_}of kT()){const w=_&&Xa(_)==="true"&&v;let E;const F=p!==void 0?x6(p):void 0;F&&Yb(F)?E=F:w&&(E=new v({})),E!==void 0&&(l||(l=new zo),l.handlers.some(k=>k.name===E.name)||l.addHandler(E,m))}return(a||s)&&l&&(l.addTags(a??[]),l.addTags(s??[],!1)),(i||o)&&l&&(l.addMetadata(i??{}),l.addMetadata(o??{},!1)),l}};function pu(r){return"name"in r?r:xo.fromMethods(r)}var F6=class{getStore(){}run(r,e){return e()}enterWith(r){}};const CT=new F6,b5=Symbol.for("lc:child_config");var TT=class{getInstance(){return du()??CT}getRunnableConfig(){var e,t;return(t=(e=this.getInstance().getStore())==null?void 0:e.extra)==null?void 0:t[b5]}runWithConfig(r,e,t){var l;const n=tn._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata),a=this.getInstance(),s=a.getStore(),i=n==null?void 0:n.getParentRunId(),o=(l=n==null?void 0:n.handlers)==null?void 0:l.find(c=>(c==null?void 0:c.name)==="langchain_tracer");let u;return o&&i?u=o.getRunTreeWithTracingConfig(i):t||(u=new cn({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[b5]:r}),s!==void 0&&s[Qo]!==void 0&&(u===void 0&&(u={}),u[Qo]=s[Qo]),a.run(u,e)}initializeGlobalInstance(r){du()===void 0&&US(r)}};const Or=new TT;var N6={};Xe(N6,{AsyncLocalStorageProviderSingleton:()=>Or,MockAsyncLocalStorage:()=>F6,_CONTEXT_VARIABLES_KEY:()=>Qo});class FT{constructor(){g(this,"store")}getStore(){return this.store}run(e,t,...n){const a=this.store;this.store=e;try{return t(...n)}finally{this.store=a}}enterWith(e){this.store=e}disable(){this.store=void 0}exit(e,...t){const n=this.store;this.store=void 0;try{return e(...t)}finally{this.store=n}}}function NT(){Or.initializeGlobalInstance(new FT)}var Fi=class extends Error{constructor(e,t){let n=e??"";t!=null&&t.lc_error_code&&(n=`${n}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/${t.lc_error_code}/
`);super(n);g(this,"lc_error_code");this.lc_error_code=t==null?void 0:t.lc_error_code}},I6=class extends Fi{get is_bubble_up(){return!0}},IT=class extends Fi{constructor(r,e){super(r,e),this.name="GraphRecursionError"}static get unminifiable_name(){return"GraphRecursionError"}},Zl=class extends Fi{constructor(r,e){super(r,e),this.name="GraphValueError"}static get unminifiable_name(){return"GraphValueError"}},Yi=class extends I6{constructor(e,t){super(JSON.stringify(e,null,2),t);g(this,"interrupts");this.name="GraphInterrupt",this.interrupts=e??[]}static get unminifiable_name(){return"GraphInterrupt"}},O6=class extends Yi{constructor(r,e){super([{value:r}],e),this.name="NodeInterrupt"}static get unminifiable_name(){return"NodeInterrupt"}},R6=class extends I6{constructor(e){super();g(this,"command");this.name="ParentCommand",this.command=e}static get unminifiable_name(){return"ParentCommand"}};function OT(r){return r!==void 0&&r.name===R6.unminifiable_name}function Kl(r){return r!==void 0&&r.is_bubble_up===!0}function qi(r){return r!==void 0&&[Yi.unminifiable_name,O6.unminifiable_name].includes(r.name)}var w5=class extends Fi{constructor(r,e){super(r,e),this.name="EmptyInputError"}static get unminifiable_name(){return"EmptyInputError"}},Lr=class extends Fi{constructor(r,e){super(r,e),this.name="EmptyChannelError"}static get unminifiable_name(){return"EmptyChannelError"}},ar=class extends Fi{constructor(r,e){super(r,e),this.name="InvalidUpdateError"}static get unminifiable_name(){return"InvalidUpdateError"}},RT=class extends Fi{constructor(r,e){super(r,e),this.name="UnreachableNodeError"}static get unminifiable_name(){return"UnreachableNodeError"}};function D6(r){return rk({clockseq:r})}function Hi(r,e){const t=e.replace(/-/g,"").match(/.{2}/g).map(n=>parseInt(n,16));return Ts(r,new Uint8Array(t))}const DT="__error__",Wl="__scheduled__",BT="__interrupt__",MT="__resume__";var E5="[...]",$T="[Circular]",Sc=[],Vi=[];function PT(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function LT(r,e,t,n){typeof n>"u"&&(n=PT()),Qf(r,"",0,[],void 0,0,n);var a;try{Vi.length===0?a=JSON.stringify(r,e,t):a=JSON.stringify(r,zT(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Sc.length!==0;){var s=Sc.pop();s.length===4?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return a}function nf(r,e,t,n){var a=Object.getOwnPropertyDescriptor(n,t);a.get!==void 0?a.configurable?(Object.defineProperty(n,t,{value:r}),Sc.push([n,t,e,a])):Vi.push([e,t,r]):(n[t]=r,Sc.push([n,t,e]))}function Qf(r,e,t,n,a,s,i){s+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){nf($T,r,e,a);return}if(typeof i.depthLimit<"u"&&s>i.depthLimit){nf(E5,r,e,a);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){nf(E5,r,e,a);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Qf(r[o],o,o,n,r,s,i);else{var u=Object.keys(r);for(o=0;o<u.length;o++){var l=u[o];Qf(r[l],l,o,n,r,s,i)}}n.pop()}}function zT(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Vi.length>0)for(var n=0;n<Vi.length;n++){var a=Vi[n];if(a[1]===e&&a[0]===t){t=a[2],Vi.splice(n,1);break}}return r.call(this,e,t)}}const UT=[];var jT={};const af=25;async function yn(r){return tn._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function Un(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const a=e[n]??[];e[n]=[...new Set(a.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const a=e.callbacks,s=t.callbacks;if(Array.isArray(s))if(!a)e.callbacks=s;else if(Array.isArray(a))e.callbacks=a.concat(s);else{const i=a.copy();for(const o of s)i.addHandler(pu(o),!0);e.callbacks=i}else if(s)if(!a)e.callbacks=s;else if(Array.isArray(a)){const i=s.copy();for(const o of a)i.addHandler(pu(o),!0);e.callbacks=i}else e.callbacks=new tn(s._parentRunId,{handlers:a.handlers.concat(s.handlers),inheritableHandlers:a.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(s.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(s.inheritableTags))),metadata:{...a.metadata,...s.metadata}})}else{const a=n;e[a]=t[a]??e[a]}return e}const qT=new Set(["string","number","boolean"]);function Tt(r){var n;const e=Or.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:a,runName:s,...i}=e;t=Object.entries(i).reduce((o,[u,l])=>(l!==void 0&&(o[u]=l),o),t)}if(r&&(t=Object.entries(r).reduce((a,[s,i])=>(i!==void 0&&(a[s]=i),a),t)),t!=null&&t.configurable)for(const a of Object.keys(t.configurable))qT.has(typeof t.configurable[a])&&!((n=t.metadata)!=null&&n[a])&&(t.metadata||(t.metadata={}),t.metadata[a]=t.configurable[a]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const a=t.timeout,s=AbortSignal.timeout(a);t.metadata||(t.metadata={}),t.metadata.timeoutMs===void 0&&(t.metadata.timeoutMs=a),t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function Pt(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:a,configurable:s,runId:i}={}){const o=Tt(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),a!==void 0&&(o.runName=a),s!==void 0&&(o.configurable={...o.configurable,...s}),i!==void 0&&delete o.runId,o}function os(r){if(r)return{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal,store:r.store}}async function us(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,a)=>{t=()=>{a(mu(e))},e.addEventListener("abort",t),e.aborted&&a(mu(e))})]).finally(()=>e.removeEventListener("abort",t))}function mu(r){return(r==null?void 0:r.reason)instanceof Error?r.reason:typeof(r==null?void 0:r.reason)=="string"?new Error(r.reason):new Error("Aborted")}var B6={};Xe(B6,{AsyncGeneratorWithSetup:()=>Ni,IterableReadableStream:()=>_n,atee:()=>Xm,concat:()=>qs,pipeGeneratorWithSetup:()=>M6});var _n=class ep extends ReadableStream{constructor(){super(...arguments);g(this,"reader")}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const t=await this.reader.read();return t.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:t.value}}catch(t){throw this.reader.releaseLock(),t}}async return(){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}return{done:!0,value:void 0}}async throw(t){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}throw t}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(t){const n=t.getReader();return new ep({start(a){return s();function s(){return n.read().then(({done:i,value:o})=>{if(i){a.close();return}return a.enqueue(o),s()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(t){return new ep({async pull(n){const{value:a,done:s}=await t.next();s&&n.close(),n.enqueue(a)},async cancel(n){await t.return(n)}})}};function Xm(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(a){for(;;)if(a.length===0){const s=await r.next();for(const i of t)i.push(s)}else{if(a[0].done)return;yield a.shift().value}})}function qs(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,a]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=qs(t[n],a):t[n]=a;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var Ni=class{constructor(r){g(this,"generator");g(this,"setup");g(this,"config");g(this,"signal");g(this,"firstResult");g(this,"firstResultUsed",!1);var e;this.generator=r.generator,this.config=r.config,this.signal=r.signal??((e=this.config)==null?void 0:e.signal),this.setup=new Promise((t,n)=>{Or.runWithConfig(os(r.config),async()=>{this.firstResult=r.generator.next(),r.startSetup?this.firstResult.then(r.startSetup).then(t,n):this.firstResult.then(a=>t(void 0),n)},!0)})}async next(...r){var e;return(e=this.signal)==null||e.throwIfAborted(),this.firstResultUsed?Or.runWithConfig(os(this.config),this.signal?async()=>us(this.generator.next(...r),this.signal):async()=>this.generator.next(...r),!0):(this.firstResultUsed=!0,this.firstResult)}async return(r){return this.generator.return(r)}async throw(r){return this.generator.throw(r)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function M6(r,e,t,n,...a){const s=new Ni({generator:e,startSetup:t,signal:n}),i=await s.setup;return{output:r(s,i,...a),setup:i}}/*!
* https://github.com/Starcounter-Jack/JSON-Patch
* (c) 2017-2022 Joachim Wester
* MIT licensed
*/const HT=Object.prototype.hasOwnProperty;function tp(r,e){return HT.call(r,e)}function rp(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)tp(r,t)&&e.push(t);return e}function oa(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function np(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Di(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function VT(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function ap(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(ap(r[t]))return!0}else if(typeof r=="object"){const t=rp(r),n=t.length;for(var e=0;e<n;e++)if(ap(r[t[e]]))return!0}}return!1}function x5(r,e){const t=[r];for(const n in e){const a=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof a<"u"&&t.push(`${n}: ${a}`)}return t.join(`
`)}var GT=class extends Error{constructor(r,e,t,n,a){super(x5(r,{name:e,index:t,operation:n,tree:a})),this.name=e,this.index=t,this.operation=n,this.tree=a,Object.setPrototypeOf(this,new.target.prototype),this.message=x5(r,{name:e,index:t,operation:n,tree:a})}},$6={};Xe($6,{JsonPatchError:()=>dr,_areEquals:()=>gu,applyOperation:()=>pi,applyPatch:()=>no,applyReducer:()=>WT,deepClone:()=>ZT,getValueByPointer:()=>Ac,validate:()=>P6,validator:()=>kc});const dr=GT,ZT=oa;function sf(r){return Object.getOwnPropertyNames(Object.prototype).includes(r)}const Gi={add:function(r,e,t){if(sf(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){if(sf(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){if(sf(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=Ac(t,this.path);n&&(n=oa(n));const a=pi(t,{op:"remove",path:this.from}).removed;return pi(t,{op:"add",path:this.path,value:a}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=Ac(t,this.from);return pi(t,{op:"add",path:this.path,value:oa(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:gu(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var KT={add:function(r,e,t){return np(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Gi.move,copy:Gi.copy,test:Gi.test,_get:Gi._get};function Ac(r,e){if(e=="")return r;var t={op:"_get",path:e};return pi(r,t),t.value}function pi(r,e,t=!1,n=!0,a=!0,s=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):kc(e,0)),e.path===""){let i={newDocument:r};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=r,i;if(e.op==="move"||e.op==="copy")return i.newDocument=Ac(r,e.from),e.op==="move"&&(i.removed=r),i;if(e.op==="test"){if(i.test=gu(r,e.value),i.test===!1)throw new dr("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return i.newDocument=r,i}else{if(e.op==="remove")return i.removed=r,i.newDocument=null,i;if(e.op==="_get")return e.value=r,i;if(t)throw new dr("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,r);return i}}else{n||(r=oa(r));const o=(e.path||"").split("/");let u=r,l=1,c=o.length,d,h,f;for(typeof t=="function"?f=t:f=kc;;){if(h=o[l],h&&h.indexOf("~")!=-1&&(h=VT(h)),a&&(h=="__proto__"||h=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(u[h]===void 0?d=o.slice(0,l).join("/"):l==c-1&&(d=e.path),d!==void 0&&f(e,0,r,d)),l++,Array.isArray(u)){if(h==="-")h=u.length;else{if(t&&!np(h))throw new dr("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,r);np(h)&&(h=~~h)}if(l>=c){if(t&&e.op==="add"&&h>u.length)throw new dr("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,r);const p=KT[e.op].call(e,u,h,r);if(p.test===!1)throw new dr("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return p}}else if(l>=c){const p=Gi[e.op].call(e,u,h,r);if(p.test===!1)throw new dr("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return p}if(u=u[h],t&&l<c&&(!u||typeof u!="object"))throw new dr("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,r)}}}function no(r,e,t,n=!0,a=!0){if(t&&!Array.isArray(e))throw new dr("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=oa(r));const s=new Array(e.length);for(let i=0,o=e.length;i<o;i++)s[i]=pi(r,e[i],t,!0,a,i),r=s[i].newDocument;return s.newDocument=r,s}function WT(r,e,t){const n=pi(r,e);if(n.test===!1)throw new dr("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function kc(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new dr("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Gi[r.op]){if(typeof r.path!="string")throw new dr("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new dr('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new dr("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new dr("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&ap(r.value))throw new dr("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var a=r.path.split("/").length,s=n.split("/").length;if(a!==s+1&&a!==s)throw new dr("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new dr("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var i={op:"_get",path:r.from,value:void 0},o=P6([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new dr("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new dr("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function P6(r,e,t){try{if(!Array.isArray(r))throw new dr("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)no(oa(e),oa(r),t||!0);else{t=t||kc;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(a){if(a instanceof dr)return a;throw a}}function gu(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),a,s,i;if(t&&n){if(s=r.length,s!=e.length)return!1;for(a=s;a--!==0;)if(!gu(r[a],e[a]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(s=o.length,s!==Object.keys(e).length)return!1;for(a=s;a--!==0;)if(!e.hasOwnProperty(o[a]))return!1;for(a=s;a--!==0;)if(i=o[a],!gu(r[i],e[i]))return!1;return!0}return r!==r&&e!==e}function L6(r,e,t,n,a){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=rp(e),i=rp(r),o=!1,u=i.length-1;u>=0;u--){var l=i[u],c=r[l];if(tp(e,l)&&!(e[l]===void 0&&c!==void 0&&Array.isArray(e)===!1)){var d=e[l];typeof c=="object"&&c!=null&&typeof d=="object"&&d!=null&&Array.isArray(c)===Array.isArray(d)?L6(c,d,t,n+"/"+Di(l),a):c!==d&&(a&&t.push({op:"test",path:n+"/"+Di(l),value:oa(c)}),t.push({op:"replace",path:n+"/"+Di(l),value:oa(d)}))}else Array.isArray(r)===Array.isArray(e)?(a&&t.push({op:"test",path:n+"/"+Di(l),value:oa(c)}),t.push({op:"remove",path:n+"/"+Di(l)}),o=!0):(a&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!o&&s.length==i.length))for(var u=0;u<s.length;u++){var l=s[u];!tp(r,l)&&e[l]!==void 0&&t.push({op:"add",path:n+"/"+Di(l),value:oa(e[l])})}}}function b0(r,e,t=!1){var n=[];return L6(r,e,n,"",t),n}({...$6});var z6={};Xe(z6,{LogStreamCallbackHandler:()=>ip,RunLog:()=>Qm,RunLogPatch:()=>qa,isLogStreamHandler:()=>U6});var qa=class{constructor(r){g(this,"ops");this.ops=r.ops??[]}concat(r){const e=this.ops.concat(r.ops),t=no({},e);return new Qm({ops:e,state:t[t.length-1].newDocument})}},Qm=class sp extends qa{constructor(t){super(t);g(this,"state");this.state=t.state}concat(t){const n=this.ops.concat(t.ops),a=no(this.state,t.ops);return new sp({ops:n,state:a[a.length-1].newDocument})}static fromRunLogPatch(t){const n=no({},t.ops);return new sp({ops:t.ops,state:n[n.length-1].newDocument})}};const U6=r=>r.name==="log_stream_tracer";async function S5(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function A5(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function YT(r){return r!==void 0&&r.message!==void 0}var ip=class extends hs{constructor(e){super({_awaitHandler:!0,...e});g(this,"autoClose",!0);g(this,"includeNames");g(this,"includeTypes");g(this,"includeTags");g(this,"excludeNames");g(this,"excludeTypes");g(this,"excludeTags");g(this,"_schemaFormat","original");g(this,"rootId");g(this,"keyMapByRunId",{});g(this,"counterMapByRunName",{});g(this,"transformStream");g(this,"writer");g(this,"receiveStream");g(this,"name","log_stream_tracer");g(this,"lc_prefer_streaming",!0);this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_n.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(a=>{var s;return(s=this.includeTags)==null?void 0:s.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(a=>{var s;return!((s=this.excludeTags)!=null&&s.includes(a))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const a=this.keyMapByRunId[e];a&&await this.writer.write(new qa({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new qa({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await S5(e,this._schemaFormat)),await this.writer.write(new qa({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await S5(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await A5(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const a=new qa({ops:n});await this.writer.write(a)}finally{if(e.id===this.rootId){const t=new qa({ops:[{op:"replace",path:"/final_output",value:await A5(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const a=this.keyMapByRunId[e.id];if(a===void 0)return;const s=e.inputs.messages!==void 0;let i;s?YT(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new ca({id:`run-${e.id}`,content:t}):i=t;const o=new qa({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:i}]});await this.writer.write(o)}},j6={};Xe(j6,{ChatGenerationChunk:()=>so,GenerationChunk:()=>ao,RUN_KEY:()=>yu});const yu="__run";var ao=class q6{constructor(e){g(this,"text");g(this,"generationInfo");this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new q6({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},so=class H6 extends ao{constructor(t){super(t);g(this,"message");this.message=t.message}concat(t){return new H6({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};const JT=Object.prototype.toString,XT=r=>JT.call(r)==="[object Error]",QT=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function eF(r){if(!(r&&XT(r)&&r.name==="TypeError"&&typeof r.message=="string"))return!1;const{message:t,stack:n}=r;return t==="Load failed"?n===void 0||"__sentry_captured__"in r:t.startsWith("error sending request for url")?!0:QT.has(t)}function tF(r){if(typeof r=="number"){if(r<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(r))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(r!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function Cl(r,e,{min:t=0,allowInfinity:n=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${r}\` to be a number${n?" or Infinity":""}.`);if(!n&&!Number.isFinite(e))throw new TypeError(`Expected \`${r}\` to be a finite number.`);if(e<t)throw new TypeError(`Expected \`${r}\` to be \u2265 ${t}.`)}}var rF=class extends Error{constructor(r){super(),r instanceof Error?(this.originalError=r,{message:r}=r):(this.originalError=new Error(r),this.originalError.stack=this.stack),this.name="AbortError",this.message=r}};function nF(r,e){const t=Math.max(1,r+1),n=e.randomize?Math.random()+1:1;let a=Math.round(n*e.minTimeout*e.factor**(t-1));return a=Math.min(a,e.maxTimeout),a}function k5(r,e){return Number.isFinite(e)?e-(performance.now()-r):e}async function aF({error:r,attemptNumber:e,retriesConsumed:t,startTime:n,options:a}){var f,p,m;const s=r instanceof Error?r:new TypeError(`Non-error was thrown: "${r}". You should only throw errors.`);if(s instanceof rF)throw s.originalError;const i=Number.isFinite(a.retries)?Math.max(0,a.retries-t):a.retries,o=a.maxRetryTime??Number.POSITIVE_INFINITY,u=Object.freeze({error:s,attemptNumber:e,retriesLeft:i,retriesConsumed:t});if(await a.onFailedAttempt(u),k5(n,o)<=0)throw s;const l=await a.shouldConsumeRetry(u),c=k5(n,o);if(c<=0||i<=0)throw s;if(s instanceof TypeError&&!eF(s)){if(l)throw s;return(f=a.signal)==null||f.throwIfAborted(),!1}if(!await a.shouldRetry(u))throw s;if(!l)return(p=a.signal)==null||p.throwIfAborted(),!1;const d=nF(t,a),h=Math.min(d,c);return h>0&&await new Promise((v,_)=>{var F,k;const w=()=>{var N;clearTimeout(E),(N=a.signal)==null||N.removeEventListener("abort",w),_(a.signal.reason)},E=setTimeout(()=>{var N;(N=a.signal)==null||N.removeEventListener("abort",w),v()},h);a.unref&&((F=E.unref)==null||F.call(E)),(k=a.signal)==null||k.addEventListener("abort",w,{once:!0})}),(m=a.signal)==null||m.throwIfAborted(),!0}async function op(r,e={}){var s,i,o;if(e={...e},tF(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??(e.retries=10),e.factor??(e.factor=2),e.minTimeout??(e.minTimeout=1e3),e.maxTimeout??(e.maxTimeout=Number.POSITIVE_INFINITY),e.maxRetryTime??(e.maxRetryTime=Number.POSITIVE_INFINITY),e.randomize??(e.randomize=!1),e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.shouldConsumeRetry??(e.shouldConsumeRetry=()=>!0),Cl("factor",e.factor,{min:0,allowInfinity:!1}),Cl("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),Cl("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),Cl("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),(s=e.signal)==null||s.throwIfAborted();let t=0,n=0;const a=performance.now();for(;!Number.isFinite(e.retries)||n<=e.retries;){t++;try{(i=e.signal)==null||i.throwIfAborted();const u=await r(t);return(o=e.signal)==null||o.throwIfAborted(),u}catch(u){await aF({error:u,attemptNumber:t,retriesConsumed:n,startTime:a,options:e})&&n++}}throw new Error("Retry attempts exhausted without throwing an error.")}var V6={};Xe(V6,{AsyncCaller:()=>Vu});const sF=[400,401,402,403,404,405,406,407,409],iF=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&sF.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const a=new Error(r==null?void 0:r.message);throw a.name="InsufficientQuotaError",a}};var Vu=class{constructor(r){g(this,"maxConcurrency");g(this,"maxRetries");g(this,"onFailedAttempt");g(this,"queue");this.maxConcurrency=r.maxConcurrency??1/0,this.maxRetries=r.maxRetries??6,this.onFailedAttempt=r.onFailedAttempt??iF;const e="default"in Qa?Qa.default:Qa;this.queue=new e({concurrency:this.maxConcurrency})}async call(r,...e){return this.queue.add(()=>op(()=>r(...e).catch(t=>{throw t instanceof Error?t:new Error(t)}),{onFailedAttempt:({error:t})=>{var n;return(n=this.onFailedAttempt)==null?void 0:n.call(this,t)},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(r,e,...t){if(r.signal){let n;return Promise.race([this.call(e,...t),new Promise((a,s)=>{var i;n=()=>{s(mu(r.signal))},(i=r.signal)==null||i.addEventListener("abort",n)})]).finally(()=>{r.signal&&n&&r.signal.removeEventListener("abort",n)})}return this.call(e,...t)}fetch(...r){return this.call(()=>fetch(...r).then(e=>e.ok?e:Promise.reject(e)))}};function Ao(r,e,t){function n(o,u){if(o._zod||Object.defineProperty(o,"_zod",{value:{def:u,constr:i,traits:new Set},enumerable:!1}),o._zod.traits.has(r))return;o._zod.traits.add(r),e(o,u);const l=i.prototype,c=Object.keys(l);for(let d=0;d<c.length;d++){const h=c[d];h in o||(o[h]=l[h].bind(o))}}const a=(t==null?void 0:t.Parent)??Object;class s extends a{}Object.defineProperty(s,"name",{value:r});function i(o){var u;const l=t!=null&&t.Parent?new s:this;n(l,o),(u=l._zod).deferred??(u.deferred=[]);for(const c of l._zod.deferred)c();return l}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:o=>{var u,l;return t!=null&&t.Parent&&o instanceof t.Parent?!0:(l=(u=o==null?void 0:o._zod)==null?void 0:u.traits)==null?void 0:l.has(r)}}),Object.defineProperty(i,"name",{value:r}),i}let ru=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}};const oF={};function w0(r){return oF}function uF(r){const e=Object.values(r).filter(n=>typeof n=="number");return Object.entries(r).filter(([n,a])=>e.indexOf(+n)===-1).map(([n,a])=>a)}function lF(r,e){return typeof e=="bigint"?e.toString():e}function cF(r){const e=r.startsWith("^")?1:0,t=r.endsWith("$")?r.length-1:r.length;return r.slice(e,t)}const C5=Symbol("evaluating");function T5(r,e,t){let n;Object.defineProperty(r,e,{get(){if(n!==C5)return n===void 0&&(n=C5,n=t()),n},set(a){Object.defineProperty(r,e,{value:a})},configurable:!0})}function G6(r,e,t){Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0})}function Z6(...r){const e={};for(const t of r){const n=Object.getOwnPropertyDescriptors(t);Object.assign(e,n)}return Object.defineProperties({},e)}const K6="captureStackTrace"in Error?Error.captureStackTrace:(...r)=>{};function F5(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function dF(r){if(F5(r)===!1)return!1;const e=r.constructor;if(e===void 0||typeof e!="function")return!0;const t=e.prototype;return!(F5(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}function ua(r,e,t){const n=new r._zod.constr(e??r._zod.def);return(!e||t!=null&&t.parent)&&(n._zod.parent=r),n}function hF(r){return{}}function fF(r,e){if(!dF(e))throw new Error("Invalid input to extend: expected a plain object");const t=r._zod.def.checks;if(t&&t.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const a=Z6(r._zod.def,{get shape(){const s={...r._zod.def.shape,...e};return G6(this,"shape",s),s},checks:[]});return ua(r,a)}function pF(r,e,t){const n=Z6(e._zod.def,{get shape(){const a=e._zod.def.shape,s={...a};for(const i in a)s[i]=r?new r({type:"optional",innerType:a[i]}):a[i];return G6(this,"shape",s),s},checks:[]});return ua(e,n)}function Tl(r,e=0){var t;if(r.aborted===!0)return!0;for(let n=e;n<r.issues.length;n++)if(((t=r.issues[n])==null?void 0:t.continue)!==!0)return!0;return!1}function Fl(r){return typeof r=="string"?r:r==null?void 0:r.message}function E0(r,e,t){var a,s,i,o,u,l;const n={...r,path:r.path??[]};if(!r.message){const c=Fl((i=(s=(a=r.inst)==null?void 0:a._zod.def)==null?void 0:s.error)==null?void 0:i.call(s,r))??Fl((o=e==null?void 0:e.error)==null?void 0:o.call(e,r))??Fl((u=t.customError)==null?void 0:u.call(t,r))??Fl((l=t.localeError)==null?void 0:l.call(t,r))??"Invalid input";n.message=c}return delete n.inst,delete n.continue,e!=null&&e.reportInput||delete n.input,n}const W6=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),r.message=JSON.stringify(e,lF,2),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},mF=Ao("$ZodError",W6),x0=Ao("$ZodError",W6,{Parent:Error});function gF(r){const e=[],t=r.map(n=>typeof n=="object"?n.key:n);for(const n of t)typeof n=="number"?e.push(`[${n}]`):typeof n=="symbol"?e.push(`[${JSON.stringify(String(n))}]`):/[^\w$]/.test(n)?e.push(`[${JSON.stringify(n)}]`):(e.length&&e.push("."),e.push(n));return e.join("")}function yF(r){var n;const e=[],t=[...r.issues].sort((a,s)=>(a.path??[]).length-(s.path??[]).length);for(const a of t)e.push(`\u2716 ${a.message}`),(n=a.path)!=null&&n.length&&e.push(`  \u2192 at ${gF(a.path)}`);return e.join(`
`)}const vF=r=>(e,t,n,a)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise)throw new ru;if(i.issues.length){const o=new((a==null?void 0:a.Err)??r)(i.issues.map(u=>E0(u,s,w0())));throw K6(o,a==null?void 0:a.callee),o}return i.value},eg=vF(x0),_F=r=>async(e,t,n,a)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const o=new((a==null?void 0:a.Err)??r)(i.issues.map(u=>E0(u,s,w0())));throw K6(o,a==null?void 0:a.callee),o}return i.value},Y6=_F(x0),bF=r=>(e,t,n)=>{const a=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:t,issues:[]},a);if(s instanceof Promise)throw new ru;return s.issues.length?{success:!1,error:new(r??mF)(s.issues.map(i=>E0(i,a,w0())))}:{success:!0,data:s.value}},wF=bF(x0),EF=r=>async(e,t,n)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let s=e._zod.run({value:t,issues:[]},a);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new r(s.issues.map(i=>E0(i,a,w0())))}:{success:!0,data:s.value}},xF=EF(x0),SF={major:4,minor:1,patch:13},tg=Ao("$ZodType",(r,e)=>{var a;var t;r??(r={}),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=SF;const n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(const s of n)for(const i of s._zod.onattach)i(r);if(n.length===0)(t=r._zod).deferred??(t.deferred=[]),(a=r._zod.deferred)==null||a.push(()=>{r._zod.run=r._zod.parse});else{const s=(o,u,l)=>{let c=Tl(o),d;for(const h of u){if(h._zod.def.when){if(!h._zod.def.when(o))continue}else if(c)continue;const f=o.issues.length,p=h._zod.check(o);if(p instanceof Promise&&(l==null?void 0:l.async)===!1)throw new ru;if(d||p instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await p,o.issues.length!==f&&(c||(c=Tl(o,f)))});else{if(o.issues.length===f)continue;c||(c=Tl(o,f))}}return d?d.then(()=>o):o},i=(o,u,l)=>{if(Tl(o))return o.aborted=!0,o;const c=s(u,n,l);if(c instanceof Promise){if(l.async===!1)throw new ru;return c.then(d=>r._zod.parse(d,l))}return r._zod.parse(c,l)};r._zod.run=(o,u)=>{if(u.skipChecks)return r._zod.parse(o,u);if(u.direction==="backward"){const c=r._zod.parse({value:o.value,issues:[]},{...u,skipChecks:!0});return c instanceof Promise?c.then(d=>i(d,o,u)):i(c,o,u)}const l=r._zod.parse(o,u);if(l instanceof Promise){if(u.async===!1)throw new ru;return l.then(c=>s(c,n,u))}return s(l,n,u)}}r["~standard"]={validate:s=>{var i;try{const o=wF(r,s);return o.success?{value:o.data}:{issues:(i=o.error)==null?void 0:i.issues}}catch{return xF(r,s).then(u=>{var l;return u.success?{value:u.data}:{issues:(l=u.error)==null?void 0:l.issues}})}},vendor:"zod",version:1}}),AF=Ao("$ZodUnknown",(r,e)=>{tg.init(r,e),r._zod.parse=t=>t}),kF=Ao("$ZodNever",(r,e)=>{tg.init(r,e),r._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:r}),t)});function N5(r,e){return r.issues.length&&e===void 0?{issues:[],value:void 0}:r}const J6=Ao("$ZodOptional",(r,e)=>{tg.init(r,e),r._zod.optin="optional",r._zod.optout="optional",T5(r._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),T5(r._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${cF(t.source)})?$`):void 0}),r._zod.parse=(t,n)=>{if(e.innerType._zod.optin==="optional"){const a=e.innerType._zod.run(t,n);return a instanceof Promise?a.then(s=>N5(s,t.value)):N5(a,t.value)}return t.value===void 0?t:e.innerType._zod.run(t,n)}});var I5;let X6=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const n=t[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const n={...this.get(t)??{}};delete n.id;const a={...n,...this._map.get(e)};return Object.keys(a).length?a:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};function CF(){return new X6}(I5=globalThis).__zod_globalRegistry??(I5.__zod_globalRegistry=CF());const pn=globalThis.__zod_globalRegistry;function TF(r){return new r({type:"unknown"})}function FF(r,e){return new r({type:"never",...hF()})}class O5{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??pn,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var d,h,f;var n;const a=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,t.schemaPath.includes(e)&&(i.cycle=t.path),i.schema;const o={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,o);const u=(h=(d=e._zod).toJSONSchema)==null?void 0:h.call(d);if(u)o.schema=u;else{const p={...t,schemaPath:[...t.schemaPath,e],path:t.path},m=e._zod.parent;if(m)o.ref=m,this.process(m,p),this.seen.get(m).isParent=!0;else{const v=o.schema;switch(a.type){case"string":{const _=v;_.type="string";const{minimum:w,maximum:E,format:F,patterns:k,contentEncoding:N}=e._zod.bag;if(typeof w=="number"&&(_.minLength=w),typeof E=="number"&&(_.maxLength=E),F&&(_.format=s[F]??F,_.format===""&&delete _.format),N&&(_.contentEncoding=N),k&&k.size>0){const B=[...k];B.length===1?_.pattern=B[0].source:B.length>1&&(o.schema.allOf=[...B.map(A=>({...this.target==="draft-7"||this.target==="draft-4"||this.target==="openapi-3.0"?{type:"string"}:{},pattern:A.source}))])}break}case"number":{const _=v,{minimum:w,maximum:E,format:F,multipleOf:k,exclusiveMaximum:N,exclusiveMinimum:B}=e._zod.bag;typeof F=="string"&&F.includes("int")?_.type="integer":_.type="number",typeof B=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(_.minimum=B,_.exclusiveMinimum=!0):_.exclusiveMinimum=B),typeof w=="number"&&(_.minimum=w,typeof B=="number"&&this.target!=="draft-4"&&(B>=w?delete _.minimum:delete _.exclusiveMinimum)),typeof N=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(_.maximum=N,_.exclusiveMaximum=!0):_.exclusiveMaximum=N),typeof E=="number"&&(_.maximum=E,typeof N=="number"&&this.target!=="draft-4"&&(N<=E?delete _.maximum:delete _.exclusiveMaximum)),typeof k=="number"&&(_.multipleOf=k);break}case"boolean":{const _=v;_.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{this.target==="openapi-3.0"?(v.type="string",v.nullable=!0,v.enum=[null]):v.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{v.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const _=v,{minimum:w,maximum:E}=e._zod.bag;typeof w=="number"&&(_.minItems=w),typeof E=="number"&&(_.maxItems=E),_.type="array",_.items=this.process(a.element,{...p,path:[...p.path,"items"]});break}case"object":{const _=v;_.type="object",_.properties={};const w=a.shape;for(const k in w)_.properties[k]=this.process(w[k],{...p,path:[...p.path,"properties",k]});const E=new Set(Object.keys(w)),F=new Set([...E].filter(k=>{const N=a.shape[k]._zod;return this.io==="input"?N.optin===void 0:N.optout===void 0}));F.size>0&&(_.required=Array.from(F)),((f=a.catchall)==null?void 0:f._zod.def.type)==="never"?_.additionalProperties=!1:a.catchall?a.catchall&&(_.additionalProperties=this.process(a.catchall,{...p,path:[...p.path,"additionalProperties"]})):this.io==="output"&&(_.additionalProperties=!1);break}case"union":{const _=v,w=a.discriminator!==void 0,E=a.options.map((F,k)=>this.process(F,{...p,path:[...p.path,w?"oneOf":"anyOf",k]}));w?_.oneOf=E:_.anyOf=E;break}case"intersection":{const _=v,w=this.process(a.left,{...p,path:[...p.path,"allOf",0]}),E=this.process(a.right,{...p,path:[...p.path,"allOf",1]}),F=N=>"allOf"in N&&Object.keys(N).length===1,k=[...F(w)?w.allOf:[w],...F(E)?E.allOf:[E]];_.allOf=k;break}case"tuple":{const _=v;_.type="array";const w=this.target==="draft-2020-12"?"prefixItems":"items",E=this.target==="draft-2020-12"||this.target==="openapi-3.0"?"items":"additionalItems",F=a.items.map((A,L)=>this.process(A,{...p,path:[...p.path,w,L]})),k=a.rest?this.process(a.rest,{...p,path:[...p.path,E,...this.target==="openapi-3.0"?[a.items.length]:[]]}):null;this.target==="draft-2020-12"?(_.prefixItems=F,k&&(_.items=k)):this.target==="openapi-3.0"?(_.items={anyOf:F},k&&_.items.anyOf.push(k),_.minItems=F.length,k||(_.maxItems=F.length)):(_.items=F,k&&(_.additionalItems=k));const{minimum:N,maximum:B}=e._zod.bag;typeof N=="number"&&(_.minItems=N),typeof B=="number"&&(_.maxItems=B);break}case"record":{const _=v;_.type="object",(this.target==="draft-7"||this.target==="draft-2020-12")&&(_.propertyNames=this.process(a.keyType,{...p,path:[...p.path,"propertyNames"]})),_.additionalProperties=this.process(a.valueType,{...p,path:[...p.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const _=v,w=uF(a.entries);w.every(E=>typeof E=="number")&&(_.type="number"),w.every(E=>typeof E=="string")&&(_.type="string"),_.enum=w;break}case"literal":{const _=v,w=[];for(const E of a.values)if(E===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof E=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");w.push(Number(E))}else w.push(E);if(w.length!==0)if(w.length===1){const E=w[0];_.type=E===null?"null":typeof E,this.target==="draft-4"||this.target==="openapi-3.0"?_.enum=[E]:_.const=E}else w.every(E=>typeof E=="number")&&(_.type="number"),w.every(E=>typeof E=="string")&&(_.type="string"),w.every(E=>typeof E=="boolean")&&(_.type="string"),w.every(E=>E===null)&&(_.type="null"),_.enum=w;break}case"file":{const _=v,w={type:"string",format:"binary",contentEncoding:"binary"},{minimum:E,maximum:F,mime:k}=e._zod.bag;E!==void 0&&(w.minLength=E),F!==void 0&&(w.maxLength=F),k?k.length===1?(w.contentMediaType=k[0],Object.assign(_,w)):_.anyOf=k.map(N=>({...w,contentMediaType:N})):Object.assign(_,w);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const _=this.process(a.innerType,p);this.target==="openapi-3.0"?(o.ref=a.innerType,v.nullable=!0):v.anyOf=[_,{type:"null"}];break}case"nonoptional":{this.process(a.innerType,p),o.ref=a.innerType;break}case"success":{const _=v;_.type="boolean";break}case"default":{this.process(a.innerType,p),o.ref=a.innerType,v.default=JSON.parse(JSON.stringify(a.defaultValue));break}case"prefault":{this.process(a.innerType,p),o.ref=a.innerType,this.io==="input"&&(v._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break}case"catch":{this.process(a.innerType,p),o.ref=a.innerType;let _;try{_=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}v.default=_;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const _=v,w=e._zod.pattern;if(!w)throw new Error("Pattern not found in template literal");_.type="string",_.pattern=w.source;break}case"pipe":{const _=this.io==="input"?a.in._zod.def.type==="transform"?a.out:a.in:a.out;this.process(_,p),o.ref=_;break}case"readonly":{this.process(a.innerType,p),o.ref=a.innerType,v.readOnly=!0;break}case"promise":{this.process(a.innerType,p),o.ref=a.innerType;break}case"optional":{this.process(a.innerType,p),o.ref=a.innerType;break}case"lazy":{const _=e._zod.innerType;this.process(_,p),o.ref=_;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}case"function":{if(this.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema");break}}}}const l=this.metadataRegistry.get(e);return l&&Object.assign(o.schema,l),this.io==="input"&&Jr(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){var c,d,h,f,p,m;const n={cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0},a=this.seen.get(e);if(!a)throw new Error("Unprocessed schema. This is a bug in Zod.");const s=v=>{var k;const _=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const N=(k=n.external.registry.get(v[0]))==null?void 0:k.id,B=n.external.uri??(L=>L);if(N)return{ref:B(N)};const A=v[1].defId??v[1].schema.id??`schema${this.counter++}`;return v[1].defId=A,{defId:A,ref:`${B("__shared")}#/${_}/${A}`}}if(v[1]===a)return{ref:"#"};const E=`#/${_}/`,F=v[1].schema.id??`__schema${this.counter++}`;return{defId:F,ref:E+F}},i=v=>{if(v[1].schema.$ref)return;const _=v[1],{ref:w,defId:E}=s(v);_.def={..._.schema},E&&(_.defId=E);const F=_.schema;for(const k in F)delete F[k];F.$ref=w};if(n.cycles==="throw")for(const v of this.seen.entries()){const _=v[1];if(_.cycle)throw new Error(`Cycle detected: #/${(c=_.cycle)==null?void 0:c.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const v of this.seen.entries()){const _=v[1];if(e===v[0]){i(v);continue}if(n.external){const E=(d=n.external.registry.get(v[0]))==null?void 0:d.id;if(e!==v[0]&&E){i(v);continue}}if((h=this.metadataRegistry.get(v[0]))==null?void 0:h.id){i(v);continue}if(_.cycle){i(v);continue}if(_.count>1&&n.reused==="ref"){i(v);continue}}const o=(v,_)=>{const w=this.seen.get(v),E=w.def??w.schema,F={...E};if(w.ref===null)return;const k=w.ref;if(w.ref=null,k){o(k,_);const N=this.seen.get(k).schema;N.$ref&&(_.target==="draft-7"||_.target==="draft-4"||_.target==="openapi-3.0")?(E.allOf=E.allOf??[],E.allOf.push(N)):(Object.assign(E,N),Object.assign(E,F))}w.isParent||this.override({zodSchema:v,jsonSchema:E,path:w.path??[]})};for(const v of[...this.seen.entries()].reverse())o(v[0],{target:this.target});const u={};if(this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?u.$schema="http://json-schema.org/draft-04/schema#":this.target==="openapi-3.0"||console.warn(`Invalid target: ${this.target}`),(f=n.external)!=null&&f.uri){const v=(p=n.external.registry.get(e))==null?void 0:p.id;if(!v)throw new Error("Schema is missing an `id` property");u.$id=n.external.uri(v)}Object.assign(u,a.def);const l=((m=n.external)==null?void 0:m.defs)??{};for(const v of this.seen.entries()){const _=v[1];_.def&&_.defId&&(l[_.defId]=_.def)}n.external||Object.keys(l).length>0&&(this.target==="draft-2020-12"?u.$defs=l:u.definitions=l);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}}function R5(r,e){if(r instanceof X6){const n=new O5(e),a={};for(const o of r._idmap.entries()){const[u,l]=o;n.process(l)}const s={},i={registry:r,uri:e==null?void 0:e.uri,defs:a};for(const o of r._idmap.entries()){const[u,l]=o;s[u]=n.emit(l,{...e,external:i})}if(Object.keys(a).length>0){const o=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[o]:a}}return{schemas:s}}const t=new O5(e);return t.process(r),t.emit(r,e)}function Jr(r,e){const t=e??{seen:new Set};if(t.seen.has(r))return!1;t.seen.add(r);const n=r._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return Jr(n.element,t);if(n.type==="set")return Jr(n.valueType,t);if(n.type==="lazy")return Jr(n.getter(),t);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return Jr(n.innerType,t);if(n.type==="intersection")return Jr(n.left,t)||Jr(n.right,t);if(n.type==="record"||n.type==="map")return Jr(n.keyType,t)||Jr(n.valueType,t);if(n.type==="pipe")return Jr(n.in,t)||Jr(n.out,t);if(n.type==="object"){for(const a in n.shape)if(Jr(n.shape[a],t))return!0;return!1}if(n.type==="union"){for(const a of n.options)if(Jr(a,t))return!0;return!1}if(n.type==="tuple"){for(const a of n.items)if(Jr(a,t))return!0;return!!(n.rest&&Jr(n.rest,t))}return!1}function ur(r){if(typeof r!="object"||r===null)return!1;const e=r;if(!("_zod"in e))return!1;const t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function xr(r){if(typeof r!="object"||r===null)return!1;const e=r;if(!("_def"in e)||"_zod"in e)return!1;const t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function NF(r){return ur(r)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),xr(r)}function ko(r){return!r||typeof r!="object"||Array.isArray(r)?!1:!!(ur(r)||xr(r))}function Q6(r){return typeof r=="object"&&r!==null&&"_def"in r&&typeof r._def=="object"&&r._def!==null&&"typeName"in r._def&&r._def.typeName==="ZodLiteral"}function e2(r){return ur(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="literal":!1}function IF(r){return!!(Q6(r)||e2(r))}async function t2(r,e){if(ur(r))try{return{success:!0,data:await Y6(r,e)}}catch(t){return{success:!1,error:t}}if(xr(r))return await r.safeParseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function S0(r,e){if(ur(r))return await Y6(r,e);if(xr(r))return await r.parseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function OF(r,e){if(ur(r))try{return{success:!0,data:eg(r,e)}}catch(t){return{success:!1,error:t}}if(xr(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Yl(r,e){if(ur(r))return eg(r,e);if(xr(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function vu(r){var e;if(ur(r))return(e=pn.get(r))==null?void 0:e.description;if(xr(r)||"description"in r&&typeof r.description=="string")return r.description}function RF(r){if(!ko(r))return!1;if(xr(r)){const e=r._def;if(e.typeName==="ZodObject"){const t=r;return!t.shape||Object.keys(t.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(ur(r)){const e=r._zod.def;if(e.type==="object"){const t=r;return!t.shape||Object.keys(t.shape).length===0}if(e.type==="record")return!0}return typeof r=="object"&&r!==null&&!("shape"in r)}function rg(r){return ko(r)?xr(r)?r._def.typeName==="ZodString":ur(r)?r._zod.def.type==="string":!1:!1}function ng(r){return typeof r=="object"&&r!==null&&"_def"in r&&typeof r._def=="object"&&r._def!==null&&"typeName"in r._def&&r._def.typeName==="ZodObject"}function Ra(r){return ur(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="object":!1}function A0(r){return ur(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="array":!1}function r2(r){return ur(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="optional":!1}function n2(r){return ur(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="nullable":!1}function sa(r){return!!(ng(r)||Ra(r))}function _u(r){if(xr(r))return r.shape;if(ur(r))return r._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function a2(r,e){if(xr(r))return r.extend(e);if(ur(r))return fF(r,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function ag(r){if(xr(r))return r.partial();if(ur(r))return pF(J6,r);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Cc(r,e=!1){if(xr(r))return r.strict();if(Ra(r)){const t=r._zod.def.shape;if(e)for(const[s,i]of Object.entries(r._zod.def.shape)){if(Ra(i)){const u=Cc(i,e);t[s]=u}else if(A0(i)){let u=i._zod.def.element;Ra(u)&&(u=Cc(u,e)),t[s]=ua(i,{...i._zod.def,element:u})}else t[s]=i;const o=pn.get(i);o&&pn.add(t[s],o)}const n=ua(r,{...r._zod.def,shape:t,catchall:FF(kF)}),a=pn.get(r);return a&&pn.add(n,a),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function up(r,e=!1){if(ng(r))return r.passthrough();if(Ra(r)){const t=r._zod.def.shape;if(e)for(const[s,i]of Object.entries(r._zod.def.shape)){if(Ra(i)){const u=up(i,e);t[s]=u}else if(A0(i)){let u=i._zod.def.element;Ra(u)&&(u=up(u,e)),t[s]=ua(i,{...i._zod.def,element:u})}else t[s]=i;const o=pn.get(i);o&&pn.add(t[s],o)}const n=ua(r,{...r._zod.def,shape:t,catchall:TF(AF)}),a=pn.get(r);return a&&pn.add(n,a),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function s2(r){if(xr(r))try{const e=r.parse(void 0);return()=>e}catch{return}if(ur(r))try{const e=eg(r,void 0);return()=>e}catch{return}}function DF(r){return xr(r)&&"typeName"in r._def&&r._def.typeName==="ZodEffects"}function BF(r){return ur(r)&&r._zod.def.type==="pipe"}function ii(r,e,t){const n=t.get(r);if(n!==void 0)return n;if(xr(r))return DF(r)?ii(r._def.schema,e,t):r;if(ur(r)){let a=r;if(BF(r)&&(a=ii(r._zod.def.in,e,t)),e){if(Ra(a)){const i={};for(const[o,u]of Object.entries(a._zod.def.shape))i[o]=ii(u,e,t);a=ua(a,{...a._zod.def,shape:i})}else if(A0(a)){const i=ii(a._zod.def.element,e,t);a=ua(a,{...a._zod.def,element:i})}else if(r2(a)){const i=ii(a._zod.def.innerType,e,t);a=ua(a,{...a._zod.def,innerType:i})}else if(n2(a)){const i=ii(a._zod.def.innerType,e,t);a=ua(a,{...a._zod.def,innerType:i})}}const s=pn.get(r);return s&&pn.add(a,s),t.set(r,a),a}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function i2(r,e=!1){return ii(r,e,new WeakMap)}function MF(r,e){if(xr(r)){const t=_u(r),n={};for(const[a,s]of Object.entries(t))e(a,s)?n[a]=s.optional():n[a]=s;return r.extend(n)}if(ur(r)){const t=_u(r),n={...r._zod.def.shape};for(const[i,o]of Object.entries(t))e(i,o)&&(n[i]=new J6({type:"optional",innerType:o}));const a=ua(r,{...r._zod.def,shape:n}),s=pn.get(r);return s&&pn.add(a,s),a}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function o2(r){return r instanceof Error&&(r.constructor.name==="ZodError"||r.constructor.name==="$ZodError")}const $F=Symbol("Let zodToJsonSchema decide on which parser to use"),PF={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},LF=r=>({...PF,...r}),zF=r=>{const e=LF(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}},u2=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function Fn(r){if(r.target!=="openAi")return{};const e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?u2(e,r.currentPath):e.join("/")}}function l2(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Ht(r,e,t,n,a){r[e]=t,l2(r,e,n,a)}var Rt;(function(r){r.assertEqual=a=>{};function e(a){}r.assertIs=e;function t(a){throw new Error}r.assertNever=t,r.arrayToEnum=a=>{const s={};for(const i of a)s[i]=i;return s},r.getValidEnumValues=a=>{const s=r.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),i={};for(const o of s)i[o]=a[o];return r.objectValues(i)},r.objectValues=a=>r.objectKeys(a).map(function(s){return a[s]}),r.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const s=[];for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&s.push(i);return s},r.find=(a,s)=>{for(const i of a)if(s(i))return i},r.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,s=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}r.joinValues=n,r.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s})(Rt||(Rt={}));var D5;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(D5||(D5={}));const Pe=Rt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),xs=r=>{switch(typeof r){case"undefined":return Pe.undefined;case"string":return Pe.string;case"number":return Number.isNaN(r)?Pe.nan:Pe.number;case"boolean":return Pe.boolean;case"function":return Pe.function;case"bigint":return Pe.bigint;case"symbol":return Pe.symbol;case"object":return Array.isArray(r)?Pe.array:r===null?Pe.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?Pe.promise:typeof Map<"u"&&r instanceof Map?Pe.map:typeof Set<"u"&&r instanceof Set?Pe.set:typeof Date<"u"&&r instanceof Date?Pe.date:Pe.object;default:return Pe.unknown}},he=Rt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let _i=class c2 extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(s){return s.message},n={_errors:[]},a=s=>{for(const i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,u=0;for(;u<i.path.length;){const l=i.path[u];u===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return a(this),n}static assert(e){if(!(e instanceof c2))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Rt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t=Object.create(null),n=[];for(const a of this.issues)if(a.path.length>0){const s=a.path[0];t[s]=t[s]||[],t[s].push(e(a))}else n.push(e(a));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};_i.create=r=>new _i(r);const lp=(r,e)=>{let t;switch(r.code){case he.invalid_type:r.received===Pe.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case he.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,Rt.jsonStringifyReplacer)}`;break;case he.unrecognized_keys:t=`Unrecognized key(s) in object: ${Rt.joinValues(r.keys,", ")}`;break;case he.invalid_union:t="Invalid input";break;case he.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Rt.joinValues(r.options)}`;break;case he.invalid_enum_value:t=`Invalid enum value. Expected ${Rt.joinValues(r.options)}, received '${r.received}'`;break;case he.invalid_arguments:t="Invalid function arguments";break;case he.invalid_return_type:t="Invalid function return type";break;case he.invalid_date:t="Invalid date";break;case he.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:Rt.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case he.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case he.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case he.custom:t="Invalid input";break;case he.invalid_intersection_types:t="Intersection results could not be merged";break;case he.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case he.not_finite:t="Number must be finite";break;default:t=e.defaultError,Rt.assertNever(r)}return{message:t}};let UF=lp;function jF(){return UF}const qF=r=>{const{data:e,path:t,errorMaps:n,issueData:a}=r,s=[...t,...a.path||[]],i={...a,path:s};if(a.message!==void 0)return{...a,path:s,message:a.message};let o="";const u=n.filter(l=>!!l).slice().reverse();for(const l of u)o=l(i,{data:e,defaultError:o}).message;return{...a,path:s,message:o}};function Ne(r,e){const t=jF(),n=qF({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===lp?void 0:lp].filter(a=>!!a)});r.common.issues.push(n)}let da=class d2{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const a of t){if(a.status==="aborted")return ct;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const a of t){const s=await a.key,i=await a.value;n.push({key:s,value:i})}return d2.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const a of t){const{key:s,value:i}=a;if(s.status==="aborted"||i.status==="aborted")return ct;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}};const ct=Object.freeze({status:"aborted"}),Uo=r=>({status:"dirty",value:r}),Zn=r=>({status:"valid",value:r}),B5=r=>r.status==="aborted",M5=r=>r.status==="dirty",io=r=>r.status==="valid",Tc=r=>typeof Promise<"u"&&r instanceof Promise;var je;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(je||(je={}));let Hs=class{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const $5=(r,e)=>{if(io(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new _i(r.common.issues);return this._error=t,this._error}}};function _t(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:a}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(i,o)=>{const{message:u}=r;return i.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??n??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:a}}let Nt=class{get description(){return this._def.description}_getType(e){return xs(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:xs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new da,ctx:{common:e.parent.common,data:e.data,parsedType:xs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Tc(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xs(e)},a=this._parseSync({data:e,path:n.path,parent:n});return $5(n,a)}"~validate"(e){var n,a;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xs(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return io(s)?{value:s.value}:{issues:t.common.issues}}catch(s){(a=(n=s==null?void 0:s.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>io(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xs(e)},a=this._parse({data:e,path:n.path,parent:n}),s=await(Tc(a)?a:Promise.resolve(a));return $5(n,s)}refine(e,t){const n=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,s)=>{const i=e(a),o=()=>s.addIssue({code:he.custom,...n(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof t=="function"?t(n,a):t),!1))}_refinement(e){return new uo({schema:this,typeName:ge.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Os.create(this,this._def)}nullable(){return lo.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return oo.create(this)}promise(){return Ic.create(this,this._def)}or(e){return Fc.create([this,e],this._def)}and(e){return Nc.create(this,e,this._def)}transform(e){return new uo({..._t(this._def),schema:this,typeName:ge.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new yp({..._t(this._def),innerType:this,defaultValue:t,typeName:ge.ZodDefault})}brand(){return new hN({typeName:ge.ZodBranded,type:this,..._t(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new vp({..._t(this._def),innerType:this,catchValue:t,typeName:ge.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return fN.create(this,e)}readonly(){return _p.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const HF=/^c[^\s-]{8,}$/i,VF=/^[0-9a-z]+$/,GF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ZF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,KF=/^[a-z0-9_-]{21}$/i,WF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,YF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,JF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,XF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let of;const QF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,eN=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,tN=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,rN=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,nN=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,aN=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,h2="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",sN=new RegExp(`^${h2}$`);function f2(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function iN(r){return new RegExp(`^${f2(r)}$`)}function oN(r){let e=`${h2}T${f2(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function uN(r,e){return!!((e==="v4"||!e)&&QF.test(r)||(e==="v6"||!e)&&tN.test(r))}function lN(r,e){if(!WF.test(r))return!1;try{const[t]=r.split(".");if(!t)return!1;const n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function cN(r,e){return!!((e==="v4"||!e)&&eN.test(r)||(e==="v6"||!e)&&rN.test(r))}let cp=class jo extends Nt{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Pe.string){const s=this._getOrReturnCtx(e);return Ne(s,{code:he.invalid_type,expected:Pe.string,received:s.parsedType}),ct}const n=new da;let a;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){const i=e.data.length>s.value,o=e.data.length<s.value;(i||o)&&(a=this._getOrReturnCtx(e,a),i?Ne(a,{code:he.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&Ne(a,{code:he.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")JF.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"email",code:he.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")of||(of=new RegExp(XF,"u")),of.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"emoji",code:he.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")ZF.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"uuid",code:he.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")KF.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"nanoid",code:he.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")HF.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"cuid",code:he.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")VF.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"cuid2",code:he.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")GF.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"ulid",code:he.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),Ne(a,{validation:"url",code:he.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"regex",code:he.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?oN(s).test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?sN.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?iN(s).test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?YF.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"duration",code:he.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?uN(e.data,s.version)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"ip",code:he.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?lN(e.data,s.alg)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"jwt",code:he.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?cN(e.data,s.version)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"cidr",code:he.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?nN.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"base64",code:he.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?aN.test(e.data)||(a=this._getOrReturnCtx(e,a),Ne(a,{validation:"base64url",code:he.invalid_string,message:s.message}),n.dirty()):Rt.assertNever(s);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(a=>e.test(a),{validation:t,code:he.invalid_string,...je.errToObj(n)})}_addCheck(e){return new jo({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...je.errToObj(e)})}url(e){return this._addCheck({kind:"url",...je.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...je.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...je.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...je.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...je.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...je.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...je.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...je.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...je.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...je.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...je.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...je.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...je.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...je.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...je.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...je.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...je.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...je.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...je.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...je.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...je.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...je.errToObj(t)})}nonempty(e){return this.min(1,je.errToObj(e))}trim(){return new jo({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new jo({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new jo({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};cp.create=r=>new cp({checks:[],typeName:ge.ZodString,coerce:(r==null?void 0:r.coerce)??!1,..._t(r)});function dN(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=t>n?t:n,s=Number.parseInt(r.toFixed(a).replace(".","")),i=Number.parseInt(e.toFixed(a).replace(".",""));return s%i/10**a}let P5=class dp extends Nt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Pe.number){const s=this._getOrReturnCtx(e);return Ne(s,{code:he.invalid_type,expected:Pe.number,received:s.parsedType}),ct}let n;const a=new da;for(const s of this._def.checks)s.kind==="int"?Rt.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),Ne(n,{code:he.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),Ne(n,{code:he.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),Ne(n,{code:he.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="multipleOf"?dN(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),Ne(n,{code:he.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),Ne(n,{code:he.not_finite,message:s.message}),a.dirty()):Rt.assertNever(s);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,je.toString(t))}gt(e,t){return this.setLimit("min",e,!1,je.toString(t))}lte(e,t){return this.setLimit("max",e,!0,je.toString(t))}lt(e,t){return this.setLimit("max",e,!1,je.toString(t))}setLimit(e,t,n,a){return new dp({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:je.toString(a)}]})}_addCheck(e){return new dp({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:je.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:je.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:je.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:je.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:je.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:je.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:je.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:je.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:je.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Rt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};P5.create=r=>new P5({checks:[],typeName:ge.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,..._t(r)});let L5=class hp extends Nt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Pe.bigint)return this._getInvalidInput(e);let n;const a=new da;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),Ne(n,{code:he.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),Ne(n,{code:he.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),Ne(n,{code:he.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):Rt.assertNever(s);return{status:a.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Ne(t,{code:he.invalid_type,expected:Pe.bigint,received:t.parsedType}),ct}gte(e,t){return this.setLimit("min",e,!0,je.toString(t))}gt(e,t){return this.setLimit("min",e,!1,je.toString(t))}lte(e,t){return this.setLimit("max",e,!0,je.toString(t))}lt(e,t){return this.setLimit("max",e,!1,je.toString(t))}setLimit(e,t,n,a){return new hp({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:je.toString(a)}]})}_addCheck(e){return new hp({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:je.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:je.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:je.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:je.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:je.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};L5.create=r=>new L5({checks:[],typeName:ge.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,..._t(r)});let z5=class extends Nt{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Pe.boolean){const n=this._getOrReturnCtx(e);return Ne(n,{code:he.invalid_type,expected:Pe.boolean,received:n.parsedType}),ct}return Zn(e.data)}};z5.create=r=>new z5({typeName:ge.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,..._t(r)});let U5=class p2 extends Nt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Pe.date){const s=this._getOrReturnCtx(e);return Ne(s,{code:he.invalid_type,expected:Pe.date,received:s.parsedType}),ct}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return Ne(s,{code:he.invalid_date}),ct}const n=new da;let a;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(a=this._getOrReturnCtx(e,a),Ne(a,{code:he.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):Rt.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new p2({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:je.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:je.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};U5.create=r=>new U5({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:ge.ZodDate,..._t(r)});let j5=class extends Nt{_parse(e){if(this._getType(e)!==Pe.symbol){const n=this._getOrReturnCtx(e);return Ne(n,{code:he.invalid_type,expected:Pe.symbol,received:n.parsedType}),ct}return Zn(e.data)}};j5.create=r=>new j5({typeName:ge.ZodSymbol,..._t(r)});let q5=class extends Nt{_parse(e){if(this._getType(e)!==Pe.undefined){const n=this._getOrReturnCtx(e);return Ne(n,{code:he.invalid_type,expected:Pe.undefined,received:n.parsedType}),ct}return Zn(e.data)}};q5.create=r=>new q5({typeName:ge.ZodUndefined,..._t(r)});let H5=class extends Nt{_parse(e){if(this._getType(e)!==Pe.null){const n=this._getOrReturnCtx(e);return Ne(n,{code:he.invalid_type,expected:Pe.null,received:n.parsedType}),ct}return Zn(e.data)}};H5.create=r=>new H5({typeName:ge.ZodNull,..._t(r)});let fp=class extends Nt{constructor(){super(...arguments),this._any=!0}_parse(e){return Zn(e.data)}};fp.create=r=>new fp({typeName:ge.ZodAny,..._t(r)});let V5=class extends Nt{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Zn(e.data)}};V5.create=r=>new V5({typeName:ge.ZodUnknown,..._t(r)});let Vs=class extends Nt{_parse(e){const t=this._getOrReturnCtx(e);return Ne(t,{code:he.invalid_type,expected:Pe.never,received:t.parsedType}),ct}};Vs.create=r=>new Vs({typeName:ge.ZodNever,..._t(r)});let G5=class extends Nt{_parse(e){if(this._getType(e)!==Pe.undefined){const n=this._getOrReturnCtx(e);return Ne(n,{code:he.invalid_type,expected:Pe.void,received:n.parsedType}),ct}return Zn(e.data)}};G5.create=r=>new G5({typeName:ge.ZodVoid,..._t(r)});let oo=class Jl extends Nt{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==Pe.array)return Ne(t,{code:he.invalid_type,expected:Pe.array,received:t.parsedType}),ct;if(a.exactLength!==null){const i=t.data.length>a.exactLength.value,o=t.data.length<a.exactLength.value;(i||o)&&(Ne(t,{code:i?he.too_big:he.too_small,minimum:o?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(Ne(t,{code:he.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(Ne(t,{code:he.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>a.type._parseAsync(new Hs(t,i,t.path,o)))).then(i=>da.mergeArray(n,i));const s=[...t.data].map((i,o)=>a.type._parseSync(new Hs(t,i,t.path,o)));return da.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new Jl({...this._def,minLength:{value:e,message:je.toString(t)}})}max(e,t){return new Jl({...this._def,maxLength:{value:e,message:je.toString(t)}})}length(e,t){return new Jl({...this._def,exactLength:{value:e,message:je.toString(t)}})}nonempty(e){return this.min(1,e)}};oo.create=(r,e)=>new oo({type:r,minLength:null,maxLength:null,exactLength:null,typeName:ge.ZodArray,..._t(e)});function Li(r){if(r instanceof ls){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=Os.create(Li(n))}return new ls({...r._def,shape:()=>e})}else return r instanceof oo?new oo({...r._def,type:Li(r.element)}):r instanceof Os?Os.create(Li(r.unwrap())):r instanceof lo?lo.create(Li(r.unwrap())):r instanceof bu?bu.create(r.items.map(e=>Li(e))):r}let ls=class ea extends Nt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Rt.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Pe.object){const l=this._getOrReturnCtx(e);return Ne(l,{code:he.invalid_type,expected:Pe.object,received:l.parsedType}),ct}const{status:n,ctx:a}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Vs&&this._def.unknownKeys==="strip"))for(const l in a.data)i.includes(l)||o.push(l);const u=[];for(const l of i){const c=s[l],d=a.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new Hs(a,d,a.path,l)),alwaysSet:l in a.data})}if(this._def.catchall instanceof Vs){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of o)u.push({key:{status:"valid",value:c},value:{status:"valid",value:a.data[c]}});else if(l==="strict")o.length>0&&(Ne(a,{code:he.unrecognized_keys,keys:o}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of o){const d=a.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new Hs(a,d,a.path,c)),alwaysSet:c in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of u){const d=await c.key,h=await c.value;l.push({key:d,value:h,alwaysSet:c.alwaysSet})}return l}).then(l=>da.mergeObjectSync(n,l)):da.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return je.errToObj,new ea({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i;const a=((i=(s=this._def).errorMap)==null?void 0:i.call(s,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:je.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new ea({...this._def,unknownKeys:"strip"})}passthrough(){return new ea({...this._def,unknownKeys:"passthrough"})}extend(e){return new ea({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ea({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ge.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ea({...this._def,catchall:e})}pick(e){const t={};for(const n of Rt.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new ea({...this._def,shape:()=>t})}omit(e){const t={};for(const n of Rt.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new ea({...this._def,shape:()=>t})}deepPartial(){return Li(this)}partial(e){const t={};for(const n of Rt.objectKeys(this.shape)){const a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional()}return new ea({...this._def,shape:()=>t})}required(e){const t={};for(const n of Rt.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Os;)s=s._def.innerType;t[n]=s}return new ea({...this._def,shape:()=>t})}keyof(){return g2(Rt.objectKeys(this.shape))}};ls.create=(r,e)=>new ls({shape:()=>r,unknownKeys:"strip",catchall:Vs.create(),typeName:ge.ZodObject,..._t(e)});ls.strictCreate=(r,e)=>new ls({shape:()=>r,unknownKeys:"strict",catchall:Vs.create(),typeName:ge.ZodObject,..._t(e)});ls.lazycreate=(r,e)=>new ls({shape:r,unknownKeys:"strip",catchall:Vs.create(),typeName:ge.ZodObject,..._t(e)});let Fc=class extends Nt{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function a(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=s.map(o=>new _i(o.ctx.common.issues));return Ne(t,{code:he.invalid_union,unionErrors:i}),ct}if(t.common.async)return Promise.all(n.map(async s=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(a);{let s;const i=[];for(const u of n){const l={...t,common:{...t.common,issues:[]},parent:null},c=u._parseSync({data:t.data,path:t.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const o=i.map(u=>new _i(u));return Ne(t,{code:he.invalid_union,unionErrors:o}),ct}}get options(){return this._def.options}};Fc.create=(r,e)=>new Fc({options:r,typeName:ge.ZodUnion,..._t(e)});function pp(r,e){const t=xs(r),n=xs(e);if(r===e)return{valid:!0,data:r};if(t===Pe.object&&n===Pe.object){const a=Rt.objectKeys(e),s=Rt.objectKeys(r).filter(o=>a.indexOf(o)!==-1),i={...r,...e};for(const o of s){const u=pp(r[o],e[o]);if(!u.valid)return{valid:!1};i[o]=u.data}return{valid:!0,data:i}}else if(t===Pe.array&&n===Pe.array){if(r.length!==e.length)return{valid:!1};const a=[];for(let s=0;s<r.length;s++){const i=r[s],o=e[s],u=pp(i,o);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return t===Pe.date&&n===Pe.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}let Nc=class extends Nt{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=(s,i)=>{if(B5(s)||B5(i))return ct;const o=pp(s.value,i.value);return o.valid?((M5(s)||M5(i))&&t.dirty(),{status:t.value,value:o.data}):(Ne(n,{code:he.invalid_intersection_types}),ct)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>a(s,i)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Nc.create=(r,e,t)=>new Nc({left:r,right:e,typeName:ge.ZodIntersection,..._t(t)});let bu=class m2 extends Nt{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Pe.array)return Ne(n,{code:he.invalid_type,expected:Pe.array,received:n.parsedType}),ct;if(n.data.length<this._def.items.length)return Ne(n,{code:he.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ct;!this._def.rest&&n.data.length>this._def.items.length&&(Ne(n,{code:he.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...n.data].map((i,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new Hs(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>da.mergeArray(t,i)):da.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new m2({...this._def,rest:e})}};bu.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new bu({items:r,typeName:ge.ZodTuple,rest:null,..._t(e)})};let Z5=class extends Nt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Pe.map)return Ne(n,{code:he.invalid_type,expected:Pe.map,received:n.parsedType}),ct;const a=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([o,u],l)=>({key:a._parse(new Hs(n,o,n.path,[l,"key"])),value:s._parse(new Hs(n,u,n.path,[l,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of i){const l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return ct;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of i){const l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return ct;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}}}};Z5.create=(r,e,t)=>new Z5({valueType:e,keyType:r,typeName:ge.ZodMap,..._t(t)});let K5=class mp extends Nt{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Pe.set)return Ne(n,{code:he.invalid_type,expected:Pe.set,received:n.parsedType}),ct;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(Ne(n,{code:he.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(Ne(n,{code:he.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const s=this._def.valueType;function i(u){const l=new Set;for(const c of u){if(c.status==="aborted")return ct;c.status==="dirty"&&t.dirty(),l.add(c.value)}return{status:t.value,value:l}}const o=[...n.data.values()].map((u,l)=>s._parse(new Hs(n,u,n.path,l)));return n.common.async?Promise.all(o).then(u=>i(u)):i(o)}min(e,t){return new mp({...this._def,minSize:{value:e,message:je.toString(t)}})}max(e,t){return new mp({...this._def,maxSize:{value:e,message:je.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};K5.create=(r,e)=>new K5({valueType:r,minSize:null,maxSize:null,typeName:ge.ZodSet,..._t(e)});let W5=class extends Nt{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};W5.create=(r,e)=>new W5({getter:r,typeName:ge.ZodLazy,..._t(e)});let Y5=class extends Nt{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Ne(t,{received:t.data,code:he.invalid_literal,expected:this._def.value}),ct}return{status:"valid",value:e.data}}get value(){return this._def.value}};Y5.create=(r,e)=>new Y5({value:r,typeName:ge.ZodLiteral,..._t(e)});function g2(r,e){return new sg({values:r,typeName:ge.ZodEnum,..._t(e)})}let sg=class gp extends Nt{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return Ne(t,{expected:Rt.joinValues(n),received:t.parsedType,code:he.invalid_type}),ct}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Ne(t,{received:t.data,code:he.invalid_enum_value,options:n}),ct}return Zn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return gp.create(e,{...this._def,...t})}exclude(e,t=this._def){return gp.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};sg.create=g2;let J5=class extends Nt{_parse(e){const t=Rt.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Pe.string&&n.parsedType!==Pe.number){const a=Rt.objectValues(t);return Ne(n,{expected:Rt.joinValues(a),received:n.parsedType,code:he.invalid_type}),ct}if(this._cache||(this._cache=new Set(Rt.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const a=Rt.objectValues(t);return Ne(n,{received:n.data,code:he.invalid_enum_value,options:a}),ct}return Zn(e.data)}get enum(){return this._def.values}};J5.create=(r,e)=>new J5({values:r,typeName:ge.ZodNativeEnum,..._t(e)});let Ic=class extends Nt{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Pe.promise&&t.common.async===!1)return Ne(t,{code:he.invalid_type,expected:Pe.promise,received:t.parsedType}),ct;const n=t.parsedType===Pe.promise?t.data:Promise.resolve(t.data);return Zn(n.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Ic.create=(r,e)=>new Ic({type:r,typeName:ge.ZodPromise,..._t(e)});let uo=class extends Nt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ge.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:i=>{Ne(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){const i=a.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return ct;const u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?ct:u.status==="dirty"||t.value==="dirty"?Uo(u.value):u});{if(t.value==="aborted")return ct;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?ct:o.status==="dirty"||t.value==="dirty"?Uo(o.value):o}}if(a.type==="refinement"){const i=o=>{const u=a.refinement(o,s);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?ct:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?ct:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(a.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!io(i))return ct;const o=a.transform(i.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>io(i)?Promise.resolve(a.transform(i.value,s)).then(o=>({status:t.value,value:o})):ct);Rt.assertNever(a)}};uo.create=(r,e,t)=>new uo({schema:r,typeName:ge.ZodEffects,effect:e,..._t(t)});uo.createWithPreprocess=(r,e,t)=>new uo({schema:e,effect:{type:"preprocess",transform:r},typeName:ge.ZodEffects,..._t(t)});let Os=class extends Nt{_parse(e){return this._getType(e)===Pe.undefined?Zn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Os.create=(r,e)=>new Os({innerType:r,typeName:ge.ZodOptional,..._t(e)});let lo=class extends Nt{_parse(e){return this._getType(e)===Pe.null?Zn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};lo.create=(r,e)=>new lo({innerType:r,typeName:ge.ZodNullable,..._t(e)});let yp=class extends Nt{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Pe.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};yp.create=(r,e)=>new yp({innerType:r,typeName:ge.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,..._t(e)});let vp=class extends Nt{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Tc(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new _i(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new _i(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};vp.create=(r,e)=>new vp({innerType:r,typeName:ge.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,..._t(e)});let X5=class extends Nt{_parse(e){if(this._getType(e)!==Pe.nan){const n=this._getOrReturnCtx(e);return Ne(n,{code:he.invalid_type,expected:Pe.nan,received:n.parsedType}),ct}return{status:"valid",value:e.data}}};X5.create=r=>new X5({typeName:ge.ZodNaN,..._t(r)});let hN=class extends Nt{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},fN=class y2 extends Nt{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ct:s.status==="dirty"?(t.dirty(),Uo(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ct:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,t){return new y2({in:e,out:t,typeName:ge.ZodPipeline})}},_p=class extends Nt{_parse(e){const t=this._def.innerType._parse(e),n=a=>(io(a)&&(a.value=Object.freeze(a.value)),a);return Tc(t)?t.then(a=>n(a)):n(t)}unwrap(){return this._def.innerType}};_p.create=(r,e)=>new _p({innerType:r,typeName:ge.ZodReadonly,..._t(e)});var ge;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(ge||(ge={}));const k0=cp.create,Q5=fp.create;Vs.create;oo.create;const C0=ls.create;Fc.create;Nc.create;bu.create;sg.create;Ic.create;Os.create;lo.create;function pN(r,e){var n,a,s;const t={type:"array"};return(n=r.type)!=null&&n._def&&((s=(a=r.type)==null?void 0:a._def)==null?void 0:s.typeName)!==ge.ZodAny&&(t.items=Lt(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ht(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ht(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ht(t,"minItems",r.exactLength.value,r.exactLength.message,e),Ht(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function mN(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ht(t,"minimum",n.value,n.message,e):Ht(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ht(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ht(t,"maximum",n.value,n.message,e):Ht(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ht(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ht(t,"multipleOf",n.value,n.message,e);break}return t}function gN(){return{type:"boolean"}}function v2(r,e){return Lt(r.type._def,e)}const yN=(r,e)=>Lt(r.innerType._def,e);function _2(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map(a=>_2(r,e,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return vN(r,e)}}const vN=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Ht(t,"minimum",n.value,n.message,e);break;case"max":Ht(t,"maximum",n.value,n.message,e);break}return t};function _N(r,e){return{...Lt(r.innerType._def,e),default:r.defaultValue()}}function bN(r,e){return e.effectStrategy==="input"?Lt(r.schema._def,e):Fn(e)}function wN(r){return{type:"string",enum:Array.from(r.values)}}const EN=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function xN(r,e){const t=[Lt(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Lt(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return t.forEach(s=>{if(EN(s))a.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:o,...u}=s;i=u}else n=void 0;a.push(i)}}),a.length?{allOf:a,...n}:void 0}function SN(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let uf;const Jn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(uf===void 0&&(uf=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),uf),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function b2(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":Ht(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":Ht(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Xn(t,"email",n.message,e);break;case"format:idn-email":Xn(t,"idn-email",n.message,e);break;case"pattern:zod":Yr(t,Jn.email,n.message,e);break}break;case"url":Xn(t,"uri",n.message,e);break;case"uuid":Xn(t,"uuid",n.message,e);break;case"regex":Yr(t,n.regex,n.message,e);break;case"cuid":Yr(t,Jn.cuid,n.message,e);break;case"cuid2":Yr(t,Jn.cuid2,n.message,e);break;case"startsWith":Yr(t,RegExp(`^${lf(n.value,e)}`),n.message,e);break;case"endsWith":Yr(t,RegExp(`${lf(n.value,e)}$`),n.message,e);break;case"datetime":Xn(t,"date-time",n.message,e);break;case"date":Xn(t,"date",n.message,e);break;case"time":Xn(t,"time",n.message,e);break;case"duration":Xn(t,"duration",n.message,e);break;case"length":Ht(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),Ht(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":Yr(t,RegExp(lf(n.value,e)),n.message,e);break;case"ip":n.version!=="v6"&&Xn(t,"ipv4",n.message,e),n.version!=="v4"&&Xn(t,"ipv6",n.message,e);break;case"base64url":Yr(t,Jn.base64url,n.message,e);break;case"jwt":Yr(t,Jn.jwt,n.message,e);break;case"cidr":n.version!=="v6"&&Yr(t,Jn.ipv4Cidr,n.message,e),n.version!=="v4"&&Yr(t,Jn.ipv6Cidr,n.message,e);break;case"emoji":Yr(t,Jn.emoji(),n.message,e);break;case"ulid":Yr(t,Jn.ulid,n.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Xn(t,"binary",n.message,e);break;case"contentEncoding:base64":Ht(t,"contentEncoding","base64",n.message,e);break;case"pattern:zod":Yr(t,Jn.base64,n.message,e);break}break;case"nanoid":Yr(t,Jn.nanoid,n.message,e);break}return t}function lf(r,e){return e.patternStrategy==="escape"?kN(r):r}const AN=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function kN(r){let e="";for(let t=0;t<r.length;t++)AN.has(r[t])||(e+="\\"),e+=r[t];return e}function Xn(r,e,t,n){var a;r.format||(a=r.anyOf)!=null&&a.some(s=>s.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Ht(r,"format",e,t,n)}function Yr(r,e,t,n){var a;r.pattern||(a=r.allOf)!=null&&a.some(s=>s.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:e_(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Ht(r,"pattern",e_(e,n),t,n)}function e_(r,e){var u;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let a="",s=!1,i=!1,o=!1;for(let l=0;l<n.length;l++){if(s){a+=n[l],s=!1;continue}if(t.i){if(i){if(n[l].match(/[a-z]/)){o?(a+=n[l],a+=`${n[l-2]}-${n[l]}`.toUpperCase(),o=!1):n[l+1]==="-"&&((u=n[l+2])!=null&&u.match(/[a-z]/))?(a+=n[l],o=!0):a+=`${n[l]}${n[l].toUpperCase()}`;continue}}else if(n[l].match(/[a-z]/)){a+=`[${n[l]}${n[l].toUpperCase()}]`;continue}}if(t.m){if(n[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(n[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(t.s&&n[l]==="."){a+=i?`${n[l]}\r
`:`[${n[l]}\r
]`;continue}a+=n[l],n[l]==="\\"?s=!0:i&&n[l]==="]"?i=!1:!i&&n[l]==="["&&(i=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return a}function w2(r,e){var n,a,s,i,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===ge.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((l,c)=>({...l,[c]:Lt(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??Fn(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Lt(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((a=r.keyType)==null?void 0:a._def.typeName)===ge.ZodString&&((s=r.keyType._def.checks)!=null&&s.length)){const{type:l,...c}=b2(r.keyType._def,e);return{...t,propertyNames:c}}else{if(((i=r.keyType)==null?void 0:i._def.typeName)===ge.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((o=r.keyType)==null?void 0:o._def.typeName)===ge.ZodBranded&&r.keyType._def.type._def.typeName===ge.ZodString&&((u=r.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...c}=v2(r.keyType._def,e);return{...t,propertyNames:c}}}return t}function CN(r,e){if(e.mapStrategy==="record")return w2(r,e);const t=Lt(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Fn(e),n=Lt(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Fn(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function TN(r){const e=r.values,n=Object.keys(r.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),a=Array.from(new Set(n.map(s=>typeof s)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function FN(r){return r.target==="openAi"?void 0:{not:Fn({...r,currentPath:[...r.currentPath,"not"]})}}function NN(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Oc={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function IN(r,e){if(e.target==="openApi3")return t_(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Oc&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((a,s)=>{const i=Oc[s._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((a,s)=>{const i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":return s._def.value===null?[...a,"null"]:a;case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===t.length){const a=n.filter((s,i,o)=>o.indexOf(s)===i);return{type:a.length>1?a:a[0],enum:t.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,a)=>[...n,...a._def.values.filter(s=>!n.includes(s))],[])};return t_(r,e)}const t_=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,a)=>Lt(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function ON(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Oc[r.innerType._def.typeName],nullable:!0}:{type:[Oc[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Lt(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Lt(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function RN(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",l2(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ht(t,"minimum",n.value,n.message,e):Ht(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ht(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ht(t,"maximum",n.value,n.message,e):Ht(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ht(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ht(t,"multipleOf",n.value,n.message,e);break}return t}function DN(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},a=[],s=r.shape();for(const o in s){let u=s[o];if(u===void 0||u._def===void 0)continue;let l=MN(u);l&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);const c=Lt(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(n.properties[o]=c,l||a.push(o))}a.length&&(n.required=a);const i=BN(r,e);return i!==void 0&&(n.additionalProperties=i),n}function BN(r,e){if(r.catchall._def.typeName!=="ZodNever")return Lt(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function MN(r){try{return r.isOptional()}catch{return!0}}const $N=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Lt(r.innerType._def,e);const t=Lt(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:Fn(e)},t]}:Fn(e)},PN=(r,e)=>{if(e.pipeStrategy==="input")return Lt(r.in._def,e);if(e.pipeStrategy==="output")return Lt(r.out._def,e);const t=Lt(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Lt(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(a=>a!==void 0)}};function LN(r,e){return Lt(r.type._def,e)}function zN(r,e){const n={type:"array",uniqueItems:!0,items:Lt(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ht(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ht(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function UN(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Lt(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Lt(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Lt(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function jN(r){return{not:Fn(r)}}function qN(r){return Fn(r)}const HN=(r,e)=>Lt(r.innerType._def,e),VN=(r,e,t)=>{switch(e){case ge.ZodString:return b2(r,t);case ge.ZodNumber:return RN(r,t);case ge.ZodObject:return DN(r,t);case ge.ZodBigInt:return mN(r,t);case ge.ZodBoolean:return gN();case ge.ZodDate:return _2(r,t);case ge.ZodUndefined:return jN(t);case ge.ZodNull:return NN(t);case ge.ZodArray:return pN(r,t);case ge.ZodUnion:case ge.ZodDiscriminatedUnion:return IN(r,t);case ge.ZodIntersection:return xN(r,t);case ge.ZodTuple:return UN(r,t);case ge.ZodRecord:return w2(r,t);case ge.ZodLiteral:return SN(r,t);case ge.ZodEnum:return wN(r);case ge.ZodNativeEnum:return TN(r);case ge.ZodNullable:return ON(r,t);case ge.ZodOptional:return $N(r,t);case ge.ZodMap:return CN(r,t);case ge.ZodSet:return zN(r,t);case ge.ZodLazy:return()=>r.getter()._def;case ge.ZodPromise:return LN(r,t);case ge.ZodNaN:case ge.ZodNever:return FN(t);case ge.ZodEffects:return bN(r,t);case ge.ZodAny:return Fn(t);case ge.ZodUnknown:return qN(t);case ge.ZodDefault:return _N(r,t);case ge.ZodBranded:return v2(r,t);case ge.ZodReadonly:return HN(r,t);case ge.ZodCatch:return yN(r,t);case ge.ZodPipeline:return PN(r,t);case ge.ZodFunction:case ge.ZodVoid:case ge.ZodSymbol:return;default:return(n=>{})()}};function Lt(r,e,t=!1){var o;const n=e.seen.get(r);if(e.override){const u=(o=e.override)==null?void 0:o.call(e,r,e,n,t);if(u!==$F)return u}if(n&&!t){const u=GN(n,e);if(u!==void 0)return u}const a={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,a);const s=VN(r,r.typeName,e),i=typeof s=="function"?Lt(s(),e):s;if(i&&ZN(r,e,i),e.postProcess){const u=e.postProcess(i,r,e);return a.jsonSchema=i,u}return a.jsonSchema=i,i}const GN=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:u2(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Fn(e)):e.$refStrategy==="seen"?Fn(e):void 0}},ZN=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),KN=(r,e)=>{const t=zF(e);let n;const a=Lt(r._def,t,!1)??Fn(t);t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));const s=n?{...a,[t.definitionPath]:n}:a;return t.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in s||"oneOf"in s||"allOf"in s||"type"in s&&Array.isArray(s.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),s};function mi(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let a=0;a<n;a++)if(!mi(r[a],e[a]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),a=Object.keys(e);if(n.length!==a.length)return!1;for(const i of n)if(!mi(r[i],e[i]))return!1;return!0}return r===e}function ta(r){return encodeURI(WN(r))}function WN(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}const YN={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},JN={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},XN={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let QN=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function Fs(r,e=Object.create(null),t=QN,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){const s=r.$id||r.id;if(s){const i=new URL(s,t.href);i.hash.length>1?e[i.href]=r:(i.hash="",n===""?t=i:Fs(r,e,t))}}else if(r!==!0&&r!==!1)return e;const a=t.href+(n?"#"+n:"");if(e[a]!==void 0)throw new Error(`Duplicate schema URI "${a}".`);if(e[a]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:a}),r.$ref&&r.__absolute_ref__===void 0){const s=new URL(r.$ref,t.href);s.hash=s.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:s.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){const s=new URL(r.$recursiveRef,t.href);s.hash=s.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:s.href})}if(r.$anchor){const s=new URL("#"+r.$anchor,t.href);e[s.href]=r}for(let s in r){if(XN[s])continue;const i=`${n}/${ta(s)}`,o=r[s];if(Array.isArray(o)){if(YN[s]){const u=o.length;for(let l=0;l<u;l++)Fs(o[l],e,t,`${i}/${l}`)}}else if(JN[s])for(let u in o)Fs(o[u],e,t,`${i}/${ta(u)}`);else Fs(o,e,t,i)}return e}const eI=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,tI=[0,31,28,31,30,31,30,31,31,30,31,30,31],rI=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,nI=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,aI=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,sI=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,iI=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,oI=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,uI=/^(?:\/(?:[^~/]|~0|~1)*)*$/,lI=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,cI=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,dI=r=>{if(r[0]==='"')return!1;const[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(a=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(a))},hI=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,fI=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,pI=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function ba(r){return r.test.bind(r)}const r_={date:E2,time:x2.bind(void 0,!1),"date-time":yI,duration:pI,uri:bI,"uri-reference":ba(aI),"uri-template":ba(sI),url:ba(iI),email:dI,hostname:ba(nI),ipv4:ba(hI),ipv6:ba(fI),regex:EI,uuid:ba(oI),"json-pointer":ba(uI),"json-pointer-uri-fragment":ba(lI),"relative-json-pointer":ba(cI)};function mI(r){return r%4===0&&(r%100!==0||r%400===0)}function E2(r){const e=r.match(eI);if(!e)return!1;const t=+e[1],n=+e[2],a=+e[3];return n>=1&&n<=12&&a>=1&&a<=(n==2&&mI(t)?29:tI[n])}function x2(r,e){const t=e.match(rI);if(!t)return!1;const n=+t[1],a=+t[2],s=+t[3],i=!!t[5];return(n<=23&&a<=59&&s<=59||n==23&&a==59&&s==60)&&(!r||i)}const gI=/t|\s/i;function yI(r){const e=r.split(gI);return e.length==2&&E2(e[0])&&x2(!0,e[1])}const vI=/\/|:/,_I=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function bI(r){return vI.test(r)&&_I.test(r)}const wI=/[^\\]\\Z/;function EI(r){if(wI.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}function xI(r){let e=0,t=r.length,n=0,a;for(;n<t;)e++,a=r.charCodeAt(n++),a>=55296&&a<=56319&&n<t&&(a=r.charCodeAt(n),(a&64512)==56320&&n++);return e}function rr(r,e,t="2019-09",n=Fs(e),a=!0,s=null,i="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:i,keyword:"false",keywordLocation:i,error:"False boolean schema."}]};const l=typeof r;let c;switch(l){case"boolean":case"number":case"string":c=l;break;case"object":r===null?c="null":Array.isArray(r)?c="array":c="object";break;default:throw new Error(`Instances of "${l}" type are not supported.`)}const{$ref:d,$recursiveRef:h,$recursiveAnchor:f,type:p,const:m,enum:v,required:_,not:w,anyOf:E,allOf:F,oneOf:k,if:N,then:B,else:A,format:L,properties:V,patternProperties:G,additionalProperties:te,unevaluatedProperties:ve,minProperties:D,maxProperties:M,propertyNames:P,dependentRequired:Z,dependentSchemas:W,dependencies:X,prefixItems:Y,items:re,additionalItems:U,unevaluatedItems:j,contains:ae,minContains:Q,maxContains:C,minItems:x,maxItems:q,uniqueItems:$,minimum:Ee,maximum:Ve,exclusiveMinimum:at,exclusiveMaximum:ot,multipleOf:Et,minLength:Se,maxLength:vt,pattern:Qt,__absolute_ref__:Sr,__absolute_recursive_ref__:Vr}=e,be=[];if(f===!0&&s===null&&(s=e),h==="#"){const Je=s===null?n[Vr]:s,we=`${o}/$recursiveRef`,Ge=rr(r,s===null?e:s,t,n,a,Je,i,we,u);Ge.valid||be.push({instanceLocation:i,keyword:"$recursiveRef",keywordLocation:we,error:"A subschema had errors."},...Ge.errors)}if(d!==void 0){const we=n[Sr||d];if(we===void 0){let ce=`Unresolved $ref "${d}".`;throw Sr&&Sr!==d&&(ce+=`  Absolute URI "${Sr}".`),ce+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(ce)}const Ge=`${o}/$ref`,Ae=rr(r,we,t,n,a,s,i,Ge,u);if(Ae.valid||be.push({instanceLocation:i,keyword:"$ref",keywordLocation:Ge,error:"A subschema had errors."},...Ae.errors),t==="4"||t==="7")return{valid:be.length===0,errors:be}}if(Array.isArray(p)){let Je=p.length,we=!1;for(let Ge=0;Ge<Je;Ge++)if(c===p[Ge]||p[Ge]==="integer"&&c==="number"&&r%1===0&&r===r){we=!0;break}we||be.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${p.join('", "')}".`})}else p==="integer"?(c!=="number"||r%1||r!==r)&&be.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${p}".`}):p!==void 0&&c!==p&&be.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${p}".`});if(m!==void 0&&(c==="object"||c==="array"?mi(r,m)||be.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):r!==m&&be.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),v!==void 0&&(c==="object"||c==="array"?v.some(Je=>mi(r,Je))||be.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(v)}.`}):v.some(Je=>r===Je)||be.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(v)}.`})),w!==void 0){const Je=`${o}/not`;rr(r,w,t,n,a,s,i,Je).valid&&be.push({instanceLocation:i,keyword:"not",keywordLocation:Je,error:'Instance matched "not" schema.'})}let Gr=[];if(E!==void 0){const Je=`${o}/anyOf`,we=be.length;let Ge=!1;for(let Ae=0;Ae<E.length;Ae++){const ce=E[Ae],Ke=Object.create(u),ze=rr(r,ce,t,n,a,f===!0?s:null,i,`${Je}/${Ae}`,Ke);be.push(...ze.errors),Ge=Ge||ze.valid,ze.valid&&Gr.push(Ke)}Ge?be.length=we:be.splice(we,0,{instanceLocation:i,keyword:"anyOf",keywordLocation:Je,error:"Instance does not match any subschemas."})}if(F!==void 0){const Je=`${o}/allOf`,we=be.length;let Ge=!0;for(let Ae=0;Ae<F.length;Ae++){const ce=F[Ae],Ke=Object.create(u),ze=rr(r,ce,t,n,a,f===!0?s:null,i,`${Je}/${Ae}`,Ke);be.push(...ze.errors),Ge=Ge&&ze.valid,ze.valid&&Gr.push(Ke)}Ge?be.length=we:be.splice(we,0,{instanceLocation:i,keyword:"allOf",keywordLocation:Je,error:"Instance does not match every subschema."})}if(k!==void 0){const Je=`${o}/oneOf`,we=be.length,Ge=k.filter((Ae,ce)=>{const Ke=Object.create(u),ze=rr(r,Ae,t,n,a,f===!0?s:null,i,`${Je}/${ce}`,Ke);return be.push(...ze.errors),ze.valid&&Gr.push(Ke),ze.valid}).length;Ge===1?be.length=we:be.splice(we,0,{instanceLocation:i,keyword:"oneOf",keywordLocation:Je,error:`Instance does not match exactly one subschema (${Ge} matches).`})}if((c==="object"||c==="array")&&Object.assign(u,...Gr),N!==void 0){const Je=`${o}/if`;if(rr(r,N,t,n,a,s,i,Je,u).valid){if(B!==void 0){const Ge=rr(r,B,t,n,a,s,i,`${o}/then`,u);Ge.valid||be.push({instanceLocation:i,keyword:"if",keywordLocation:Je,error:'Instance does not match "then" schema.'},...Ge.errors)}}else if(A!==void 0){const Ge=rr(r,A,t,n,a,s,i,`${o}/else`,u);Ge.valid||be.push({instanceLocation:i,keyword:"if",keywordLocation:Je,error:'Instance does not match "else" schema.'},...Ge.errors)}}if(c==="object"){if(_!==void 0)for(const Ae of _)Ae in r||be.push({instanceLocation:i,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${Ae}".`});const Je=Object.keys(r);if(D!==void 0&&Je.length<D&&be.push({instanceLocation:i,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${D} properties.`}),M!==void 0&&Je.length>M&&be.push({instanceLocation:i,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${M} properties.`}),P!==void 0){const Ae=`${o}/propertyNames`;for(const ce in r){const Ke=`${i}/${ta(ce)}`,ze=rr(ce,P,t,n,a,s,Ke,Ae);ze.valid||be.push({instanceLocation:i,keyword:"propertyNames",keywordLocation:Ae,error:`Property name "${ce}" does not match schema.`},...ze.errors)}}if(Z!==void 0){const Ae=`${o}/dependantRequired`;for(const ce in Z)if(ce in r){const Ke=Z[ce];for(const ze of Ke)ze in r||be.push({instanceLocation:i,keyword:"dependentRequired",keywordLocation:Ae,error:`Instance has "${ce}" but does not have "${ze}".`})}}if(W!==void 0)for(const Ae in W){const ce=`${o}/dependentSchemas`;if(Ae in r){const Ke=rr(r,W[Ae],t,n,a,s,i,`${ce}/${ta(Ae)}`,u);Ke.valid||be.push({instanceLocation:i,keyword:"dependentSchemas",keywordLocation:ce,error:`Instance has "${Ae}" but does not match dependant schema.`},...Ke.errors)}}if(X!==void 0){const Ae=`${o}/dependencies`;for(const ce in X)if(ce in r){const Ke=X[ce];if(Array.isArray(Ke))for(const ze of Ke)ze in r||be.push({instanceLocation:i,keyword:"dependencies",keywordLocation:Ae,error:`Instance has "${ce}" but does not have "${ze}".`});else{const ze=rr(r,Ke,t,n,a,s,i,`${Ae}/${ta(ce)}`);ze.valid||be.push({instanceLocation:i,keyword:"dependencies",keywordLocation:Ae,error:`Instance has "${ce}" but does not match dependant schema.`},...ze.errors)}}}const we=Object.create(null);let Ge=!1;if(V!==void 0){const Ae=`${o}/properties`;for(const ce in V){if(!(ce in r))continue;const Ke=`${i}/${ta(ce)}`,ze=rr(r[ce],V[ce],t,n,a,s,Ke,`${Ae}/${ta(ce)}`);if(ze.valid)u[ce]=we[ce]=!0;else if(Ge=a,be.push({instanceLocation:i,keyword:"properties",keywordLocation:Ae,error:`Property "${ce}" does not match schema.`},...ze.errors),Ge)break}}if(!Ge&&G!==void 0){const Ae=`${o}/patternProperties`;for(const ce in G){const Ke=new RegExp(ce,"u"),ze=G[ce];for(const er in r){if(!Ke.test(er))continue;const Rn=`${i}/${ta(er)}`,K=rr(r[er],ze,t,n,a,s,Rn,`${Ae}/${ta(ce)}`);K.valid?u[er]=we[er]=!0:(Ge=a,be.push({instanceLocation:i,keyword:"patternProperties",keywordLocation:Ae,error:`Property "${er}" matches pattern "${ce}" but does not match associated schema.`},...K.errors))}}}if(!Ge&&te!==void 0){const Ae=`${o}/additionalProperties`;for(const ce in r){if(we[ce])continue;const Ke=`${i}/${ta(ce)}`,ze=rr(r[ce],te,t,n,a,s,Ke,Ae);ze.valid?u[ce]=!0:(Ge=a,be.push({instanceLocation:i,keyword:"additionalProperties",keywordLocation:Ae,error:`Property "${ce}" does not match additional properties schema.`},...ze.errors))}}else if(!Ge&&ve!==void 0){const Ae=`${o}/unevaluatedProperties`;for(const ce in r)if(!u[ce]){const Ke=`${i}/${ta(ce)}`,ze=rr(r[ce],ve,t,n,a,s,Ke,Ae);ze.valid?u[ce]=!0:be.push({instanceLocation:i,keyword:"unevaluatedProperties",keywordLocation:Ae,error:`Property "${ce}" does not match unevaluated properties schema.`},...ze.errors)}}}else if(c==="array"){q!==void 0&&r.length>q&&be.push({instanceLocation:i,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${r.length} > ${q}).`}),x!==void 0&&r.length<x&&be.push({instanceLocation:i,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${r.length} < ${x}).`});const Je=r.length;let we=0,Ge=!1;if(Y!==void 0){const Ae=`${o}/prefixItems`,ce=Math.min(Y.length,Je);for(;we<ce;we++){const Ke=rr(r[we],Y[we],t,n,a,s,`${i}/${we}`,`${Ae}/${we}`);if(u[we]=!0,!Ke.valid&&(Ge=a,be.push({instanceLocation:i,keyword:"prefixItems",keywordLocation:Ae,error:"Items did not match schema."},...Ke.errors),Ge))break}}if(re!==void 0){const Ae=`${o}/items`;if(Array.isArray(re)){const ce=Math.min(re.length,Je);for(;we<ce;we++){const Ke=rr(r[we],re[we],t,n,a,s,`${i}/${we}`,`${Ae}/${we}`);if(u[we]=!0,!Ke.valid&&(Ge=a,be.push({instanceLocation:i,keyword:"items",keywordLocation:Ae,error:"Items did not match schema."},...Ke.errors),Ge))break}}else for(;we<Je;we++){const ce=rr(r[we],re,t,n,a,s,`${i}/${we}`,Ae);if(u[we]=!0,!ce.valid&&(Ge=a,be.push({instanceLocation:i,keyword:"items",keywordLocation:Ae,error:"Items did not match schema."},...ce.errors),Ge))break}if(!Ge&&U!==void 0){const ce=`${o}/additionalItems`;for(;we<Je;we++){const Ke=rr(r[we],U,t,n,a,s,`${i}/${we}`,ce);u[we]=!0,Ke.valid||(Ge=a,be.push({instanceLocation:i,keyword:"additionalItems",keywordLocation:ce,error:"Items did not match additional items schema."},...Ke.errors))}}}if(ae!==void 0)if(Je===0&&Q===void 0)be.push({instanceLocation:i,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(Q!==void 0&&Je<Q)be.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${Je}) than minContains (${Q}).`});else{const Ae=`${o}/contains`,ce=be.length;let Ke=0;for(let ze=0;ze<Je;ze++){const er=rr(r[ze],ae,t,n,a,s,`${i}/${ze}`,Ae);er.valid?(u[ze]=!0,Ke++):be.push(...er.errors)}Ke>=(Q||0)&&(be.length=ce),Q===void 0&&C===void 0&&Ke===0?be.splice(ce,0,{instanceLocation:i,keyword:"contains",keywordLocation:Ae,error:"Array does not contain item matching schema."}):Q!==void 0&&Ke<Q?be.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${Q} items matching schema. Only ${Ke} items were found.`}):C!==void 0&&Ke>C&&be.push({instanceLocation:i,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${C} items matching schema. ${Ke} items were found.`})}if(!Ge&&j!==void 0){const Ae=`${o}/unevaluatedItems`;for(we;we<Je;we++){if(u[we])continue;const ce=rr(r[we],j,t,n,a,s,`${i}/${we}`,Ae);u[we]=!0,ce.valid||be.push({instanceLocation:i,keyword:"unevaluatedItems",keywordLocation:Ae,error:"Items did not match unevaluated items schema."},...ce.errors)}}if($)for(let Ae=0;Ae<Je;Ae++){const ce=r[Ae],Ke=typeof ce=="object"&&ce!==null;for(let ze=0;ze<Je;ze++){if(Ae===ze)continue;const er=r[ze];(ce===er||Ke&&(typeof er=="object"&&er!==null)&&mi(ce,er))&&(be.push({instanceLocation:i,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${Ae} and ${ze}.`}),Ae=Number.MAX_SAFE_INTEGER,ze=Number.MAX_SAFE_INTEGER)}}}else if(c==="number"){if(t==="4"?(Ee!==void 0&&(at===!0&&r<=Ee||r<Ee)&&be.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${at?"or equal to ":""} ${Ee}.`}),Ve!==void 0&&(ot===!0&&r>=Ve||r>Ve)&&be.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${ot?"or equal to ":""} ${Ve}.`})):(Ee!==void 0&&r<Ee&&be.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${Ee}.`}),Ve!==void 0&&r>Ve&&be.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${Ve}.`}),at!==void 0&&r<=at&&be.push({instanceLocation:i,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${r} is less than ${at}.`}),ot!==void 0&&r>=ot&&be.push({instanceLocation:i,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${r} is greater than or equal to ${ot}.`})),Et!==void 0){const Je=r%Et;Math.abs(0-Je)>=11920929e-14&&Math.abs(Et-Je)>=11920929e-14&&be.push({instanceLocation:i,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${r} is not a multiple of ${Et}.`})}}else if(c==="string"){const Je=Se===void 0&&vt===void 0?0:xI(r);Se!==void 0&&Je<Se&&be.push({instanceLocation:i,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${Je} < ${Se}).`}),vt!==void 0&&Je>vt&&be.push({instanceLocation:i,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${Je} > ${vt}).`}),Qt!==void 0&&!new RegExp(Qt,"u").test(r)&&be.push({instanceLocation:i,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),L!==void 0&&r_[L]&&!r_[L](r)&&be.push({instanceLocation:i,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${L}".`})}return{valid:be.length===0,errors:be}}class SI{constructor(e,t="2019-09",n=!0){g(this,"schema");g(this,"draft");g(this,"shortCircuit");g(this,"lookup");this.schema=e,this.draft=t,this.shortCircuit=n,this.lookup=Fs(e)}validate(e){return rr(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),Fs(e,this.lookup)}}var S2={};Xe(S2,{Validator:()=>SI,deepCompareStrict:()=>mi,toJsonSchema:()=>mn,validatesOnlyStrings:()=>nu});function mn(r,e){if(ur(r)){const t=i2(r,!0);if(Ra(t)){const n=Cc(t,!0);return R5(n,e)}else return R5(r,e)}return xr(r)?KN(r):r}function nu(r){if(!r||typeof r!="object"||Object.keys(r).length===0||Array.isArray(r))return!1;if("type"in r)return typeof r.type=="string"?r.type==="string":Array.isArray(r.type)?r.type.every(e=>e==="string"):!1;if("enum"in r)return Array.isArray(r.enum)&&r.enum.length>0&&r.enum.every(e=>typeof e=="string");if("const"in r)return typeof r.const=="string";if("allOf"in r&&Array.isArray(r.allOf))return r.allOf.some(e=>nu(e));if("anyOf"in r&&Array.isArray(r.anyOf)||"oneOf"in r&&Array.isArray(r.oneOf)){const e="anyOf"in r?r.anyOf:r.oneOf;return e.length>0&&e.every(t=>nu(t))}if("not"in r)return!1;if("$ref"in r&&typeof r.$ref=="string"){const e=r.$ref,t=Fs(r);return t[e]?nu(t[e]):!1}return!1}function ig(r){return r?r.lc_runnable:!1}var AI=class{constructor(r){g(this,"includeNames");g(this,"includeTypes");g(this,"includeTags");g(this,"excludeNames");g(this,"excludeTypes");g(this,"excludeTags");this.includeNames=r.includeNames,this.includeTypes=r.includeTypes,this.includeTags=r.includeTags,this.excludeNames=r.excludeNames,this.excludeTypes=r.excludeTypes,this.excludeTags=r.excludeTags}includeEvent(r,e){let t=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const n=r.tags??[];return this.includeNames!==void 0&&(t=t||this.includeNames.includes(r.name)),this.includeTypes!==void 0&&(t=t||this.includeTypes.includes(e)),this.includeTags!==void 0&&(t=t||n.some(a=>{var s;return(s=this.includeTags)==null?void 0:s.includes(a)})),this.excludeNames!==void 0&&(t=t&&!this.excludeNames.includes(r.name)),this.excludeTypes!==void 0&&(t=t&&!this.excludeTypes.includes(e)),this.excludeTags!==void 0&&(t=t&&n.every(a=>{var s;return!((s=this.excludeTags)!=null&&s.includes(a))})),t}};const kI=r=>btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");function cf(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const CI=["*","_","`"];function TI(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function FI(r,e,t){const{firstNode:n,lastNode:a,nodeColors:s,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{};let l=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const p="default",m={[p]:"{0}({1})"};n!==void 0&&(m[n]="{0}([{1}]):::first"),a!==void 0&&(m[a]="{0}([{1}]):::last");for(const[v,_]of Object.entries(r)){const w=_.name.split(":").pop()??"";let F=CI.some(N=>w.startsWith(N)&&w.endsWith(N))?`<p>${w}</p>`:w;Object.keys(_.metadata??{}).length&&(F+=`<hr/><small><em>${Object.entries(_.metadata??{}).map(([N,B])=>`${N} = ${B}`).join(`
`)}</em></small>`);const k=(m[v]??m[p]).replace("{0}",cf(v)).replace("{1}",F);l+=`	${k}
`}}const c={};for(const p of e){const m=p.source.split(":"),v=p.target.split(":"),_=m.filter((w,E)=>w===v[E]).join(":");c[_]||(c[_]=[]),c[_].push(p)}const d=new Set;function h(p){return[...p].sort((m,v)=>m.split(":").length-v.split(":").length)}function f(p,m){const v=p.length===1&&p[0].source===p[0].target;if(m&&!v){const w=m.split(":").pop();if(d.has(m))throw new Error(`Found duplicate subgraph '${w}' at '${m} -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(m),l+=`	subgraph ${w}
`}const _=h(Object.keys(c).filter(w=>w.startsWith(`${m}:`)&&w!==m&&w.split(":").length===m.split(":").length+1));for(const w of _)f(c[w],w);for(const w of p){const{source:E,target:F,data:k,conditional:N}=w;let B="";if(k!==void 0){let A=k;const L=A.split(" ");L.length>u&&(A=Array.from({length:Math.ceil(L.length/u)},(V,G)=>L.slice(G*u,(G+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),B=N?` -. &nbsp;${A}&nbsp; .-> `:` -- &nbsp;${A}&nbsp; --> `}else B=N?" -.-> ":" --> ";l+=`	${cf(E)}${B}${cf(F)};
`}m&&!v&&(l+=`	end
`)}f(c[""]??[],"");for(const p in c)!p.includes(":")&&p!==""&&f(c[p],p);return i&&(l+=TI(s??{})),l}async function NI(r,e){let t=(e==null?void 0:e.backgroundColor)??"white";const n=(e==null?void 0:e.imageType)??"png",a=kI(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${a}?bgColor=${t}&type=${n}`,i=await fetch(s);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}var A2={};Xe(A2,{Graph:()=>wu});function II(r,e){if(r!==void 0&&!hi(r))return r;if(ig(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function OI(r){return ig(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...mn(r.data.schema),title:r.data.name}}}var wu=class k2{constructor(e){g(this,"nodes",{});g(this,"edges",[]);this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=hi(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...OI(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const a=t??Ga(),s={id:a,data:e,name:II(t,e),metadata:n};return this.nodes[a]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const s={source:e.id,target:t.id,data:n,conditional:a};return this.edges.push(s),s}firstNode(){return n_(this)}lastNode(){return a_(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(l=>l.id).every(hi)&&(n="");const s=l=>n?`${n}:${l}`:l;Object.entries(e.nodes).forEach(([l,c])=>{this.nodes[s(l)]={...c,id:s(l)}});const i=e.edges.map(l=>({...l,source:s(l.source),target:s(l.target)}));this.edges=[...this.edges,...i];const o=e.firstNode(),u=e.lastNode();return[o?{id:s(o.id),data:o.data}:void 0,u?{id:s(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&n_(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&a_(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(a=>[a.id,a.name])),t=new Map;Object.values(e).forEach(a=>{t.set(a,(t.get(a)||0)+1)});const n=a=>{const s=e[a];return hi(a)&&t.get(s)===1?s:a};return new k2({nodes:Object.fromEntries(Object.entries(this.nodes).map(([a,s])=>[n(a),{...s,id:n(a)}])),edges:this.edges.map(a=>({...a,source:n(a.source),target:n(a.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:s}=e??{},i=this.reid(),o=i.firstNode(),u=i.lastNode();return FI(i.nodes,i.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:t,curveStyle:n,nodeColors:a,wrapLabelNWords:s})}async drawMermaidPng(e){const t=this.drawMermaid(e);return NI(t,{backgroundColor:e==null?void 0:e.backgroundColor})}};function n_(r,e=[]){const t=new Set(r.edges.filter(a=>!e.includes(a.source)).map(a=>a.target)),n=[];for(const a of Object.values(r.nodes))!e.includes(a.id)&&!t.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function a_(r,e=[]){const t=new Set(r.edges.filter(a=>!e.includes(a.target)).map(a=>a.source)),n=[];for(const a of Object.values(r.nodes))!e.includes(a.id)&&!t.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function Nl({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const RI=r=>r.name==="event_stream_tracer";var DI=class extends hs{constructor(e){super({_awaitHandler:!0,...e});g(this,"autoClose",!0);g(this,"includeNames");g(this,"includeTypes");g(this,"includeTags");g(this,"excludeNames");g(this,"excludeTypes");g(this,"excludeTags");g(this,"runInfoMap",new Map);g(this,"tappedPromises",new Map);g(this,"transformStream");g(this,"writer");g(this,"receiveStream");g(this,"name","event_stream_tracer");g(this,"lc_prefer_streaming",!0);this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_n.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(a=>{var s;return(s=this.includeTags)==null?void 0:s.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(a=>{var s;return!((s=this.excludeTags)!=null&&s.includes(a))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const a=this.runInfoMap.get(e);if(a===void 0){yield n.value;return}function s(o,u){return o==="llm"&&typeof u=="string"?new ao({text:u}):u}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(u=>{o=u}),this.tappedPromises.set(e,i);try{const u={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...u,data:{chunk:s(a.runType,n.value)}},a),yield n.value;for await(const l of t)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...u,data:{chunk:s(a.runType,l)}},a),yield l}finally{o==null||o()}}else{yield n.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var i,o;const t=Nl(e),n=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,a);const s=`on_${n}_start`;await this.send({event:s,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},a)}async onLLMNewToken(e,t,n){const a=this.runInfoMap.get(e.id);let s,i;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?s=new ca({content:t,id:`run-${e.id}`}):s=n.chunk.message;else if(a.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?s=new ao({text:t}):s=n.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:i,data:{chunk:s},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){var i,o,u;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const a=(i=e.outputs)==null?void 0:i.generations;let s;if(t.runType==="chat_model"){for(const l of a??[]){if(s!==void 0)break;s=(o=l[0])==null?void 0:o.message}n="on_chat_model_end"}else if(t.runType==="llm")s={generations:a==null?void 0:a.map(l=>l.map(c=>({text:c.text,generationInfo:c.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:s,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var i,o;const t=Nl(e),n=e.run_type??"chain",a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:e.run_type};let s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},a.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,a.inputs=e.inputs.input):(s.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${n}_start`,data:s,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},a)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},i={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(i.input=a.input,t.inputs=a.input),await this.sendEndEvent({event:n,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var a,s;const t=Nl(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{}},n)}async onToolEnd(e){var a;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((a=e.outputs)==null?void 0:a.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var s,i;const t=Nl(e),a={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,a),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((i=e.extra)==null?void 0:i.metadata)??{}},a)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const a=this.runInfoMap.get(n);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:a.tags,metadata:a.metadata,data:t},a)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}},C2=class extends hs{constructor({config:e,onStart:t,onEnd:n,onError:a}){super({_awaitHandler:!0});g(this,"name","RootListenersTracer");g(this,"rootId");g(this,"config");g(this,"argOnStart");g(this,"argOnEnd");g(this,"argOnError");this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function BI(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const a of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return _n.fromReadableStream(t)}function s_(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const MI=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function bp(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*i_(r,e){for(;;){const{value:t,done:n}=Or.runWithConfig(os(r),e.next.bind(e),!0);if(n)break;yield t}}async function*wp(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:a}=await Or.runWithConfig(os(r),t.next.bind(e),!0);if(a)break;yield n}}function Cr(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var At=class extends Vn{constructor(){super(...arguments);g(this,"lc_runnable",!0);g(this,"name")}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}withRetry(e){return new og({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Gs({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new R2({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Tt);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([a])=>a!=="runId"));return Array.from({length:t},(a,s)=>Tt(s===0?e:n))}return Array.from({length:t},()=>Tt(e))}async batch(e,t,n){var u;const a=this._getOptionsList(t??{},e.length),s=((u=a[0])==null?void 0:u.maxConcurrency)??(n==null?void 0:n.maxConcurrency),i=new Vu({maxConcurrency:s,onFailedAttempt:l=>{throw l}}),o=e.map((l,c)=>i.call(async()=>{try{return await this.invoke(l,a[c])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Tt(t),a=new Ni({generator:this._streamIterator(e,n),config:n});return await a.setup,_n.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Tt(e):t=Tt({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const a=Tt(n),s=await yn(a),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),Cr(t,"input"),a.runId,a==null?void 0:a.runType,void 0,void 0,(a==null?void 0:a.runName)??this.getName()));delete a.runId;let o;try{const u=e.call(this,t,a,i);o=await us(u,n==null?void 0:n.signal)}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(Cr(o,"output"))),o}async _batchWithConfig(e,t,n,a){var l;const s=this._getOptionsList(n??{},t.length),i=await Promise.all(s.map(yn)),o=await Promise.all(i.map(async(c,d)=>{const h=await(c==null?void 0:c.handleChainStart(this.toJSON(),Cr(t[d],"input"),s[d].runId,s[d].runType,void 0,void 0,s[d].runName??this.getName()));return delete s[d].runId,h}));let u;try{const c=e.call(this,t,s,o,a);u=await us(c,(l=s==null?void 0:s[0])==null?void 0:l.signal)}catch(c){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(Cr(u,"output")))),u}_concatOutputChunks(e,t){return qs(e,t)}async*_transformStreamWithConfig(e,t,n){let a,s=!0,i,o=!0;const u=Tt(n),l=await yn(u),c=this;async function*d(){for await(const f of e){if(s)if(a===void 0)a=f;else try{a=c._concatOutputChunks(a,f)}catch{a=void 0,s=!1}yield f}}let h;try{const f=await M6(t.bind(this),d(),async()=>l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),n==null?void 0:n.signal,u);delete u.runId,h=f.setup;const p=h==null?void 0:h.handlers.find(RI);let m=f.output;p!==void 0&&h!==void 0&&(m=p.tapOutputIterable(h.runId,m));const v=h==null?void 0:h.handlers.find(U6);v!==void 0&&h!==void 0&&(m=v.tapOutputIterable(h.runId,m));for await(const _ of m)if(yield _,o)if(i===void 0)i=_;else try{i=this._concatOutputChunks(i,_)}catch{i=void 0,o=!1}}catch(f){throw await(h==null?void 0:h.handleChainError(f,void 0,void 0,void 0,{inputs:Cr(a,"input")})),f}await(h==null?void 0:h.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:Cr(a,"input")}))}getGraph(e){const t=new wu,n=t.addNode({name:`${this.getName()}Input`,schema:Q5()}),a=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:Q5()});return t.addEdge(n,a),t.addEdge(a,s),t}pipe(e){return new Zs({first:this,last:Pr(e)})}pick(e){return this.pipe(new D2(e))}assign(e){return this.pipe(new ug(new Co({steps:e})))}async*transform(e,t){let n;for await(const a of e)n===void 0?n=a:n=this._concatOutputChunks(n,a);yield*this._streamIterator(n,Tt(t))}async*streamLog(e,t,n){const a=new ip({...n,autoClose:!1,_schemaFormat:"original"}),s=Tt(t);yield*this._streamLog(e,a,s)}async*_streamLog(e,t,n){const{callbacks:a}=n;if(a===void 0)n.callbacks=[t];else if(Array.isArray(a))n.callbacks=a.concat([t]);else{const u=a.copy();u.addHandler(t,!0),n.callbacks=u}const s=this.stream(e,n);async function i(){try{const u=await s;for await(const l of u){const c=new qa({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await t.writer.write(c)}}finally{await t.writer.close()}}const o=i();try{for await(const u of t)yield u}finally{await o}}streamEvents(e,t,n){let a;if(t.version==="v1")a=this._streamEventsV1(e,t,n);else if(t.version==="v2")a=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?BI(a):_n.fromAsyncGenerator(a)}async*_streamEventsV2(e,t,n){var p;const a=new DI({...n,autoClose:!1}),s=Tt(t),i=s.runId??Ga();s.runId=i;const o=s.callbacks;if(o===void 0)s.callbacks=[a];else if(Array.isArray(o))s.callbacks=o.concat(a);else{const m=o.copy();m.addHandler(a,!0),s.callbacks=m}const u=new AbortController,l=this;async function c(){let m,v=null;try{t!=null&&t.signal?"any"in AbortSignal?m=AbortSignal.any([u.signal,t.signal]):(m=t.signal,v=()=>{u.abort()},t.signal.addEventListener("abort",v,{once:!0})):m=u.signal;const _=await l.stream(e,{...s,signal:m}),w=a.tapOutputIterable(i,_);for await(const E of w)if(u.signal.aborted)break}finally{await a.finish(),m&&v&&m.removeEventListener("abort",v)}}const d=c();let h=!1,f;try{for await(const m of a){if(!h){m.data.input=e,h=!0,f=m.run_id,yield m;continue}m.run_id===f&&m.event.endsWith("_end")&&(p=m.data)!=null&&p.input&&delete m.data.input,yield m}}finally{u.abort(),await d}}async*_streamEventsV1(e,t,n){let a,s=!1;const i=Tt(t),o=i.tags??[],u=i.metadata??{},l=i.runName??this.getName(),c=new ip({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new AI({...n}),h=this._streamLog(e,c,i);for await(const p of h){if(a?a=a.concat(p):a=Qm.fromRunLogPatch(p),a.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;const w={...a.state},E={run_id:w.id,event:`on_${w.type}_start`,name:l,tags:o,metadata:u,data:{input:e}};d.includeEvent(E,w.type)&&(yield E)}const m=p.ops.filter(w=>w.path.startsWith("/logs/")).map(w=>w.path.split("/")[2]),v=[...new Set(m)];for(const w of v){let E,F={};const k=a.state.logs[w];if(k.end_time===void 0?k.streamed_output.length>0?E="stream":E="start":E="end",E==="start")k.inputs!==void 0&&(F.input=k.inputs);else if(E==="end")k.inputs!==void 0&&(F.input=k.inputs),F.output=k.final_output;else if(E==="stream"){const N=k.streamed_output.length;if(N!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${N} instead. Encountered in: "${k.name}"`);F={chunk:k.streamed_output[0]},k.streamed_output=[]}yield{event:`on_${k.type}_${E}`,name:k.name,run_id:k.id,tags:k.tags,metadata:k.metadata,data:F}}const{state:_}=a;if(_.streamed_output.length>0){const w=_.streamed_output.length;if(w!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${w} instead. Encountered in: "${_.name}"`);const E={chunk:_.streamed_output[0]};_.streamed_output=[];const F={event:`on_${_.type}_stream`,run_id:_.id,tags:o,metadata:u,name:l,data:E};d.includeEvent(F,_.type)&&(yield F)}}const f=a==null?void 0:a.state;if(f!==void 0){const p={event:`on_${f.type}_end`,name:l,run_id:f.id,tags:o,metadata:u,data:{output:f.final_output}};d.includeEvent(p,f.type)&&(yield p)}}static isRunnable(e){return ig(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new Gs({bound:this,config:{},configFactories:[a=>({callbacks:[new C2({config:a,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return UI(this,e)}},Gs=class T2 extends At{constructor(t){super(t);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"lc_serializable",!0);g(this,"bound");g(this,"config");g(this,"kwargs");g(this,"configFactories");this.bound=t.bound,this.kwargs=t.kwargs,this.config=t.config,this.configFactories=t.configFactories}static lc_name(){return"RunnableBinding"}getName(t){return this.bound.getName(t)}async _mergeConfig(...t){const n=Un(this.config,...t);return Un(n,...this.configFactories?await Promise.all(this.configFactories.map(async a=>await a(n))):[])}withConfig(t){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...t}})}withRetry(t){return new og({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:t==null?void 0:t.stopAfterAttempt,...t})}async invoke(t,n){return this.bound.invoke(t,await this._mergeConfig(n,this.kwargs))}async batch(t,n,a){const s=Array.isArray(n)?await Promise.all(n.map(async i=>this._mergeConfig(Tt(i),this.kwargs))):await this._mergeConfig(Tt(n),this.kwargs);return this.bound.batch(t,s,a)}_concatOutputChunks(t,n){return this.bound._concatOutputChunks(t,n)}async*_streamIterator(t,n){yield*this.bound._streamIterator(t,await this._mergeConfig(Tt(n),this.kwargs))}async stream(t,n){return this.bound.stream(t,await this._mergeConfig(Tt(n),this.kwargs))}async*transform(t,n){yield*this.bound.transform(t,await this._mergeConfig(Tt(n),this.kwargs))}streamEvents(t,n,a){const s=this,i=async function*(){yield*s.bound.streamEvents(t,{...await s._mergeConfig(Tt(n),s.kwargs),version:n.version},a)};return _n.fromAsyncGenerator(i())}static isRunnableBinding(t){return t.bound&&At.isRunnable(t.bound)}withListeners({onStart:t,onEnd:n,onError:a}){return new T2({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new C2({config:s,onStart:t,onEnd:n,onError:a})]})]})}},$I=class F2 extends At{constructor(t){super(t);g(this,"lc_serializable",!0);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"bound");this.bound=t.bound}static lc_name(){return"RunnableEach"}async invoke(t,n){return this._callWithConfig(this._invoke.bind(this),t,n)}async _invoke(t,n,a){return this.bound.batch(t,Pt(n,{callbacks:a==null?void 0:a.getChild()}))}withListeners({onStart:t,onEnd:n,onError:a}){return new F2({bound:this.bound.withListeners({onStart:t,onEnd:n,onError:a})})}},og=class extends Gs{constructor(e){super(e);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"maxAttemptNumber",3);g(this,"onFailedAttempt",()=>{});this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}static lc_name(){return"RunnableRetry"}_patchConfigForRetry(e,t,n){const a=e>1?`retry:attempt:${e}`:void 0;return Pt(t,{callbacks:n==null?void 0:n.getChild(a)})}async _invoke(e,t,n){return op(a=>super.invoke(e,this._patchConfigForRetry(a,t,n)),{onFailedAttempt:({error:a})=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,a){const s={};try{await op(async i=>{const o=e.map((h,f)=>f).filter(h=>s[h.toString()]===void 0||s[h.toString()]instanceof Error),u=o.map(h=>e[h]),l=o.map(h=>this._patchConfigForRetry(i,t==null?void 0:t[h],n==null?void 0:n[h])),c=await super.batch(u,l,{...a,returnExceptions:!0});let d;for(let h=0;h<c.length;h+=1){const f=c[h],p=o[h];f instanceof Error&&d===void 0&&(d=f,d.input=u[h]),s[p.toString()]=f}if(d)throw d;return c},{onFailedAttempt:({error:i})=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((a==null?void 0:a.returnExceptions)!==!0)throw i}return Object.keys(s).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>s[parseInt(i,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}},Zs=class qo extends At{constructor(t){super(t);g(this,"first");g(this,"middle",[]);g(this,"last");g(this,"omitSequenceTags",!1);g(this,"lc_serializable",!0);g(this,"lc_namespace",["langchain_core","runnables"]);this.first=t.first,this.middle=t.middle??this.middle,this.last=t.last,this.name=t.name,this.omitSequenceTags=t.omitSequenceTags??this.omitSequenceTags}static lc_name(){return"RunnableSequence"}get steps(){return[this.first,...this.middle,this.last]}async invoke(t,n){var l;const a=Tt(n),s=await yn(a),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),Cr(t,"input"),a.runId,void 0,void 0,void 0,a==null?void 0:a.runName));delete a.runId;let o=t,u;try{const c=[this.first,...this.middle];for(let d=0;d<c.length;d+=1){const f=c[d].invoke(o,Pt(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));o=await us(f,n==null?void 0:n.signal)}if((l=n==null?void 0:n.signal)!=null&&l.aborted)throw mu(n.signal);u=await this.last.invoke(o,Pt(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd(Cr(u,"output"))),u}async batch(t,n,a){var l;const s=this._getOptionsList(n??{},t.length),i=await Promise.all(s.map(yn)),o=await Promise.all(i.map(async(c,d)=>{const h=await(c==null?void 0:c.handleChainStart(this.toJSON(),Cr(t[d],"input"),s[d].runId,void 0,void 0,void 0,s[d].runName));return delete s[d].runId,h}));let u=t;try{for(let c=0;c<this.steps.length;c+=1){const h=this.steps[c].batch(u,o.map((f,p)=>{const m=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return Pt(s[p],{callbacks:m})}),a);u=await us(h,(l=s[0])==null?void 0:l.signal)}}catch(c){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(Cr(u,"output")))),u}_concatOutputChunks(t,n){return this.last._concatOutputChunks(t,n)}async*_streamIterator(t,n){var h;const a=await yn(n),{runId:s,...i}=n??{},o=await(a==null?void 0:a.handleChainStart(this.toJSON(),Cr(t,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),u=[this.first,...this.middle,this.last];let l=!0,c;async function*d(){yield t}try{let f=u[0].transform(d(),Pt(i,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let p=1;p<u.length;p+=1)f=await u[p].transform(f,Pt(i,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));for await(const p of f)if((h=n==null?void 0:n.signal)==null||h.throwIfAborted(),yield p,l)if(c===void 0)c=p;else try{c=this._concatOutputChunks(c,p)}catch{c=void 0,l=!1}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(Cr(c,"output")))}getGraph(t){const n=new wu;let a=null;return this.steps.forEach((s,i)=>{const o=s.getGraph(t);i!==0&&o.trimFirstNode(),i!==this.steps.length-1&&o.trimLastNode(),n.extend(o);const u=o.firstNode();if(!u)throw new Error(`Runnable ${s} has no first node`);a&&n.addEdge(a,u),a=o.lastNode()}),n}pipe(t){return qo.isRunnableSequence(t)?new qo({first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}):new qo({first:this.first,middle:[...this.middle,this.last],last:Pr(t),name:this.name})}static isRunnableSequence(t){return Array.isArray(t.middle)&&At.isRunnable(t)}static from([t,...n],a){let s={};return typeof a=="string"?s.name=a:a!==void 0&&(s=a),new qo({...s,first:Pr(t),middle:n.slice(0,-1).map(Pr),last:Pr(n[n.length-1])})}},Co=class N2 extends At{constructor(t){super(t);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"lc_serializable",!0);g(this,"steps");this.steps={};for(const[n,a]of Object.entries(t.steps))this.steps[n]=Pr(a)}static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}static from(t){return new N2({steps:t})}async invoke(t,n){const a=Tt(n),s=await yn(a),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:t},a.runId,void 0,void 0,void 0,a==null?void 0:a.runName));delete a.runId;const o={};try{const u=Object.entries(this.steps).map(async([l,c])=>{o[l]=await c.invoke(t,Pt(a,{callbacks:i==null?void 0:i.getChild(`map:key:${l}`)}))});await us(Promise.all(u),n==null?void 0:n.signal)}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(o)),o}async*_transform(t,n,a){const s={...this.steps},i=Xm(t,Object.keys(s).length),o=new Map(Object.entries(s).map(([u,l],c)=>{const d=l.transform(i[c],Pt(a,{callbacks:n==null?void 0:n.getChild(`map:key:${u}`)}));return[u,d.next().then(h=>({key:u,gen:d,result:h}))]}));for(;o.size;){const u=Promise.race(o.values()),{key:l,result:c,gen:d}=await us(u,a==null?void 0:a.signal);o.delete(l),c.done||(yield{[l]:c.value},o.set(l,d.next().then(h=>({key:l,gen:d,result:h}))))}}transform(t,n){return this._transformStreamWithConfig(t,this._transform.bind(this),n)}async stream(t,n){async function*a(){yield t}const s=Tt(n),i=new Ni({generator:this.transform(a(),s),config:s});return await i.setup,_n.fromAsyncGenerator(i)}},PI=class I2 extends At{constructor(t){super(t);g(this,"lc_serializable",!1);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"func");if(!Jm(t.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=t.func}async invoke(t,n){const[a]=this._getOptionsList(n??{},1),s=await yn(a),i=this.func(Pt(a,{callbacks:s}),t);return us(i,a==null?void 0:a.signal)}async*_streamIterator(t,n){var i,o;const[a]=this._getOptionsList(n??{},1),s=await this.invoke(t,n);if(bp(s)){for await(const u of s)(i=a==null?void 0:a.signal)==null||i.throwIfAborted(),yield u;return}if(MI(s)){for(;;){(o=a==null?void 0:a.signal)==null||o.throwIfAborted();const u=s.next();if(u.done)break;yield u.value}return}yield s}static from(t){return new I2({func:t})}};function LI(r){if(Jm(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var fs=class O2 extends At{constructor(t){if(Jm(t.func))return PI.from(t.func);super(t);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"func");LI(t.func),this.func=t.func}static lc_name(){return"RunnableLambda"}static from(t){return new O2({func:t})}async _invoke(t,n,a){return new Promise((s,i)=>{const o=Pt(n,{callbacks:a==null?void 0:a.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??af)-1});Or.runWithConfig(os(o),async()=>{var u,l;try{let c=await this.func(t,{...o});if(c&&At.isRunnable(c)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(t,{...o,recursionLimit:(o.recursionLimit??af)-1})}else if(bp(c)){let d;for await(const h of wp(o,c))if((u=n==null?void 0:n.signal)==null||u.throwIfAborted(),d===void 0)d=h;else try{d=this._concatOutputChunks(d,h)}catch{d=h}c=d}else if(s_(c)){let d;for(const h of i_(o,c))if((l=n==null?void 0:n.signal)==null||l.throwIfAborted(),d===void 0)d=h;else try{d=this._concatOutputChunks(d,h)}catch{d=h}c=d}s(c)}catch(c){i(c)}})})}async invoke(t,n){return this._callWithConfig(this._invoke.bind(this),t,n)}async*_transform(t,n,a){var u,l;let s;for await(const c of t)if(s===void 0)s=c;else try{s=this._concatOutputChunks(s,c)}catch{s=c}const i=Pt(a,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((a==null?void 0:a.recursionLimit)??af)-1}),o=await new Promise((c,d)=>{Or.runWithConfig(os(i),async()=>{try{const h=await this.func(s,{...i,config:i});c(h)}catch(h){d(h)}})});if(o&&At.isRunnable(o)){if((a==null?void 0:a.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await o.stream(s,i);for await(const d of c)yield d}else if(bp(o))for await(const c of wp(i,o))(u=a==null?void 0:a.signal)==null||u.throwIfAborted(),yield c;else if(s_(o))for(const c of i_(i,o))(l=a==null?void 0:a.signal)==null||l.throwIfAborted(),yield c;else yield o}transform(t,n){return this._transformStreamWithConfig(t,this._transform.bind(this),n)}async stream(t,n){async function*a(){yield t}const s=Tt(n),i=new Ni({generator:this.transform(a(),s),config:s});return await i.setup,_n.fromAsyncGenerator(i)}},zI=class extends Co{},R2=class extends At{constructor(e){super(e);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"lc_serializable",!0);g(this,"runnable");g(this,"fallbacks");this.runnable=e.runnable,this.fallbacks=e.fallbacks}static lc_name(){return"RunnableWithFallbacks"}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Tt(t),a=await yn(n),{runId:s,...i}=n,o=await(a==null?void 0:a.handleChainStart(this.toJSON(),Cr(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),u=Pt(i,{callbacks:o==null?void 0:o.getChild()});return await Or.runWithConfig(u,async()=>{var d;let c;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const f=await h.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(Cr(f,"output"))),f}catch(f){c===void 0&&(c=f)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(c)),c)})}async*_streamIterator(e,t){var d;const n=Tt(t),a=await yn(n),{runId:s,...i}=n,o=await(a==null?void 0:a.handleChainStart(this.toJSON(),Cr(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName));let u,l;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const f=Pt(i,{callbacks:o==null?void 0:o.getChild()});try{const p=await h.stream(e,f);l=wp(f,p);break}catch(p){u===void 0&&(u=p)}}if(l===void 0){const h=u??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(h)),h}let c;try{for await(const h of l){yield h;try{c=c===void 0?c:this._concatOutputChunks(c,h)}catch{c=void 0}}}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}await(o==null?void 0:o.handleChainEnd(Cr(c,"output")))}async batch(e,t,n){var u;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),s=await Promise.all(a.map(l=>yn(l))),i=await Promise.all(s.map(async(l,c)=>{const d=await(l==null?void 0:l.handleChainStart(this.toJSON(),Cr(e[c],"input"),a[c].runId,void 0,void 0,void 0,a[c].runName));return delete a[c].runId,d}));let o;for(const l of this.runnables()){(u=a[0].signal)==null||u.throwIfAborted();try{const c=await l.batch(e,i.map((d,h)=>Pt(a[h],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(i.map((d,h)=>d==null?void 0:d.handleChainEnd(Cr(c[h],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(i.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function Pr(r){if(typeof r=="function")return new fs({func:r});if(At.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=Pr(n);return new Co({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var ug=class extends At{constructor(e){e instanceof Co&&(e={mapper:e});super(e);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"lc_serializable",!0);g(this,"mapper");this.mapper=e.mapper}static lc_name(){return"RunnableAssign"}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const a=this.mapper.getStepsKeys(),[s,i]=Xm(e),o=this.mapper.transform(i,Pt(n,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(const l of s){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);const c=Object.fromEntries(Object.entries(l).filter(([d])=>!a.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await u).value;for await(const l of o)yield l}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Tt(t),s=new Ni({generator:this.transform(n(),a),config:a});return await s.setup,_n.fromAsyncGenerator(s)}},D2=class extends At{constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e});super(e);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"lc_serializable",!0);g(this,"keys");this.keys=e.keys}static lc_name(){return"RunnablePick"}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const a=Tt(t),s=new Ni({generator:this.transform(n(),a),config:a});return await s.setup,_n.fromAsyncGenerator(s)}},Ep=class extends Gs{constructor(e){const t=Zs.from([fs.from(async n=>{let a;if(eu(n))try{a=await S0(this.schema,n.args)}catch{throw new _c("Received tool input did not match expected schema",JSON.stringify(n.args))}else a=n;return a}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}});g(this,"name");g(this,"description");g(this,"schema");this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function UI(r,e){const t=e.name??r.getName(),n=e.description??vu(e.schema);return rg(e.schema)?new Ep({name:t,description:n,schema:C0({input:k0()}).transform(a=>a.input),bound:r}):new Ep({name:t,description:n,schema:e.schema,bound:r})}const Rc=(r,e)=>{const t=[...new Set(e==null?void 0:e.map(a=>{if(typeof a=="string")return a;const s=new a({});if(!("getType"in s)||typeof s.getType!="function")throw new Error("Invalid type provided.");return s.getType()}))],n=r.getType();return t.some(a=>a===n)};function jI(r,e){return Array.isArray(r)?o_(r,e):fs.from(t=>o_(t,r))}function o_(r,e={}){const{includeNames:t,excludeNames:n,includeTypes:a,excludeTypes:s,includeIds:i,excludeIds:o}=e,u=[];for(const l of r)if(!(n&&l.name&&n.includes(l.name))){{if(s&&Rc(l,s))continue;if(o&&l.id&&o.includes(l.id))continue}a||i||t?(t&&l.name&&t.some(c=>c===l.name)||a&&Rc(l,a)||i&&l.id&&i.some(c=>c===l.id))&&u.push(l):u.push(l)}return u}function qI(r){return Array.isArray(r)?u_(r):fs.from(u_)}function u_(r){if(!r.length)return[];const e=[];for(const t of r){const n=t,a=e.pop();if(!a)e.push(n);else if(n.getType()==="tool"||n.getType()!==a.getType())e.push(a,n);else{const s=wc(a),i=wc(n),o=s.concat(i);typeof s.content=="string"&&typeof i.content=="string"&&(o.content=`${s.content}
${i.content}`),e.push(GI(o))}}return e}function HI(r,e){if(Array.isArray(r)){const t=r;if(!e)throw new Error("Options parameter is required when providing messages.");return l_(t,e)}else{const t=r;return fs.from(n=>l_(n,t)).withConfig({runName:"trim_messages"})}}async function l_(r,e){const{maxTokens:t,tokenCounter:n,strategy:a="last",allowPartial:s=!1,endOn:i,startOn:o,includeSystem:u=!1,textSplitter:l}=e;if(o&&a==="first")throw new Error("`startOn` should only be specified if `strategy` is 'last'.");if(u&&a==="first")throw new Error("`includeSystem` should only be specified if `strategy` is 'last'.");let c;"getNumTokens"in n?c=async h=>(await Promise.all(h.map(p=>n.getNumTokens(p.content)))).reduce((p,m)=>p+m,0):c=async h=>n(h);let d=M2;if(l&&("splitText"in l?d=l.splitText:d=async h=>l(h)),a==="first")return B2(r,{maxTokens:t,tokenCounter:c,textSplitter:d,partialStrategy:s?"first":void 0,endOn:i});if(a==="last")return VI(r,{maxTokens:t,tokenCounter:c,textSplitter:d,allowPartial:s,includeSystem:u,startOn:o,endOn:i});throw new Error(`Unrecognized strategy: '${a}'. Must be one of 'first' or 'last'.`)}async function B2(r,e){const{maxTokens:t,tokenCounter:n,textSplitter:a,partialStrategy:s,endOn:i}=e;let o=[...r],u=0;for(let l=0;l<o.length;l+=1){const c=l>0?o.slice(0,-l):o;if(await n(c)<=t){u=o.length-l;break}}if(u<o.length&&s){let l=!1;if(Array.isArray(o[u].content)){const c=o[u];if(typeof c.content=="string")throw new Error("Expected content to be an array.");const d=c.content.length,h=s==="last"?[...c.content].reverse():c.content;for(let f=1;f<=d;f+=1){const p=s==="first"?h.slice(0,f):h.slice(-f),m=Object.fromEntries(Object.entries(c).filter(([w])=>w!=="type"&&!w.startsWith("lc_"))),v=lg(c.getType(),{...m,content:p}),_=[...o.slice(0,u),v];if(await n(_)<=t)o=_,u+=1,l=!0;else break}l&&s==="last"&&(c.content=[...h].reverse())}if(!l){const c=o[u];let d;if(Array.isArray(c.content)&&c.content.some(h=>typeof h=="string"||h.type==="text")){const h=c.content.find(f=>f.type==="text"&&f.text);d=h==null?void 0:h.text}else typeof c.content=="string"&&(d=c.content);if(d){const h=await a(d),f=h.length;s==="last"&&h.reverse();for(let p=0;p<f-1;p+=1)if(h.pop(),c.content=h.join(""),await n([...o.slice(0,u),c])<=t){s==="last"&&(c.content=[...h].reverse().join("")),o=[...o.slice(0,u),c],u+=1;break}}}}if(i){const l=Array.isArray(i)?i:[i];for(;u>0&&!Rc(o[u-1],l);)u-=1}return o.slice(0,u)}async function VI(r,e){var c;const{allowPartial:t=!1,includeSystem:n=!1,endOn:a,startOn:s,...i}=e;let o=r.map(d=>{const h=Object.fromEntries(Object.entries(d).filter(([f])=>f!=="type"&&!f.startsWith("lc_")));return lg(d.getType(),h,fu(d))});if(a){const d=Array.isArray(a)?a:[a];for(;o.length>0&&!Rc(o[o.length-1],d);)o=o.slice(0,-1)}const u=n&&((c=o[0])==null?void 0:c.getType())==="system";let l=u?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return l=await B2(l,{...i,partialStrategy:t?"last":void 0,endOn:s}),u?[l[0],...l.slice(1).reverse()]:l.reverse()}const c_={human:{message:Gn,messageChunk:f0},ai:{message:Hr,messageChunk:ca},system:{message:is,messageChunk:to},developer:{message:is,messageChunk:to},tool:{message:js,messageChunk:u0},function:{message:d0,messageChunk:h0},generic:{message:Ti,messageChunk:c0},remove:{message:bc,messageChunk:bc}};function lg(r,e,t){var s;let n,a;switch(r){case"human":t?n=new f0(e):a=new Gn(e);break;case"ai":if(t){let i={...e};"tool_calls"in i&&(i={...i,tool_call_chunks:(s=i.tool_calls)==null?void 0:s.map(o=>({...o,type:"tool_call_chunk",index:void 0,args:JSON.stringify(o.args)}))}),n=new ca(i)}else a=new Hr(e);break;case"system":t?n=new to(e):a=new is(e);break;case"developer":t?n=new to({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}}):a=new is({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in e)t?n=new u0(e):a=new js(e);else throw new Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(t)n=new h0(e);else{if(!e.name)throw new Error("FunctionMessage must have a 'name' field");a=new d0(e)}break;case"generic":if("role"in e)t?n=new c0(e):a=new Ti(e);else throw new Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw new Error(`Unrecognized message type ${r}`)}if(t&&n)return n;if(a)return a;throw new Error(`Unrecognized message type ${r}`)}function GI(r){const e=r.getType();let t;const n=Object.fromEntries(Object.entries(r).filter(([a])=>!["type","tool_call_chunks"].includes(a)&&!a.startsWith("lc_")));if(e in c_&&(t=lg(e,n)),!t)throw new Error(`Unrecognized message chunk class ${e}. Supported classes are ${Object.keys(c_)}`);return t}function M2(r){const e=r.split(`
`);return Promise.resolve([...e.slice(0,-1).map(t=>`${t}
`),e[e.length-1]])}const ZI=["tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result"],KI=["image","video","audio","text-plain","file"],WI=["text","reasoning",...ZI,...KI];var $2={};Xe($2,{AIMessage:()=>Hr,AIMessageChunk:()=>ca,BaseMessage:()=>jn,BaseMessageChunk:()=>Xs,ChatMessage:()=>Ti,ChatMessageChunk:()=>c0,FunctionMessage:()=>d0,FunctionMessageChunk:()=>h0,HumanMessage:()=>Gn,HumanMessageChunk:()=>f0,KNOWN_BLOCK_TYPES:()=>WI,RemoveMessage:()=>bc,SystemMessage:()=>is,SystemMessageChunk:()=>to,ToolMessage:()=>js,ToolMessageChunk:()=>u0,_isMessageFieldWithRole:()=>Ob,_mergeDicts:()=>qr,_mergeLists:()=>Uu,_mergeObj:()=>Nb,_mergeStatus:()=>Fb,coerceMessageLikeToMessage:()=>Oa,collapseToolCallChunks:()=>zb,convertToChunk:()=>wc,convertToOpenAIImageBlock:()=>Ab,convertToProviderContentBlock:()=>QS,defaultTextSplitter:()=>M2,defaultToolCallParser:()=>Mm,filterMessages:()=>jI,getBufferString:()=>zm,iife:()=>BA,isAIMessage:()=>Lm,isAIMessageChunk:()=>Zf,isBase64ContentBlock:()=>Om,isBaseMessage:()=>$r,isBaseMessageChunk:()=>fu,isChatMessage:()=>_A,isChatMessageChunk:()=>bA,isDataContentBlock:()=>Us,isDirectToolOutput:()=>Bm,isFunctionMessage:()=>wA,isFunctionMessageChunk:()=>EA,isHumanMessage:()=>xA,isHumanMessageChunk:()=>SA,isIDContentBlock:()=>Sb,isMessage:()=>Tb,isOpenAIToolCallArray:()=>gA,isPlainTextContentBlock:()=>JS,isSystemMessage:()=>AA,isSystemMessageChunk:()=>kA,isToolMessage:()=>$m,isToolMessageChunk:()=>Db,isURLContentBlock:()=>Im,mapChatMessagesToStoredMessages:()=>zA,mapStoredMessageToChatMessage:()=>Um,mapStoredMessagesToChatMessages:()=>LA,mergeContent:()=>ss,mergeMessageRuns:()=>qI,mergeResponseMetadata:()=>$b,mergeUsageMetadata:()=>Lb,parseBase64DataUrl:()=>Vf,parseMimeType:()=>XS,trimMessages:()=>HI});var P2={};Xe(P2,{BaseChatMessageHistory:()=>L2,BaseListChatMessageHistory:()=>cg,InMemoryChatMessageHistory:()=>YI});var L2=class extends Vn{async addMessages(r){for(const e of r)await this.addMessage(e)}},cg=class extends Vn{addUserMessage(r){return this.addMessage(new Gn(r))}addAIMessage(r){return this.addMessage(new Hr(r))}async addMessages(r){for(const e of r)await this.addMessage(e)}clear(){throw new Error("Not implemented.")}},YI=class extends cg{constructor(e){super(...arguments);g(this,"lc_namespace",["langchain","stores","message","in_memory"]);g(this,"messages",[]);this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}},z2={};Xe(z2,{Embeddings:()=>dg});var dg=class{constructor(r){g(this,"caller");this.caller=new Vu(r??{})}},JI={},U2={};Xe(U2,{BaseMemory:()=>XI,getInputValue:()=>QI,getOutputValue:()=>eO,getPromptInputKey:()=>tO});var XI=class{};const j2=(r,e)=>{if(e!==void 0)return r[e];const t=Object.keys(r);if(t.length===1)return r[t[0]]},QI=(r,e)=>{const t=j2(r,e);if(!t){const n=Object.keys(r);throw new Error(`input values have ${n.length} keys, you must specify an input key or pass only 1 key as input`)}return t},eO=(r,e)=>{const t=j2(r,e);if(!t&&t!==""){const n=Object.keys(r);throw new Error(`output values have ${n.length} keys, you must specify an output key or pass only 1 key as output`)}return t};function tO(r,e){const t=Object.keys(r).filter(n=>!e.includes(n)&&n!=="stop");if(t.length!==1)throw new Error(`One input key expected, but got ${t.length}`);return t[0]}var q2={};Xe(q2,{BasePromptValue:()=>T0,ChatPromptValue:()=>fg,ImagePromptValue:()=>H2,StringPromptValue:()=>hg});var T0=class extends Vn{},hg=class extends T0{constructor(e){super({value:e});g(this,"lc_namespace",["langchain_core","prompt_values"]);g(this,"lc_serializable",!0);g(this,"value");this.value=e}static lc_name(){return"StringPromptValue"}toString(){return this.value}toChatMessages(){return[new Gn(this.value)]}},fg=class extends T0{constructor(e){Array.isArray(e)&&(e={messages:e});super(e);g(this,"lc_namespace",["langchain_core","prompt_values"]);g(this,"lc_serializable",!0);g(this,"messages");this.messages=e.messages}static lc_name(){return"ChatPromptValue"}toString(){return zm(this.messages)}toChatMessages(){return this.messages}},H2=class extends T0{constructor(e){"imageUrl"in e||(e={imageUrl:e});super(e);g(this,"lc_namespace",["langchain_core","prompt_values"]);g(this,"lc_serializable",!0);g(this,"imageUrl");g(this,"value");this.imageUrl=e.imageUrl}static lc_name(){return"ImagePromptValue"}toString(){return this.imageUrl.url}toChatMessages(){return[new Gn({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},V2={};Xe(V2,{BaseStore:()=>G2,InMemoryStore:()=>rO});var G2=class extends Vn{},rO=class extends G2{constructor(){super(...arguments);g(this,"lc_namespace",["langchain","storage"]);g(this,"store",{})}async mget(e){return e.map(t=>this.store[t])}async mset(e){for(const[t,n]of e)this.store[t]=n}async mdelete(e){for(const t of e)delete this.store[t]}async*yieldKeys(e){const t=Object.keys(this.store);for(const n of t)(e===void 0||n.startsWith(e))&&(yield n)}},Z2={};Xe(Z2,{BaseRetriever:()=>pg});var pg=class extends At{constructor(e){super(e);g(this,"callbacks");g(this,"tags");g(this,"metadata");g(this,"verbose");this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){const n=Tt(qu(t)),a=await tn.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),s=await(a==null?void 0:a.handleRetrieverStart(this.toJSON(),e,n.runId,void 0,void 0,void 0,n.runName));try{const i=await this._getRelevantDocuments(e,s);return await(s==null?void 0:s.handleRetrieverEnd(i)),i}catch(i){throw await(s==null?void 0:s.handleRetrieverError(i)),i}}},K2={};Xe(K2,{SaveableVectorStore:()=>nO,VectorStore:()=>mg,VectorStoreRetriever:()=>Xl});var Xl=class extends pg{constructor(e){super(e);g(this,"vectorStore");g(this,"k",4);g(this,"searchType","similarity");g(this,"searchKwargs");g(this,"filter");this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}async _getRelevantDocuments(e,t){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t==null?void 0:t.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t==null?void 0:t.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}},mg=class extends Vn{constructor(e,t){super(t);g(this,"lc_namespace",["langchain","vectorstores",this._vectorstoreType()]);g(this,"embeddings");this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,n=void 0,a=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,n)).map(i=>i[0])}async similaritySearchWithScore(e,t=4,n=void 0,a=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,n)}static fromTexts(e,t,n,a){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,n,a,s,i){if(typeof e=="number")return new Xl({vectorStore:this,k:e,filter:t,tags:[...a??[],this._vectorstoreType()],metadata:s,verbose:i,callbacks:n});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Xl({...o,searchKwargs:e.searchKwargs}):new Xl({...o})}}},nO=class extends mg{static load(r,e){throw new Error("Not implemented")}},$e="0123456789abcdef".split(""),aO=[-2147483648,8388608,32768,128],Qn=[24,16,8,0],Il=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Ir=[];function ha(r,e){e?(Ir[0]=Ir[16]=Ir[1]=Ir[2]=Ir[3]=Ir[4]=Ir[5]=Ir[6]=Ir[7]=Ir[8]=Ir[9]=Ir[10]=Ir[11]=Ir[12]=Ir[13]=Ir[14]=Ir[15]=0,this.blocks=Ir):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=r}ha.prototype.update=function(r){if(!this.finalized){var e,t=typeof r;if(t!=="string"){if(t==="object"){if(r===null)throw new Error(ERROR);if(ARRAY_BUFFER&&r.constructor===ArrayBuffer)r=new Uint8Array(r);else if(!Array.isArray(r)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(r)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var n,a=0,s,i=r.length,o=this.blocks;a<i;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)for(s=this.start;a<i&&s<64;++a)o[s>>>2]|=r[a]<<Qn[s++&3];else for(s=this.start;a<i&&s<64;++a)n=r.charCodeAt(a),n<128?o[s>>>2]|=n<<Qn[s++&3]:n<2048?(o[s>>>2]|=(192|n>>>6)<<Qn[s++&3],o[s>>>2]|=(128|n&63)<<Qn[s++&3]):n<55296||n>=57344?(o[s>>>2]|=(224|n>>>12)<<Qn[s++&3],o[s>>>2]|=(128|n>>>6&63)<<Qn[s++&3],o[s>>>2]|=(128|n&63)<<Qn[s++&3]):(n=65536+((n&1023)<<10|r.charCodeAt(++a)&1023),o[s>>>2]|=(240|n>>>18)<<Qn[s++&3],o[s>>>2]|=(128|n>>>12&63)<<Qn[s++&3],o[s>>>2]|=(128|n>>>6&63)<<Qn[s++&3],o[s>>>2]|=(128|n&63)<<Qn[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=o[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};ha.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>>2]|=aO[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};ha.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4,s=this.h5,i=this.h6,o=this.h7,u=this.blocks,l,c,d,h,f,p,m,v,_,w,E;for(l=16;l<64;++l)f=u[l-15],c=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,f=u[l-2],d=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,u[l]=u[l-16]+c+u[l-7]+d<<0;for(E=e&t,l=0;l<64;l+=4)this.first?(this.is224?(v=300032,f=u[0]-1413257819,o=f-150054599<<0,n=f+24177077<<0):(v=704751109,f=u[0]-210244248,o=f-1521486534<<0,n=f+143694565<<0),this.first=!1):(c=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),d=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),v=r&e,h=v^r&t^E,m=a&s^~a&i,f=o+d+m+Il[l]+u[l],p=c+h,o=n+f<<0,n=f+p<<0),c=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),d=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),_=n&r,h=_^n&e^v,m=i&o^~i&a,f=s+d+m+Il[l+1]+u[l+1],p=c+h,i=t+f<<0,t=f+p<<0,c=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),d=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),w=t&n,h=w^t&r^_,m=s&i^~s&o,f=a+d+m+Il[l+2]+u[l+2],p=c+h,s=e+f<<0,e=f+p<<0,c=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),d=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),E=e&t,h=E^e&n^w,m=s&i^~s&o,f=a+d+m+Il[l+3]+u[l+3],p=c+h,a=r+f<<0,r=f+p<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+a<<0,this.h5=this.h5+s<<0,this.h6=this.h6+i<<0,this.h7=this.h7+o<<0};ha.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4,s=this.h5,i=this.h6,o=this.h7,u=$e[r>>>28&15]+$e[r>>>24&15]+$e[r>>>20&15]+$e[r>>>16&15]+$e[r>>>12&15]+$e[r>>>8&15]+$e[r>>>4&15]+$e[r&15]+$e[e>>>28&15]+$e[e>>>24&15]+$e[e>>>20&15]+$e[e>>>16&15]+$e[e>>>12&15]+$e[e>>>8&15]+$e[e>>>4&15]+$e[e&15]+$e[t>>>28&15]+$e[t>>>24&15]+$e[t>>>20&15]+$e[t>>>16&15]+$e[t>>>12&15]+$e[t>>>8&15]+$e[t>>>4&15]+$e[t&15]+$e[n>>>28&15]+$e[n>>>24&15]+$e[n>>>20&15]+$e[n>>>16&15]+$e[n>>>12&15]+$e[n>>>8&15]+$e[n>>>4&15]+$e[n&15]+$e[a>>>28&15]+$e[a>>>24&15]+$e[a>>>20&15]+$e[a>>>16&15]+$e[a>>>12&15]+$e[a>>>8&15]+$e[a>>>4&15]+$e[a&15]+$e[s>>>28&15]+$e[s>>>24&15]+$e[s>>>20&15]+$e[s>>>16&15]+$e[s>>>12&15]+$e[s>>>8&15]+$e[s>>>4&15]+$e[s&15]+$e[i>>>28&15]+$e[i>>>24&15]+$e[i>>>20&15]+$e[i>>>16&15]+$e[i>>>12&15]+$e[i>>>8&15]+$e[i>>>4&15]+$e[i&15];return this.is224||(u+=$e[o>>>28&15]+$e[o>>>24&15]+$e[o>>>20&15]+$e[o>>>16&15]+$e[o>>>12&15]+$e[o>>>8&15]+$e[o>>>4&15]+$e[o&15]),u};ha.prototype.toString=ha.prototype.hex;ha.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,a=this.h4,s=this.h5,i=this.h6,o=this.h7,u=[r>>>24&255,r>>>16&255,r>>>8&255,r&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255];return this.is224||u.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),u};ha.prototype.array=ha.prototype.digest;ha.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(this.is224?28:32),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),r};const gg=(...r)=>new ha(!1,!0).update(r.join("")).hex();var W2={};Xe(W2,{sha256:()=>gg});var Y2={};Xe(Y2,{BaseCache:()=>X2,InMemoryCache:()=>Q2,defaultHashKeyEncoder:()=>J2,deserializeStoredGeneration:()=>sO,serializeGeneration:()=>iO});const J2=(...r)=>gg(r.join("_"));function sO(r){return r.message!==void 0?{text:r.text,message:Um(r.message)}:{text:r.text}}function iO(r){const e={text:r.text};return r.message!==void 0&&(e.message=r.message.toDict()),e}var X2=class{constructor(){g(this,"keyEncoder",J2)}makeDefaultKeyEncoder(e){this.keyEncoder=e}};const oO=new Map;var Q2=class ew extends X2{constructor(t){super();g(this,"cache");this.cache=t??new Map}lookup(t,n){return Promise.resolve(this.cache.get(this.keyEncoder(t,n))??null)}async update(t,n,a){this.cache.set(this.keyEncoder(t,n),a)}static global(){return new ew(oO)}},tw={};Xe(tw,{BaseDocumentLoader:()=>rw});var rw=class{},nw={};Xe(nw,{LangSmithLoader:()=>uO});var uO=class extends rw{constructor(e){super();g(this,"datasetId");g(this,"datasetName");g(this,"exampleIds");g(this,"asOf");g(this,"splits");g(this,"inlineS3Urls");g(this,"offset");g(this,"limit");g(this,"metadata");g(this,"filter");g(this,"contentKey");g(this,"formatContent");g(this,"client");if(e.client&&e.clientConfig)throw new Error("client and clientConfig cannot both be provided.");this.client=e.client??new ro(e==null?void 0:e.clientConfig),this.contentKey=e.contentKey?e.contentKey.split("."):[],this.formatContent=e.formatContent??lO,this.datasetId=e.datasetId,this.datasetName=e.datasetName,this.exampleIds=e.exampleIds,this.asOf=e.asOf,this.splits=e.splits,this.inlineS3Urls=e.inlineS3Urls,this.offset=e.offset,this.limit=e.limit,this.metadata=e.metadata,this.filter=e.filter}async load(){const e=[];for await(const t of this.client.listExamples({datasetId:this.datasetId,datasetName:this.datasetName,exampleIds:this.exampleIds,asOf:this.asOf,splits:this.splits,inlineS3Urls:this.inlineS3Urls,offset:this.offset,limit:this.limit,metadata:this.metadata,filter:this.filter})){let n=t.inputs;for(const i of this.contentKey)n=n[i];const a=this.formatContent(n),s=t;["created_at","modified_at"].forEach(i=>{i in s&&typeof s[i]=="object"&&(s[i]=s[i].toString())}),e.push({pageContent:a,metadata:s})}return e}};function lO(r){if(typeof r=="string")return r;try{return JSON.stringify(r,null,2)}catch{return String(r)}}var Rs=class{constructor(r){g(this,"pageContent");g(this,"metadata");g(this,"id");this.pageContent=r.pageContent!==void 0?r.pageContent.toString():"",this.metadata=r.metadata??{},this.id=r.id}},aw=class extends At{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","documents","transformers"])}invoke(e,t){return this.transformDocuments(e)}},cO=class extends aw{async transformDocuments(r){const e=[];for(const t of r){const n=await this._transformDocument(t);e.push(n)}return e}},sw={};Xe(sw,{BaseDocumentTransformer:()=>aw,Document:()=>Rs,MappingDocumentTransformer:()=>cO});var yg=class extends Vn{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","example_selectors","base"])}},iw=class{async getPromptAsync(r,e){return this.getPrompt(r).partial((e==null?void 0:e.partialVariables)??{})}},dO=class extends iw{constructor(e,t=[]){super();g(this,"defaultPrompt");g(this,"conditionals");this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,n]of this.conditionals)if(t(e))return n;return this.defaultPrompt}};function hO(r){return r._modelType()==="base_llm"}function fO(r){return r._modelType()==="base_chat_model"}function d_(r){return r.split(/\n| /).length}var pO=class ow extends yg{constructor(t){super(t);g(this,"examples",[]);g(this,"examplePrompt");g(this,"getTextLength",d_);g(this,"maxLength",2048);g(this,"exampleTextLengths",[]);this.examplePrompt=t.examplePrompt,this.maxLength=t.maxLength??2048,this.getTextLength=t.getTextLength??d_}async addExample(t){this.examples.push(t);const n=await this.examplePrompt.format(t);this.exampleTextLengths.push(this.getTextLength(n))}async calculateExampleTextLengths(t,n){if(t.length>0)return t;const{examples:a,examplePrompt:s}=n;return(await Promise.all(a.map(o=>s.format(o)))).map(o=>this.getTextLength(o))}async selectExamples(t){const n=Object.values(t).join(" ");let a=this.maxLength-this.getTextLength(n),s=0;const i=[];for(;a>0&&s<this.examples.length;){const o=a-this.exampleTextLengths[s];if(o<0)break;i.push(this.examples[s]),a=o,s+=1}return i}static async fromExamples(t,n){const a=new ow(n);return await Promise.all(t.map(s=>a.addExample(s))),a}};function df(r){return Object.keys(r).sort().map(e=>r[e])}var mO=class uw extends yg{constructor(t){super(t);g(this,"vectorStoreRetriever");g(this,"exampleKeys");g(this,"inputKeys");if(this.exampleKeys=t.exampleKeys,this.inputKeys=t.inputKeys,t.vectorStore!==void 0)this.vectorStoreRetriever=t.vectorStore.asRetriever({k:t.k??4,filter:t.filter});else if(t.vectorStoreRetriever)this.vectorStoreRetriever=t.vectorStoreRetriever;else throw new Error('You must specify one of "vectorStore" and "vectorStoreRetriever".')}async addExample(t){const n=this.inputKeys??Object.keys(t),a=df(n.reduce((s,i)=>({...s,[i]:t[i]}),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new Rs({pageContent:a,metadata:t})])}async selectExamples(t){const n=this.inputKeys??Object.keys(t),a=df(n.reduce((o,u)=>({...o,[u]:t[u]}),{})).join(" "),i=(await this.vectorStoreRetriever.invoke(a)).map(o=>o.metadata);return this.exampleKeys?i.map(o=>this.exampleKeys.reduce((u,l)=>({...u,[l]:o[l]}),{})):i}static async fromExamples(t,n,a,s={}){const i=s.inputKeys??null,o=t.map(l=>df(i?i.reduce((c,d)=>({...c,[d]:l[d]}),{}):l).join(" ")),u=await a.fromTexts(o,t,n,s);return new uw({vectorStore:u,k:s.k??4,exampleKeys:s.exampleKeys,inputKeys:s.inputKeys})}},lw={};Xe(lw,{BaseExampleSelector:()=>yg,BasePromptSelector:()=>iw,ConditionalPromptSelector:()=>dO,LengthBasedExampleSelector:()=>pO,SemanticSimilarityExampleSelector:()=>mO,isChatModel:()=>fO,isLLM:()=>hO});const xp="10f90ea3-90a4-4962-bf75-83a0f3c1c62a";var gO=class extends Vn{constructor(){super(...arguments);g(this,"lc_namespace",["langchain","recordmanagers"])}},cw=class{constructor(r){g(this,"uid");g(this,"hash_");g(this,"contentHash");g(this,"metadataHash");g(this,"pageContent");g(this,"metadata");g(this,"keyEncoder",gg);this.uid=r.uid,this.pageContent=r.pageContent,this.metadata=r.metadata}makeDefaultKeyEncoder(r){this.keyEncoder=r}calculateHashes(){const r=["hash_","content_hash","metadata_hash"];for(const t of r)if(t in this.metadata)throw new Error(`Metadata cannot contain key ${t} as it is reserved for internal use. Restricted keys: [${r.join(", ")}]`);const e=this._hashStringToUUID(this.pageContent);try{const t=this._hashNestedDictToUUID(this.metadata);this.contentHash=e,this.metadataHash=t}catch(t){throw new Error(`Failed to hash metadata: ${t}. Please use a dict that can be serialized using json.`)}this.hash_=this._hashStringToUUID(this.contentHash+this.metadataHash),this.uid||(this.uid=this.hash_)}toDocument(){return new Rs({pageContent:this.pageContent,metadata:this.metadata})}static fromDocument(r,e){const t=new this({pageContent:r.pageContent,metadata:r.metadata,uid:e||r.uid});return t.calculateHashes(),t}_hashStringToUUID(r){const e=this.keyEncoder(r);return Ts(e,xp)}_hashNestedDictToUUID(r){const e=JSON.stringify(r,Object.keys(r).sort()),t=this.keyEncoder(e);return Ts(t,xp)}};function dw(r,e){const t=[];let n=[];return e.forEach(a=>{n.push(a),n.length>=r&&(t.push(n),n=[])}),n.length>0&&t.push(n),t}function hw(r){const e=new Set,t=[];for(const n of r){if(!n.hash_)throw new Error("Hashed document does not have a hash");e.has(n.hash_)||(e.add(n.hash_),t.push(n))}return t}function fw(r){if(r===null)return e=>null;if(typeof r=="string")return e=>e.metadata[r];if(typeof r=="function")return r;throw new Error(`sourceIdKey should be null, a string or a function, got ${typeof r}`)}const pw=r=>"load"in r&&typeof r.load=="function"&&"loadAndSplit"in r&&typeof r.loadAndSplit=="function";async function yO(r){const{docsSource:e,recordManager:t,vectorStore:n,options:a}=r,{batchSize:s=100,cleanup:i,sourceIdKey:o,cleanupBatchSize:u=1e3,forceUpdate:l=!1}=a??{};if(i==="incremental"&&!o)throw new Error("sourceIdKey is required when cleanup mode is incremental. Please provide through 'options.sourceIdKey'.");const c=pw(e)?await e.load():e,d=fw(o??null),h=await t.getTime();let f=0,p=0,m=0,v=0;const _=dw(s??100,c);for(const w of _){const E=hw(w.map(V=>cw.fromDocument(V))),F=E.map(V=>d(V));i==="incremental"&&E.forEach((V,G)=>{if(F[G]===null)throw new Error("sourceIdKey must be provided when cleanup is incremental")});const k=await t.exists(E.map(V=>V.uid)),N=[],B=[],A=[],L=new Set;if(E.forEach((V,G)=>{if(k[G])if(l)L.add(V.uid);else{A.push(V.uid);return}N.push(V.uid),B.push(V.toDocument())}),A.length>0&&(await t.update(A,{timeAtLeast:h}),v+=A.length),B.length>0&&(await n.addDocuments(B,{ids:N}),f+=B.length-L.size,m+=L.size),await t.update(E.map(V=>V.uid),{timeAtLeast:h,groupIds:F}),i==="incremental"){F.forEach(G=>{if(!G)throw new Error("Source id cannot be null")});const V=await t.listKeys({before:h,groupIds:F});V.length>0&&(await n.delete({ids:V}),await t.deleteKeys(V),p+=V.length)}}if(i==="full"){let w=await t.listKeys({before:h,limit:u});for(;w.length>0;)await n.delete({ids:w}),await t.deleteKeys(w),p+=w.length,w=await t.listKeys({before:h,limit:u})}return{numAdded:f,numDeleted:p,numUpdated:m,numSkipped:v}}var mw={};Xe(mw,{RecordManager:()=>gO,UUIDV5_NAMESPACE:()=>xp,_HashedDocument:()=>cw,_batch:()=>dw,_deduplicateInOrder:()=>hw,_getSourceIdAssigner:()=>fw,_isBaseDocumentLoader:()=>pw,index:()=>yO});var Mo={},h_;function vO(){if(h_)return Mo;h_=1,Mo.byteLength=o,Mo.toByteArray=l,Mo.fromByteArray=h;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=n.length;a<s;++a)r[a]=n[a],e[n.charCodeAt(a)]=a;e[45]=62,e[95]=63;function i(f){var p=f.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=f.indexOf("=");m===-1&&(m=p);var v=m===p?0:4-m%4;return[m,v]}function o(f){var p=i(f),m=p[0],v=p[1];return(m+v)*3/4-v}function u(f,p,m){return(p+m)*3/4-m}function l(f){var p,m=i(f),v=m[0],_=m[1],w=new t(u(f,v,_)),E=0,F=_>0?v-4:v,k;for(k=0;k<F;k+=4)p=e[f.charCodeAt(k)]<<18|e[f.charCodeAt(k+1)]<<12|e[f.charCodeAt(k+2)]<<6|e[f.charCodeAt(k+3)],w[E++]=p>>16&255,w[E++]=p>>8&255,w[E++]=p&255;return _===2&&(p=e[f.charCodeAt(k)]<<2|e[f.charCodeAt(k+1)]>>4,w[E++]=p&255),_===1&&(p=e[f.charCodeAt(k)]<<10|e[f.charCodeAt(k+1)]<<4|e[f.charCodeAt(k+2)]>>2,w[E++]=p>>8&255,w[E++]=p&255),w}function c(f){return r[f>>18&63]+r[f>>12&63]+r[f>>6&63]+r[f&63]}function d(f,p,m){for(var v,_=[],w=p;w<m;w+=3)v=(f[w]<<16&16711680)+(f[w+1]<<8&65280)+(f[w+2]&255),_.push(c(v));return _.join("")}function h(f){for(var p,m=f.length,v=m%3,_=[],w=16383,E=0,F=m-v;E<F;E+=w)_.push(d(f,E,E+w>F?F:E+w));return v===1?(p=f[m-1],_.push(r[p>>2]+r[p<<4&63]+"==")):v===2&&(p=(f[m-2]<<8)+f[m-1],_.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),_.join("")}return Mo}var _O=vO();const bO=Ai(_O);var wO=Object.defineProperty,EO=(r,e,t)=>e in r?wO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xO=(r,e,t)=>(EO(r,e+"",t),t);function SO(r,e){let t=Array.from({length:r.length},(n,a)=>({start:a,end:a+1}));for(;t.length>1;){let n=null;for(let a=0;a<t.length-1;a++){const s=r.slice(t[a].start,t[a+1].end),i=e.get(s.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,a])}if(n!=null){const a=n[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function AO(r,e){return r.length===1?[e.get(r.join(","))]:SO(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function kO(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Sp=class{constructor(r,e){g(this,"specialTokens");g(this,"inverseSpecialTokens");g(this,"patStr");g(this,"textEncoder",new TextEncoder);g(this,"textDecoder",new TextDecoder("utf-8"));g(this,"rankMap",new Map);g(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,a)=>{const[s,i,...o]=a.split(" "),u=Number.parseInt(i,10);return o.forEach((l,c)=>n[l]=u+c),n},{});for(const[n,a]of Object.entries(t)){const s=bO.toByteArray(n);this.rankMap.set(s.join(","),a),this.textMap.set(a,s)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[a,s])=>(n[s]=this.textEncoder.encode(a),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),a=Sp.specialTokenRegex(Object.keys(this.specialTokens)),s=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!i.has(l)):t);if(o.size>0){const l=Sp.specialTokenRegex([...o]),c=r.match(l);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let u=0;for(;;){let l=null,c=u;for(;a.lastIndex=c,l=a.exec(r),!(l==null||i.has(l[0]));)c=l.index+1;const d=(l==null?void 0:l.index)??r.length;for(const f of r.substring(u,d).matchAll(n)){const p=this.textEncoder.encode(f[0]),m=this.rankMap.get(p.join(","));if(m!=null){s.push(m);continue}s.push(...AO(p,this.rankMap))}if(l==null)break;let h=this.specialTokens[l[0]];s.push(h),u=l.index+l[0].length}return s}decode(r){const e=[];let t=0;for(let s=0;s<r.length;++s){const i=r[s],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}const n=new Uint8Array(t);let a=0;for(const s of e)n.set(s,a),a+=s.length;return this.textDecoder.decode(n)}},gw=Sp;xO(gw,"specialTokenRegex",r=>new RegExp(r.map(e=>kO(e)).join("|"),"g"));function CO(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":return"o200k_base";default:throw new Error("Unknown model")}}var yw={};Xe(yw,{encodingForModel:()=>vg,getEncoding:()=>vw});const Ol={},TO=new Vu({});async function vw(r){return r in Ol||(Ol[r]=TO.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new gw(e)).catch(e=>{throw delete Ol[r],e})),await Ol[r]}async function vg(r){return vw(CO(r))}var _w={};Xe(_w,{BaseLangChain:()=>_g,BaseLanguageModel:()=>bg,calculateMaxTokens:()=>IO,getEmbeddingContextSize:()=>FO,getModelContextSize:()=>bw,getModelNameForTiktoken:()=>F0,isOpenAITool:()=>NO});const F0=r=>r.startsWith("gpt-5")?"gpt-5":r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r,FO=r=>{switch(r){case"text-embedding-ada-002":return 8191;default:return 2046}},bw=r=>{switch(F0(r)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":return 128e3;case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"code-cushman-001":return 2048;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6;case"gemini-pro":case"gemini-pro-vision":return 32768;default:return 4097}};function NO(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const IO=async({prompt:r,modelName:e})=>{let t;try{t=(await vg(F0(e))).encode(r).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(r.length/4)}return bw(e)-t},OO=()=>!1;var _g=class extends At{constructor(e){super(e);g(this,"verbose");g(this,"callbacks");g(this,"tags");g(this,"metadata");this.verbose=e.verbose??OO(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}get lc_attributes(){return{callbacks:void 0,verbose:void 0}}},bg=class extends _g{constructor({callbacks:e,callbackManager:t,...n}){const{cache:a,...s}=n;super({callbacks:e??t,...s});g(this,"caller");g(this,"cache");g(this,"_encoding");typeof a=="object"?this.cache=a:a?this.cache=Q2.global():this.cache=void 0,this.caller=new Vu(n??{})}get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(a=>typeof a=="string"?a:a.type==="text"&&"text"in a?a.text:"").join("");let n=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await vg("modelName"in this?F0(this.modelName):"gpt2")}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}if(this._encoding)try{n=this._encoding.encode(t).length}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new hg(e):Array.isArray(e)?new fg(e.map(Oa)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}get profile(){return{}}},Eu=class extends At{constructor(e){super(e);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"lc_serializable",!0);g(this,"func");e&&(this.func=e.func)}static lc_name(){return"RunnablePassthrough"}async invoke(e,t){const n=Tt(t);return this.func&&await this.func(e,n),this._callWithConfig(a=>Promise.resolve(a),e,n)}async*transform(e,t){const n=Tt(t);let a,s=!0;for await(const i of this._transformStreamWithConfig(e,o=>o,n))if(yield i,s)if(a===void 0)a=i;else try{a=qs(a,i)}catch{a=void 0,s=!1}this.func&&a!==void 0&&await this.func(a,n)}static assign(e){return new ug(new Co({steps:e}))}};const RO=r=>r();function hf(r){const e=r.constructor;return new e({...r,content:r.contentBlocks,response_metadata:{...r.response_metadata,output_version:"v1"}})}var ww={};Xe(ww,{BaseChatModel:()=>Gu,SimpleChatModel:()=>DO});function ff(r){const e=[];for(const t of r){let n=t;if(Array.isArray(t.content))for(let a=0;a<t.content.length;a++){const s=t.content[a];(Im(s)||Om(s))&&n===t&&(n=new t.constructor({...n,content:[...t.content.slice(0,a),Ab(s),...t.content.slice(a+1)]}))}e.push(n)}return e}var Gu=class oi extends bg{constructor(t){super(t);g(this,"lc_namespace",["langchain","chat_models",this._llmType()]);g(this,"disableStreaming",!1);g(this,"outputVersion");this.outputVersion=RO(()=>{const n=t.outputVersion??Xa("LC_OUTPUT_VERSION");return n&&["v0","v1"].includes(n)?n:"v0"})}get callKeys(){return[...super.callKeys,"outputVersion"]}_separateRunnableConfigFromCallOptionsCompat(t){const[n,a]=super._separateRunnableConfigFromCallOptions(t);return a.signal=n.signal,[n,a]}async invoke(t,n){const a=oi._convertInputToPromptValue(t);return(await this.generatePrompt([a],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(t,n,a){throw new Error("Not implemented.")}async*_streamIterator(t,n){var a;if(this._streamResponseChunks===oi.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(t,n);else{const i=oi._convertInputToPromptValue(t).toChatMessages(),[o,u]=this._separateRunnableConfigFromCallOptionsCompat(n),l={...o.metadata,...this.getLsParams(u)},c=await tn.configure(o.callbacks,this.callbacks,o.tags,this.tags,l,this.metadata,{verbose:this.verbose}),d={options:u,invocation_params:this==null?void 0:this.invocationParams(u),batch_size:1},h=u.outputVersion??this.outputVersion,f=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[ff(i)],o.runId,void 0,d,void 0,void 0,o.runName));let p,m;try{for await(const v of this._streamResponseChunks(i,u,f==null?void 0:f[0])){if(v.message.id==null){const _=(a=f==null?void 0:f.at(0))==null?void 0:a.runId;_!=null&&v.message._updateId(`run-${_}`)}v.message.response_metadata={...v.generationInfo,...v.message.response_metadata},h==="v1"?yield hf(v.message):yield v.message,p?p=p.concat(v):p=v,Zf(v.message)&&v.message.usage_metadata!==void 0&&(m={tokenUsage:{promptTokens:v.message.usage_metadata.input_tokens,completionTokens:v.message.usage_metadata.output_tokens,totalTokens:v.message.usage_metadata.total_tokens}})}}catch(v){throw await Promise.all((f??[]).map(_=>_==null?void 0:_.handleLLMError(v))),v}await Promise.all((f??[]).map(v=>v==null?void 0:v.handleLLMEnd({generations:[[p]],llmOutput:m})))}}getLsParams(t){const n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:t.stop,ls_provider:n}}async _generateUncached(t,n,a,s){var f,p;const i=t.map(m=>m.map(Oa));let o;if(s!==void 0&&s.length===i.length)o=s;else{const m={...a.metadata,...this.getLsParams(n)},v=await tn.configure(a.callbacks,this.callbacks,a.tags,this.tags,m,this.metadata,{verbose:this.verbose}),_={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1};o=await(v==null?void 0:v.handleChatModelStart(this.toJSON(),i.map(ff),a.runId,void 0,_,void 0,void 0,a.runName))}const u=n.outputVersion??this.outputVersion,l=[],c=[];if(!!(o!=null&&o[0].handlers.find(qm))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==oi.prototype._streamResponseChunks)try{const m=await this._streamResponseChunks(i[0],n,o==null?void 0:o[0]);let v,_;for await(const w of m){if(w.message.id==null){const E=(f=o==null?void 0:o.at(0))==null?void 0:f.runId;E!=null&&w.message._updateId(`run-${E}`)}v===void 0?v=w:v=qs(v,w),Zf(w.message)&&w.message.usage_metadata!==void 0&&(_={tokenUsage:{promptTokens:w.message.usage_metadata.input_tokens,completionTokens:w.message.usage_metadata.output_tokens,totalTokens:w.message.usage_metadata.total_tokens}})}if(v===void 0)throw new Error("Received empty response from chat model call.");l.push([v]),await(o==null?void 0:o[0].handleLLMEnd({generations:l,llmOutput:_}))}catch(m){throw await(o==null?void 0:o[0].handleLLMError(m)),m}else{const m=await Promise.allSettled(i.map(async(v,_)=>{const w=await this._generate(v,{...n,promptIndex:_},o==null?void 0:o[_]);if(u==="v1")for(const E of w.generations)E.message=hf(E.message);return w}));await Promise.all(m.map(async(v,_)=>{var w,E,F;if(v.status==="fulfilled"){const k=v.value;for(const N of k.generations){if(N.message.id==null){const B=(w=o==null?void 0:o.at(0))==null?void 0:w.runId;B!=null&&N.message._updateId(`run-${B}`)}N.message.response_metadata={...N.generationInfo,...N.message.response_metadata}}return k.generations.length===1&&(k.generations[0].message.response_metadata={...k.llmOutput,...k.generations[0].message.response_metadata}),l[_]=k.generations,c[_]=k.llmOutput,(E=o==null?void 0:o[_])==null?void 0:E.handleLLMEnd({generations:[k.generations],llmOutput:k.llmOutput})}else return await((F=o==null?void 0:o[_])==null?void 0:F.handleLLMError(v.reason)),Promise.reject(v.reason)}))}const h={generations:l,llmOutput:c.length?(p=this._combineLLMOutput)==null?void 0:p.call(this,...c):void 0};return Object.defineProperty(h,yu,{value:o?{runIds:o==null?void 0:o.map(m=>m.runId)}:void 0,configurable:!0}),h}async _generateCached({messages:t,cache:n,llmStringKey:a,parsedOptions:s,handledOptions:i}){const o=t.map(w=>w.map(Oa)),u={...i.metadata,...this.getLsParams(s)},l=await tn.configure(i.callbacks,this.callbacks,i.tags,this.tags,u,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},d=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),o.map(ff),i.runId,void 0,c,void 0,void 0,i.runName)),h=[],p=(await Promise.allSettled(o.map(async(w,E)=>{const F=oi._convertInputToPromptValue(w).toString(),k=await n.lookup(F,a);return k==null&&h.push(E),k}))).map((w,E)=>({result:w,runManager:d==null?void 0:d[E]})).filter(({result:w})=>w.status==="fulfilled"&&w.value!=null||w.status==="rejected"),m=s.outputVersion??this.outputVersion,v=[];await Promise.all(p.map(async({result:w,runManager:E},F)=>{if(w.status==="fulfilled"){const k=w.value;return v[F]=k.map(N=>("message"in N&&$r(N.message)&&Lm(N.message)&&(N.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},m==="v1"&&(N.message=hf(N.message))),N.generationInfo={...N.generationInfo,tokenUsage:{}},N)),k.length&&await(E==null?void 0:E.handleLLMNewToken(k[0].text)),E==null?void 0:E.handleLLMEnd({generations:[k]},void 0,void 0,void 0,{cached:!0})}else return await(E==null?void 0:E.handleLLMError(w.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(w.reason)}));const _={generations:v,missingPromptIndices:h,startedRunManagers:d};return Object.defineProperty(_,yu,{value:d?{runIds:d==null?void 0:d.map(w=>w.runId)}:void 0,configurable:!0}),_}async generate(t,n,a){let s;Array.isArray(n)?s={stop:n}:s=n;const i=t.map(m=>m.map(Oa)),[o,u]=this._separateRunnableConfigFromCallOptionsCompat(s);if(o.callbacks=o.callbacks??a,!this.cache)return this._generateUncached(i,u,o);const{cache:l}=this,c=this._getSerializedCacheKeyParametersForCall(u),{generations:d,missingPromptIndices:h,startedRunManagers:f}=await this._generateCached({messages:i,cache:l,llmStringKey:c,parsedOptions:u,handledOptions:o});let p={};if(h.length>0){const m=await this._generateUncached(h.map(v=>i[v]),u,o,f!==void 0?h.map(v=>f==null?void 0:f[v]):void 0);await Promise.all(m.generations.map(async(v,_)=>{const w=h[_];d[w]=v;const E=oi._convertInputToPromptValue(i[w]).toString();return l.update(E,c,v)})),p=m.llmOutput??{}}return{generations:d,llmOutput:p}}invocationParams(t){return{}}_modelType(){return"base_chat_model"}async generatePrompt(t,n,a){const s=t.map(i=>i.toChatMessages());return this.generate(s,n,a)}withStructuredOutput(t,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n!=null&&n.strict)throw new Error('"strict" mode is not supported for this model by default.');const a=t,s=n==null?void 0:n.name,i=vu(a)??"A function available to call.",o=n==null?void 0:n.method,u=n==null?void 0:n.includeRaw;if(o==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",c;ko(a)?c=[{type:"function",function:{name:l,description:i,parameters:mn(a)}}]:("name"in a&&(l=a.name),c=[{type:"function",function:{name:l,description:i,parameters:a}}]);const d=this.bindTools(c),h=fs.from(v=>{if(!ca.isInstance(v))throw new Error("Input is not an AIMessageChunk.");if(!v.tool_calls||v.tool_calls.length===0)throw new Error("No tool calls found in the response.");const _=v.tool_calls.find(w=>w.name===l);if(!_)throw new Error(`No tool call found with name ${l}.`);return _.args});if(!u)return d.pipe(h).withConfig({runName:"StructuredOutput"});const f=Eu.assign({parsed:(v,_)=>h.invoke(v.raw,_)}),p=Eu.assign({parsed:()=>null}),m=f.withFallbacks({fallbacks:[p]});return Zs.from([{raw:d},m]).withConfig({runName:"StructuredOutputRunnable"})}},DO=class extends Gu{async _generate(r,e,t){const n=await this._call(r,e,t),a=new Hr(n);if(typeof a.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:a.content,message:a}]}}},Ew={};Xe(Ew,{BaseLLM:()=>xw,LLM:()=>wg});var xw=class Ho extends bg{constructor(){super(...arguments);g(this,"lc_namespace",["langchain","llms",this._llmType()])}async invoke(t,n){const a=Ho._convertInputToPromptValue(t);return(await this.generatePrompt([a],n,n==null?void 0:n.callbacks)).generations[0][0].text}async*_streamResponseChunks(t,n,a){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(t){const[n,a]=super._separateRunnableConfigFromCallOptions(t);return a.signal=n.signal,[n,a]}async*_streamIterator(t,n){if(this._streamResponseChunks===Ho.prototype._streamResponseChunks)yield this.invoke(t,n);else{const a=Ho._convertInputToPromptValue(t),[s,i]=this._separateRunnableConfigFromCallOptionsCompat(n),o=await tn.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),u={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1},l=await(o==null?void 0:o.handleLLMStart(this.toJSON(),[a.toString()],s.runId,void 0,u,void 0,void 0,s.runName));let c=new ao({text:""});try{for await(const d of this._streamResponseChunks(a.toString(),i,l==null?void 0:l[0]))c?c=c.concat(d):c=d,typeof d.text=="string"&&(yield d.text)}catch(d){throw await Promise.all((l??[]).map(h=>h==null?void 0:h.handleLLMError(d))),d}await Promise.all((l??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[c]]})))}}async generatePrompt(t,n,a){const s=t.map(i=>i.toString());return this.generate(s,n,a)}invocationParams(t){return{}}_flattenLLMResult(t){const n=[];for(let a=0;a<t.generations.length;a+=1){const s=t.generations[a];if(a===0)n.push({generations:[s],llmOutput:t.llmOutput});else{const i=t.llmOutput?{...t.llmOutput,tokenUsage:{}}:void 0;n.push({generations:[s],llmOutput:i})}}return n}async _generateUncached(t,n,a,s){let i;if(s!==void 0&&s.length===t.length)i=s;else{const c=await tn.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),d={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:t.length};i=await(c==null?void 0:c.handleLLMStart(this.toJSON(),t,a.runId,void 0,d,void 0,void 0,a==null?void 0:a.runName))}const o=!!(i!=null&&i[0].handlers.find(qm));let u;if(o&&t.length===1&&this._streamResponseChunks!==Ho.prototype._streamResponseChunks)try{const c=await this._streamResponseChunks(t[0],n,i==null?void 0:i[0]);let d;for await(const h of c)d===void 0?d=h:d=qs(d,h);if(d===void 0)throw new Error("Received empty response from chat model call.");u={generations:[[d]],llmOutput:{}},await(i==null?void 0:i[0].handleLLMEnd(u))}catch(c){throw await(i==null?void 0:i[0].handleLLMError(c)),c}else{try{u=await this._generate(t,n,i==null?void 0:i[0])}catch(d){throw await Promise.all((i??[]).map(h=>h==null?void 0:h.handleLLMError(d))),d}const c=this._flattenLLMResult(u);await Promise.all((i??[]).map((d,h)=>d==null?void 0:d.handleLLMEnd(c[h])))}const l=(i==null?void 0:i.map(c=>c.runId))||void 0;return Object.defineProperty(u,yu,{value:l?{runIds:l}:void 0,configurable:!0}),u}async _generateCached({prompts:t,cache:n,llmStringKey:a,parsedOptions:s,handledOptions:i,runId:o}){const u=await tn.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:t.length},c=await(u==null?void 0:u.handleLLMStart(this.toJSON(),t,o,void 0,l,void 0,void 0,i==null?void 0:i.runName)),d=[],f=(await Promise.allSettled(t.map(async(v,_)=>{const w=await n.lookup(v,a);return w==null&&d.push(_),w}))).map((v,_)=>({result:v,runManager:c==null?void 0:c[_]})).filter(({result:v})=>v.status==="fulfilled"&&v.value!=null||v.status==="rejected"),p=[];await Promise.all(f.map(async({result:v,runManager:_},w)=>{if(v.status==="fulfilled"){const E=v.value;return p[w]=E.map(F=>(F.generationInfo={...F.generationInfo,tokenUsage:{}},F)),E.length&&await(_==null?void 0:_.handleLLMNewToken(E[0].text)),_==null?void 0:_.handleLLMEnd({generations:[E]},void 0,void 0,void 0,{cached:!0})}else return await(_==null?void 0:_.handleLLMError(v.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(v.reason)}));const m={generations:p,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(m,yu,{value:c?{runIds:c==null?void 0:c.map(v=>v.runId)}:void 0,configurable:!0}),m}async generate(t,n,a){if(!Array.isArray(t))throw new Error("Argument 'prompts' is expected to be a string[]");let s;Array.isArray(n)?s={stop:n}:s=n;const[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??a,!this.cache)return this._generateUncached(t,o,i);const{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({prompts:t,cache:u,llmStringKey:l,parsedOptions:o,handledOptions:i,runId:i.runId});let f={};if(d.length>0){const p=await this._generateUncached(d.map(m=>t[m]),o,i,h!==void 0?d.map(m=>h==null?void 0:h[m]):void 0);await Promise.all(p.generations.map(async(m,v)=>{const _=d[v];return c[_]=m,u.update(t[_],l,m)})),f=p.llmOutput??{}}return{generations:c,llmOutput:f}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},wg=class extends xw{async _generate(r,e,t){return{generations:await Promise.all(r.map((a,s)=>this._call(a,{...e,promptIndex:s},t).then(i=>[{text:i}])))}}},BO={},Sw={};Xe(Sw,{BaseDocumentCompressor:()=>MO});var MO=class{static isBaseDocumentCompressor(r){return(r==null?void 0:r.compressDocuments)!==void 0}},Zu=class extends At{constructor(e){super(e);g(this,"lc_serializable",!0);g(this,"lc_namespace",["langchain_core","prompts",this._getPromptType()]);g(this,"inputVariables");g(this,"outputParser");g(this,"partialVariables");g(this,"metadata");g(this,"tags");const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}get lc_attributes(){return{partialVariables:void 0}}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},n={};for(const[s,i]of Object.entries(t))typeof i=="string"?n[s]=i:n[s]=await i();return{...n,...e}}async invoke(e,t){const n={...this.metadata,...t==null?void 0:t.metadata},a=[...this.tags??[],...(t==null?void 0:t.tags)??[]];return this._callWithConfig(s=>this.formatPromptValue(s),e,{...t,tags:a,metadata:n,runType:"prompt"})}},xu=class extends Zu{async formatPromptValue(r){const e=await this.format(r);return new hg(e)}};/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var $O=Object.prototype.toString,To=Array.isArray||function(e){return $O.call(e)==="[object Array]"};function Eg(r){return typeof r=="function"}function PO(r){return To(r)?"array":typeof r}function pf(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function f_(r,e){return r!=null&&typeof r=="object"&&e in r}function LO(r,e){return r!=null&&typeof r!="object"&&r.hasOwnProperty&&r.hasOwnProperty(e)}var zO=RegExp.prototype.test;function UO(r,e){return zO.call(r,e)}var jO=/\S/;function qO(r){return!UO(jO,r)}var HO={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function VO(r){return String(r).replace(/[&<>"'`=\/]/g,function(t){return HO[t]})}var GO=/\s*/,ZO=/\s+/,p_=/\s*=/,KO=/\s*\}/,WO=/#|\^|\/|>|\{|&|=|!/;function YO(r,e){if(!r)return[];var t=!1,n=[],a=[],s=[],i=!1,o=!1,u="",l=0;function c(){if(i&&!o)for(;s.length;)delete a[s.pop()];else s=[];i=!1,o=!1}var d,h,f;function p(A){if(typeof A=="string"&&(A=A.split(ZO,2)),!To(A)||A.length!==2)throw new Error("Invalid tags: "+A);d=new RegExp(pf(A[0])+"\\s*"),h=new RegExp("\\s*"+pf(A[1])),f=new RegExp("\\s*"+pf("}"+A[1]))}p(e||bn.tags);for(var m=new Ku(r),v,_,w,E,F,k;!m.eos();){if(v=m.pos,w=m.scanUntil(d),w)for(var N=0,B=w.length;N<B;++N)E=w.charAt(N),qO(E)?(s.push(a.length),u+=E):(o=!0,t=!0,u+=" "),a.push(["text",E,v,v+1]),v+=1,E===`
`&&(c(),u="",l=0,t=!1);if(!m.scan(d))break;if(i=!0,_=m.scan(WO)||"name",m.scan(GO),_==="="?(w=m.scanUntil(p_),m.scan(p_),m.scanUntil(h)):_==="{"?(w=m.scanUntil(f),m.scan(KO),m.scanUntil(h),_="&"):w=m.scanUntil(h),!m.scan(h))throw new Error("Unclosed tag at "+m.pos);if(_==">"?F=[_,w,v,m.pos,u,l,t]:F=[_,w,v,m.pos],l++,a.push(F),_==="#"||_==="^")n.push(F);else if(_==="/"){if(k=n.pop(),!k)throw new Error('Unopened section "'+w+'" at '+v);if(k[1]!==w)throw new Error('Unclosed section "'+k[1]+'" at '+v)}else _==="name"||_==="{"||_==="&"?o=!0:_==="="&&p(w)}if(c(),k=n.pop(),k)throw new Error('Unclosed section "'+k[1]+'" at '+m.pos);return XO(JO(a))}function JO(r){for(var e=[],t,n,a=0,s=r.length;a<s;++a)t=r[a],t&&(t[0]==="text"&&n&&n[0]==="text"?(n[1]+=t[1],n[3]=t[3]):(e.push(t),n=t));return e}function XO(r){for(var e=[],t=e,n=[],a,s,i=0,o=r.length;i<o;++i)switch(a=r[i],a[0]){case"#":case"^":t.push(a),n.push(a),t=a[4]=[];break;case"/":s=n.pop(),s[5]=a[2],t=n.length>0?n[n.length-1][4]:e;break;default:t.push(a)}return e}function Ku(r){this.string=r,this.tail=r,this.pos=0}Ku.prototype.eos=function(){return this.tail===""};Ku.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};Ku.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n};function co(r,e){this.view=r,this.cache={".":this.view},this.parent=e}co.prototype.push=function(e){return new co(e,this)};co.prototype.lookup=function(e){var t=this.cache,n;if(t.hasOwnProperty(e))n=t[e];else{for(var a=this,s,i,o,u=!1;a;){if(e.indexOf(".")>0)for(s=a.view,i=e.split("."),o=0;s!=null&&o<i.length;)o===i.length-1&&(u=f_(s,i[o])||LO(s,i[o])),s=s[i[o++]];else s=a.view[e],u=f_(a.view,e);if(u){n=s;break}a=a.parent}t[e]=n}return Eg(n)&&(n=n.call(this.view)),n};function an(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}an.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};an.prototype.parse=function(e,t){var n=this.templateCache,a=e+":"+(t||bn.tags).join(":"),s=typeof n<"u",i=s?n.get(a):void 0;return i==null&&(i=YO(e,t),s&&n.set(a,i)),i};an.prototype.render=function(e,t,n,a){var s=this.getConfigTags(a),i=this.parse(e,s),o=t instanceof co?t:new co(t,void 0);return this.renderTokens(i,o,n,e,a)};an.prototype.renderTokens=function(e,t,n,a,s){for(var i="",o,u,l,c=0,d=e.length;c<d;++c)l=void 0,o=e[c],u=o[0],u==="#"?l=this.renderSection(o,t,n,a,s):u==="^"?l=this.renderInverted(o,t,n,a,s):u===">"?l=this.renderPartial(o,t,n,s):u==="&"?l=this.unescapedValue(o,t):u==="name"?l=this.escapedValue(o,t,s):u==="text"&&(l=this.rawValue(o)),l!==void 0&&(i+=l);return i};an.prototype.renderSection=function(e,t,n,a,s){var i=this,o="",u=t.lookup(e[1]);function l(h){return i.render(h,t,n,s)}if(u){if(To(u))for(var c=0,d=u.length;c<d;++c)o+=this.renderTokens(e[4],t.push(u[c]),n,a,s);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),n,a,s);else if(Eg(u)){if(typeof a!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,a.slice(e[3],e[5]),l),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,n,a,s);return o}};an.prototype.renderInverted=function(e,t,n,a,s){var i=t.lookup(e[1]);if(!i||To(i)&&i.length===0)return this.renderTokens(e[4],t,n,a,s)};an.prototype.indentPartial=function(e,t,n){for(var a=t.replace(/[^ \t]/g,""),s=e.split(`
`),i=0;i<s.length;i++)s[i].length&&(i>0||!n)&&(s[i]=a+s[i]);return s.join(`
`)};an.prototype.renderPartial=function(e,t,n,a){if(n){var s=this.getConfigTags(a),i=Eg(n)?n(e[1]):n[e[1]];if(i!=null){var o=e[6],u=e[5],l=e[4],c=i;u==0&&l&&(c=this.indentPartial(i,l,o));var d=this.parse(c,s);return this.renderTokens(d,t,n,c,a)}}};an.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(n!=null)return n};an.prototype.escapedValue=function(e,t,n){var a=this.getConfigEscape(n)||bn.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&a===bn.escape?String(s):a(s)};an.prototype.rawValue=function(e){return e[1]};an.prototype.getConfigTags=function(e){return To(e)?e:e&&typeof e=="object"?e.tags:void 0};an.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!To(e))return e.escape};var bn={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(r){Su.templateCache=r},get templateCache(){return Su.templateCache}},Su=new an;bn.clearCache=function(){return Su.clearCache()};bn.parse=function(e,t){return Su.parse(e,t)};bn.render=function(e,t,n,a){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+PO(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Su.render(e,t,n,a)};bn.escape=VO;bn.Scanner=Ku;bn.Context=co;bn.Writer=an;function Aw(){bn.escape=r=>r}const Au=r=>{const e=r.split(""),t=[],n=(s,i)=>{for(let o=i;o<e.length;o+=1)if(s.includes(e[o]))return o;return-1};let a=0;for(;a<e.length;)if(e[a]==="{"&&a+1<e.length&&e[a+1]==="{")t.push({type:"literal",text:"{"}),a+=2;else if(e[a]==="}"&&a+1<e.length&&e[a+1]==="}")t.push({type:"literal",text:"}"}),a+=2;else if(e[a]==="{"){const s=n("}",a);if(s<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(a+1,s).join("")}),a=s+1}else{if(e[a]==="}")throw new Error("Single '}' in template.");{const s=n("{}",a),i=(s<0?e.slice(a):e.slice(a,s)).join("");t.push({type:"literal",text:i}),a=s<0?e.length:s}}return t},kw=(r,e=[])=>{const t=[];for(const n of r)if(n[0]==="name"){const a=n[1].includes(".")?n[1].split(".")[0]:n[1];t.push({type:"variable",name:a})}else if(["#","&","^",">"].includes(n[0])){if(t.push({type:"variable",name:n[1]}),n[0]==="#"&&n.length>4&&Array.isArray(n[4])){const a=[...e,n[1]],s=kw(n[4],a);t.push(...s)}}else t.push({type:"literal",text:n[1]});return t},Dc=r=>{Aw();const e=bn.parse(r);return kw(e)},Cw=(r,e)=>Au(r).reduce((t,n)=>{if(n.type==="variable"){if(n.name in e){const a=typeof e[n.name]=="string"?e[n.name]:JSON.stringify(e[n.name]);return t+a}throw new Error(`(f-string) Missing value for input ${n.name}`)}return t+n.text},""),Tw=(r,e)=>(Aw(),bn.render(r,e)),Bc={"f-string":Cw,mustache:Tw},Fw={"f-string":Au,mustache:Dc},la=(r,e,t)=>{try{return Bc[e](r,t)}catch(n){throw l0(n,"INVALID_PROMPT_INPUT")}},Mc=(r,e)=>Fw[e](r),Wu=(r,e,t)=>{if(!(e in Bc)){const n=Object.keys(Bc);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${n}`)}try{const n=t.reduce((a,s)=>(a[s]="foo",a),{});Array.isArray(r)?r.forEach(a=>{if(a.type==="text"&&"text"in a&&typeof a.text=="string")la(a.text,e,n);else if(a.type==="image_url"){if(typeof a.image_url=="string")la(a.image_url,e,n);else if(typeof a.image_url=="object"&&a.image_url!==null&&"url"in a.image_url&&typeof a.image_url.url=="string"){const s=a.image_url.url;la(s,e,n)}}else throw new Error(`Invalid message template received. ${JSON.stringify(a,null,2)}`)}):la(r,e,n)}catch(n){throw new Error(`Invalid prompt schema: ${n.message}`)}};var Ds=class Vo extends xu{constructor(t){super(t);g(this,"template");g(this,"templateFormat","f-string");g(this,"validateTemplate",!0);g(this,"additionalContentFields");if(t.templateFormat==="mustache"&&t.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,t),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Wu(this.template,this.templateFormat,n)}}static lc_name(){return"PromptTemplate"}_getPromptType(){return"prompt"}async format(t){const n=await this.mergePartialAndUserVariables(t);return la(this.template,this.templateFormat,n)}static fromExamples(t,n,a,s=`

`,i=""){const o=[i,...t,n].join(s);return new Vo({inputVariables:a,template:o})}static fromTemplate(t,n){const{templateFormat:a="f-string",...s}=n??{},i=new Set;return Mc(t,a).forEach(o=>{o.type==="variable"&&i.add(o.name)}),new Vo({inputVariables:[...i],templateFormat:a,template:t,...s})}async partial(t){const n=this.inputVariables.filter(i=>!(i in t)),a={...this.partialVariables??{},...t},s={...this,inputVariables:n,partialVariables:a};return new Vo(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(t){if(!t.template)throw new Error("Prompt template must have a template");return new Vo({inputVariables:t.input_variables,template:t.template,templateFormat:t.template_format})}},Ql=class Nw extends Zu{constructor(t){super(t);g(this,"lc_namespace",["langchain_core","prompts","image"]);g(this,"template");g(this,"templateFormat","f-string");g(this,"validateTemplate",!0);g(this,"additionalContentFields");if(this.template=t.template,this.templateFormat=t.templateFormat??this.templateFormat,this.validateTemplate=t.validateTemplate??this.validateTemplate,this.additionalContentFields=t.additionalContentFields,this.validateTemplate){let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Wu([{type:"image_url",image_url:this.template}],this.templateFormat,n)}}static lc_name(){return"ImagePromptTemplate"}_getPromptType(){return"prompt"}async partial(t){const n=this.inputVariables.filter(i=>!(i in t)),a={...this.partialVariables??{},...t},s={...this,inputVariables:n,partialVariables:a};return new Nw(s)}async format(t){const n={};for(const[o,u]of Object.entries(this.template))typeof u=="string"?n[o]=la(u,this.templateFormat,t):n[o]=u;const a=t.url||n.url,s=t.detail||n.detail;if(!a)throw new Error("Must provide either an image URL.");if(typeof a!="string")throw new Error("url must be a string.");const i={url:a};return s&&(i.detail=s),i}async formatPromptValue(t){const n=await this.format(t);return new H2(n)}},Ap=class extends At{constructor(e){const t=e.templateFormat??"f-string",n=kp(e.template,t);super({inputVariables:n,...e});g(this,"lc_namespace",["langchain_core","prompts","dict"]);g(this,"lc_serializable",!0);g(this,"template");g(this,"templateFormat");g(this,"inputVariables");this.template=e.template,this.templateFormat=t,this.inputVariables=n}static lc_name(){return"DictPromptTemplate"}async format(e){return Cp(this.template,e,this.templateFormat)}async invoke(e){return await this._callWithConfig(this.format.bind(this),e,{runType:"prompt"})}};function kp(r,e){const t=[];for(const n of Object.values(r))if(typeof n=="string")Mc(n,e).forEach(a=>{a.type==="variable"&&t.push(a.name)});else if(Array.isArray(n))for(const a of n)typeof a=="string"?Mc(a,e).forEach(s=>{s.type==="variable"&&t.push(s.name)}):typeof a=="object"&&t.push(...kp(a,e));else typeof n=="object"&&n!==null&&t.push(...kp(n,e));return Array.from(new Set(t))}function Cp(r,e,t){const n={};for(const[a,s]of Object.entries(r))if(typeof s=="string")n[a]=la(s,t,e);else if(Array.isArray(s)){const i=[];for(const o of s)typeof o=="string"?i.push(la(o,t,e)):typeof o=="object"&&i.push(Cp(o,e,t));n[a]=i}else typeof s=="object"&&s!==null?n[a]=Cp(s,e,t):n[a]=s;return n}var N0=class extends At{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","prompts","chat"]);g(this,"lc_serializable",!0)}async invoke(e,t){return this._callWithConfig(n=>this.formatMessages(n),e,{...t,runType:"prompt"})}},Tp=class extends N0{constructor(e){typeof e=="string"&&(e={variableName:e});super(e);g(this,"variableName");g(this,"optional");this.variableName=e.variableName,this.optional=e.optional??!1}static lc_name(){return"MessagesPlaceholder"}get inputVariables(){return[this.variableName]}async formatMessages(e){const t=e[this.variableName];if(this.optional&&!t)return[];if(!t){const a=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw a.name="InputFormatError",a}let n;try{Array.isArray(t)?n=t.map(Oa):n=[Oa(t)]}catch(a){const s=typeof t=="string"?t:JSON.stringify(t,null,2),i=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${s}`,`Additional message: ${a.message}`].join(`

`));throw i.name="InputFormatError",i.lc_error_code=a.lc_error_code,i}return n}},Iw=class extends N0{constructor(e){"prompt"in e||(e={prompt:e});super(e);g(this,"prompt");this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},xg=class extends Zu{constructor(r){super(r)}async format(r){return(await this.formatPromptValue(r)).toString()}async formatPromptValue(r){const e=await this.formatMessages(r);return new fg(e)}},Ow=class extends Iw{constructor(e,t){"prompt"in e||(e={prompt:e,role:t});super(e);g(this,"role");this.role=e.role}static lc_name(){return"ChatMessagePromptTemplate"}async format(e){return new Ti(await this.prompt.format(e),this.role)}static fromTemplate(e,t,n){return new this(Ds.fromTemplate(e,{templateFormat:n==null?void 0:n.templateFormat}),t)}};function QO(r){return r===null||typeof r!="object"||Array.isArray(r)?!1:Object.keys(r).length===1&&"text"in r&&typeof r.text=="string"}function eR(r){return r===null||typeof r!="object"||Array.isArray(r)?!1:"image_url"in r&&(typeof r.image_url=="string"||typeof r.image_url=="object"&&r.image_url!==null&&"url"in r.image_url&&typeof r.image_url.url=="string")}var Sg=class extends N0{constructor(e,t){"prompt"in e||(e={prompt:e});super(e);g(this,"lc_namespace",["langchain_core","prompts","chat"]);g(this,"lc_serializable",!0);g(this,"inputVariables",[]);g(this,"additionalOptions",{});g(this,"prompt");g(this,"messageClass");g(this,"chatMessageClass");if(this.prompt=e.prompt,Array.isArray(this.prompt)){let n=[];this.prompt.forEach(a=>{"inputVariables"in a&&(n=n.concat(a.inputVariables))}),this.inputVariables=n}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}createMessage(e){const t=this.constructor;if(t._messageClass()){const n=t._messageClass();return new n({content:e})}else if(t.chatMessageClass){const n=t.chatMessageClass();return new n({content:e,role:this.getRoleFromMessageClass(n.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(Ds.fromTemplate(e,t));const n=[];for(const a of e)if(typeof a=="string")n.push(Ds.fromTemplate(a,t));else if(a!==null)if(QO(a)){let s="";typeof a.text=="string"&&(s=a.text??"");const i={...t,additionalContentFields:a};n.push(Ds.fromTemplate(s,i))}else if(eR(a)){let s=a.image_url??"",i,o=[];if(typeof s=="string"){let u;(t==null?void 0:t.templateFormat)==="mustache"?u=Dc(s):u=Au(s);const l=u.flatMap(c=>c.type==="variable"?[c.name]:[]);if(((l==null?void 0:l.length)??0)>0){if(l.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${l}
From: ${s}`);o=[l[0]]}else o=[];s={url:s},i=new Ql({template:s,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:a})}else if(typeof s=="object"){if("url"in s){let u;(t==null?void 0:t.templateFormat)==="mustache"?u=Dc(s.url):u=Au(s.url),o=u.flatMap(l=>l.type==="variable"?[l.name]:[])}else o=[];i=new Ql({template:s,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:a})}else throw new Error("Invalid image template");n.push(i)}else typeof a=="object"&&n.push(new Ap({template:a,templateFormat:t==null?void 0:t.templateFormat}));return new this({prompt:n,additionalOptions:t})}async format(e){if(this.prompt instanceof xu){const t=await this.prompt.format(e);return this.createMessage(t)}else{const t=[];for(const n of this.prompt){let a={};if(!("inputVariables"in n))throw new Error(`Prompt ${n} does not have inputVariables defined.`);for(const s of n.inputVariables)a||(a={[s]:e[s]}),a={...a,[s]:e[s]};if(n instanceof xu){const s=await n.format(a);let i;"additionalContentFields"in n&&(i=n.additionalContentFields),s!==""&&t.push({...i,type:"text",text:s})}else if(n instanceof Ql){const s=await n.format(a);let i;"additionalContentFields"in n&&(i=n.additionalContentFields),t.push({...i,type:"image_url",image_url:s})}else if(n instanceof Ap){const s=await n.format(a);let i;"additionalContentFields"in n&&(i=n.additionalContentFields),t.push({...i,...s})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}},Ag=class extends Sg{static _messageClass(){return Gn}static lc_name(){return"HumanMessagePromptTemplate"}},Rw=class extends Sg{static _messageClass(){return Hr}static lc_name(){return"AIMessagePromptTemplate"}},Dw=class extends Sg{static _messageClass(){return is}static lc_name(){return"SystemMessagePromptTemplate"}};function tR(r){return typeof r.formatMessages=="function"}function rR(r,e){if(tR(r)||$r(r))return r;if(Array.isArray(r)&&r[0]==="placeholder"){const a=r[1];if((e==null?void 0:e.templateFormat)==="mustache"&&typeof a=="string"&&a.slice(0,2)==="{{"&&a.slice(-2)==="}}"){const s=a.slice(2,-2);return new Tp({variableName:s,optional:!0})}else if(typeof a=="string"&&a[0]==="{"&&a[a.length-1]==="}"){const s=a.slice(1,-1);return new Tp({variableName:s,optional:!0})}throw new Error(`Invalid placeholder template for format ${(e==null?void 0:e.templateFormat)??'"f-string"'}: "${r[1]}". Expected a variable name surrounded by ${(e==null?void 0:e.templateFormat)==="mustache"?"double":"single"} curly braces.`)}const t=Oa(r);let n;if(typeof t.content=="string"?n=t.content:n=t.content.map(a=>"text"in a?{...a,text:a.text}:"image_url"in a?{...a,image_url:a.image_url}:a),t._getType()==="human")return Ag.fromTemplate(n,e);if(t._getType()==="ai")return Rw.fromTemplate(n,e);if(t._getType()==="system")return Dw.fromTemplate(n,e);if(Ti.isInstance(t))return Ow.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function nR(r){return r.constructor.lc_name()==="MessagesPlaceholder"}var kg=class ec extends xg{constructor(t){super(t);g(this,"promptMessages");g(this,"validateTemplate",!0);g(this,"templateFormat","f-string");if(t.templateFormat==="mustache"&&t.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,t),this.validateTemplate){const n=new Set;for(const u of this.promptMessages)if(!(u instanceof jn))for(const l of u.inputVariables)n.add(l);const a=this.inputVariables,s=new Set(this.partialVariables?a.concat(Object.keys(this.partialVariables)):a),i=new Set([...s].filter(u=>!n.has(u)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are not used in any of the prompt messages.`);const o=new Set([...n].filter(u=>!s.has(u)));if(o.size>0)throw new Error(`Input variables \`${[...o]}\` are used in prompt messages but not in the prompt template.`)}}static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}_getPromptType(){return"chat"}async _parseImagePrompts(t,n){if(typeof t.content=="string")return t;const a=await Promise.all(t.content.map(async s=>{if(s.type!=="image_url")return s;let i="";typeof s.image_url=="string"?i=s.image_url:typeof s.image_url=="object"&&s.image_url!==null&&"url"in s.image_url&&typeof s.image_url.url=="string"&&(i=s.image_url.url);const u=await Ds.fromTemplate(i,{templateFormat:this.templateFormat}).format(n);return typeof s.image_url=="object"&&s.image_url!==null&&"url"in s.image_url?s.image_url.url=u:s.image_url=u,s}));return t.content=a,t}async formatMessages(t){const n=await this.mergePartialAndUserVariables(t);let a=[];for(const s of this.promptMessages)if(s instanceof jn)a.push(await this._parseImagePrompts(s,n));else{let i;this.templateFormat==="mustache"?i={...n}:i=s.inputVariables.reduce((u,l)=>{if(!(l in n)&&!(nR(s)&&s.optional))throw l0(new Error(`Missing value for input variable \`${l.toString()}\``),"INVALID_PROMPT_INPUT");return u[l]=n[l],u},{});const o=await s.formatMessages(i);a=a.concat(o)}return a}async partial(t){const n=this.inputVariables.filter(i=>!(i in t)),a={...this.partialVariables??{},...t},s={...this,inputVariables:n,partialVariables:a};return new ec(s)}static fromTemplate(t,n){const a=Ds.fromTemplate(t,n),s=new Ag({prompt:a});return this.fromMessages([s])}static fromMessages(t,n){const a=t.reduce((o,u)=>o.concat(u instanceof ec?u.promptMessages:[rR(u,n)]),[]),s=t.reduce((o,u)=>u instanceof ec?Object.assign(o,u.partialVariables):o,Object.create(null)),i=new Set;for(const o of a)if(!(o instanceof jn))for(const u of o.inputVariables)u in s||i.add(u);return new this({...n,inputVariables:[...i],promptMessages:a,partialVariables:s,templateFormat:n==null?void 0:n.templateFormat})}},aR=class Fp extends xu{constructor(t){super(t);g(this,"lc_serializable",!1);g(this,"examples");g(this,"exampleSelector");g(this,"examplePrompt");g(this,"suffix","");g(this,"exampleSeparator",`

`);g(this,"prefix","");g(this,"templateFormat","f-string");g(this,"validateTemplate",!0);if(Object.assign(this,t),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Wu(this.prefix+this.suffix,this.templateFormat,n)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(t){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(t);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(t){const n=this.inputVariables.filter(i=>!(i in t)),a={...this.partialVariables??{},...t},s={...this,inputVariables:n,partialVariables:a};return new Fp(s)}async format(t){const n=await this.mergePartialAndUserVariables(t),a=await this.getExamples(n),s=await Promise.all(a.map(o=>this.examplePrompt.format(o))),i=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return la(i,this.templateFormat,n)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(t){const{example_prompt:n}=t;if(!n)throw new Error("Missing example prompt");const a=await Ds.deserialize(n);let s;if(Array.isArray(t.examples))s=t.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new Fp({inputVariables:t.input_variables,examplePrompt:a,examples:s,exampleSeparator:t.example_separator,prefix:t.prefix,suffix:t.suffix,templateFormat:t.template_format})}},sR=class Bw extends xg{constructor(t){super(t);g(this,"lc_serializable",!0);g(this,"examples");g(this,"exampleSelector");g(this,"examplePrompt");g(this,"suffix","");g(this,"exampleSeparator",`

`);g(this,"prefix","");g(this,"templateFormat","f-string");g(this,"validateTemplate",!0);if(this.examples=t.examples,this.examplePrompt=t.examplePrompt,this.exampleSeparator=t.exampleSeparator??`

`,this.exampleSelector=t.exampleSelector,this.prefix=t.prefix??"",this.suffix=t.suffix??"",this.templateFormat=t.templateFormat??"f-string",this.validateTemplate=t.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Wu(this.prefix+this.suffix,this.templateFormat,n)}}_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}async getExamples(t){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(t);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(t){const n=await this.mergePartialAndUserVariables(t);let a=await this.getExamples(n);a=a.map(i=>{const o={};return this.examplePrompt.inputVariables.forEach(u=>{o[u]=i[u]}),o});const s=[];for(const i of a){const o=await this.examplePrompt.formatMessages(i);s.push(...o)}return s}async format(t){const n=await this.mergePartialAndUserVariables(t),a=await this.getExamples(n),i=(await Promise.all(a.map(u=>this.examplePrompt.formatMessages(u)))).flat().map(u=>u.content),o=[this.prefix,...i,this.suffix].join(this.exampleSeparator);return la(o,this.templateFormat,n)}async partial(t){const n=this.inputVariables.filter(i=>!(i in t)),a={...this.partialVariables??{},...t},s={...this,inputVariables:n,partialVariables:a};return new Bw(s)}},iR=class tc extends Zu{constructor(t){super({...t,inputVariables:[]});g(this,"pipelinePrompts");g(this,"finalPrompt");this.pipelinePrompts=t.pipelinePrompts,this.finalPrompt=t.finalPrompt,this.inputVariables=this.computeInputValues()}static lc_name(){return"PipelinePromptTemplate"}computeInputValues(){const t=this.pipelinePrompts.map(a=>a.name),n=this.pipelinePrompts.map(a=>a.prompt.inputVariables.filter(s=>!t.includes(s))).flat();return[...new Set(n)]}static extractRequiredInputValues(t,n){return n.reduce((a,s)=>(a[s]=t[s],a),{})}async formatPipelinePrompts(t){const n=await this.mergePartialAndUserVariables(t);for(const{name:a,prompt:s}of this.pipelinePrompts){const i=tc.extractRequiredInputValues(n,s.inputVariables);s instanceof kg?n[a]=await s.formatMessages(i):n[a]=await s.format(i)}return tc.extractRequiredInputValues(n,this.finalPrompt.inputVariables)}async formatPromptValue(t){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(t))}async format(t){return this.finalPrompt.format(await this.formatPipelinePrompts(t))}async partial(t){const n={...this};return n.inputVariables=this.inputVariables.filter(a=>!(a in t)),n.partialVariables={...this.partialVariables??{},...t},new tc(n)}serialize(){throw new Error("Not implemented.")}_getPromptType(){return"pipeline"}};function m_(r){return typeof r=="object"&&r!=null&&"withStructuredOutput"in r&&typeof r.withStructuredOutput=="function"}function oR(r){return typeof r=="object"&&r!=null&&"lc_id"in r&&Array.isArray(r.lc_id)&&r.lc_id.join("/")==="langchain_core/runnables/RunnableBinding"}var uR=class Mw extends kg{constructor(t){super(t);g(this,"schema");g(this,"method");g(this,"lc_namespace",["langchain_core","prompts","structured"]);this.schema=t.schema,this.method=t.method}get lc_aliases(){return{...super.lc_aliases,schema:"schema_"}}pipe(t){if(m_(t))return super.pipe(t.withStructuredOutput(this.schema));if(oR(t)&&m_(t.bound))return super.pipe(new Gs({bound:t.bound.withStructuredOutput(this.schema,...this.method?[{method:this.method}]:[]),kwargs:t.kwargs??{},config:t.config,configFactories:t.configFactories}));throw new Error('Structured prompts need to be piped to a language model that supports the "withStructuredOutput()" method.')}static fromMessagesAndSchema(t,n,a){return Mw.fromMessages(t,{schema:n,method:a})}},$w={};Xe($w,{AIMessagePromptTemplate:()=>Rw,BaseChatPromptTemplate:()=>xg,BaseMessagePromptTemplate:()=>N0,BaseMessageStringPromptTemplate:()=>Iw,BasePromptTemplate:()=>Zu,BaseStringPromptTemplate:()=>xu,ChatMessagePromptTemplate:()=>Ow,ChatPromptTemplate:()=>kg,DEFAULT_FORMATTER_MAPPING:()=>Bc,DEFAULT_PARSER_MAPPING:()=>Fw,DictPromptTemplate:()=>Ap,FewShotChatMessagePromptTemplate:()=>sR,FewShotPromptTemplate:()=>aR,HumanMessagePromptTemplate:()=>Ag,ImagePromptTemplate:()=>Ql,MessagesPlaceholder:()=>Tp,PipelinePromptTemplate:()=>iR,PromptTemplate:()=>Ds,StructuredPrompt:()=>uR,SystemMessagePromptTemplate:()=>Dw,checkValidTemplate:()=>Wu,interpolateFString:()=>Cw,interpolateMustache:()=>Tw,parseFString:()=>Au,parseMustache:()=>Dc,parseTemplate:()=>Mc,renderTemplate:()=>la});var lR=class extends At{constructor(e){super(e);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"lc_serializable",!0);g(this,"runnables");this.runnables=e.runnables}static lc_name(){return"RouterRunnable"}async invoke(e,t){const{key:n,input:a}=e,s=this.runnables[n];if(s===void 0)throw new Error(`No runnable associated with key "${n}".`);return s.invoke(a,Tt(t))}async batch(e,t,n){var h;const a=e.map(f=>f.key),s=e.map(f=>f.input);if(a.find(f=>this.runnables[f]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const o=a.map(f=>this.runnables[f]),u=this._getOptionsList(t??{},e.length),l=((h=u[0])==null?void 0:h.maxConcurrency)??(n==null?void 0:n.maxConcurrency),c=l&&l>0?l:e.length,d=[];for(let f=0;f<s.length;f+=c){const p=s.slice(f,f+c).map((v,_)=>o[_].invoke(v,u[_])),m=await Promise.all(p);d.push(m)}return d.flat()}async stream(e,t){const{key:n,input:a}=e,s=this.runnables[n];if(s===void 0)throw new Error(`No runnable associated with key "${n}".`);return s.stream(a,t)}},cR=class extends At{constructor(e){super(e);g(this,"lc_namespace",["langchain_core","runnables"]);g(this,"lc_serializable",!0);g(this,"default");g(this,"branches");this.branches=e.branches,this.default=e.default}static lc_name(){return"RunnableBranch"}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const n=e.slice(0,-1).map(([s,i])=>[Pr(s),Pr(i)]),a=Pr(e[e.length-1]);return new this({branches:n,default:a})}async _invoke(e,t,n){let a;for(let s=0;s<this.branches.length;s+=1){const[i,o]=this.branches[s];if(await i.invoke(e,Pt(t,{callbacks:n==null?void 0:n.getChild(`condition:${s+1}`)}))){a=await o.invoke(e,Pt(t,{callbacks:n==null?void 0:n.getChild(`branch:${s+1}`)}));break}}return a||(a=await this.default.invoke(e,Pt(t,{callbacks:n==null?void 0:n.getChild("branch:default")}))),a}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async*_streamIterator(e,t){const n=await yn(t),a=await(n==null?void 0:n.handleChainStart(this.toJSON(),Cr(e,"input"),t==null?void 0:t.runId,void 0,void 0,void 0,t==null?void 0:t.runName));let s,i=!0,o;try{for(let u=0;u<this.branches.length;u+=1){const[l,c]=this.branches[u];if(await l.invoke(e,Pt(t,{callbacks:a==null?void 0:a.getChild(`condition:${u+1}`)}))){o=await c.stream(e,Pt(t,{callbacks:a==null?void 0:a.getChild(`branch:${u+1}`)}));for await(const h of o)if(yield h,i)if(s===void 0)s=h;else try{s=qs(s,h)}catch{s=void 0,i=!1}break}}if(o===void 0){o=await this.default.stream(e,Pt(t,{callbacks:a==null?void 0:a.getChild("branch:default")}));for await(const u of o)if(yield u,i)if(s===void 0)s=u;else try{s=qs(s,u)}catch{s=void 0,i=!1}}}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}await(a==null?void 0:a.handleChainEnd(s??{}))}},dR=class extends Gs{constructor(e){let t=fs.from((i,o)=>this._enterHistory(i,o??{})).withConfig({runName:"loadHistory"});const n=e.historyMessagesKey??e.inputMessagesKey;n&&(t=Eu.assign({[n]:t}).withConfig({runName:"insertHistory"}));const a=t.pipe(e.runnable.withListeners({onEnd:(i,o)=>this._exitHistory(i,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),s=e.config??{};super({...e,config:s,bound:a});g(this,"runnable");g(this,"inputMessagesKey");g(this,"outputMessagesKey");g(this,"historyMessagesKey");g(this,"getMessageHistory");this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if(typeof e=="object"&&!Array.isArray(e)&&!$r(e)){let n;this.inputMessagesKey?n=this.inputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="input",Array.isArray(e[n])&&Array.isArray(e[n][0])?t=e[n][0]:t=e[n]}else t=e;if(typeof t=="string")return[new Gn(t)];if(Array.isArray(t))return t;if($r(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(!Array.isArray(e)&&!$r(e)&&typeof e!="string"){let n;this.outputMessagesKey!==void 0?n=this.outputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="output",e.generations!==void 0?t=e.generations[0][0].message:t=e[n]}else t=e;if(typeof t=="string")return[new Hr(t)];if(Array.isArray(t))return t;if($r(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){var s;const a=await((s=t==null?void 0:t.configurable)==null?void 0:s.messageHistory).getMessages();return this.historyMessagesKey===void 0?a.concat(this._getInputMessages(e)):a}async _exitHistory(e,t){var u;const n=(u=t.configurable)==null?void 0:u.messageHistory;let a;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?a=e.inputs[0]:a=e.inputs;let s=this._getInputMessages(a);if(this.historyMessagesKey===void 0){const l=await n.getMessages();s=s.slice(l.length)}const i=e.outputs;if(!i)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const o=this._getOutputMessages(i);await n.addMessages([...s,...o])}async _mergeConfig(...e){const t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){const a={[this.inputMessagesKey??"input"]:"foo"},s={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(a)}, ${JSON.stringify(s)})`)}const{sessionId:n}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(n),t}},Pw={};Xe(Pw,{RouterRunnable:()=>lR,Runnable:()=>At,RunnableAssign:()=>ug,RunnableBinding:()=>Gs,RunnableBranch:()=>cR,RunnableEach:()=>$I,RunnableLambda:()=>fs,RunnableMap:()=>Co,RunnableParallel:()=>zI,RunnablePassthrough:()=>Eu,RunnablePick:()=>D2,RunnableRetry:()=>og,RunnableSequence:()=>Zs,RunnableToolLike:()=>Ep,RunnableWithFallbacks:()=>R2,RunnableWithMessageHistory:()=>dR,_coerceToRunnable:()=>Pr,ensureConfig:()=>Tt,getCallbackManagerForConfig:()=>yn,mergeConfigs:()=>Un,patchConfig:()=>Pt,pickRunnableConfigKeys:()=>os,raceWithSignal:()=>us});var Lw={};Xe(Lw,{applyPatch:()=>no,compare:()=>b0});var I0=class extends At{parseResultWithPrompt(r,e,t){return this.parseResult(r,t)}_baseMessageToString(r){return typeof r.content=="string"?r.content:this._baseMessageContentToString(r.content)}_baseMessageContentToString(r){return JSON.stringify(r)}async invoke(r,e){return typeof r=="string"?this._callWithConfig(async(t,n)=>this.parseResult([{text:t}],n==null?void 0:n.callbacks),r,{...e,runType:"parser"}):this._callWithConfig(async(t,n)=>this.parseResult([{message:t,text:this._baseMessageToString(t)}],n==null?void 0:n.callbacks),r,{...e,runType:"parser"})}},Yu=class extends I0{parseResult(r,e){return this.parse(r[0].text,e)}async parseWithPrompt(r,e,t){return this.parse(r,t)}_type(){throw new Error("_type not implemented")}},es=class extends Error{constructor(e,t,n,a=!1){super(e);g(this,"llmOutput");g(this,"observation");g(this,"sendToLLM");if(this.llmOutput=t,this.observation=n,this.sendToLLM=a,a&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");l0(this,"OUTPUT_PARSING_FAILURE")}},Ju=class extends Yu{async*_transform(r){for await(const e of r)typeof e=="string"?yield this.parseResult([{text:e}]):yield this.parseResult([{message:e,text:this._baseMessageToString(e)}])}async*transform(r,e){yield*this._transformStreamWithConfig(r,this._transform.bind(this),{...e,runType:"parser"})}},Xu=class extends Ju{constructor(e){super(e);g(this,"diff",!1);this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const a of e){if(typeof a!="string"&&typeof a.content!="string")throw new Error("Cannot handle non-string output.");let s;if(fu(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");s=new so({message:a,text:a.content})}else if($r(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");s=new so({message:wc(a),text:a.content})}else s=new ao({text:a});n===void 0?n=s:n=n.concat(s);const i=await this.parsePartialResult([n]);i!=null&&!mi(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}},hR=class extends Xu{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","output_parsers"]);g(this,"lc_serializable",!0)}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?b0(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Gf(e[0].text)}async parse(e){return Gf(e,JSON.parse)}getFormatInstructions(){return""}};function zw(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=eo(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(a){throw new es([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${a.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function fR(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function pR(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}var Uw=class extends Xu{constructor(e){super(e);g(this,"returnId",!1);g(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);g(this,"lc_serializable",!0);this.returnId=(e==null?void 0:e.returnId)??this.returnId}static lc_name(){return"JsonOutputToolsParser"}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var i;const n=e[0].message;let a;if(Lm(n)&&((i=n.tool_calls)!=null&&i.length)?a=n.tool_calls.map(o=>{const{id:u,...l}=o;return this.returnId?{id:u,...l}:l}):n.additional_kwargs.tool_calls!==void 0&&(a=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(u=>zw(u,{returnId:this.returnId,partial:t}))),!a)return[];const s=[];for(const o of a)if(o!==void 0){const u={type:o.name,args:o.args,id:o.id};s.push(u)}return s}},mR=class extends Uw{constructor(e){super(e);g(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);g(this,"lc_serializable",!0);g(this,"returnId",!1);g(this,"keyName");g(this,"returnSingle",!1);g(this,"zodSchema");this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}static lc_name(){return"JsonOutputKeyToolsParser"}async _validateResult(e){var n;if(this.zodSchema===void 0)return e;const t=await t2(this.zodSchema,e);if(t.success)return t.data;throw new es(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify((n=t.error)==null?void 0:n.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(s=>s.type===this.keyName);let a=n;if(n.length)return this.returnId||(a=n.map(s=>s.args)),this.returnSingle?a[0]:a}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName);let a=n;return n.length?(this.returnId||(a=n.map(i=>i.args)),this.returnSingle?this._validateResult(a[0]):await Promise.all(a.map(i=>this._validateResult(i)))):void 0}},jw={};Xe(jw,{JsonOutputKeyToolsParser:()=>mR,JsonOutputToolsParser:()=>Uw,convertLangChainToolCallToOpenAI:()=>fR,makeInvalidToolCall:()=>pR,parseToolCall:()=>zw});var gR={},qw={};Xe(qw,{RunCollectorCallbackHandler:()=>yR});var yR=class extends hs{constructor({exampleId:e}={}){super({_awaitHandler:!0});g(this,"name","run_collector");g(this,"exampleId");g(this,"tracedRuns");this.exampleId=e,this.tracedRuns=[]}async persistRun(e){const t={...e};t.reference_example_id=this.exampleId,this.tracedRuns.push(t)}},Hw=class extends I0{constructor(e){super();g(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);g(this,"lc_serializable",!0);g(this,"argsOnly",!0);this.argsOnly=(e==null?void 0:e.argsOnly)??this.argsOnly}static lc_name(){return"OutputFunctionsParser"}async parseResult(e){if("message"in e[0]){const n=e[0].message.additional_kwargs.function_call;if(!n)throw new Error(`No function_call in message ${JSON.stringify(e)}`);if(!n.arguments)throw new Error(`No arguments in function_call ${JSON.stringify(e)}`);return this.argsOnly?n.arguments:JSON.stringify(n)}else throw new Error(`No message in generations ${JSON.stringify(e)}`)}},Vw=class extends Xu{constructor(e){super(e);g(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);g(this,"lc_serializable",!0);g(this,"outputParser");g(this,"argsOnly",!0);this.argsOnly=(e==null?void 0:e.argsOnly)??this.argsOnly,this.outputParser=new Hw(e)}static lc_name(){return"JsonOutputFunctionsParser"}_diff(e,t){return t?b0(e??{},t):void 0}async parsePartialResult(e){const t=e[0];if(!t.message)return;const{message:n}=t,a=n.additional_kwargs.function_call;if(a)return this.argsOnly?eo(a.arguments):{...a,arguments:eo(a.arguments)}}async parseResult(e){const t=await this.outputParser.parseResult(e);if(!t)throw new Error(`No result from "OutputFunctionsParser" ${JSON.stringify(e)}`);return this.parse(t)}async parse(e){const t=JSON.parse(e);return this.argsOnly||(t.arguments=JSON.parse(t.arguments)),t}getFormatInstructions(){return""}},vR=class extends I0{constructor(e){super(e);g(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);g(this,"lc_serializable",!0);g(this,"outputParser",new Vw);g(this,"attrName");this.attrName=e.attrName}static lc_name(){return"JsonKeyOutputFunctionsParser"}get lc_aliases(){return{attrName:"key_name"}}async parseResult(e){return(await this.outputParser.parseResult(e))[this.attrName]}},Gw={};Xe(Gw,{JsonKeyOutputFunctionsParser:()=>vR,JsonOutputFunctionsParser:()=>Vw,OutputFunctionsParser:()=>Hw});var Zw={};Xe(Zw,{chunkArray:()=>_R});const _R=(r,e)=>r.reduce((t,n,a)=>{const s=Math.floor(a/e),i=t[s]||[];return t[s]=i.concat([n]),t},[]);function Cg(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function Tg(r){return r!==void 0&&At.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function Fg(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&(ko(r.schema)||r.schema!=null&&typeof r.schema=="object"&&"type"in r.schema&&typeof r.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(r.schema.type))}function Ng(r){return Fg(r)||Tg(r)||Cg(r)}var Kw={};Xe(Kw,{convertToOpenAIFunction:()=>Ww,convertToOpenAITool:()=>bR,isLangChainTool:()=>Ng,isRunnableToolLike:()=>Tg,isStructuredTool:()=>Cg,isStructuredToolParams:()=>Fg});function Ww(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:mn(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function bR(r,e){const t=typeof e=="number"?void 0:e;let n;return Ng(r)?n={type:"function",function:Ww(r)}:n=r,(t==null?void 0:t.strict)!==void 0&&(n.function.strict=t.strict),n}const Ns={and:"and",or:"or",not:"not"},St={eq:"eq",ne:"ne",lt:"lt",gt:"gt",lte:"lte",gte:"gte"};var Yw=class{},Ig=class{accept(r){if(this.exprName==="Operation")return r.visitOperation(this);if(this.exprName==="Comparison")return r.visitComparison(this);if(this.exprName==="StructuredQuery")return r.visitStructuredQuery(this);throw new Error("Unknown Expression type")}},Og=class extends Ig{},wR=class extends Og{constructor(e,t,n){super();g(this,"exprName","Comparison");this.comparator=e,this.attribute=t,this.value=n}},ER=class extends Og{constructor(e,t){super();g(this,"exprName","Operation");this.operator=e,this.args=t}},xR=class extends Ig{constructor(e,t){super();g(this,"exprName","StructuredQuery");this.query=e,this.filter=t}};function Jw(r){return r&&typeof r=="object"&&!Array.isArray(r)}function ia(r){return r?typeof r=="string"&&r.length>0||typeof r=="function"?!1:Jw(r)&&Object.keys(r).length===0:!0}function Xw(r){if(typeof r=="number")return r%1===0;if(typeof r=="string"){const e=parseInt(r,10);return!Number.isNaN(e)&&e%1===0&&e.toString()===r}return!1}function Qw(r){if(typeof r=="number")return r%1!==0;if(typeof r=="string"){const e=parseFloat(r);return!Number.isNaN(e)&&e%1!==0&&e.toString()===r}return!1}function e8(r){return typeof r=="string"&&(Number.isNaN(parseFloat(r))||parseFloat(r).toString()!==r)}function t8(r){return typeof r=="boolean"}function Rg(r){let e;if(e8(r))e=r;else if(Xw(r))e=parseInt(r,10);else if(Qw(r))e=parseFloat(r);else if(t8(r))e=!!r;else throw new Error("Unsupported value type");return e}var Dg=class extends Yw{},SR=class extends Dg{constructor(e){super();g(this,"allowedOperators");g(this,"allowedComparators");this.allowedOperators=(e==null?void 0:e.allowedOperators)??[Ns.and,Ns.or],this.allowedComparators=(e==null?void 0:e.allowedComparators)??[St.eq,St.ne,St.gt,St.gte,St.lt,St.lte]}formatFunction(e){if(e in St){if(this.allowedComparators.length>0&&this.allowedComparators.indexOf(e)===-1)throw new Error(`Comparator ${e} not allowed. Allowed comparators: ${this.allowedComparators.join(", ")}`)}else if(e in Ns){if(this.allowedOperators.length>0&&this.allowedOperators.indexOf(e)===-1)throw new Error(`Operator ${e} not allowed. Allowed operators: ${this.allowedOperators.join(", ")}`)}else throw new Error("Unknown comparator or operator");return`$${e}`}visitOperation(e){var n;const t=(n=e.args)==null?void 0:n.map(a=>a.accept(this));return{[this.formatFunction(e.operator)]:t}}visitComparison(e){return{[e.attribute]:{[this.formatFunction(e.comparator)]:Rg(e.value)}}}visitStructuredQuery(e){let t={};return e.filter&&(t={filter:e.filter.accept(this)}),t}mergeFilters(e,t,n="and",a=!1){if(!(ia(e)&&ia(t))){if(ia(e)||n==="replace")return ia(t)?void 0:t;if(ia(t))return a?e:n==="and"?void 0:e;if(n==="and")return{$and:[e,t]};if(n==="or")return{$or:[e,t]};throw new Error("Unknown merge type")}}},AR=class extends Dg{constructor(){super(...arguments);g(this,"allowedOperators",[Ns.and,Ns.or]);g(this,"allowedComparators",[St.eq,St.ne,St.gt,St.gte,St.lt,St.lte])}formatFunction(){throw new Error("Not implemented")}getAllowedComparatorsForType(e){switch(e){case"string":return[St.eq,St.ne,St.gt,St.gte,St.lt,St.lte];case"number":return[St.eq,St.ne,St.gt,St.gte,St.lt,St.lte];case"boolean":return[St.eq,St.ne];default:throw new Error(`Unsupported data type: ${e}`)}}getComparatorFunction(e){switch(e){case St.eq:return(t,n)=>t===n;case St.ne:return(t,n)=>t!==n;case St.gt:return(t,n)=>t>n;case St.gte:return(t,n)=>t>=n;case St.lt:return(t,n)=>t<n;case St.lte:return(t,n)=>t<=n;default:throw new Error("Unknown comparator")}}getOperatorFunction(e){switch(e){case Ns.and:return(t,n)=>t&&n;case Ns.or:return(t,n)=>t||n;default:throw new Error("Unknown operator")}}visitOperation(e){const{operator:t,args:n}=e;if(this.allowedOperators.includes(t)){const a=this.getOperatorFunction(t);return s=>n?n.reduce((i,o)=>{const u=o.accept(this);if(typeof u=="function")return a(i,u(s));throw new Error("Filter is not a function")},!0):!0}else throw new Error("Operator not allowed")}visitComparison(e){const{comparator:t,attribute:n,value:a}=e,s=[St.ne];if(this.allowedComparators.includes(t)){if(!this.getAllowedComparatorsForType(typeof a).includes(t))throw new Error(`'${t}' comparator not allowed to be used with ${typeof a}`);const i=this.getComparatorFunction(t);return o=>{const u=o.metadata[n];return u===void 0?!!s.includes(t):i(u,Rg(a))}}else throw new Error("Comparator not allowed")}visitStructuredQuery(e){var n;if(!e.filter)return{};const t=(n=e.filter)==null?void 0:n.accept(this);if(typeof t!="function")throw new Error("Structured query filter is not a function");return{filter:t}}mergeFilters(e,t,n="and"){if(!(ia(e)&&ia(t))){if(ia(e)||n==="replace")return ia(t)?void 0:t;if(ia(t))return n==="and"?void 0:e;if(n==="and")return a=>e(a)&&t(a);if(n==="or")return a=>e(a)||t(a);throw new Error("Unknown merge type")}}},r8={};Xe(r8,{BaseTranslator:()=>Dg,BasicTranslator:()=>SR,Comparators:()=>St,Comparison:()=>wR,Expression:()=>Ig,FilterDirective:()=>Og,FunctionalTranslator:()=>AR,Operation:()=>ER,Operators:()=>Ns,StructuredQuery:()=>xR,Visitor:()=>Yw,castValue:()=>Rg,isBoolean:()=>t8,isFilterEmpty:()=>ia,isFloat:()=>Qw,isInt:()=>Xw,isObject:()=>Jw,isString:()=>e8});var n8={};Xe(n8,{BaseToolkit:()=>kR,DynamicStructuredTool:()=>i8,DynamicTool:()=>s8,StructuredTool:()=>O0,Tool:()=>a8,ToolInputParsingException:()=>_c,isLangChainTool:()=>Ng,isRunnableToolLike:()=>Tg,isStructuredTool:()=>Cg,isStructuredToolParams:()=>Fg,tool:()=>CR});var O0=class extends _g{constructor(e){super(e??{});g(this,"extras");g(this,"returnDirect",!1);g(this,"verboseParsingErrors",!1);g(this,"responseFormat","content");g(this,"defaultConfig");this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat,this.defaultConfig=(e==null?void 0:e.defaultConfig)??this.defaultConfig,this.metadata=(e==null?void 0:e.metadata)??this.metadata,this.extras=(e==null?void 0:e.extras)??this.extras}get lc_namespace(){return["langchain","tools"]}async invoke(e,t){let n,a=Tt(Un(this.defaultConfig,t));return eu(e)?(n=e.args,a={...a,toolCall:e}):n=e,this.call(n,a)}async call(e,t,n){const a=eu(e)?e.args:e;let s;if(ko(this.schema))try{s=await S0(this.schema,a)}catch(p){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${p.message}`),o2(p)&&(m=`${m}

${yF(p)}`),new _c(m,JSON.stringify(e))}else{const p=rr(a,this.schema);if(!p.valid){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${p.errors.map(v=>`${v.keywordLocation}: ${v.error}`).join(`
`)}`),new _c(m,JSON.stringify(e))}s=a}const i=qu(t),o=tn.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),u=await(o==null?void 0:o.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),i.runId,void 0,void 0,void 0,i.runName));delete i.runId;let l;try{l=await this._call(s,u,i)}catch(p){throw await(u==null?void 0:u.handleToolError(p)),p}let c,d;if(this.responseFormat==="content_and_artifact")if(Array.isArray(l)&&l.length===2)[c,d]=l;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(l)}`);else c=l;let h;eu(e)&&(h=e.id),!h&&yA(i)&&(h=i.toolCall.id);const f=TR({content:c,artifact:d,toolCallId:h,name:this.name,metadata:this.metadata});return await(u==null?void 0:u.handleToolEnd(f)),f}},a8=class extends O0{constructor(e){super(e);g(this,"schema",C0({input:k0().optional()}).transform(e=>e.input))}call(e,t){const n=typeof e=="string"||e==null?{input:e}:e;return super.call(n,t)}},s8=class extends a8{constructor(e){super(e);g(this,"name");g(this,"description");g(this,"func");this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}static lc_name(){return"DynamicTool"}async call(e,t){const n=qu(t);return n.runName===void 0&&(n.runName=this.name),super.call(e,n)}async _call(e,t,n){return this.func(e,t,n)}},i8=class extends O0{constructor(e){super(e);g(this,"name");g(this,"description");g(this,"func");g(this,"schema");this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}static lc_name(){return"DynamicStructuredTool"}async call(e,t,n){const a=qu(t);return a.runName===void 0&&(a.runName=this.name),super.call(e,a,n)}_call(e,t,n){return this.func(e,t,n)}},kR=class{getTools(){return this.tools}};function CR(r,e){var i;const t=rg(e.schema),n=nu(e.schema);if(!e.schema||t||n)return new s8({...e,description:e.description??((i=e.schema)==null?void 0:i.description)??`${e.name} tool`,func:async(o,u,l)=>new Promise((c,d)=>{const h=Pt(l,{callbacks:u==null?void 0:u.getChild()});Or.runWithConfig(os(h),async()=>{try{c(r(o,h))}catch(f){d(f)}})})});const a=e.schema,s=e.description??e.schema.description??`${e.name} tool`;return new i8({...e,description:s,schema:a,func:async(o,u,l)=>new Promise((c,d)=>{let h;const f=()=>{l!=null&&l.signal&&h&&l.signal.removeEventListener("abort",h)};l!=null&&l.signal&&(h=()=>{f(),d(mu(l.signal))},l.signal.addEventListener("abort",h));const p=Pt(l,{callbacks:u==null?void 0:u.getChild()});Or.runWithConfig(os(p),async()=>{var m;try{const v=await r(o,p);if((m=l==null?void 0:l.signal)!=null&&m.aborted){f();return}f(),c(v)}catch(v){f(),d(v)}})})})}function TR(r){const{content:e,artifact:t,toolCallId:n,metadata:a}=r;return n&&!Bm(e)?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new js({status:"success",content:e,artifact:t,tool_call_id:n,name:r.name,metadata:a}):new js({status:"success",content:FR(e),artifact:t,tool_call_id:n,name:r.name,metadata:a}):e}function FR(r){try{return JSON.stringify(r,null,2)??""}catch{return`${r}`}}var NR=class extends Gu{_combineLLMOutput(){return[]}_llmType(){return"fake"}async _generate(r,e,t){var a;if((a=e==null?void 0:e.stop)!=null&&a.length)return{generations:[{message:new Hr(e.stop[0]),text:e.stop[0]}]};const n=r.map(s=>typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2)).join(`
`);return await(t==null?void 0:t.handleLLMNewToken(n)),{generations:[{message:new Hr(n),text:n}],llmOutput:{}}}},IR=class o8 extends Gu{constructor({sleep:t=50,responses:n=[],chunks:a=[],toolStyle:s="openai",thrownErrorString:i,...o}){super(o);g(this,"sleep",50);g(this,"responses",[]);g(this,"chunks",[]);g(this,"toolStyle","openai");g(this,"thrownErrorString");g(this,"tools",[]);this.sleep=t,this.responses=n,this.chunks=a,this.toolStyle=s,this.thrownErrorString=i}_llmType(){return"fake"}bindTools(t){const n=[...this.tools,...t],a=n.map(o=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:o.name,description:o.description,parameters:mn(o.schema)}};case"anthropic":return{name:o.name,description:o.description,input_schema:mn(o.schema)};case"bedrock":return{toolSpec:{name:o.name,description:o.description,inputSchema:mn(o.schema)}};case"google":return{name:o.name,description:o.description,parameters:mn(o.schema)};default:throw new Error(`Unsupported tool style: ${this.toolStyle}`)}}),s=this.toolStyle==="google"?[{functionDeclarations:a}]:a,i=new o8({sleep:this.sleep,responses:this.responses,chunks:this.chunks,toolStyle:this.toolStyle,thrownErrorString:this.thrownErrorString});return i.tools=n,i.withConfig({tools:s})}async _generate(t,n,a){var o,u,l,c;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const s=((u=(o=this.responses)==null?void 0:o[0])==null?void 0:u.content)??t[0].content??"";return{generations:[{text:"",message:new Hr({content:s,tool_calls:(c=(l=this.chunks)==null?void 0:l[0])==null?void 0:c.tool_calls})}]}}async*_streamResponseChunks(t,n,a){var o,u,l;if(this.thrownErrorString)throw new Error(this.thrownErrorString);if((o=this.chunks)!=null&&o.length){for(const c of this.chunks){const d=new so({message:new ca({content:c.content,tool_calls:c.tool_calls,additional_kwargs:c.additional_kwargs??{}}),text:((u=c.content)==null?void 0:u.toString())??""});yield d,await(a==null?void 0:a.handleLLMNewToken(c.content,void 0,void 0,void 0,void 0,{chunk:d}))}return}const s=((l=this.responses)==null?void 0:l[0])??new Hr(typeof t[0].content=="string"?t[0].content:""),i=typeof s.content=="string"?s.content:"";for(const c of i){await new Promise(h=>setTimeout(h,this.sleep));const d=new so({message:new ca({content:c}),text:c});yield d,await(a==null?void 0:a.handleLLMNewToken(c,void 0,void 0,void 0,void 0,{chunk:d}))}}},OR=class u8 extends Gu{constructor(t){super(t);g(this,"lc_serializable",!0);g(this,"responses");g(this,"i",0);g(this,"sleep");g(this,"emitCustomEvent",!1);g(this,"generationInfo");g(this,"tools",[]);g(this,"toolStyle","openai");const{responses:n,sleep:a,emitCustomEvent:s,generationInfo:i}=t;this.responses=n,this.sleep=a,this.emitCustomEvent=s??this.emitCustomEvent,this.generationInfo=i}static lc_name(){return"FakeListChatModel"}_combineLLMOutput(){return[]}_llmType(){return"fake-list"}async _generate(t,n,a){var s;if(await this._sleepIfRequested(),n!=null&&n.thrownErrorString)throw new Error(n.thrownErrorString);if(this.emitCustomEvent&&await(a==null?void 0:a.handleCustomEvent("some_test_event",{someval:!0})),(s=n==null?void 0:n.stop)!=null&&s.length)return{generations:[this._formatGeneration(n.stop[0])]};{const i=this._currentResponse();return this._incrementResponse(),{generations:[this._formatGeneration(i)],llmOutput:{}}}}_formatGeneration(t){return{message:new Hr(t),text:t}}async*_streamResponseChunks(t,n,a){const s=this._currentResponse();this._incrementResponse(),this.emitCustomEvent&&await(a==null?void 0:a.handleCustomEvent("some_test_event",{someval:!0}));const i=[...s];for(let o=0;o<i.length;o++){const u=i[o],l=o===i.length-1;if(await this._sleepIfRequested(),n!=null&&n.thrownErrorString)throw new Error(n.thrownErrorString);yield this._createResponseChunk(u,l?this.generationInfo:void 0),a==null||a.handleLLMNewToken(u)}}async _sleepIfRequested(){this.sleep!==void 0&&await this._sleep()}async _sleep(){return new Promise(t=>{setTimeout(()=>t(),this.sleep)})}_createResponseChunk(t,n){return new so({message:new ca({content:t}),text:t,generationInfo:n})}_currentResponse(){return this.responses[this.i]}_incrementResponse(){this.i<this.responses.length-1?this.i+=1:this.i=0}bindTools(t){const n=[...this.tools,...t],a=n.map(o=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:o.name,description:o.description,parameters:mn(o.schema)}};case"anthropic":return{name:o.name,description:o.description,input_schema:mn(o.schema)};case"bedrock":return{toolSpec:{name:o.name,description:o.description,inputSchema:mn(o.schema)}};case"google":return{name:o.name,description:o.description,parameters:mn(o.schema)};default:throw new Error(`Unsupported tool style: ${this.toolStyle}`)}}),s=this.toolStyle==="google"?[{functionDeclarations:a}]:a,i=new u8({responses:this.responses,sleep:this.sleep,emitCustomEvent:this.emitCustomEvent,generationInfo:this.generationInfo});return i.tools=n,i.toolStyle=this.toolStyle,i.i=this.i,i.withConfig({tools:s})}withStructuredOutput(t,n){return fs.from(async a=>{var i,o;const s=await this.invoke(a);if((o=(i=s.tool_calls)==null?void 0:i[0])!=null&&o.args)return s.tool_calls[0].args;if(typeof s.content=="string")return JSON.parse(s.content);throw new Error("No structured output found")})}},RR=class extends dg{constructor(e){super(e??{});g(this,"vectorSize");this.vectorSize=(e==null?void 0:e.vectorSize)??4}async embedDocuments(e){return Promise.all(e.map(t=>this.embedQuery(t)))}async embedQuery(e){let t=e;t=t.toLowerCase().replaceAll(/[^a-z ]/g,"");const n=t.length%this.vectorSize,a=n===0?0:this.vectorSize-n,s=t.length+a;t=t.padEnd(s," ");const i=t.length/this.vectorSize,o=[];for(let l=0;l<t.length;l+=i)o.push(t.slice(l,l+i));return o.map(l=>{let c=0;for(let h=0;h<l.length;h+=1)c+=l===" "?0:l.charCodeAt(h);return c%26/26})}},DR=class extends dg{constructor(r){super(r??{})}embedDocuments(r){return Promise.resolve(r.map(()=>[.1,.2,.3,.4]))}embedQuery(r){return Promise.resolve([.1,.2,.3,.4])}},BR=class extends wg{constructor(e){super(e);g(this,"response");g(this,"thrownErrorString");this.response=e.response,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e,t,n){if(this.thrownErrorString)throw new Error(this.thrownErrorString);const a=this.response??e;return await(n==null?void 0:n.handleLLMNewToken(a)),a}},MR=class extends wg{constructor(e){super(e);g(this,"sleep",50);g(this,"responses");g(this,"thrownErrorString");this.sleep=e.sleep??this.sleep,this.responses=e.responses,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e){var n,a;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const t=(n=this.responses)==null?void 0:n[0];return this.responses=(a=this.responses)==null?void 0:a.slice(1),t??e}async*_streamResponseChunks(e,t,n){var s,i;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const a=(s=this.responses)==null?void 0:s[0];this.responses=(i=this.responses)==null?void 0:i.slice(1);for(const o of a??e)await new Promise(u=>setTimeout(u,this.sleep)),yield{text:o,generationInfo:{}},await(n==null?void 0:n.handleLLMNewToken(o))}},$R=class extends L2{constructor(){super();g(this,"lc_namespace",["langchain_core","message","fake"]);g(this,"messages",[])}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async addUserMessage(e){this.messages.push(new Gn(e))}async addAIMessage(e){this.messages.push(new Hr(e))}async clear(){this.messages=[]}},PR=class extends cg{constructor(){super();g(this,"lc_namespace",["langchain_core","message","fake"]);g(this,"messages",[])}async addMessage(e){this.messages.push(e)}async getMessages(){return this.messages}},LR=class extends hs{constructor(){super();g(this,"name","fake_tracer");g(this,"runs",[])}persistRun(e){return this.runs.push(e),Promise.resolve()}},zR=class extends Yu{constructor(){super(...arguments);g(this,"lc_namespace",["tests","fake"])}getFormatInstructions(){return""}async parse(e){return e.split(",").map(t=>t.trim())}},UR=class extends pg{constructor(e){super();g(this,"lc_namespace",["test","fake"]);g(this,"output",[new Rs({pageContent:"foo"}),new Rs({pageContent:"bar"})]);this.output=(e==null?void 0:e.output)??this.output}async _getRelevantDocuments(e){return this.output}},jR=class extends At{constructor(e){super(e);g(this,"lc_namespace",["tests","fake"]);g(this,"returnOptions");this.returnOptions=e.returnOptions}async invoke(e,t){return this.returnOptions?t??{}:{input:e}}},qR=class extends O0{constructor(e){super(e);g(this,"name");g(this,"description");g(this,"schema");this.name=e.name,this.description=e.description,this.schema=e.schema}async _call(e,t){return JSON.stringify(e)}},HR=class extends hs{constructor(){super();g(this,"runPromiseResolver");g(this,"runPromise");g(this,"name","single_run_extractor");this.runPromise=new Promise(e=>{this.runPromiseResolver=e})}async persistRun(e){this.runPromiseResolver(e)}async extract(){return this.runPromise}};function l8(r,e){let t=0,n=0,a=0;for(let s=0;s<r.length;s++)t+=r[s]*e[s],n+=r[s]*r[s],a+=e[s]*e[s];return t/(Math.sqrt(n)*Math.sqrt(a))}var VR=class c8 extends mg{constructor(t,{similarity:n,...a}={}){super(t,a);g(this,"memoryVectors",[]);g(this,"similarity");this.similarity=n??l8}_vectorstoreType(){return"memory"}async addDocuments(t){const n=t.map(({pageContent:a})=>a);return this.addVectors(await this.embeddings.embedDocuments(n),t)}async addVectors(t,n){const a=t.map((s,i)=>({content:n[i].pageContent,embedding:s,metadata:n[i].metadata}));this.memoryVectors=this.memoryVectors.concat(a)}async similaritySearchVectorWithScore(t,n,a){const s=l=>{if(!a)return!0;const c=new Rs({metadata:l.metadata,pageContent:l.content});return a(c)},i=this.memoryVectors.filter(s);return i.map((l,c)=>({similarity:this.similarity(t,l.embedding),index:c})).sort((l,c)=>l.similarity>c.similarity?-1:0).slice(0,n).map(l=>[new Rs({metadata:i[l.index].metadata,pageContent:i[l.index].content}),l.similarity])}static async fromTexts(t,n,a,s){const i=[];for(let o=0;o<t.length;o+=1){const u=Array.isArray(n)?n[o]:n,l=new Rs({pageContent:t[o],metadata:u});i.push(l)}return c8.fromDocuments(i,a,s)}static async fromDocuments(t,n,a){const s=new this(n,a);return await s.addDocuments(t),s}static async fromExistingIndex(t,n){return new this(t,n)}},d8={};Xe(d8,{FakeChatMessageHistory:()=>$R,FakeChatModel:()=>NR,FakeEmbeddings:()=>DR,FakeLLM:()=>BR,FakeListChatMessageHistory:()=>PR,FakeListChatModel:()=>OR,FakeRetriever:()=>UR,FakeRunnable:()=>jR,FakeSplitIntoListParser:()=>zR,FakeStreamingChatModel:()=>IR,FakeStreamingLLM:()=>MR,FakeTool:()=>qR,FakeTracer:()=>LR,FakeVectorStore:()=>VR,SingleRunExtractor:()=>HR,SyntheticEmbeddings:()=>RR});var h8={};Xe(h8,{extendInteropZodObject:()=>a2,getInteropZodDefaultGetter:()=>s2,getInteropZodObjectShape:()=>_u,getSchemaDescription:()=>vu,interopParse:()=>Yl,interopParseAsync:()=>S0,interopSafeParse:()=>OF,interopSafeParseAsync:()=>t2,interopZodObjectMakeFieldsOptional:()=>MF,interopZodObjectPartial:()=>ag,interopZodObjectPassthrough:()=>up,interopZodObjectStrict:()=>Cc,interopZodTransformInputSchema:()=>i2,isInteropZodError:()=>o2,isInteropZodLiteral:()=>IF,isInteropZodObject:()=>sa,isInteropZodSchema:()=>ko,isShapelessZodSchema:()=>RF,isSimpleStringZodSchema:()=>rg,isZodArrayV4:()=>A0,isZodLiteralV3:()=>Q6,isZodLiteralV4:()=>e2,isZodNullableV4:()=>n2,isZodObjectV3:()=>ng,isZodObjectV4:()=>Ra,isZodOptionalV4:()=>r2,isZodSchema:()=>NF,isZodSchemaV3:()=>xr,isZodSchemaV4:()=>ur});var f8={};Xe(f8,{EventStreamContentType:()=>GR,convertEventStreamToIterableReadableDataStream:()=>KR,getBytes:()=>p8,getLines:()=>m8,getMessages:()=>g8});const GR="text/event-stream";async function p8(r,e){if(r instanceof ReadableStream){const t=r.getReader();for(;;){const n=await t.read();if(n.done){e(new Uint8Array,!0);break}e(n.value)}}else try{for await(const t of r)e(new Uint8Array(t));e(new Uint8Array,!0)}catch(t){throw new Error(["Parsing event source stream failed.","Ensure your implementation of fetch returns a web or Node readable stream.",`Error: ${t.message}`].join(`
`))}}var Zi=function(r){return r[r.NewLine=10]="NewLine",r[r.CarriageReturn=13]="CarriageReturn",r[r.Space=32]="Space",r[r.Colon=58]="Colon",r}(Zi||{});function m8(r){let e,t,n,a=!1;return function(i,o){if(o){r(i,0,!0);return}e===void 0?(e=i,t=0,n=-1):e=ZR(e,i);const u=e.length;let l=0;for(;t<u;){a&&(e[t]===Zi.NewLine&&(l=++t),a=!1);let c=-1;for(;t<u&&c===-1;++t)switch(e[t]){case Zi.Colon:n===-1&&(n=t-l);break;case Zi.CarriageReturn:a=!0;case Zi.NewLine:c=t;break}if(c===-1)break;r(e.subarray(l,c),n),l=t,n=-1}l===u?e=void 0:l!==0&&(e=e.subarray(l),t-=l)}}function g8(r,e,t){let n=mf();const a=new TextDecoder;return function(i,o,u){if(u){WR(n)||(r==null||r(n),n=mf());return}if(i.length===0)r==null||r(n),n=mf();else if(o>0){const l=a.decode(i.subarray(0,o)),c=o+(i[o+1]===Zi.Space?2:1),d=a.decode(i.subarray(c));switch(l){case"data":n.data=n.data?n.data+`
`+d:d;break;case"event":n.event=d;break;case"id":e==null||e(n.id=d);break;case"retry":{const h=parseInt(d,10);Number.isNaN(h)||t==null||t(n.retry=h);break}}}}}function ZR(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function mf(){return{data:"",event:"",id:"",retry:void 0}}function KR(r,e){const t=new ReadableStream({async start(n){const a=g8(i=>{if(i.event==="error")throw new Error(i.data??"Unspecified event streaming error.");i.event==="metadata"?e==null||e(i):i.data&&n.enqueue(i.data)});await p8(r,m8((i,o,u)=>{a(i,o,u),u&&n.close()}))}});return _n.fromReadableStream(t)}function WR(r){return r.data===""&&r.event===""&&r.id===""&&r.retry===void 0}var YR=class extends Ju{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","output_parsers","bytes"]);g(this,"lc_serializable",!0);g(this,"textEncoder",new TextEncoder)}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},Qu=class extends Ju{constructor(){super(...arguments);g(this,"re")}async*_transform(e){let t="";for await(const n of e)if(typeof n=="string"?t+=n:t+=n.content,this.re){const a=[...t.matchAll(this.re)];if(a.length>1){let s=0;for(const i of a.slice(0,-1))yield[i[1]],s+=(i.index??0)+i[0].length;t=t.slice(s)}}else{const a=await this.parse(t);if(a.length>1){for(const s of a.slice(0,-1))yield[s];t=a[a.length-1]}}for(const n of await this.parse(t))yield[n]}},JR=class extends Qu{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","output_parsers","list"]);g(this,"lc_serializable",!0)}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(t=>t.trim())}catch{throw new es(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},XR=class extends Qu{constructor({length:e,separator:t}){super(...arguments);g(this,"lc_namespace",["langchain_core","output_parsers","list"]);g(this,"length");g(this,"separator");this.length=e,this.separator=t||","}async parse(e){try{const t=e.trim().split(this.separator).map(n=>n.trim());if(this.length!==void 0&&t.length!==this.length)throw new es(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){throw Object.getPrototypeOf(t)===es.prototype?t:new es(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},QR=class extends Qu{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","output_parsers","list"]);g(this,"lc_serializable",!0);g(this,"re",/\d+\.\s([^\n]+)/g)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}},eD=class extends Qu{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","output_parsers","list"]);g(this,"lc_serializable",!0);g(this,"re",/^\s*[-*]\s([^\n]+)$/gm)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}},tD=class extends Ju{constructor(){super(...arguments);g(this,"lc_namespace",["langchain_core","output_parsers","string"]);g(this,"lc_serializable",!0)}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,n)=>t+this._messageContentToString(n),"")}},y8=class extends Yu{constructor(e){super(e);g(this,"lc_namespace",["langchain","output_parsers","structured"]);this.schema=e}static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=C0(Object.fromEntries(Object.entries(e).map(([n,a])=>[n,k0().describe(a)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(mn(this.schema))}
\`\`\`
`}async parse(e){var t,n;try{const a=e.trim(),i=(((t=a.match(/^```(?:json)?\s*([\s\S]*?)```/))==null?void 0:t[1])||((n=a.match(/```json\s*([\s\S]*?)```/))==null?void 0:n[1])||a).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(o,u)=>`"${u.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await S0(this.schema,JSON.parse(i))}catch(a){throw new es(`Failed to parse. Text: "${e}". Error: ${a}`,e)}}},v8=class extends y8{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(r){const e=(r==null?void 0:r.interpolationDepth)??1;if(e<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(mn(this.schema)).replaceAll("{","{".repeat(e)).replaceAll("}","}".repeat(e))}
\`\`\``}_schemaToInstruction(r,e=2){const t=r;if("type"in t){let n=!1,a;if(Array.isArray(t.type)){const o=t.type.findIndex(u=>u==="null");o!==-1&&(n=!0,t.type.splice(o,1)),a=t.type.join(" | ")}else a=t.type;if(t.type==="object"&&t.properties){const o=t.description?` // ${t.description}`:"";return`{
${Object.entries(t.properties).map(([l,c])=>{var h;const d=(h=t.required)!=null&&h.includes(l)?"":" (optional)";return`${" ".repeat(e)}"${l}": ${this._schemaToInstruction(c,e+2)}${d}`}).join(`
`)}
${" ".repeat(e-2)}}${o}`}if(t.type==="array"&&t.items){const o=t.description?` // ${t.description}`:"";return`array[
${" ".repeat(e)}${this._schemaToInstruction(t.items,e+2)}
${" ".repeat(e-2)}] ${o}`}const s=n?" (nullable)":"",i=t.description?` // ${t.description}`:"";return`${a}${i}${s}`}if("anyOf"in t)return t.anyOf.map(n=>this._schemaToInstruction(n,e)).join(`
${" ".repeat(e-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(r){return new this(r)}static fromNamesAndDescriptions(r){const e=C0(Object.fromEntries(Object.entries(r).map(([t,n])=>[t,k0().describe(n)])));return new this(e)}},rD=class extends Yu{constructor({inputSchema:e}){super(...arguments);g(this,"structuredInputParser");this.structuredInputParser=new v8(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(n){throw new es(`Failed to parse. Text: "${e}". Error: ${n}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}};const nD=function(){const r={};r.parser=function(C,x){return new t(C,x)},r.SAXParser=t,r.SAXStream=l,r.createStream=u,r.MAX_BUFFER_LENGTH=64*1024;const e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];r.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function t(C,x){if(!(this instanceof t))return new t(C,x);var q=this;a(q),q.q=q.c="",q.bufferCheckPosition=r.MAX_BUFFER_LENGTH,q.opt=x||{},q.opt.lowercase=q.opt.lowercase||q.opt.lowercasetags,q.looseCase=q.opt.lowercase?"toLowerCase":"toUpperCase",q.tags=[],q.closed=q.closedRoot=q.sawRoot=!1,q.tag=q.error=null,q.strict=!!C,q.noscript=!!(C||q.opt.noscript),q.state=A.BEGIN,q.strictEntities=q.opt.strictEntities,q.ENTITIES=q.strictEntities?Object.create(r.XML_ENTITIES):Object.create(r.ENTITIES),q.attribList=[],q.opt.xmlns&&(q.ns=Object.create(p)),q.trackPosition=q.opt.position!==!1,q.trackPosition&&(q.position=q.line=q.column=0),V(q,"onready")}Object.create||(Object.create=function(C){function x(){}x.prototype=C;var q=new x;return q}),Object.keys||(Object.keys=function(C){var x=[];for(var q in C)C.hasOwnProperty(q)&&x.push(q);return x});function n(C){for(var x=Math.max(r.MAX_BUFFER_LENGTH,10),q=0,$=0,Ee=e.length;$<Ee;$++){var Ve=C[e[$]].length;if(Ve>x)switch(e[$]){case"textNode":te(C);break;case"cdata":G(C,"oncdata",C.cdata),C.cdata="";break;case"script":G(C,"onscript",C.script),C.script="";break;default:D(C,"Max buffer length exceeded: "+e[$])}q=Math.max(q,Ve)}var at=r.MAX_BUFFER_LENGTH-q;C.bufferCheckPosition=at+C.position}function a(C){for(var x=0,q=e.length;x<q;x++)C[e[x]]=""}function s(C){te(C),C.cdata!==""&&(G(C,"oncdata",C.cdata),C.cdata=""),C.script!==""&&(G(C,"onscript",C.script),C.script="")}t.prototype={end:function(){M(this)},write:Q,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){s(this)}};var i=ReadableStream;i||(i=function(){});var o=r.EVENTS.filter(function(C){return C!=="error"&&C!=="end"});function u(C,x){return new l(C,x)}function l(C,x){if(!(this instanceof l))return new l(C,x);i.apply(this),this._parser=new t(C,x),this.writable=!0,this.readable=!0;var q=this;this._parser.onend=function(){q.emit("end")},this._parser.onerror=function($){q.emit("error",$),q._parser.error=null},this._decoder=null,o.forEach(function($){Object.defineProperty(q,"on"+$,{get:function(){return q._parser["on"+$]},set:function(Ee){if(!Ee)return q.removeAllListeners($),q._parser["on"+$]=Ee,Ee;q.on($,Ee)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(i.prototype,{constructor:{value:l}}),l.prototype.write=function(C){return this._parser.write(C.toString()),this.emit("data",C),!0},l.prototype.end=function(C){return C&&C.length&&this.write(C),this._parser.end(),!0},l.prototype.on=function(C,x){var q=this;return!q._parser["on"+C]&&o.indexOf(C)!==-1&&(q._parser["on"+C]=function(){var $=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);$.splice(0,0,C),q.emit.apply(q,$)}),i.prototype.on.call(q,C,x)};var c="[CDATA[",d="DOCTYPE",h="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/2000/xmlns/",p={xml:h,xmlns:f},m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,v=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,_=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,w=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function E(C){return C===" "||C===`
`||C==="\r"||C==="	"}function F(C){return C==='"'||C==="'"}function k(C){return C===">"||E(C)}function N(C,x){return C.test(x)}function B(C,x){return!N(C,x)}var A=0;r.STATE={BEGIN:A++,BEGIN_WHITESPACE:A++,TEXT:A++,TEXT_ENTITY:A++,OPEN_WAKA:A++,SGML_DECL:A++,SGML_DECL_QUOTED:A++,DOCTYPE:A++,DOCTYPE_QUOTED:A++,DOCTYPE_DTD:A++,DOCTYPE_DTD_QUOTED:A++,COMMENT_STARTING:A++,COMMENT:A++,COMMENT_ENDING:A++,COMMENT_ENDED:A++,CDATA:A++,CDATA_ENDING:A++,CDATA_ENDING_2:A++,PROC_INST:A++,PROC_INST_BODY:A++,PROC_INST_ENDING:A++,OPEN_TAG:A++,OPEN_TAG_SLASH:A++,ATTRIB:A++,ATTRIB_NAME:A++,ATTRIB_NAME_SAW_WHITE:A++,ATTRIB_VALUE:A++,ATTRIB_VALUE_QUOTED:A++,ATTRIB_VALUE_CLOSED:A++,ATTRIB_VALUE_UNQUOTED:A++,ATTRIB_VALUE_ENTITY_Q:A++,ATTRIB_VALUE_ENTITY_U:A++,CLOSE_TAG:A++,CLOSE_TAG_SAW_WHITE:A++,SCRIPT:A++,SCRIPT_ENDING:A++},r.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},r.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(r.ENTITIES).forEach(function(C){var x=r.ENTITIES[C],q=typeof x=="number"?String.fromCharCode(x):x;r.ENTITIES[C]=q});for(var L in r.STATE)r.STATE[r.STATE[L]]=L;A=r.STATE;function V(C,x,q){C[x]&&C[x](q)}function G(C,x,q){C.textNode&&te(C),V(C,x,q)}function te(C){C.textNode=ve(C.opt,C.textNode),C.textNode&&V(C,"ontext",C.textNode),C.textNode=""}function ve(C,x){return C.trim&&(x=x.trim()),C.normalize&&(x=x.replace(/\s+/g," ")),x}function D(C,x){return te(C),C.trackPosition&&(x+=`
Line: `+C.line+`
Column: `+C.column+`
Char: `+C.c),x=new Error(x),C.error=x,V(C,"onerror",x),C}function M(C){return C.sawRoot&&!C.closedRoot&&P(C,"Unclosed root tag"),C.state!==A.BEGIN&&C.state!==A.BEGIN_WHITESPACE&&C.state!==A.TEXT&&D(C,"Unexpected end"),te(C),C.c="",C.closed=!0,V(C,"onend"),t.call(C,C.strict,C.opt),C}function P(C,x){if(typeof C!="object"||!(C instanceof t))throw new Error("bad call to strictFail");C.strict&&D(C,x)}function Z(C){C.strict||(C.tagName=C.tagName[C.looseCase]());var x=C.tags[C.tags.length-1]||C,q=C.tag={name:C.tagName,attributes:{}};C.opt.xmlns&&(q.ns=x.ns),C.attribList.length=0,G(C,"onopentagstart",q)}function W(C,x){var q=C.indexOf(":"),$=q<0?["",C]:C.split(":"),Ee=$[0],Ve=$[1];return x&&C==="xmlns"&&(Ee="xmlns",Ve=""),{prefix:Ee,local:Ve}}function X(C){if(C.strict||(C.attribName=C.attribName[C.looseCase]()),C.attribList.indexOf(C.attribName)!==-1||C.tag.attributes.hasOwnProperty(C.attribName)){C.attribName=C.attribValue="";return}if(C.opt.xmlns){var x=W(C.attribName,!0),q=x.prefix,$=x.local;if(q==="xmlns")if($==="xml"&&C.attribValue!==h)P(C,"xml: prefix must be bound to "+h+`
Actual: `+C.attribValue);else if($==="xmlns"&&C.attribValue!==f)P(C,"xmlns: prefix must be bound to "+f+`
Actual: `+C.attribValue);else{var Ee=C.tag,Ve=C.tags[C.tags.length-1]||C;Ee.ns===Ve.ns&&(Ee.ns=Object.create(Ve.ns)),Ee.ns[$]=C.attribValue}C.attribList.push([C.attribName,C.attribValue])}else C.tag.attributes[C.attribName]=C.attribValue,G(C,"onattribute",{name:C.attribName,value:C.attribValue});C.attribName=C.attribValue=""}function Y(C,x){if(C.opt.xmlns){var q=C.tag,$=W(C.tagName);q.prefix=$.prefix,q.local=$.local,q.uri=q.ns[$.prefix]||"",q.prefix&&!q.uri&&(P(C,"Unbound namespace prefix: "+JSON.stringify(C.tagName)),q.uri=$.prefix);var Ee=C.tags[C.tags.length-1]||C;q.ns&&Ee.ns!==q.ns&&Object.keys(q.ns).forEach(function(Gr){G(C,"onopennamespace",{prefix:Gr,uri:q.ns[Gr]})});for(var Ve=0,at=C.attribList.length;Ve<at;Ve++){var ot=C.attribList[Ve],Et=ot[0],Se=ot[1],vt=W(Et,!0),Qt=vt.prefix,Sr=vt.local,Vr=Qt===""?"":q.ns[Qt]||"",be={name:Et,value:Se,prefix:Qt,local:Sr,uri:Vr};Qt&&Qt!=="xmlns"&&!Vr&&(P(C,"Unbound namespace prefix: "+JSON.stringify(Qt)),be.uri=Qt),C.tag.attributes[Et]=be,G(C,"onattribute",be)}C.attribList.length=0}C.tag.isSelfClosing=!!x,C.sawRoot=!0,C.tags.push(C.tag),G(C,"onopentag",C.tag),x||(!C.noscript&&C.tagName.toLowerCase()==="script"?C.state=A.SCRIPT:C.state=A.TEXT,C.tag=null,C.tagName=""),C.attribName=C.attribValue="",C.attribList.length=0}function re(C){if(!C.tagName){P(C,"Weird empty close tag."),C.textNode+="</>",C.state=A.TEXT;return}if(C.script){if(C.tagName!=="script"){C.script+="</"+C.tagName+">",C.tagName="",C.state=A.SCRIPT;return}G(C,"onscript",C.script),C.script=""}var x=C.tags.length,q=C.tagName;C.strict||(q=q[C.looseCase]());for(var $=q;x--;){var Ee=C.tags[x];if(Ee.name!==$)P(C,"Unexpected close tag");else break}if(x<0){P(C,"Unmatched closing tag: "+C.tagName),C.textNode+="</"+C.tagName+">",C.state=A.TEXT;return}C.tagName=q;for(var Ve=C.tags.length;Ve-- >x;){var at=C.tag=C.tags.pop();C.tagName=C.tag.name,G(C,"onclosetag",C.tagName);var ot={};for(var Et in at.ns)ot[Et]=at.ns[Et];var Se=C.tags[C.tags.length-1]||C;C.opt.xmlns&&at.ns!==Se.ns&&Object.keys(at.ns).forEach(function(vt){var Qt=at.ns[vt];G(C,"onclosenamespace",{prefix:vt,uri:Qt})})}x===0&&(C.closedRoot=!0),C.tagName=C.attribValue=C.attribName="",C.attribList.length=0,C.state=A.TEXT}function U(C){var x=C.entity,q=x.toLowerCase(),$,Ee="";return C.ENTITIES[x]?C.ENTITIES[x]:C.ENTITIES[q]?C.ENTITIES[q]:(x=q,x.charAt(0)==="#"&&(x.charAt(1)==="x"?(x=x.slice(2),$=parseInt(x,16),Ee=$.toString(16)):(x=x.slice(1),$=parseInt(x,10),Ee=$.toString(10))),x=x.replace(/^0+/,""),isNaN($)||Ee.toLowerCase()!==x?(P(C,"Invalid character entity"),"&"+C.entity+";"):String.fromCodePoint($))}function j(C,x){x==="<"?(C.state=A.OPEN_WAKA,C.startTagPosition=C.position):E(x)||(P(C,"Non-whitespace before first tag."),C.textNode=x,C.state=A.TEXT)}function ae(C,x){var q="";return x<C.length&&(q=C.charAt(x)),q}function Q(C){var x=this;if(this.error)throw this.error;if(x.closed)return D(x,"Cannot write after close. Assign an onready handler.");if(C===null)return M(x);typeof C=="object"&&(C=C.toString());for(var q=0,$="";$=ae(C,q++),x.c=$,!!$;)switch(x.trackPosition&&(x.position++,$===`
`?(x.line++,x.column=0):x.column++),x.state){case A.BEGIN:if(x.state=A.BEGIN_WHITESPACE,$==="\uFEFF")continue;j(x,$);continue;case A.BEGIN_WHITESPACE:j(x,$);continue;case A.TEXT:if(x.sawRoot&&!x.closedRoot){for(var Ee=q-1;$&&$!=="<"&&$!=="&";)$=ae(C,q++),$&&x.trackPosition&&(x.position++,$===`
`?(x.line++,x.column=0):x.column++);x.textNode+=C.substring(Ee,q-1)}$==="<"&&!(x.sawRoot&&x.closedRoot&&!x.strict)?(x.state=A.OPEN_WAKA,x.startTagPosition=x.position):(!E($)&&(!x.sawRoot||x.closedRoot)&&P(x,"Text data outside of root node."),$==="&"?x.state=A.TEXT_ENTITY:x.textNode+=$);continue;case A.SCRIPT:$==="<"?x.state=A.SCRIPT_ENDING:x.script+=$;continue;case A.SCRIPT_ENDING:$==="/"?x.state=A.CLOSE_TAG:(x.script+="<"+$,x.state=A.SCRIPT);continue;case A.OPEN_WAKA:if($==="!")x.state=A.SGML_DECL,x.sgmlDecl="";else if(!E($))if(N(m,$))x.state=A.OPEN_TAG,x.tagName=$;else if($==="/")x.state=A.CLOSE_TAG,x.tagName="";else if($==="?")x.state=A.PROC_INST,x.procInstName=x.procInstBody="";else{if(P(x,"Unencoded <"),x.startTagPosition+1<x.position){var Ve=x.position-x.startTagPosition;$=new Array(Ve).join(" ")+$}x.textNode+="<"+$,x.state=A.TEXT}continue;case A.SGML_DECL:(x.sgmlDecl+$).toUpperCase()===c?(G(x,"onopencdata"),x.state=A.CDATA,x.sgmlDecl="",x.cdata=""):x.sgmlDecl+$==="--"?(x.state=A.COMMENT,x.comment="",x.sgmlDecl=""):(x.sgmlDecl+$).toUpperCase()===d?(x.state=A.DOCTYPE,(x.doctype||x.sawRoot)&&P(x,"Inappropriately located doctype declaration"),x.doctype="",x.sgmlDecl=""):$===">"?(G(x,"onsgmldeclaration",x.sgmlDecl),x.sgmlDecl="",x.state=A.TEXT):(F($)&&(x.state=A.SGML_DECL_QUOTED),x.sgmlDecl+=$);continue;case A.SGML_DECL_QUOTED:$===x.q&&(x.state=A.SGML_DECL,x.q=""),x.sgmlDecl+=$;continue;case A.DOCTYPE:$===">"?(x.state=A.TEXT,G(x,"ondoctype",x.doctype),x.doctype=!0):(x.doctype+=$,$==="["?x.state=A.DOCTYPE_DTD:F($)&&(x.state=A.DOCTYPE_QUOTED,x.q=$));continue;case A.DOCTYPE_QUOTED:x.doctype+=$,$===x.q&&(x.q="",x.state=A.DOCTYPE);continue;case A.DOCTYPE_DTD:x.doctype+=$,$==="]"?x.state=A.DOCTYPE:F($)&&(x.state=A.DOCTYPE_DTD_QUOTED,x.q=$);continue;case A.DOCTYPE_DTD_QUOTED:x.doctype+=$,$===x.q&&(x.state=A.DOCTYPE_DTD,x.q="");continue;case A.COMMENT:$==="-"?x.state=A.COMMENT_ENDING:x.comment+=$;continue;case A.COMMENT_ENDING:$==="-"?(x.state=A.COMMENT_ENDED,x.comment=ve(x.opt,x.comment),x.comment&&G(x,"oncomment",x.comment),x.comment=""):(x.comment+="-"+$,x.state=A.COMMENT);continue;case A.COMMENT_ENDED:$!==">"?(P(x,"Malformed comment"),x.comment+="--"+$,x.state=A.COMMENT):x.state=A.TEXT;continue;case A.CDATA:$==="]"?x.state=A.CDATA_ENDING:x.cdata+=$;continue;case A.CDATA_ENDING:$==="]"?x.state=A.CDATA_ENDING_2:(x.cdata+="]"+$,x.state=A.CDATA);continue;case A.CDATA_ENDING_2:$===">"?(x.cdata&&G(x,"oncdata",x.cdata),G(x,"onclosecdata"),x.cdata="",x.state=A.TEXT):$==="]"?x.cdata+="]":(x.cdata+="]]"+$,x.state=A.CDATA);continue;case A.PROC_INST:$==="?"?x.state=A.PROC_INST_ENDING:E($)?x.state=A.PROC_INST_BODY:x.procInstName+=$;continue;case A.PROC_INST_BODY:if(!x.procInstBody&&E($))continue;$==="?"?x.state=A.PROC_INST_ENDING:x.procInstBody+=$;continue;case A.PROC_INST_ENDING:$===">"?(G(x,"onprocessinginstruction",{name:x.procInstName,body:x.procInstBody}),x.procInstName=x.procInstBody="",x.state=A.TEXT):(x.procInstBody+="?"+$,x.state=A.PROC_INST_BODY);continue;case A.OPEN_TAG:N(v,$)?x.tagName+=$:(Z(x),$===">"?Y(x):$==="/"?x.state=A.OPEN_TAG_SLASH:(E($)||P(x,"Invalid character in tag name"),x.state=A.ATTRIB));continue;case A.OPEN_TAG_SLASH:$===">"?(Y(x,!0),re(x)):(P(x,"Forward-slash in opening tag not followed by >"),x.state=A.ATTRIB);continue;case A.ATTRIB:if(E($))continue;$===">"?Y(x):$==="/"?x.state=A.OPEN_TAG_SLASH:N(m,$)?(x.attribName=$,x.attribValue="",x.state=A.ATTRIB_NAME):P(x,"Invalid attribute name");continue;case A.ATTRIB_NAME:$==="="?x.state=A.ATTRIB_VALUE:$===">"?(P(x,"Attribute without value"),x.attribValue=x.attribName,X(x),Y(x)):E($)?x.state=A.ATTRIB_NAME_SAW_WHITE:N(v,$)?x.attribName+=$:P(x,"Invalid attribute name");continue;case A.ATTRIB_NAME_SAW_WHITE:if($==="=")x.state=A.ATTRIB_VALUE;else{if(E($))continue;P(x,"Attribute without value"),x.tag.attributes[x.attribName]="",x.attribValue="",G(x,"onattribute",{name:x.attribName,value:""}),x.attribName="",$===">"?Y(x):N(m,$)?(x.attribName=$,x.state=A.ATTRIB_NAME):(P(x,"Invalid attribute name"),x.state=A.ATTRIB)}continue;case A.ATTRIB_VALUE:if(E($))continue;F($)?(x.q=$,x.state=A.ATTRIB_VALUE_QUOTED):(P(x,"Unquoted attribute value"),x.state=A.ATTRIB_VALUE_UNQUOTED,x.attribValue=$);continue;case A.ATTRIB_VALUE_QUOTED:if($!==x.q){$==="&"?x.state=A.ATTRIB_VALUE_ENTITY_Q:x.attribValue+=$;continue}X(x),x.q="",x.state=A.ATTRIB_VALUE_CLOSED;continue;case A.ATTRIB_VALUE_CLOSED:E($)?x.state=A.ATTRIB:$===">"?Y(x):$==="/"?x.state=A.OPEN_TAG_SLASH:N(m,$)?(P(x,"No whitespace between attributes"),x.attribName=$,x.attribValue="",x.state=A.ATTRIB_NAME):P(x,"Invalid attribute name");continue;case A.ATTRIB_VALUE_UNQUOTED:if(!k($)){$==="&"?x.state=A.ATTRIB_VALUE_ENTITY_U:x.attribValue+=$;continue}X(x),$===">"?Y(x):x.state=A.ATTRIB;continue;case A.CLOSE_TAG:if(x.tagName)$===">"?re(x):N(v,$)?x.tagName+=$:x.script?(x.script+="</"+x.tagName,x.tagName="",x.state=A.SCRIPT):(E($)||P(x,"Invalid tagname in closing tag"),x.state=A.CLOSE_TAG_SAW_WHITE);else{if(E($))continue;B(m,$)?x.script?(x.script+="</"+$,x.state=A.SCRIPT):P(x,"Invalid tagname in closing tag."):x.tagName=$}continue;case A.CLOSE_TAG_SAW_WHITE:if(E($))continue;$===">"?re(x):P(x,"Invalid characters in closing tag");continue;case A.TEXT_ENTITY:case A.ATTRIB_VALUE_ENTITY_Q:case A.ATTRIB_VALUE_ENTITY_U:var at,ot;switch(x.state){case A.TEXT_ENTITY:at=A.TEXT,ot="textNode";break;case A.ATTRIB_VALUE_ENTITY_Q:at=A.ATTRIB_VALUE_QUOTED,ot="attribValue";break;case A.ATTRIB_VALUE_ENTITY_U:at=A.ATTRIB_VALUE_UNQUOTED,ot="attribValue";break}if($===";")if(x.opt.unparsedEntities){var Et=U(x);x.entity="",x.state=at,x.write(Et)}else x[ot]+=U(x),x.entity="",x.state=at;else N(x.entity.length?w:_,$)?x.entity+=$:(P(x,"Invalid character in entity name"),x[ot]+="&"+x.entity+$,x.entity="",x.state=at);continue;default:throw new Error(x,"Unknown state: "+x.state)}return x.position>=x.bufferCheckPosition&&n(x),x}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */return String.fromCodePoint||function(){var C=String.fromCharCode,x=Math.floor,q=function(){var $=16384,Ee=[],Ve,at,ot=-1,Et=arguments.length;if(!Et)return"";for(var Se="";++ot<Et;){var vt=Number(arguments[ot]);if(!isFinite(vt)||vt<0||vt>1114111||x(vt)!==vt)throw RangeError("Invalid code point: "+vt);vt<=65535?Ee.push(vt):(vt-=65536,Ve=(vt>>10)+55296,at=vt%1024+56320,Ee.push(Ve,at)),(ot+1===Et||Ee.length>$)&&(Se+=C.apply(null,Ee),Ee.length=0)}return Se};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:q,configurable:!0,writable:!0}):String.fromCodePoint=q}(),r},aD=nD(),Np=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var sD=class extends Xu{constructor(e){super(e);g(this,"tags");g(this,"lc_namespace",["langchain_core","output_parsers"]);g(this,"lc_serializable",!0);this.tags=e==null?void 0:e.tags}static lc_name(){return"XMLOutputParser"}_diff(e,t){if(t)return e?b0(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Ip(e[0].text)}async parse(e){return Ip(e)}getFormatInstructions(){var t;return!!(this.tags&&this.tags.length>0)?Np.replace("{tags}",((t=this.tags)==null?void 0:t.join(", "))??""):Np}};const iD=r=>r.split(`
`).map(e=>e.replace(/^\s+/,"")).join(`
`).trim(),_8=r=>{if(Object.keys(r).length===0)return{};const e={};return r.children.length>0?(e[r.name]=r.children.map(_8),e):(e[r.name]=r.text??void 0,e)};function Ip(r){const e=iD(r),t=aD.parser(!0);let n={};const a=[];t.onopentag=o=>{const u={name:o.name,attributes:o.attributes,children:[],text:"",isSelfClosing:o.isSelfClosing};a.length>0?a[a.length-1].children.push(u):n=u,o.isSelfClosing||a.push(u)},t.onclosetag=()=>{if(a.length>0){const o=a.pop();a.length===0&&o&&(n=o)}},t.ontext=o=>{if(a.length>0){const u=a[a.length-1];u.text+=o}},t.onattribute=o=>{if(a.length>0){const u=a[a.length-1];u.attributes[o.name]=o.value}};const s=/```(xml)?(.*)```/s.exec(e),i=s?s[2]:e;return t.write(i).close(),n&&n.name==="?xml"&&(n=n.children[0]),_8(n)}var b8={};Xe(b8,{AsymmetricStructuredOutputParser:()=>rD,BaseCumulativeTransformOutputParser:()=>Xu,BaseLLMOutputParser:()=>I0,BaseOutputParser:()=>Yu,BaseTransformOutputParser:()=>Ju,BytesOutputParser:()=>YR,CommaSeparatedListOutputParser:()=>JR,CustomListOutputParser:()=>XR,JsonMarkdownStructuredOutputParser:()=>v8,JsonOutputParser:()=>hR,ListOutputParser:()=>Qu,MarkdownListOutputParser:()=>eD,NumberedListOutputParser:()=>QR,OutputParserException:()=>es,StringOutputParser:()=>tD,StructuredOutputParser:()=>y8,XMLOutputParser:()=>sD,XML_FORMAT_INSTRUCTIONS:()=>Np,parseJsonMarkdown:()=>Gf,parsePartialJson:()=>eo,parseXMLMarkdown:()=>Ip});var oD={};function uD(r,e){let t=0;for(let n=0;n<r.length;n++)t+=r[n]*e[n];return t}function lD(r,e){let t=0;for(let n=0;n<r.length;n++)t+=(r[n]-e[n])*(r[n]-e[n]);return t}function cD(r,e){return Math.sqrt(lD(r,e))}var w8={};Xe(w8,{cosineSimilarity:()=>Op,euclideanDistance:()=>fD,innerProduct:()=>hD,matrixFunc:()=>R0,maximalMarginalRelevance:()=>pD,normalize:()=>dD});function R0(r,e,t){if(r.length===0||r[0].length===0||e.length===0||e[0].length===0)return[[]];if(r[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[r.length,r[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return r.map(n=>e.map(a=>t(n,a)).map(a=>Number.isNaN(a)?0:a))}function dD(r,e=!1){const t=mD(r);return r.map(n=>n.map(a=>e?1-a/t:a/t))}function Op(r,e){return R0(r,e,l8)}function hD(r,e){return R0(r,e,uD)}function fD(r,e){return R0(r,e,cD)}function pD(r,e,t=.5,n=4){if(Math.min(n,e.length)<=0)return[];const a=Array.isArray(r[0])?r:[r],s=Op(a,e)[0],i=E8(s).maxIndex,o=[e[i]],u=[i];for(;u.length<Math.min(n,e.length);){let l=-1/0,c=-1;const d=Op(e,o);s.forEach((h,f)=>{if(u.includes(f))return;const p=Math.max(...d[f]),m=t*h-(1-t)*p;m>l&&(l=m,c=f)}),o.push(e[c]),u.push(c)}return u}function E8(r){if(r.length===0)return{maxIndex:-1,maxValue:NaN};let e=r[0],t=0;for(let n=1;n<r.length;n+=1)r[n]>e&&(t=n,e=r[n]);return{maxIndex:t,maxValue:e}}function mD(r){return r.reduce((e,t)=>Math.max(e,E8(t).maxValue),0)}var x8={};Xe(x8,{agents:()=>jT,caches:()=>Y2,callbacks__base:()=>Wb,callbacks__manager:()=>S6,callbacks__promises:()=>E6,chat_history:()=>P2,document_loaders__base:()=>tw,document_loaders__langsmith:()=>nw,documents:()=>sw,embeddings:()=>z2,example_selectors:()=>lw,index:()=>JI,indexing:()=>mw,language_models__base:()=>_w,language_models__chat_models:()=>ww,language_models__llms:()=>Ew,language_models__profile:()=>BO,load__serializable:()=>Eb,memory:()=>U2,messages:()=>$2,messages__tool:()=>Rb,output_parsers:()=>b8,output_parsers__openai_functions:()=>Gw,output_parsers__openai_tools:()=>jw,outputs:()=>j6,prompt_values:()=>q2,prompts:()=>$w,retrievers:()=>Z2,retrievers__document_compressors:()=>Sw,runnables:()=>Pw,runnables__graph:()=>A2,singletons:()=>N6,stores:()=>V2,structured_query:()=>r8,tools:()=>n8,tracers__base:()=>g6,tracers__console:()=>v6,tracers__log_stream:()=>z6,tracers__run_collector:()=>qw,tracers__tracer_langchain:()=>b6,types__stream:()=>gR,utils__async_caller:()=>V6,utils__chunk_array:()=>Zw,utils__env:()=>Ub,utils__event_source_parse:()=>f8,utils__format:()=>oD,utils__function_calling:()=>Kw,utils__hash:()=>W2,utils__json_patch:()=>Lw,utils__json_schema:()=>S2,utils__math:()=>w8,utils__stream:()=>B6,utils__testing:()=>d8,utils__tiktoken:()=>yw,utils__types:()=>h8,vectorstores:()=>K2});function gD(r){const e={};for(let t=r;t&&t.prototype;t=Object.getPrototypeOf(t))Object.assign(e,Reflect.get(t.prototype,"lc_aliases"));return Object.entries(e).reduce((t,[n,a])=>(t[a]=n,t),{})}async function rc(r){const{optionalImportsMap:e={},optionalImportEntrypoints:t=[],importMap:n={},secretsMap:a={},path:s=["$"]}=this,i=s.join(".");if(typeof r=="object"&&r!==null&&!Array.isArray(r)&&"lc"in r&&"type"in r&&"id"in r&&r.lc===1&&r.type==="secret"){const o=r,[u]=o.id;if(u in a)return a[u];{const l=Xa(u);if(l)return l;throw new Error(`Missing key "${u}" for ${i} in load(secretsMap={})`)}}else if(typeof r=="object"&&r!==null&&!Array.isArray(r)&&"lc"in r&&"type"in r&&"id"in r&&r.lc===1&&r.type==="not_implemented"){const u=JSON.stringify(r);throw new Error(`Trying to load an object that doesn't implement serialization: ${i} -> ${u}`)}else if(typeof r=="object"&&r!==null&&!Array.isArray(r)&&"lc"in r&&"type"in r&&"id"in r&&"kwargs"in r&&r.lc===1){const o=r,u=JSON.stringify(o),[l,...c]=o.id.slice().reverse(),d=c.reverse(),h={langchain_core:x8,langchain:n};let f=null;const p=[d.join("/")];d[0]==="langchain_community"&&p.push(["langchain",...d.slice(1)].join("/"));const m=p.find(w=>w in e);if(UT.concat(t).includes(d.join("/"))||m)if(m!==void 0)f=await e[m];else throw new Error(`Missing key "${d.join("/")}" for ${i} in load(optionalImportsMap={})`);else{let w;if(d[0]==="langchain"||d[0]==="langchain_core")w=h[d[0]],d.shift();else throw new Error(`Invalid namespace: ${i} -> ${u}`);if(d.length===0)throw new Error(`Invalid namespace: ${i} -> ${u}`);let E;do{if(E=d.join("__"),E in w)break;d.pop()}while(d.length>0);E in w&&(f=w[E])}if(typeof f!="object"||f===null)throw new Error(`Invalid namespace: ${i} -> ${u}`);const v=f[l]??Object.values(f).find(w=>typeof w=="function"&&o0(w)===l);if(typeof v!="function")throw new Error(`Invalid identifer: ${i} -> ${u}`);const _=await rc.call({...this,path:[...s,"kwargs"]},o.kwargs);if(o.type==="constructor"){const w=new v(wb(_,WS,gD(v)));return Object.defineProperty(w.constructor,"name",{value:l}),w}else throw new Error(`Invalid type: ${i} -> ${u}`)}else if(typeof r=="object"&&r!==null)return Array.isArray(r)?Promise.all(r.map((o,u)=>rc.call({...this,path:[...s,`${u}`]},o))):Object.fromEntries(await Promise.all(Object.entries(r).map(async([o,u])=>[o,await rc.call({...this,path:[...s,o]},u)])));return r}async function yD(r,e){const t=JSON.parse(r);return rc.call({...e},t)}function vD(r){return r!==null&&r.lc===1&&r.type==="constructor"&&Array.isArray(r.id)}async function Rp(r){if(r&&typeof r=="object"){if(Array.isArray(r))return await Promise.all(r.map(t=>Rp(t)));{const e={};for(const[t,n]of Object.entries(r))e[t]=await Rp(n);if(e.lc===2&&e.type==="undefined")return;if(e.lc===2&&e.type==="constructor"&&Array.isArray(e.id))try{const t=e.id[e.id.length-1];let n;switch(t){case"Set":n=Set;break;case"Map":n=Map;break;case"RegExp":n=RegExp;break;case"Error":n=Error;break;default:return e}return e.method?n[e.method](...e.args||[]):new n(...e.args||[])}catch{return e}else if(vD(e))return yD(JSON.stringify(e));return e}}return r}function gf(r,e,t,n){return{lc:2,type:"constructor",id:[r.name],method:e??null,args:t??[],kwargs:n??{}}}function _D(r){return r===void 0?{lc:2,type:"undefined"}:r instanceof Set||r instanceof Map?gf(r.constructor,void 0,[Array.from(r)]):r instanceof RegExp?gf(RegExp,void 0,[r.source,r.flags]):r instanceof Error?gf(r.constructor,void 0,[r.message]):(r==null?void 0:r.lg_name)==="Send"?{node:r.node,args:r.args}:r}var bD=class{_dumps(r){return new TextEncoder().encode(LT(r,(t,n)=>_D(n)))}async dumpsTyped(r){return r instanceof Uint8Array?["bytes",r]:["json",this._dumps(r)]}async _loads(r){const e=JSON.parse(r);return Rp(e)}async loadsTyped(r,e){if(r==="bytes")return typeof e=="string"?new TextEncoder().encode(e):e;if(r==="json")return this._loads(typeof e=="string"?e:new TextDecoder().decode(e));throw new Error(`Unknown serialization type: ${r}`)}};function S8(r){if(typeof r!="object"||r===null)return r;const e=Array.isArray(r)?[]:{};for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=S8(r[t]));return e}function A8(){return{v:4,id:D6(-2),ts:new Date().toISOString(),channel_values:{},channel_versions:{},versions_seen:{}}}function $c(r){return{v:r.v,id:r.id,ts:r.ts,channel_values:{...r.channel_values},channel_versions:{...r.channel_versions},versions_seen:S8(r.versions_seen)}}function k8(r,e){return typeof r=="number"&&typeof e=="number"?Math.sign(r-e):String(r).localeCompare(String(e))}function wD(...r){return r.reduce((e,t,n)=>n===0?t:k8(e,t)>=0?e:t)}const ED={[DT]:-1,[Wl]:-2,[BT]:-3,[MT]:-4};var $o=class extends Error{constructor(r){super(r),this.name="InvalidNamespaceError"}};function xD(r){if(r.length===0)throw new $o("Namespace cannot be empty.");for(const e of r){if(typeof e!="string")throw new $o(`Invalid namespace label '${e}' found in ${r}. Namespace labels must be strings, but got ${typeof e}.`);if(e.includes("."))throw new $o(`Invalid namespace label '${e}' found in ${r}. Namespace labels cannot contain periods ('.').`);if(e==="")throw new $o(`Namespace labels cannot be empty strings. Got ${e} in ${r}`)}if(r[0]==="langgraph")throw new $o(`Root label for namespace cannot be "langgraph". Got: ${r}`)}var SD=class{async get(r,e){return(await this.batch([{namespace:r,key:e}]))[0]}async search(r,e={}){const{filter:t,limit:n=10,offset:a=0,query:s}=e;return(await this.batch([{namespacePrefix:r,filter:t,limit:n,offset:a,query:s}]))[0]}async put(r,e,t,n){xD(r),await this.batch([{namespace:r,key:e,value:t,index:n}])}async delete(r,e){await this.batch([{namespace:r,key:e,value:null}])}async listNamespaces(r={}){const{prefix:e,suffix:t,maxDepth:n,limit:a=100,offset:s=0}=r,i=[];return e&&i.push({matchType:"prefix",path:e}),t&&i.push({matchType:"suffix",path:t}),(await this.batch([{matchConditions:i.length?i:void 0,maxDepth:n,limit:a,offset:s}]))[0]}start(){}stop(){}};const AD=r=>"lg_name"in r&&r.lg_name==="AsyncBatchedStore"?r.store:r;var kD=class extends SD{constructor(e){super();g(this,"lg_name","AsyncBatchedStore");g(this,"store");g(this,"queue",new Map);g(this,"nextKey",0);g(this,"running",!1);g(this,"processingTask",null);this.store=AD(e)}get isRunning(){return this.running}async batch(e){throw new Error("The `batch` method is not implemented on `AsyncBatchedStore`.\n Instead, it calls the `batch` method on the wrapped store.\n If you are seeing this error, something is wrong.")}async get(e,t){return this.enqueueOperation({namespace:e,key:t})}async search(e,t){const{filter:n,limit:a=10,offset:s=0,query:i}=t||{};return this.enqueueOperation({namespacePrefix:e,filter:n,limit:a,offset:s,query:i})}async put(e,t,n){return this.enqueueOperation({namespace:e,key:t,value:n})}async delete(e,t){return this.enqueueOperation({namespace:e,key:t,value:null})}start(){this.running||(this.running=!0,this.processingTask=this.processBatchQueue())}async stop(){this.running=!1,this.processingTask&&await this.processingTask}enqueueOperation(e){return new Promise((t,n)=>{const a=this.nextKey;this.nextKey+=1,this.queue.set(a,{operation:e,resolve:t,reject:n})})}async processBatchQueue(){for(;this.running;){if(await new Promise(t=>{setTimeout(t,0)}),this.queue.size===0)continue;const e=new Map(this.queue);this.queue.clear();try{const t=Array.from(e.values()).map(({operation:a})=>a),n=await this.store.batch(t);e.forEach(({resolve:a},s)=>{const i=Array.from(e.keys()).indexOf(s);a(n[i])})}catch(t){e.forEach(({reject:n})=>{n(t)})}}}toJSON(){return{queue:this.queue,nextKey:this.nextKey,running:this.running,store:"[LangGraphStore]"}}},CD=class{constructor(r){g(this,"serde",new bD);this.serde=r||this.serde}};function C8(r){return r!=null&&r.lg_is_channel===!0}var Ii=class{constructor(){g(this,"ValueType");g(this,"UpdateType");g(this,"lg_is_channel",!0)}consume(){return!1}finish(){return!1}isAvailable(){try{return this.get(),!0}catch(r){if(r.name===Lr.unminifiable_name)return!1;throw r}}};const Dp=Symbol.for("LG_IS_ONLY_BASE_CHANNEL");function Bg(r){if(r[Dp]===!0)return r;const e={};for(const t in r){if(!Object.prototype.hasOwnProperty.call(r,t))continue;const n=r[t];C8(n)&&(e[t]=n)}return Object.assign(e,{[Dp]:!0}),e}function Pc(r,e){const t=Bg(r),n={};for(const a in t){if(!Object.prototype.hasOwnProperty.call(t,a))continue;const s=e.channel_values[a];n[a]=t[a].fromCheckpoint(s)}return Object.assign(n,{[Dp]:!0}),n}function li(r,e,t,n){let a;if(e===void 0)a=r.channel_values;else{a={};for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s))try{a[s]=e[s].checkpoint()}catch(i){if(i.name!==Lr.unminifiable_name)throw i}}return{v:4,id:(n==null?void 0:n.id)??D6(t),ts:new Date().toISOString(),channel_values:a,channel_versions:r.channel_versions,versions_seen:r.versions_seen}}var Bp=class T8 extends Ii{constructor(t,n){super();g(this,"lc_graph_name","BinaryOperatorAggregate");g(this,"value");g(this,"operator");g(this,"initialValueFactory");this.operator=t,this.initialValueFactory=n,this.value=n==null?void 0:n()}fromCheckpoint(t){const n=new T8(this.operator,this.initialValueFactory);return typeof t<"u"&&(n.value=t),n}update(t){let n=t;if(!n.length)return!1;this.value===void 0&&([this.value]=n,n=n.slice(1));for(const a of n)this.value!==void 0&&(this.value=this.operator(this.value,a));return!0}get(){if(this.value===void 0)throw new Lr;return this.value}checkpoint(){if(this.value===void 0)throw new Lr;return this.value}isAvailable(){return this.value!==void 0}},Mg=class F8 extends Ii{constructor(){super(...arguments);g(this,"lc_graph_name","LastValue");g(this,"value",[])}fromCheckpoint(t){const n=new F8;return typeof t<"u"&&(n.value=[t]),n}update(t){if(t.length===0)return!1;if(t.length!==1)throw new ar("LastValue can only receive one value per step.",{lc_error_code:"INVALID_CONCURRENT_GRAPH_UPDATE"});return this.value=[t[t.length-1]],!0}get(){if(this.value.length===0)throw new Lr;return this.value[0]}checkpoint(){if(this.value.length===0)throw new Lr;return this.value[0]}isAvailable(){return this.value.length!==0}},TD=class N8 extends Ii{constructor(){super(...arguments);g(this,"lc_graph_name","LastValueAfterFinish");g(this,"value",[]);g(this,"finished",!1)}fromCheckpoint(t){const n=new N8;if(typeof t<"u"){const[a,s]=t;n.value=[a],n.finished=s}return n}update(t){return t.length===0?!1:(this.finished=!1,this.value=[t[t.length-1]],!0)}get(){if(this.value.length===0||!this.finished)throw new Lr;return this.value[0]}checkpoint(){if(this.value.length!==0)return[this.value[0],this.finished]}consume(){return this.finished?(this.finished=!1,this.value=[],!0):!1}finish(){return!this.finished&&this.value.length>0?(this.finished=!0,!0):!1}isAvailable(){return this.value.length!==0&&this.finished}},FD=class{constructor(r){g(this,"lc_graph_name","AnnotationRoot");g(this,"spec");this.spec=r}};const un=function(r){return r?Mp(r):new Mg};un.Root=r=>new FD(r);function Mp(r){return typeof r=="object"&&r&&"reducer"in r&&r.reducer?new Bp(r.reducer,r.default):typeof r=="object"&&r&&"value"in r&&r.value?new Bp(r.value,r.default):new Mg}const Vt="__start__",Ct="__end__",Ha="__input__",ND="__copy__",gn="__error__",yf="__pregel_ns_writes",Bs="__pregel_send",$g="__pregel_call",gi="__pregel_read",vr="__pregel_checkpointer",Ss="__pregel_resuming",au="__pregel_task_id",Lc="__pregel_stream",ID="__pregel_resume_value",nc="__pregel_resume_map",Ms="__pregel_scratchpad",ac="__pregel_previous",I8="__pregel_durability",$p="checkpoint_id",Aa="checkpoint_ns",OD="__pregel_node_finished",$n="checkpoint_map",g_="__pregel_abort_signals",Ot="__interrupt__",vn="__resume__",Pg="__no_writes__",ho="__return__",vf="__previous__",wr="langsmith:hidden",RD="langsmith:nostream",y_="__self__",Pn="__pregel_tasks",kn="__pregel_push",sc="__pregel_pull",Ln="00000000-0000-0000-0000-000000000000",DD=[wr,Ha,Ot,vn,gn,Pg,Bs,gi,vr,I8,Lc,Ss,au,$g,ID,Ms,ac,$n,Aa,$p],Tr="|",ts=":",v_=Symbol.for("langgraph.command");var l4,BD=(l4=v_,class{constructor(r){g(this,l4);this[v_]=r}});function Pp(r){const e=r;return e!=null&&typeof e.node=="string"&&e.args!==void 0}var zc=class{constructor(r,e){g(this,"lg_name","Send");g(this,"node");g(this,"args");this.node=r,this.args=ku(e)}toJSON(){return{lg_name:this.lg_name,node:this.node,args:this.args}}};function Nn(r){return r instanceof zc}function O8(r){return!r||typeof r!="object"||!(Ot in r)?!1:Array.isArray(r[Ot])}var Ff,Fa=(Ff=class extends BD{constructor(e){super(e);g(this,"lg_name","Command");g(this,"lc_direct_tool_output",!0);g(this,"graph");g(this,"update");g(this,"resume");g(this,"goto",[]);this.resume=e.resume,this.graph=e.graph,this.update=e.update,e.goto&&(this.goto=Array.isArray(e.goto)?ku(e.goto):[ku(e.goto)])}_updateAsTuples(){return this.update&&typeof this.update=="object"&&!Array.isArray(this.update)?Object.entries(this.update):Array.isArray(this.update)&&this.update.every(e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="string")?this.update:[["__root__",this.update]]}toJSON(){var t;let e;return typeof this.goto=="string"?e=this.goto:Nn(this.goto)?e=this.goto.toJSON():e=(t=this.goto)==null?void 0:t.map(n=>typeof n=="string"?n:n.toJSON()),{lg_name:this.lg_name,update:this.update,resume:this.resume,goto:e}}},g(Ff,"PARENT","__parent__"),Ff);function hn(r){return typeof r!="object"||r==null?!1:"lg_name"in r&&r.lg_name==="Command"}function ku(r,e=new Map){if(r!=null&&typeof r=="object"){if(e.has(r))return e.get(r);let t;if(Array.isArray(r))t=[],e.set(r,t),r.forEach((n,a)=>{t[a]=ku(n,e)});else if(hn(r)&&!(r instanceof Fa))t=new Fa(r),e.set(r,t);else if(Pp(r)&&!(r instanceof zc))t=new zc(r.node,r.args),e.set(r,t);else if(hn(r)||Nn(r))t=r,e.set(r,t);else if("lc_serializable"in r&&r.lc_serializable)t=r,e.set(r,t);else{t={},e.set(r,t);for(const[n,a]of Object.entries(r))t[n]=ku(a,e)}return t}return r}const MD=["tags","metadata","callbacks","configurable"],$D=["tags","metadata","callbacks","runName","maxConcurrency","recursionLimit","configurable","runId","outputKeys","streamMode","store","writer","interrupt","context","interruptBefore","interruptAfter","checkpointDuring","durability","signal"],PD=25;function R8(...r){const e={tags:[],metadata:{},callbacks:void 0,recursionLimit:PD,configurable:{}},t=Or.getRunnableConfig();if(t!==void 0){for(const[n,a]of Object.entries(t))if(a!==void 0)if(MD.includes(n)){let s;Array.isArray(a)?s=[...a]:typeof a=="object"?n==="callbacks"&&"copy"in a&&typeof a.copy=="function"?s=a.copy():s={...a}:s=a,e[n]=s}else e[n]=a}for(const n of r)if(n!==void 0)for(const[a,s]of Object.entries(n))s!==void 0&&$D.includes(a)&&(e[a]=s);for(const[n,a]of Object.entries(e.configurable))e.metadata=e.metadata??{},!n.startsWith("__")&&(typeof a=="string"||typeof a=="number"||typeof a=="boolean")&&!(n in e.metadata)&&(e.metadata[n]=a);return e}function LD(){return Or.getRunnableConfig()}function _f(r){return r.split(Tr).filter(e=>!e.match(/^\d+$/)).map(e=>e.split(ts)[0]).join(Tr)}function zD(r){const e=r.split(Tr);for(;e.length>1&&e[e.length-1].match(/^\d+$/);)e.pop();return e.slice(0,-1).join(Tr)}const de=r=>BigInt(r),Gt=(r,e=0)=>new DataView(r.buffer,r.byteOffset+e,r.byteLength-e),D8=de("0x9E3779B1"),B8=de("0x85EBCA77"),UD=de("0xC2B2AE3D"),Ks=de("0x9E3779B185EBCA87"),bi=de("0xC2B2AE3D27D4EB4F"),M8=de("0x165667B19E3779F9"),Lg=de("0x85EBCA77C2B2AE63"),jD=de("0x27D4EB2F165667C5"),qD=de("0x165667919E3779F9"),HD=de("0x9FB21C651E98DF25"),VD=r=>{const e=r.length;if(e%2!==0)throw new Error("String should have an even number of characters");const t=e/2,n=new Uint8Array(t);let a=0,s=0;for(;s<t;){const i=r.slice(a,a+=2);n[s]=Number.parseInt(i,16),s+=1}return Gt(n)},Ea=VD("b8fe6c3923a44bbe7c01812cf721ad1cded46de9839097db7240a4a4b7b3671fcb79e64eccc0e578825ad07dccff7221b8084674f743248ee03590e6813a264c3c2852bb91c300cb88d0658b1b532ea371644897a20df94e3819ef46a9deacd8a8fa763fe39c343ff9dcbbc7c70b4f1d8a51e04bcdb45931c89f7ec9d9787364eac5ac8334d3ebc3c581a0fffa1363eb170ddd51b7f0da49d316552629d4689e2b16be587d47a1fc8ff8b8d17ad031ce45cb3a8f95160428afd7fbcabb4b407e"),Ji=(de(1)<<de(128))-de(1),gt=(de(1)<<de(64))-de(1),Uc=(de(1)<<de(32))-de(1),Va=64,$8=Va/8,GD=8,Rl=4;function fo(r){if(!r)throw new Error("Assert failed")}function ZD(r){const e=new DataView(new ArrayBuffer(8));return e.setBigUint64(0,r,!0),e.getBigUint64(0,!1)}function KD(r){let e=r;return e=(e&de(65535))<<de(16)|(e&de(4294901760))>>de(16),e=(e&de(16711935))<<de(8)|(e&de(4278255360))>>de(8),e}function WD(r,e){return(r&Uc)*(e&Uc)&gt}function YD(r,e){return(r<<e|r>>de(32)-e)&Uc}function P8(r,e,t){for(let n=0;n<$8;n+=1){const a=e.getBigUint64(n*8,!0),s=a^t.getBigUint64(n*8,!0);r[n^1]+=a,r[n]+=WD(s,s>>de(32))}return r}function __(r,e,t,n){for(let a=0;a<n;a+=1)P8(r,Gt(e,a*Va),Gt(t,a*8));return r}function JD(r,e){for(let t=0;t<$8;t+=1){const n=e.getBigUint64(t*8,!0);let a=r[t];a=Lp(a,de(47)),a^=n,a*=D8,r[t]=a&gt}return r}function Dl(r,e){return L8(r[0]^e.getBigUint64(0,!0),r[1]^e.getBigUint64(GD,!0))}function b_(r,e,t){let n=t;return n+=Dl(r.slice(0),Gt(e,0*Rl)),n+=Dl(r.slice(2),Gt(e,4*Rl)),n+=Dl(r.slice(4),Gt(e,8*Rl)),n+=Dl(r.slice(6),Gt(e,12*Rl)),Na(n&gt)}function XD(r,e,t,n,a){let s=r;const i=Math.floor((t.byteLength-Va)/8),o=Va*i,u=Math.floor((e.byteLength-1)/o);for(let l=0;l<u;l+=1)s=__(s,Gt(e,l*o),t,i),s=a(s,Gt(t,t.byteLength-Va));{const l=Math.floor((e.byteLength-1-o*u)/Va);s=__(s,Gt(e,u*o),t,l),s=n(s,Gt(e,e.byteLength-Va),Gt(t,t.byteLength-Va-7))}return s}function QD(r,e){let t=new BigUint64Array([UD,Ks,bi,M8,Lg,B8,jD,D8]);fo(r.byteLength>128),t=XD(t,r,e,P8,JD),fo(t.length*8===64);{const n=b_(t,Gt(e,11),de(r.byteLength)*Ks&gt);return b_(t,Gt(e,e.byteLength-Va-11),~(de(r.byteLength)*bi)&gt)<<de(64)|n}}function L8(r,e){const t=r*e&Ji;return t&gt^t>>de(64)}function w_(r,e,t){return L8((r.getBigUint64(0,!0)^e.getBigUint64(0,!0)+t)&gt,(r.getBigUint64(8,!0)^e.getBigUint64(8,!0)-t)&gt)}function ic(r,e,t,n,a){let s=r&gt,i=r>>de(64)&gt;return s+=w_(e,n,a),s^=t.getBigUint64(0,!0)+t.getBigUint64(8,!0),s&=gt,i+=w_(t,Gt(n,16),a),i^=e.getBigUint64(0,!0)+e.getBigUint64(8,!0),i&=gt,i<<de(64)|s}function Na(r){let e=r;return e^=e>>de(37),e*=qD,e&=gt,e^=e>>de(32),e}function jc(r){let e=r;return e^=e>>de(33),e*=bi,e&=gt,e^=e>>de(29),e*=M8,e&=gt,e^=e>>de(32),e}function eB(r,e,t){const n=r.byteLength;fo(n>0&&n<=3);const a=de(r.getUint8(n-1))|de(n<<8)|de(r.getUint8(0)<<16)|de(r.getUint8(n>>1)<<24),s=(de(e.getUint32(0,!0))^de(e.getUint32(4,!0)))+t,i=(a^s)&gt,o=(de(e.getUint32(8,!0))^de(e.getUint32(12,!0)))-t,u=(YD(KD(a),de(13))^o)&gt;return(jc(u)&gt)<<de(64)|jc(i)}function Lp(r,e){return r^r>>e}function tB(r,e,t){const n=r.byteLength;fo(n>=4&&n<=8);{const a=r.getUint32(0,!0),s=r.getUint32(n-4,!0),i=de(a)|de(s)<<de(32),o=(e.getBigUint64(16,!0)^e.getBigUint64(24,!0))+t&gt;let l=(i^o)*(Ks+(de(n)<<de(2)))&Ji;return l+=(l&gt)<<de(65),l&=Ji,l^=l>>de(67),Lp(Lp(l&gt,de(35))*HD&gt,de(28))|Na(l>>de(64))<<de(64)}}function rB(r,e,t){const n=r.byteLength;fo(n>=9&&n<=16);{const a=(e.getBigUint64(32,!0)^e.getBigUint64(40,!0))+t&gt,s=(e.getBigUint64(48,!0)^e.getBigUint64(56,!0))-t&gt,i=r.getBigUint64(0,!0);let o=r.getBigUint64(n-8,!0),u=(i^o^a)*Ks;const l=(u&gt)+(de(n-1)<<de(54));u=u&(Ji^gt)|l,o^=s,u+=o+(o&Uc)*(B8-de(1))<<de(64),u&=Ji,u^=ZD(u>>de(64));let c=(u&gt)*bi;return c+=(u>>de(64))*bi<<de(64),c&=Ji,Na(c&gt)|Na(c>>de(64))<<de(64)}}function nB(r,e){const t=r.byteLength;return fo(t<=16),t>8?rB(r,Ea,e):t>=4?tB(r,Ea,e):t>0?eB(r,Ea,e):jc(e^Ea.getBigUint64(64,!0)^Ea.getBigUint64(72,!0))|jc(e^Ea.getBigUint64(80,!0)^Ea.getBigUint64(88,!0))<<de(64)}function zp(r){return~r+de(1)&gt}function aB(r,e,t){let n=de(r.byteLength)*Ks&gt,a=de(r.byteLength-1)/de(32);for(;a>=0;){const o=Number(a);n=ic(n,Gt(r,16*o),Gt(r,r.byteLength-16*(o+1)),Gt(e,32*o),t),a-=de(1)}let s=n+(n>>de(64))&gt;s=Na(s);let i=(n&gt)*Ks+(n>>de(64))*Lg+(de(r.byteLength)-t&gt)*bi;return i&=gt,i=zp(Na(i)),s|i<<de(64)}function sB(r,e,t){let n=de(r.byteLength)*Ks&gt;for(let i=32;i<160;i+=32)n=ic(n,Gt(r,i-32),Gt(r,i-16),Gt(e,i-32),t);n=Na(n&gt)|Na(n>>de(64))<<de(64);for(let i=160;i<=r.byteLength;i+=32)n=ic(n,Gt(r,i-32),Gt(r,i-16),Gt(e,3+i-160),t);n=ic(n,Gt(r,r.byteLength-16),Gt(r,r.byteLength-32),Gt(e,103),zp(t));let a=n+(n>>de(64))&gt;a=Na(a);let s=(n&gt)*Ks+(n>>de(64))*Lg+(de(r.byteLength)-t&gt)*bi;return s&=gt,s=zp(Na(s)),a|s<<de(64)}function ui(r,e=de(0)){const t=new TextEncoder,n=Gt(typeof r=="string"?t.encode(r):r),a=n.byteLength,s=i=>i.toString(16).padStart(32,"0");return a<=16?s(nB(n,e)):a<=128?s(aB(n,Ea,e)):a<=240?s(sB(n,Ea,e)):s(QD(n,Ea))}function z8(r){return/^[0-9a-f]{32}$/.test(r)}function iB(r){var u,l,c;const e=Or.getRunnableConfig();if(!e)throw new Error("Called interrupt() outside the context of a graph.");const t=e.configurable;if(!t)throw new Error("No configurable found in config");if(!t[vr])throw new Zl("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});const a=t[Ms];a.interruptCounter+=1;const s=a.interruptCounter;if(a.resume.length>0&&s<a.resume.length)return(u=t[Bs])==null||u.call(t,[[vn,a.resume]]),a.resume[s];if(a.nullResume!==void 0){if(a.resume.length!==s)throw new Error(`Resume length mismatch: ${a.resume.length} !== ${s}`);const d=a.consumeNullResume();return a.resume.push(d),(l=t[Bs])==null||l.call(t,[[vn,a.resume]]),d}const i=(c=t[Aa])==null?void 0:c.split(Tr),o=i?ui(i.join(Tr)):void 0;throw new Yi([{id:o,value:r}])}var Oi=class extends At{constructor(e){super();g(this,"lc_namespace",["langgraph"]);g(this,"func");g(this,"tags");g(this,"config");g(this,"trace",!0);g(this,"recurse",!0);this.name=e.name??e.func.name,this.func=e.func,this.config=e.tags?{tags:e.tags}:void 0,this.trace=e.trace??this.trace,this.recurse=e.recurse??this.recurse}async _tracedInvoke(e,t,n){return new Promise((a,s)=>{const i=Pt(t,{callbacks:n==null?void 0:n.getChild()});Or.runWithConfig(i,async()=>{try{const o=await this.func(e,i);a(o)}catch(o){s(o)}})})}async invoke(e,t){let n;const a=R8(t),s=Un(this.config,a);return this.trace?n=await this._callWithConfig(this._tracedInvoke,e,s):n=await Or.runWithConfig(s,async()=>this.func(e,s)),At.isRunnable(n)&&this.recurse?await Or.runWithConfig(s,async()=>n.invoke(e,s)):n}};function*ws(r,e){if(e===void 0)yield*r;else for(const t of r)yield[e,t]}async function ks(r){const e=[];for await(const t of await r)e.push(t);return e}function Go(r){const e=[];for(const t of r)e.push(t);return e}function Bi(r,e){return r?"configurable"in r?{...r,configurable:{...r.configurable,...e}}:{...r,configurable:e}:{configurable:e}}function oB(r){return typeof r=="object"&&(r==null?void 0:r[Symbol.for("LG_SKIP_WRITE")])!==void 0}const yi={[Symbol.for("LG_PASSTHROUGH")]:!0};function Bl(r){return typeof r=="object"&&(r==null?void 0:r[Symbol.for("LG_PASSTHROUGH")])!==void 0}const bf=Symbol("IS_WRITER");var Xr=class Up extends Oi{constructor(t,n){const a=`ChannelWrite<${t.map(s=>Nn(s)?s.node:"channel"in s?s.channel:"...").join(",")}>`;super({writes:t,name:a,tags:n,func:async(s,i)=>this._write(s,i??{})});g(this,"writes");this.writes=t}async _write(t,n){const a=this.writes.map(s=>wf(s)&&Bl(s.value)?{mapper:s.mapper,value:t}:oc(s)&&Bl(s.value)?{channel:s.channel,value:t,skipNone:s.skipNone,mapper:s.mapper}:s);return await Up.doWrite(n,a),t}static async doWrite(t,n){var i;for(const o of n){if(oc(o)){if(o.channel===Pn)throw new ar("Cannot write to the reserved channel TASKS");if(Bl(o.value))throw new ar("PASSTHROUGH value must be replaced")}if(wf(o)&&Bl(o.value))throw new ar("PASSTHROUGH value must be replaced")}const a=[];for(const o of n)if(Nn(o))a.push([Pn,o]);else if(wf(o)){const u=await o.mapper.invoke(o.value,t);u!=null&&u.length>0&&a.push(...u)}else if(oc(o)){const u=o.mapper!==void 0?await o.mapper.invoke(o.value,t):o.value;if(oB(u)||o.skipNone&&u===void 0)continue;a.push([o.channel,u])}else throw new Error(`Invalid write entry: ${JSON.stringify(o)}`);((i=t.configurable)==null?void 0:i[Bs])(a)}static isWriter(t){return t instanceof Up||bf in t&&!!t[bf]}static registerWriter(t){return Object.defineProperty(t,bf,{value:!0})}};function oc(r){return r!==void 0&&typeof r.channel=="string"}function wf(r){return r!==void 0&&!oc(r)&&At.isRunnable(r.mapper)}var uB=class U8 extends Oi{constructor(t,n,a=!1){super({func:(s,i)=>U8.doRead(i,this.channel,this.fresh,this.mapper)});g(this,"lc_graph_name","ChannelRead");g(this,"channel");g(this,"fresh",!1);g(this,"mapper");this.fresh=a,this.mapper=n,this.channel=t,this.name=Array.isArray(t)?`ChannelRead<${t.join(",")}>`:`ChannelRead<${t}>`}static doRead(t,n,a,s){var o;const i=(o=t.configurable)==null?void 0:o[gi];if(!i)throw new Error("Runnable is not configured with a read function. Make sure to call in the context of a Pregel process");return s?s(i(n,a)):i(n,a)}};const Mi=new Eu;var Cu=class Zo extends Gs{constructor(t){var v;const{channels:n,triggers:a,mapper:s,writers:i,bound:o,kwargs:u,metadata:l,retryPolicy:c,cachePolicy:d,tags:h,subgraphs:f,ends:p}=t,m=[...(v=t.config)!=null&&v.tags?t.config.tags:[],...h??[]];super({...t,bound:t.bound??Mi,config:{...t.config?t.config:{},tags:m}});g(this,"lc_graph_name","PregelNode");g(this,"channels");g(this,"triggers",[]);g(this,"mapper");g(this,"writers",[]);g(this,"bound",Mi);g(this,"kwargs",{});g(this,"metadata",{});g(this,"tags",[]);g(this,"retryPolicy");g(this,"cachePolicy");g(this,"subgraphs");g(this,"ends");this.channels=n,this.triggers=a,this.mapper=s,this.writers=i??this.writers,this.bound=o??this.bound,this.kwargs=u??this.kwargs,this.metadata=l??this.metadata,this.tags=m,this.retryPolicy=c,this.cachePolicy=d,this.subgraphs=f,this.ends=p}getWriters(){var n;const t=[...this.writers];for(;t.length>1&&t[t.length-1]instanceof Xr&&t[t.length-2]instanceof Xr;){const a=t.slice(-2),s=a[0].writes.concat(a[1].writes);t[t.length-2]=new Xr(s,(n=a[0].config)==null?void 0:n.tags),t.pop()}return t}getNode(){const t=this.getWriters();if(!(this.bound===Mi&&t.length===0))return this.bound===Mi&&t.length===1?t[0]:this.bound===Mi?new Zs({first:t[0],middle:t.slice(1,t.length-1),last:t[t.length-1],omitSequenceTags:!0}):t.length>0?new Zs({first:this.bound,middle:t.slice(0,t.length-1),last:t[t.length-1],omitSequenceTags:!0}):this.bound}join(t){if(!Array.isArray(t))throw new Error("channels must be a list");if(typeof this.channels!="object")throw new Error("all channels must be named when using .join()");return new Zo({channels:{...this.channels,...Object.fromEntries(t.map(n=>[n,n]))},triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound,kwargs:this.kwargs,config:this.config,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}pipe(t){return Xr.isWriter(t)?new Zo({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:[...this.writers,t],bound:this.bound,config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):this.bound===Mi?new Zo({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:Pr(t),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):new Zo({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound.pipe(t),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}};function lB(r){return"steps"in r&&Array.isArray(r.steps)}function zg(r){return"lg_is_pregel"in r&&r.lg_is_pregel===!0}function j8(r){const e=[r];for(const t of e){if(zg(t))return t;lB(t)&&e.push(...t.steps)}}function Xi(r,e,t=!0,n=!1){try{return r[e].get()}catch(a){if(a.name===Lr.unminifiable_name){if(n)return a;if(t)return null}throw a}}function wi(r,e,t=!0){if(Array.isArray(e)){const n={};for(const a of e)try{n[a]=Xi(r,a,!t)}catch(s){if(s.name===Lr.unminifiable_name)continue}return n}else return Xi(r,e)}function*cB(r,e){if(r.graph===Fa.PARENT)throw new ar("There is no parent graph.");if(r.goto){let t;Array.isArray(r.goto)?t=r.goto:t=[r.goto];for(const n of t)if(Nn(n))yield[Ln,Pn,n];else if(typeof n=="string")yield[Ln,`branch:to:${n}`,"__start__"];else throw new Error(`In Command.send, expected Send or string, got ${typeof n}`)}if(r.resume)if(typeof r.resume=="object"&&Object.keys(r.resume).length&&Object.keys(r.resume).every(z8))for(const[t,n]of Object.entries(r.resume)){const a=e.filter(s=>s[0]===t&&s[1]===vn).map(s=>s[2]).slice(0,1)??[];a.push(n),yield[t,vn,a]}else yield[Ln,vn,r.resume];if(r.update){if(typeof r.update!="object"||!r.update)throw new Error("Expected cmd.update to be a dict mapping channel names to update values");if(Array.isArray(r.update))for(const[t,n]of r.update)yield[Ln,t,n];else for(const[t,n]of Object.entries(r.update))yield[Ln,t,n]}}function*q8(r,e){if(e!=null)if(Array.isArray(r)&&typeof e=="object"&&!Array.isArray(e))for(const t in e)r.includes(t)&&(yield[t,e[t]]);else{if(Array.isArray(r))throw new Error('Input chunk must be an object when "inputChannels" is an array');yield[r,e]}}function*Ef(r,e,t){Array.isArray(r)?(e===!0||e.find(([n,a])=>r.includes(n)))&&(yield wi(t,r)):(e===!0||e.some(([n,a])=>n===r))&&(yield Xi(t,r))}function*dB(r,e,t){const n=e.filter(([o,u])=>{var l;return(o.config===void 0||!((l=o.config.tags)!=null&&l.includes(wr)))&&u[0][0]!==gn&&u[0][0]!==Ot});if(!n.length)return;let a;n.some(([o])=>o.writes.some(([u,l])=>u===ho))?a=n.flatMap(([o])=>o.writes.filter(([u,l])=>u===ho).map(([u,l])=>[o.name,l])):Array.isArray(r)?a=n.flatMap(([o])=>{const{writes:u}=o,l={};for(const[c]of u)r.includes(c)&&(l[c]=(l[c]||0)+1);return Object.values(l).some(c=>c>1)?u.filter(([c])=>r.includes(c)).map(([c,d])=>[o.name,{[c]:d}]):[[o.name,Object.fromEntries(u.filter(([c])=>r.includes(c)))]]}):a=n.flatMap(([o])=>o.writes.filter(([u,l])=>u===r).map(([u,l])=>[o.name,l]));const s={};for(const[o,u]of a)o in s||(s[o]=[]),s[o].push(u);const i={};for(const o in s)if(s[o].length===1){const[u]=s[o];i[o]=u}else i[o]=s[o];t&&(i.__metadata__={cached:t}),yield i}function Ug(r){const e=typeof r[Vt];if(e==="number")return 0;if(e==="string")return"";for(const t in r){if(!Object.prototype.hasOwnProperty.call(r,t))continue;const n=typeof r[t];if(n==="number")return 0;if(n==="string")return"";break}}function uc(r,e){if(Object.keys(r).length>0){const t=Ug(e);return Object.fromEntries(Object.entries(e).filter(([n,a])=>a>(r[n]??t)))}else return e}function hB(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}function aa(r,e){return r===null?{configurable:e}:(r==null?void 0:r.configurable)===void 0?{...r,configurable:e}:{...r,configurable:{...r.configurable,...e}}}function ai(r,e){var n,a;const t=(e==null?void 0:e.parents)??{};return Object.keys(t).length>0?aa(r,{[$n]:{...t,[((n=r.configurable)==null?void 0:n.checkpoint_ns)??""]:(a=r.configurable)==null?void 0:a.checkpoint_id}}):r}function qc(...r){const e=[...new Set(r.filter(Boolean))];if(e.length===0)return{signal:void 0,dispose:void 0};if(e.length===1)return{signal:e[0],dispose:void 0};const t=new AbortController,n=()=>{var i;const s=(i=e.find(o=>o.aborted))==null?void 0:i.reason;t.abort(s),e.forEach(o=>o.removeEventListener("abort",n))};e.forEach(s=>s.addEventListener("abort",n,{once:!0}));const a=e.find(s=>s.aborted);return a&&t.abort(a.reason),{signal:t.signal,dispose:()=>{e.forEach(s=>s.removeEventListener("abort",n))}}}const fB=(r,e)=>{if(!(!r&&!e))return r?e?Array.isArray(r)&&Array.isArray(e)?[...r,...e]:Array.isArray(r)?[...r,e]:Array.isArray(e)?[r,...e]:[r,e]:r:e};var pB=class{constructor({func:r,name:e,input:t,retry:n,cache:a,callbacks:s}){g(this,"func");g(this,"name");g(this,"input");g(this,"retry");g(this,"cache");g(this,"callbacks");g(this,"__lg_type","call");this.func=r,this.name=e,this.input=t,this.retry=n,this.cache=a,this.callbacks=s}};function mB(r){return typeof r=="object"&&r!==null&&"__lg_type"in r&&r.__lg_type==="call"}function gB(r,e){const t=new Oi({func:n=>e(...n),name:r,trace:!1,recurse:!1});return new Zs({name:r,first:t,last:new Xr([{channel:ho,value:yi}],[wr])})}const yB=r=>r!==void 0?r+1:1;function vB(r,e){if(e==null)return!1;for(const t of r)if(e[t])return!0;return!1}function _B(r){let e;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e==null?e=r[t]:e=wD(e,r[t]));return e}function Ml(r,e,t){const n=Ug(r.channel_versions),a=r.versions_seen[Ot]??{};let s=!1;if((r.channel_versions[Vt]??n)>(a[Vt]??n))s=!0;else for(const o in r.channel_versions)if(Object.prototype.hasOwnProperty.call(r.channel_versions,o)&&r.channel_versions[o]>(a[o]??n)){s=!0;break}const i=t.some(o=>{var u,l;return e==="*"?!((l=(u=o.config)==null?void 0:u.tags)!=null&&l.includes(wr)):e.includes(o.name)});return s&&i}function lc(r,e,t,n,a=!1){let s=new Set;if(Array.isArray(n))s=new Set(n.filter(o=>t.writes.some(([u,l])=>u===o)));else{for(const[o]of t.writes)if(o===n){s=new Set([o]);break}s=s||new Set}let i;if(a&&s.size>0){const o=Object.fromEntries(Object.entries(e).filter(([c,d])=>s.has(c))),u=li(r,o,-1),l=Pc(o,u);An($c(u),l,[t],void 0,void 0),i=wi({...e,...l},n)}else i=wi(e,n);return i}function xf(r,e,t){for(const[n,a]of t)if([kn,Pn].includes(n)&&a!=null){if(!Nn(a))throw new ar(`Invalid packet type, expected SendProtocol, got ${JSON.stringify(a)}`);if(!(a.node in e))throw new ar(`Invalid node name "${a.node}" in Send packet`)}r(t)}const bB=new Set([Pg,kn,vn,Ot,ho,gn]);function An(r,e,t,n,a){var h,f;t.sort((p,m)=>{var w,E;const v=((w=p.path)==null?void 0:w.slice(0,3))||[],_=((E=m.path)==null?void 0:E.slice(0,3))||[];for(let F=0;F<Math.min(v.length,_.length);F+=1){if(v[F]<_[F])return-1;if(v[F]>_[F])return 1}return v.length-_.length});const s=t.some(p=>p.triggers.length>0),i=Bg(e);for(const p of t){(h=r.versions_seen)[f=p.name]??(h[f]={});for(const m of p.triggers)m in r.channel_versions&&(r.versions_seen[p.name][m]=r.channel_versions[m])}let o=_B(r.channel_versions);const u=new Set(t.flatMap(p=>p.triggers).filter(p=>!DD.includes(p)));let l=!1;for(const p of u)p in i&&i[p].consume()&&n!==void 0&&(r.channel_versions[p]=n(o),l=!0);const c={};for(const p of t)for(const[m,v]of p.writes)bB.has(m)||m in i&&(c[m]??(c[m]=[]),c[m].push(v));o!=null&&n!=null&&(o=l?n(o):o);const d=new Set;for(const[p,m]of Object.entries(c))if(p in i){const v=i[p];let _;try{_=v.update(m)}catch(w){if(w.name===ar.unminifiable_name){const E=new ar(`Invalid update for channel "${p}" with values ${JSON.stringify(m)}: ${w.message}`);throw E.lc_error_code=w.lc_error_code,E}else throw w}_&&n!==void 0&&(r.channel_versions[p]=n(o),v.isAvailable()&&d.add(p))}if(s)for(const p in i){if(!Object.prototype.hasOwnProperty.call(i,p))continue;const m=i[p];m.isAvailable()&&!d.has(p)&&m.update([])&&n!==void 0&&(r.channel_versions[p]=n(o),m.isAvailable()&&d.add(p))}if(s&&!vB(d,a))for(const p in i){if(!Object.prototype.hasOwnProperty.call(i,p))continue;const m=i[p];m.finish()&&n!==void 0&&(r.channel_versions[p]=n(o),m.isAvailable()&&d.add(p))}return d}function*wB(r,e,t){if(t.updatedChannels!=null&&t.triggerToNodes!=null){const a=new Set;for(const s of t.updatedChannels){const i=t.triggerToNodes[s];for(const o of i??[])a.add(o)}yield*[...a].sort();return}if(!(()=>{for(const a in r.channel_versions)if(r.channel_versions[a]!==null)return!1;return!0})())for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(yield a)}function Ki(r,e,t,n,a,s,i){const o={},u=n[Pn];if(u!=null&&u.isAvailable()){const l=u.get().length;for(let c=0;c<l;c+=1){const d=jp([kn,c],r,e,t,n,a,s,i);d!==void 0&&(o[d.id]=d)}}for(const l of wB(r,t,i)){const c=jp([sc,l],r,e,t,n,a,s,i);c!==void 0&&(o[c.id]=c)}return o}function jp(r,e,t,n,a,s,i,o){var f,p,m,v;const{step:u,checkpointer:l,manager:c}=o,d=s.configurable??{},h=d.checkpoint_ns??"";if(r[0]===kn&&mB(r[r.length-1])){const _=r[r.length-1],w=gB(_.name,_.func),E=[kn],F=h===""?_.name:`${h}${Tr}${_.name}`,k=Hi(JSON.stringify([F,u.toString(),_.name,kn,r[1],r[2]]),e.id),N=`${F}${ts}${k}`,B=[...r.slice(0,3),!0],A={langgraph_step:u,langgraph_node:_.name,langgraph_triggers:E,langgraph_path:B,langgraph_checkpoint_ns:N};if(i){const L=[];return{name:_.name,input:_.input,proc:w,writes:L,config:Pt(Un(s,{metadata:A,store:o.store??s.store}),{runName:_.name,callbacks:c==null?void 0:c.getChild(`graph:step:${u}`),configurable:{[au]:k,[Bs]:G=>xf(te=>L.push(...te),n,G),[gi]:(G,te=!1)=>lc(e,a,{name:_.name,writes:L,triggers:E,path:B},G,te),[vr]:l??d[vr],[$n]:{...d[$n],[h]:e.id},[Ms]:Sf({pendingWrites:t??[],taskId:k,currentTaskInput:_.input,resumeMap:(f=s.configurable)==null?void 0:f[nc],namespaceHash:ui(N)}),[ac]:e.channel_values[vf],checkpoint_id:void 0,checkpoint_ns:N}}),triggers:E,retry_policy:_.retry,cache_key:_.cache?{key:ui((_.cache.keyFunc??JSON.stringify)([_.input])),ns:[yf,_.name??"__dynamic__"],ttl:_.cache.ttl}:void 0,id:k,path:B,writers:[]}}else return{id:k,name:_.name,interrupts:[],path:B}}else if(r[0]===kn){const _=typeof r[1]=="number"?r[1]:parseInt(r[1],10);if(!((p=a[Pn])!=null&&p.isAvailable()))return;const w=a[Pn].get();if(_<0||_>=w.length)return;const E=Pp(w[_])&&!Nn(w[_])?new zc(w[_].node,w[_].args):w[_];if(!Pp(E)){console.warn(`Ignoring invalid packet ${JSON.stringify(E)} in pending sends.`);return}if(!(E.node in n)){console.warn(`Ignoring unknown node name ${E.node} in pending sends.`);return}const F=[kn],k=h===""?E.node:`${h}${Tr}${E.node}`,N=Hi(JSON.stringify([k,u.toString(),E.node,kn,_.toString()]),e.id),B=`${k}${ts}${N}`;let A={langgraph_step:u,langgraph_node:E.node,langgraph_triggers:F,langgraph_path:r.slice(0,3),langgraph_checkpoint_ns:B};if(i){const L=n[E.node],V=L.getNode();if(V!==void 0){L.metadata!==void 0&&(A={...A,...L.metadata});const G=[];return{name:E.node,input:E.args,proc:V,subgraphs:L.subgraphs,writes:G,config:Pt(Un(s,{metadata:A,tags:L.tags,store:o.store??s.store}),{runName:E.node,callbacks:c==null?void 0:c.getChild(`graph:step:${u}`),configurable:{[au]:N,[Bs]:te=>xf(ve=>G.push(...ve),n,te),[gi]:(te,ve=!1)=>lc(e,a,{name:E.node,writes:G,triggers:F,path:r},te,ve),[vr]:l??d[vr],[$n]:{...d[$n],[h]:e.id},[Ms]:Sf({pendingWrites:t??[],taskId:N,currentTaskInput:E.args,resumeMap:(m=s.configurable)==null?void 0:m[nc],namespaceHash:ui(B)}),[ac]:e.channel_values[vf],checkpoint_id:void 0,checkpoint_ns:B}}),triggers:F,retry_policy:L.retryPolicy,cache_key:L.cachePolicy?{key:ui((L.cachePolicy.keyFunc??JSON.stringify)([E.args])),ns:[yf,L.name??"__dynamic__",E.node],ttl:L.cachePolicy.ttl}:void 0,id:N,path:r,writers:L.getWriters()}}}else return{id:N,name:E.node,interrupts:[],path:r}}else if(r[0]===sc){const _=r[1].toString(),w=n[_];if(w===void 0)return;if(t!=null&&t.length){const N=h===""?_:`${h}${Tr}${_}`,B=Hi(JSON.stringify([N,u.toString(),_,sc,_]),e.id);if(t.some(L=>L[0]===B&&L[1]!==gn))return}const E=Ug(e.channel_versions);if(E===void 0)return;const F=e.versions_seen[_]??{},k=w.triggers.find(N=>a[N].isAvailable()?(e.channel_versions[N]??E)>(F[N]??E):!1);if(k!==void 0){const N=EB(w,a,i);if(N===void 0)return;const B=h===""?_:`${h}${Tr}${_}`,A=Hi(JSON.stringify([B,u.toString(),_,sc,[k]]),e.id),L=`${B}${ts}${A}`;let V={langgraph_step:u,langgraph_node:_,langgraph_triggers:[k],langgraph_path:r,langgraph_checkpoint_ns:L};if(i){const G=w.getNode();if(G!==void 0){w.metadata!==void 0&&(V={...V,...w.metadata});const te=[];return{name:_,input:N,proc:G,subgraphs:w.subgraphs,writes:te,config:Pt(Un(s,{metadata:V,tags:w.tags,store:o.store??s.store}),{runName:_,callbacks:c==null?void 0:c.getChild(`graph:step:${u}`),configurable:{[au]:A,[Bs]:ve=>xf(D=>{te.push(...D)},n,ve),[gi]:(ve,D=!1)=>lc(e,a,{name:_,writes:te,triggers:[k],path:r},ve,D),[vr]:l??d[vr],[$n]:{...d[$n],[h]:e.id},[Ms]:Sf({pendingWrites:t??[],taskId:A,currentTaskInput:N,resumeMap:(v=s.configurable)==null?void 0:v[nc],namespaceHash:ui(L)}),[ac]:e.channel_values[vf],checkpoint_id:void 0,checkpoint_ns:L}}),triggers:[k],retry_policy:w.retryPolicy,cache_key:w.cachePolicy?{key:ui((w.cachePolicy.keyFunc??JSON.stringify)([N])),ns:[yf,w.name??"__dynamic__",_],ttl:w.cachePolicy.ttl}:void 0,id:A,path:r,writers:w.getWriters()}}}else return{id:A,name:_,interrupts:[],path:r}}}}function EB(r,e,t){let n;if(typeof r.channels=="object"&&!Array.isArray(r.channels)){n={};for(const[a,s]of Object.entries(r.channels))if(r.triggers.includes(s))try{n[a]=Xi(e,s,!1)}catch(i){if(i.name===Lr.unminifiable_name)return;throw i}else if(s in e)try{n[a]=Xi(e,s,!1)}catch(i){if(i.name===Lr.unminifiable_name)continue;throw i}}else if(Array.isArray(r.channels)){let a=!1;for(const s of r.channels)try{n=Xi(e,s,!1),a=!0;break}catch(i){if(i.name===Lr.unminifiable_name)continue;throw i}if(!a)return}else throw new Error(`Invalid channels type, expected list or dict, got ${r.channels}`);return t&&r.mapper!==void 0&&(n=r.mapper(n)),n}function Sf({pendingWrites:r,taskId:e,currentTaskInput:t,resumeMap:n,namespaceHash:a}){var u;const s=(u=r.find(([l,c])=>l===Ln&&c===vn))==null?void 0:u[2],o={callCounter:0,interruptCounter:-1,resume:(()=>{const l=r.filter(([c,d])=>c===e&&d===vn).flatMap(([c,d,h])=>h);if(n!=null&&a in n){const c=n[a];l.push(c)}return l})(),nullResume:s,subgraphCounter:0,currentTaskInput:t,consumeNullResume:()=>{if(o.nullResume)return delete o.nullResume,r.splice(r.findIndex(([l,c])=>l===Ln&&c===vn),1),s}};return o}const Tu={blue:{start:"\x1B[34m",end:"\x1B[0m"},green:{start:"\x1B[32m",end:"\x1B[0m"},yellow:{start:"\x1B[33;1m",end:"\x1B[0m"}},Fu=(r,e)=>`${r.start}${e}${r.end}`;function*E_(r){var e;for(const{id:t,name:n,input:a,config:s,triggers:i,writes:o}of r){if((e=s==null?void 0:s.tags)!=null&&e.includes(wr))continue;const u=o.filter(([l,c])=>l===t&&c===Ot).map(([,l])=>l);yield{id:t,name:n,input:a,triggers:i,interrupts:u}}}function xB(r){return typeof r!="object"||r===null?!1:"$writes"in r&&Array.isArray(r.$writes)}function H8(r){const e={};for(const[t,n]of r){const a=String(t);if(a in e){const s=xB(e[a])?e[a].$writes:[e[a]];s.push(n),e[a]={$writes:s}}else e[a]=n}return e}function*SB(r,e){var t;for(const[{id:n,name:a,config:s},i]of r)(t=s==null?void 0:s.tags)!=null&&t.includes(wr)||(yield{id:n,name:a,result:H8(i.filter(([o])=>Array.isArray(e)?e.includes(o):o===e)),interrupts:i.filter(o=>o[0]===Ot).map(o=>o[1])})}function*AB(r,e,t,n,a,s,i,o){var d,h,f;function u(p){const m={};return p.callbacks!=null&&(m.callbacks=p.callbacks),p.configurable!=null&&(m.configurable=p.configurable),p.maxConcurrency!=null&&(m.max_concurrency=p.maxConcurrency),p.metadata!=null&&(m.metadata=p.metadata),p.recursionLimit!=null&&(m.recursion_limit=p.recursionLimit),p.runId!=null&&(m.run_id=p.runId),p.runName!=null&&(m.run_name=p.runName),p.tags!=null&&(m.tags=p.tags),m}const l=(d=r.configurable)==null?void 0:d.checkpoint_ns,c={};for(const p of a){if(!((h=p.subgraphs)!=null&&h.length?p.subgraphs:[p.proc]).find(j8))continue;let v=`${p.name}:${p.id}`;l&&(v=`${l}|${v}`),c[p.id]={configurable:{thread_id:(f=r.configurable)==null?void 0:f.thread_id,checkpoint_ns:v}}}yield{config:u(r),values:wi(e,t),metadata:n,next:a.map(p=>p.name),tasks:V8(a,s,c,o),parentConfig:i?u(i):void 0}}function V8(r,e,t,n){return r.map(a=>{var l;const s=(l=e.find(([c,d])=>c===a.id&&d===gn))==null?void 0:l[2],i=e.filter(([c,d])=>c===a.id&&d===Ot).map(([,,c])=>c),o=(()=>{var d;if(s||i.length||!e.length)return;const c=e.findIndex(([h,f])=>h===a.id&&f===ho);if(c>=0)return e[c][2];if(typeof n=="string")return(d=e.find(([h,f])=>h===a.id&&f===n))==null?void 0:d[2];if(Array.isArray(n)){const h=e.filter(([f,p])=>f===a.id&&n.includes(p)).map(([,f,p])=>[f,p]);return h.length?H8(h):void 0}})();if(s)return{id:a.id,name:a.name,path:a.path,error:s,interrupts:i,result:o};const u=t==null?void 0:t[a.id];return{id:a.id,name:a.name,path:a.path,interrupts:i,...u!==void 0?{state:u}:{},result:o}})}function kB(r,e,t){console.log([`${Fu(Tu.blue,`[${r}:checkpoint]`)}`,`\x1B[1m State at the end of step ${r}:\x1B[0m
`,JSON.stringify(wi(e,t),null,2)].join(""))}function G8(r,e){const t=e.length;console.log([`${Fu(Tu.blue,`[${r}:tasks]`)}`,`\x1B[1m Starting step ${r} with ${t} task${t===1?"":"s"}:\x1B[0m
`,e.map(n=>`- ${Fu(Tu.green,String(n.name))} -> ${JSON.stringify(n.input,null,2)}`).join(`
`)].join(""))}function CB(r,e,t){const n={};for(const[a,s]of e)t.includes(a)&&(n[a]||(n[a]=[]),n[a].push(s));console.log([`${Fu(Tu.blue,`[${r}:writes]`)}`,`\x1B[1m Finished step ${r} with writes to ${Object.keys(n).length} channel${Object.keys(n).length!==1?"s":""}:\x1B[0m
`,Object.entries(n).map(([a,s])=>`- ${Fu(Tu.yellow,a)} -> ${s.map(i=>JSON.stringify(i)).join(", ")}`).join(`
`)].join(""))}var x_=class extends _n{constructor(e,t){const n=e.getReader(),a=t??new AbortController;super({start(s){return i();function i(){return n.read().then(({done:o,value:u})=>{if(o){s.close();return}return s.enqueue(u),i()})}}});g(this,"_abortController");g(this,"_innerReader");this._abortController=a,this._innerReader=n}async cancel(e){this._abortController.abort(e),this._innerReader.releaseLock()}get signal(){return this._abortController.signal}},Z8=class extends _n{constructor(e){let t;const n=new Promise(a=>{t=a});super({start:a=>{t(a)}});g(this,"modes");g(this,"controller");g(this,"passthroughFn");g(this,"_closed",!1);n.then(a=>{this.controller=a}),this.passthroughFn=e.passthroughFn,this.modes=e.modes}get closed(){return this._closed}push(e){var t;(t=this.passthroughFn)==null||t.call(this,e),this.controller.enqueue(e)}close(){try{this.controller.close()}catch{}finally{this._closed=!0}}error(e){this.controller.error(e)}};function TB(r){return JSON.stringify(r,function(e,t){const n=this[e];if(n!=null&&typeof n=="object"&&"toDict"in n&&typeof n.toDict=="function"){const{type:a,data:s}=n.toDict();return{...s,type:a}}return t})}function FB(r){return r instanceof Error?{error:r.name,message:r.message}:{error:"Error",message:JSON.stringify(r)}}function jg(r){return typeof r!="object"||r==null?!1:"configurable"in r&&typeof r.configurable=="object"&&r.configurable!=null}function Af(r){return!jg(r)||!r.configurable.thread_id?null:{thread_id:r.configurable.thread_id,checkpoint_ns:r.configurable.checkpoint_ns||"",checkpoint_id:r.configurable.checkpoint_id||null,checkpoint_map:r.configurable.checkpoint_map||null}}function S_(r){if(jg(r)){const e=Object.fromEntries(Object.entries(r.configurable).filter(([n])=>!n.startsWith("__"))),t={...r,configurable:e};return delete t.callbacks,t}return r}function A_(r){const e={...r,checkpoint:Af(r.config),parent_checkpoint:Af(r.parentConfig),config:S_(r.config),parent_config:S_(r.parentConfig),tasks:r.tasks.map(t=>{if(jg(t.state)){const n=Af(t.state);if(n!=null){const a={...t,checkpoint:n};return delete a.state,a}}return t})};return delete e.parentConfig,e}function NB(r){const e=new TextEncoder;return new ReadableStream({async start(t){const n=a=>{t.enqueue(e.encode(`event: ${a.event}
data: ${TB(a.data)}

`))};try{for await(const a of r){const[s,i,o]=a;let u=o;if(i==="debug"){const c=o;c.type==="checkpoint"&&(u={...c,payload:A_(c.payload)})}i==="checkpoints"&&(u=A_(o));const l=s!=null&&s.length?`${i}|${s.join("|")}`:i;n({event:l,data:u})}}catch(a){n({event:"error",data:FB(a)})}t.close()}})}const $l=Symbol.for("INPUT_DONE"),kf=Symbol.for("INPUT_RESUMING"),IB=25;function OB(...r){return new Z8({passthroughFn:e=>{for(const t of r)t.modes.has(e[1])&&t.push(e)},modes:new Set(r.flatMap(e=>Array.from(e.modes)))})}var RB=class extends CD{constructor(e){super();g(this,"cache");g(this,"queue",Promise.resolve());this.cache=e}async get(e){return this.enqueueOperation("get",e)}async set(e){return this.enqueueOperation("set",e)}async clear(e){return this.enqueueOperation("clear",e)}async stop(){await this.queue}enqueueOperation(e,...t){const n=this.queue.then(()=>this.cache[e](...t));return this.queue=n.then(()=>{},()=>{}),n}},DB=class K8{constructor(e){g(this,"input");g(this,"output");g(this,"config");g(this,"checkpointer");g(this,"checkpointerGetNextVersion");g(this,"channels");g(this,"checkpoint");g(this,"checkpointIdSaved");g(this,"checkpointConfig");g(this,"checkpointMetadata");g(this,"checkpointNamespace");g(this,"checkpointPendingWrites",[]);g(this,"checkpointPreviousVersions");g(this,"step");g(this,"stop");g(this,"durability");g(this,"outputKeys");g(this,"streamKeys");g(this,"nodes");g(this,"skipDoneTasks");g(this,"prevCheckpointConfig");g(this,"updatedChannels");g(this,"status","pending");g(this,"tasks",{});g(this,"stream");g(this,"checkpointerPromises",[]);g(this,"isNested");g(this,"_checkpointerChainedPromise",Promise.resolve());g(this,"store");g(this,"cache");g(this,"manager");g(this,"interruptAfter");g(this,"interruptBefore");g(this,"toInterrupt",[]);g(this,"debug",!1);g(this,"triggerToNodes");this.input=e.input,this.checkpointer=e.checkpointer,this.checkpointer!==void 0?this.checkpointerGetNextVersion=this.checkpointer.getNextVersion.bind(this.checkpointer):this.checkpointerGetNextVersion=yB,this.checkpoint=e.checkpoint,this.checkpointMetadata=e.checkpointMetadata,this.checkpointPreviousVersions=e.checkpointPreviousVersions,this.channels=e.channels,this.checkpointPendingWrites=e.checkpointPendingWrites,this.step=e.step,this.stop=e.stop,this.config=e.config,this.checkpointConfig=e.checkpointConfig,this.isNested=e.isNested,this.manager=e.manager,this.outputKeys=e.outputKeys,this.streamKeys=e.streamKeys,this.nodes=e.nodes,this.skipDoneTasks=e.skipDoneTasks,this.store=e.store,this.cache=e.cache?new RB(e.cache):void 0,this.stream=e.stream,this.checkpointNamespace=e.checkpointNamespace,this.prevCheckpointConfig=e.prevCheckpointConfig,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.durability=e.durability,this.debug=e.debug,this.triggerToNodes=e.triggerToNodes}get isResuming(){var u,l,c,d,h;let e=!1;if(Vt in this.checkpoint.channel_versions)e=!0;else for(const f in this.checkpoint.channel_versions)if(Object.prototype.hasOwnProperty.call(this.checkpoint.channel_versions,f)){e=!0;break}const n=((u=this.config.configurable)==null?void 0:u[Ss])!==void 0&&((l=this.config.configurable)==null?void 0:l[Ss]),a=this.input===null||this.input===void 0,s=hn(this.input)&&this.input.resume!=null,i=this.input===kf,o=!this.isNested&&((c=this.config.metadata)==null?void 0:c.run_id)!==void 0&&((d=this.checkpointMetadata)==null?void 0:d.run_id)!==void 0&&this.config.metadata.run_id===((h=this.checkpointMetadata)==null?void 0:h.run_id);return e&&(n||a||s||i||o)}static async initialize(e){var E,F,k,N,B,A,L,V,G,te,ve,D;let{config:t,stream:n}=e;n!==void 0&&((E=t.configurable)==null?void 0:E[Lc])!==void 0&&(n=OB(n,t.configurable[Lc]));const a=t.configurable?!("checkpoint_id"in t.configurable):!0,s=(F=t.configurable)==null?void 0:F[Ms];t.configurable&&s&&(s.subgraphCounter>0&&(t=aa(t,{[Aa]:[t.configurable[Aa],s.subgraphCounter.toString()].join(Tr)})),s.subgraphCounter+=1);const i=gi in(t.configurable??{});!i&&((k=t.configurable)==null?void 0:k.checkpoint_ns)!==void 0&&((N=t.configurable)==null?void 0:N.checkpoint_ns)!==""&&(t=aa(t,{checkpoint_ns:"",checkpoint_id:void 0}));let o=t;((B=t.configurable)==null?void 0:B[$n])!==void 0&&((V=(A=t.configurable)==null?void 0:A[$n])!=null&&V[(L=t.configurable)==null?void 0:L.checkpoint_ns])&&(o=aa(t,{checkpoint_id:t.configurable[$n][(G=t.configurable)==null?void 0:G.checkpoint_ns]}));const u=((ve=(te=t.configurable)==null?void 0:te.checkpoint_ns)==null?void 0:ve.split(Tr))??[],l=await((D=e.checkpointer)==null?void 0:D.getTuple(o))??{config:t,checkpoint:A8(),metadata:{source:"input",step:-2,parents:{}},pendingWrites:[]};o={...t,...l.config,configurable:{checkpoint_ns:"",...t.configurable,...l.config.configurable}};const c=l.parentConfig,d=$c(l.checkpoint),h={...l.metadata},f=l.pendingWrites??[],p=Pc(e.channelSpecs,d),m=(h.step??0)+1,v=m+(t.recursionLimit??IB)+1,_={...d.channel_versions},w=e.store?new kD(e.store):void 0;return w&&await w.start(),new K8({input:e.input,config:t,checkpointer:e.checkpointer,checkpoint:d,checkpointMetadata:h,checkpointConfig:o,prevCheckpointConfig:c,checkpointNamespace:u,channels:p,isNested:i,manager:e.manager,skipDoneTasks:a,step:m,stop:v,checkpointPreviousVersions:_,checkpointPendingWrites:f,outputKeys:e.outputKeys??[],streamKeys:e.streamKeys??[],nodes:e.nodes,stream:n,store:w,cache:e.cache,interruptAfter:e.interruptAfter,interruptBefore:e.interruptBefore,durability:e.durability,debug:e.debug,triggerToNodes:e.triggerToNodes})}_checkpointerPutAfterPrevious(e){this._checkpointerChainedPromise=this._checkpointerChainedPromise.then(()=>{var t;return(t=this.checkpointer)==null?void 0:t.put(e.config,e.checkpoint,e.metadata,e.newVersions)}),this.checkpointerPromises.push(this._checkpointerChainedPromise)}putWrites(e,t){var i;let n=t;if(n.length===0)return;n.every(([o])=>o in ED)&&(n=Array.from(new Map(n.map(o=>[o[0],o])).values())),this.checkpointPendingWrites=this.checkpointPendingWrites.filter(o=>o[0]!==e);for(const[o,u]of n)this.checkpointPendingWrites.push([e,o,u]);const a=aa(this.checkpointConfig,{[Aa]:((i=this.config.configurable)==null?void 0:i.checkpoint_ns)??"",[$p]:this.checkpoint.id});if(this.durability!=="exit"&&this.checkpointer!=null&&this.checkpointerPromises.push(this.checkpointer.putWrites(a,n,e)),this.tasks&&this._outputWrites(e,n),!t.length||!this.cache||!this.tasks)return;const s=this.tasks[e];s==null||s.cache_key==null||t[0][0]===gn||t[0][0]===Ot||this.cache.set([{key:[s.cache_key.ns,s.cache_key.key],value:s.writes,ttl:s.cache_key.ttl}])}_outputWrites(e,t,n=!1){var s,i;const a=this.tasks[e];if(a!==void 0){if(a.config!==void 0&&(a.config.tags??[]).includes(wr))return;if(t.length>0)if(t[0][0]===Ot){if(((s=a.path)==null?void 0:s[0])===kn&&((i=a.path)==null?void 0:i.at(-1))===!0)return;const o=t.filter(u=>u[0]===Ot).flatMap(u=>u[1]);this._emit([["updates",{[Ot]:o}],["values",{[Ot]:o}]])}else t[0][0]!==gn&&this._emit(Go(ws(dB(this.outputKeys,[[a,t]],n),"updates")));n||this._emit(Go(ws(SB([[a,t]],this.streamKeys),"tasks")))}}async _matchCachedWrites(){if(!this.cache)return[];const e=[],t=([i,o])=>`ns:${i.join(",")}|key:${o}`,n=[],a={};for(const i of Object.values(this.tasks))i.cache_key!=null&&!i.writes.length&&(n.push([i.cache_key.ns,i.cache_key.key]),a[t([i.cache_key.ns,i.cache_key.key])]=i);if(n.length===0)return[];const s=await this.cache.get(n);for(const{key:i,value:o}of s){const u=a[t(i)];u!=null&&(u.writes.push(...o),e.push({task:u,result:o}))}return e}async tick(e){var s,i,o;this.store&&!this.store.isRunning&&await((s=this.store)==null?void 0:s.start());const{inputKeys:t=[]}=e;if(this.status!=="pending")throw new Error(`Cannot tick when status is no longer "pending". Current status: "${this.status}"`);if(![$l,kf].includes(this.input))await this._first(t);else{if(this.toInterrupt.length>0)throw this.status="interrupt_before",new Yi;if(Object.values(this.tasks).every(u=>u.writes.length>0)){const u=Object.values(this.tasks).flatMap(c=>c.writes);this.updatedChannels=An(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes);const l=await ks(ws(Ef(this.outputKeys,u,this.channels),"values"));if(this._emit(l),this.checkpointPendingWrites=[],await this._putCheckpoint({source:"loop"}),Ml(this.checkpoint,this.interruptAfter,Object.values(this.tasks)))throw this.status="interrupt_after",new Yi;((i=this.config.configurable)==null?void 0:i[Ss])!==void 0&&((o=this.config.configurable)==null||delete o[Ss])}else return!1}if(this.step>this.stop)return this.status="out_of_steps",!1;const n=Ki(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.config,!0,{step:this.step,checkpointer:this.checkpointer,isResuming:this.isResuming,manager:this.manager,store:this.store,stream:this.stream,triggerToNodes:this.triggerToNodes,updatedChannels:this.updatedChannels});if(this.tasks=n,this.checkpointer&&this._emit(await ks(ws(AB(this.checkpointConfig,this.channels,this.streamKeys,this.checkpointMetadata,Object.values(this.tasks),this.checkpointPendingWrites,this.prevCheckpointConfig,this.outputKeys),"checkpoints"))),Object.values(this.tasks).length===0)return this.status="done",!1;if(this.skipDoneTasks&&this.checkpointPendingWrites.length>0){for(const[u,l,c]of this.checkpointPendingWrites){if(l===gn||l===Ot||l===vn)continue;const d=Object.values(this.tasks).find(h=>h.id===u);d&&d.writes.push([l,c])}for(const u of Object.values(this.tasks))u.writes.length>0&&this._outputWrites(u.id,u.writes,!0)}if(Object.values(this.tasks).every(u=>u.writes.length>0))return this.tick({inputKeys:t});if(Ml(this.checkpoint,this.interruptBefore,Object.values(this.tasks)))throw this.status="interrupt_before",new Yi;const a=await ks(ws(E_(Object.values(this.tasks)),"tasks"));return this._emit(a),!0}async finishAndHandleError(e){this.durability==="exit"&&(!this.isNested||typeof e<"u"||this.checkpointNamespace.every(n=>!n.includes(ts)))&&(this._putCheckpoint(this.checkpointMetadata),this._flushPendingWrites());const t=this._suppressInterrupt(e);return(t||e===void 0)&&(this.output=wi(this.channels,this.outputKeys)),t&&(this.tasks!==void 0&&this.checkpointPendingWrites.length>0&&Object.values(this.tasks).some(n=>n.writes.length>0)&&(this.updatedChannels=An(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes),this._emit(Go(ws(Ef(this.outputKeys,Object.values(this.tasks).flatMap(n=>n.writes),this.channels),"values")))),qi(e)&&!e.interrupts.length&&this._emit([["updates",{[Ot]:[]}],["values",{[Ot]:[]}]])),t}async acceptPush(e,t,n){var i,o;if(((i=this.interruptAfter)==null?void 0:i.length)>0&&Ml(this.checkpoint,this.interruptAfter,[e])){this.toInterrupt.push(e);return}const a=jp([kn,e.path??[],t,e.id,n],this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,e.config??{},!0,{step:this.step,checkpointer:this.checkpointer,manager:this.manager,store:this.store,stream:this.stream});if(!a)return;if(((o=this.interruptBefore)==null?void 0:o.length)>0&&Ml(this.checkpoint,this.interruptBefore,[a])){this.toInterrupt.push(a);return}this._emit(Go(ws(E_([a]),"tasks"))),this.debug&&G8(this.step,[a]),this.tasks[a.id]=a,this.skipDoneTasks&&this._matchWrites({[a.id]:a});const s=await this._matchCachedWrites();for(const{task:u}of s)this._outputWrites(u.id,u.writes,!0);return a}_suppressInterrupt(e){return qi(e)&&!this.isNested}async _first(e){var i;const{configurable:t}=this.config,n=t==null?void 0:t[Ms];if(n&&n.nullResume!==void 0&&this.putWrites(Ln,[[vn,n.nullResume]]),hn(this.input)){const o=this.input.resume!=null;if(this.input.resume!=null&&typeof this.input.resume=="object"&&Object.keys(this.input.resume).every(z8)&&((i=this.config).configurable??(i.configurable={}),this.config.configurable[nc]=this.input.resume),o&&this.checkpointer==null)throw new Error("Cannot use Command(resume=...) without checkpointer");const u={};for(const[l,c,d]of cB(this.input,this.checkpointPendingWrites))u[l]??(u[l]=[]),u[l].push([c,d]);if(Object.keys(u).length===0)throw new w5("Received empty Command input");for(const[l,c]of Object.entries(u))this.putWrites(l,c)}const a=(this.checkpointPendingWrites??[]).filter(o=>o[0]===Ln).map(o=>o.slice(1));a.length>0&&An(this.checkpoint,this.channels,[{name:Ha,writes:a,triggers:[]}],this.checkpointerGetNextVersion,this.triggerToNodes);const s=hn(this.input)&&a.length>0;if(this.isResuming||s){for(const u in this.channels)if(Object.prototype.hasOwnProperty.call(this.channels,u)&&this.checkpoint.channel_versions[u]!==void 0){const l=this.checkpoint.channel_versions[u];this.checkpoint.versions_seen[Ot]={...this.checkpoint.versions_seen[Ot],[u]:l}}const o=await ks(ws(Ef(this.outputKeys,!0,this.channels),"values"));this._emit(o)}if(this.isResuming)this.input=kf;else if(s)await this._putCheckpoint({source:"input"}),this.input=$l;else{const o=await ks(q8(e,this.input));if(o.length>0){const u=Ki(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.config,!0,{step:this.step});this.updatedChannels=An(this.checkpoint,this.channels,Object.values(u).concat([{name:Ha,writes:o,triggers:[]}]),this.checkpointerGetNextVersion,this.triggerToNodes),await this._putCheckpoint({source:"input"}),this.input=$l}else if(Ss in(this.config.configurable??{}))this.input=$l;else throw new w5(`Received no input writes for ${JSON.stringify(e,null,2)}`)}this.isNested||(this.config=aa(this.config,{[Ss]:this.isResuming}))}_emit(e){for(const[t,n]of e)if(this.stream.modes.has(t)&&this.stream.push([this.checkpointNamespace,t,n]),(t==="checkpoints"||t==="tasks")&&this.stream.modes.has("debug")){const a=t==="checkpoints"?this.step-1:this.step,s=new Date().toISOString(),i=t==="checkpoints"?"checkpoint":typeof n=="object"&&n!=null&&"result"in n?"task_result":"task";this.stream.push([this.checkpointNamespace,"debug",{step:a,type:i,timestamp:s,payload:n}])}}_putCheckpoint(e){var s;const t=this.checkpointMetadata===e,n=this.checkpointer!=null&&(this.durability!=="exit"||t),a=i=>{var l,c,d;this.prevCheckpointConfig=(c=(l=this.checkpointConfig)==null?void 0:l.configurable)!=null&&c.checkpoint_id?this.checkpointConfig:void 0,this.checkpointConfig=aa(this.checkpointConfig,{[Aa]:((d=this.config.configurable)==null?void 0:d.checkpoint_ns)??""});const o={...this.checkpoint.channel_versions},u=uc(this.checkpointPreviousVersions,o);this.checkpointPreviousVersions=o,this._checkpointerPutAfterPrevious({config:{...this.checkpointConfig},checkpoint:$c(i),metadata:{...this.checkpointMetadata},newVersions:u}),this.checkpointConfig={...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_id:this.checkpoint.id}}};t||(this.checkpointMetadata={...e,step:this.step,parents:((s=this.config.configurable)==null?void 0:s[$n])??{}}),this.checkpoint=li(this.checkpoint,n?this.channels:void 0,this.step,t?{id:this.checkpoint.id}:void 0),n&&a(this.checkpoint),t||(this.step+=1)}_flushPendingWrites(){var n;if(this.checkpointer==null||this.checkpointPendingWrites.length===0)return;const e=aa(this.checkpointConfig,{[Aa]:((n=this.config.configurable)==null?void 0:n.checkpoint_ns)??"",[$p]:this.checkpoint.id}),t={};for(const[a,s,i]of this.checkpointPendingWrites)t[a]??(t[a]=[]),t[a].push([s,i]);for(const[a,s]of Object.entries(t))this.checkpointerPromises.push(this.checkpointer.putWrites(e,s,a))}_matchWrites(e){for(const[t,n,a]of this.checkpointPendingWrites){if(n===gn||n===Ot||n===vn)continue;const s=Object.values(e).find(i=>i.id===t);s&&s.writes.push([n,a])}for(const t of Object.values(e))t.writes.length>0&&this._outputWrites(t.id,t.writes,!0)}};function BB(r){return $r(r==null?void 0:r.message)}var MB=class extends xo{constructor(e){super();g(this,"name","StreamMessagesHandler");g(this,"streamFn");g(this,"metadatas",{});g(this,"seen",{});g(this,"emittedChatModelRunIds",{});g(this,"stableMessageIdMap",{});g(this,"lc_prefer_streaming",!0);this.streamFn=e}_emit(e,t,n,a=!1){var i;if(a&&t.id!==void 0&&this.seen[t.id]!==void 0)return;let s=t.id;n!=null&&($m(t)?s??(s=`run-${n}-tool-${t.tool_call_id}`):((s==null||s===`run-${n}`)&&(s=this.stableMessageIdMap[n]??s??`run-${n}`),(i=this.stableMessageIdMap)[n]??(i[n]=s))),s!==t.id&&(t.id=s,t.lc_kwargs.id=s),t.id!=null&&(this.seen[t.id]=t),this.streamFn([e[0],"messages",[t,e[1]]])}handleChatModelStart(e,t,n,a,s,i,o,u){o&&(!i||!i.includes(RD)&&!i.includes("nostream"))&&(this.metadatas[n]=[o.langgraph_checkpoint_ns.split("|"),{tags:i,name:u,...o}])}handleLLMNewToken(e,t,n,a,s,i){const o=i==null?void 0:i.chunk;this.emittedChatModelRunIds[n]=!0,this.metadatas[n]!==void 0&&(BB(o)?this._emit(this.metadatas[n],o.message,n):this._emit(this.metadatas[n],new ca({content:e}),n))}handleLLMEnd(e,t){var n,a;if(this.metadatas[t]!==void 0){if(!this.emittedChatModelRunIds[t]){const s=(a=(n=e.generations)==null?void 0:n[0])==null?void 0:a[0];$r(s==null?void 0:s.message)&&this._emit(this.metadatas[t],s==null?void 0:s.message,t,!0),delete this.emittedChatModelRunIds[t]}delete this.metadatas[t],delete this.stableMessageIdMap[t]}}handleLLMError(e,t){delete this.metadatas[t]}handleChainStart(e,t,n,a,s,i,o,u){if(i!==void 0&&u===i.langgraph_node&&(s===void 0||!s.includes(wr))&&(this.metadatas[n]=[i.langgraph_checkpoint_ns.split("|"),{tags:s,name:u,...i}],typeof t=="object")){for(const l of Object.values(t))if(($r(l)||fu(l))&&l.id!==void 0)this.seen[l.id]=l;else if(Array.isArray(l))for(const c of l)($r(c)||fu(c))&&c.id!==void 0&&(this.seen[c.id]=c)}}handleChainEnd(e,t){const n=this.metadatas[t];if(delete this.metadatas[t],n!==void 0){if($r(e))this._emit(n,e,t,!0);else if(Array.isArray(e))for(const a of e)$r(a)&&this._emit(n,a,t,!0);else if(e!=null&&typeof e=="object"){for(const a of Object.values(e))if($r(a))this._emit(n,a,t,!0);else if(Array.isArray(a))for(const s of a)$r(s)&&this._emit(n,s,t,!0)}}}handleChainError(e,t){delete this.metadatas[t]}};const $B=500,PB=2,LB=128e3,zB=3,UB=[400,401,402,403,404,405,406,407,409],jB=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||r.name==="GraphValueError"||(r==null?void 0:r.code)==="ECONNABORTED")return!1;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);return!(e&&UB.includes(+e)||((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota")};async function W8(r,e,t,n){var c;const a=r.retry_policy??e;let s=a!==void 0?a.initialInterval??$B:0,i=0,o,u,{config:l}=r;for(t&&(l=aa(l,t)),l={...l,signal:n};!(n!=null&&n.aborted);){r.writes.splice(0,r.writes.length),o=void 0;try{u=await r.proc.invoke(r.input,l);break}catch(d){if(o=d,o.pregelTaskId=r.id,OT(o)){const m=(c=l==null?void 0:l.configurable)==null?void 0:c.checkpoint_ns,v=o.command;if(v.graph===m){for(const _ of r.writers)await _.invoke(v,l);o=void 0;break}else if(v.graph===Fa.PARENT){const _=zD(m);o.command=new Fa({...o.command,graph:_})}}if(Kl(o)||a===void 0||(i+=1,i>=(a.maxAttempts??zB))||!(a.retryOn??jB)(o))break;s=Math.min(a.maxInterval??LB,s*(a.backoffFactor??PB));const f=a.jitter?Math.floor(s+Math.random()*1e3):s;await new Promise(m=>setTimeout(m,f));const p=o.name??o.constructor.unminifiable_name??o.constructor.name;((a==null?void 0:a.logWarning)??!0)&&console.log(`Retrying task "${String(r.name)}" after ${s.toFixed(2)}ms (attempt ${i}) after ${p}: ${o}`),l=aa(l,{[Ss]:!0})}}return{task:r,result:u,error:o,signalAborted:n==null?void 0:n.aborted}}const qp=Symbol.for("promiseAdded");function qB(){const r={next:()=>{},wait:Promise.resolve(qp)};function e(t){r.next=()=>{r.wait=new Promise(e),t(qp)}}return r.wait=new Promise(e),r}var HB=class{constructor({loop:r,nodeFinished:e}){g(this,"nodeFinished");g(this,"loop");this.loop=r,this.nodeFinished=e}async tick(r={}){const{timeout:e,retryPolicy:t,onStepWrite:n,maxConcurrency:a}=r,s=new Set;let i;const o=new AbortController,u=o.signal,l=e?AbortSignal.timeout(e):void 0,c=Object.values(this.loop.tasks).filter(p=>p.writes.length===0),{signals:d,disposeCombinedSignal:h}=this._initializeAbortSignals({exceptionSignal:u,stepTimeoutSignal:l,signal:r.signal}),f=this._executeTasksWithRetry(c,{signals:d,retryPolicy:t,maxConcurrency:a});for await(const{task:p,error:m,signalAborted:v}of f)this._commit(p,m),qi(m)||Kl(m)&&!qi(i)?i=m:m&&(s.size===0||!v)&&(o.abort(),s.add(m));if(h==null||h(),n==null||n(this.loop.step,Object.values(this.loop.tasks).map(p=>p.writes).flat()),s.size===1)throw Array.from(s)[0];if(s.size>1)throw new AggregateError(Array.from(s),`Multiple errors occurred during superstep ${this.loop.step}. See the "errors" field of this exception for more details.`);if(qi(i)||Kl(i)&&this.loop.isNested)throw i}_initializeAbortSignals({exceptionSignal:r,stepTimeoutSignal:e,signal:t}){var l;const n=((l=this.loop.config.configurable)==null?void 0:l[g_])??{},a=n.externalAbortSignal??t,s=e??n.timeoutAbortSignal,{signal:i,dispose:o}=qc(a,s,r),u={externalAbortSignal:a,timeoutAbortSignal:s,composedAbortSignal:i};return this.loop.config=aa(this.loop.config,{[g_]:u}),{signals:u,disposeCombinedSignal:o}}async*_executeTasksWithRetry(r,e){var h,f,p;const{retryPolicy:t,maxConcurrency:n,signals:a}=e??{},s=qB(),i={},o={executingTasksMap:i,barrier:s,retryPolicy:t,scheduleTask:async(m,v,_)=>this.loop.acceptPush(m,v,_)};if((h=a==null?void 0:a.composedAbortSignal)!=null&&h.aborted)throw new Error("Abort");let u=0,l;const c=qc(a==null?void 0:a.externalAbortSignal,a==null?void 0:a.timeoutAbortSignal),d=c.signal?new Promise((m,v)=>{var _;l=()=>v(new Error("Abort")),(_=c.signal)==null||_.addEventListener("abort",l,{once:!0})}):void 0;for(;(u===0||Object.keys(i).length>0)&&r.length;){for(;Object.values(i).length<(n??r.length)&&u<r.length;u+=1){const v=r[u];i[v.id]=W8(v,t,{[$g]:cc==null?void 0:cc.bind(o,this,v)},a==null?void 0:a.composedAbortSignal).catch(_=>{var w;return{task:v,error:_,signalAborted:(w=a==null?void 0:a.composedAbortSignal)==null?void 0:w.aborted}})}const m=await Promise.race([...Object.values(i),...d?[d]:[],s.wait]);m!==qp&&(yield m,l!=null&&((f=c.signal)==null||f.removeEventListener("abort",l),(p=c.dispose)==null||p.call(c)),delete i[m.task.id])}}_commit(r,e){var t;if(e!==void 0)if(qi(e)){if(e.interrupts.length){const n=e.interrupts.map(s=>[Ot,s]),a=r.writes.filter(s=>s[0]===vn);a.length&&n.push(...a),this.loop.putWrites(r.id,n)}}else Kl(e)&&r.writes.length?this.loop.putWrites(r.id,r.writes):this.loop.putWrites(r.id,[[gn,{message:e.message,name:e.name}]]);else this.nodeFinished&&(((t=r.config)==null?void 0:t.tags)==null||!r.config.tags.includes(wr))&&this.nodeFinished(String(r.name)),r.writes.length===0&&r.writes.push([Pg,null]),this.loop.putWrites(r.id,r.writes)}};async function cc(r,e,t,n,a,s={}){var d,h;const i=(h=(d=e.config)==null?void 0:d.configurable)==null?void 0:h[Ms];if(!i)throw new Error(`BUG: No scratchpad found on task ${e.name}__${e.id}`);const o=i.callCounter;i.callCounter+=1;const u=new pB({func:t,name:n,input:a,cache:s.cache,retry:s.retry,callbacks:s.callbacks}),l=await this.scheduleTask(e,o,u);if(!l)return;const c=this.executingTasksMap[l.id];if(c!==void 0)return c;if(l.writes.length>0){const f=l.writes.filter(([m])=>m===ho),p=l.writes.filter(([m])=>m===gn);if(f.length>0){if(f.length===1)return Promise.resolve(f[0][1]);throw new Error(`BUG: multiple returns found for task ${l.name}__${l.id}`)}if(p.length>0){if(p.length===1){const m=p[0][1],v=m instanceof Error?m:new Error(String(m));return Promise.reject(v)}throw new Error(`BUG: multiple errors found for task ${l.name}__${l.id}`)}return}else{const f=W8(l,s.retry,{[$g]:cc.bind(this,r,l)});return this.executingTasksMap[l.id]=f,this.barrier.next(),f.then(({result:p,error:m})=>m?Promise.reject(m):p)}}var Ua=class extends Error{constructor(r){super(r),this.name="GraphValidationError"}};function VB({nodes:r,channels:e,inputChannels:t,outputChannels:n,streamChannels:a,interruptAfterNodes:s,interruptBeforeNodes:i}){if(!e)throw new Ua("Channels not provided");const o=new Set,u=new Set;for(const[l,c]of Object.entries(r)){if(l===Ot)throw new Ua(`"Node name ${Ot} is reserved"`);if(c.constructor===Cu)c.triggers.forEach(d=>o.add(d));else throw new Ua(`Invalid node type ${typeof c}, expected PregelNode`)}for(const l of o)if(!(l in e))throw new Ua(`Subscribed channel '${String(l)}' not in channels`);if(Array.isArray(t)){if(t.every(l=>!o.has(l)))throw new Ua(`None of the input channels ${t} are subscribed to by any node`)}else if(!o.has(t))throw new Ua(`Input channel ${String(t)} is not subscribed to by any node`);Array.isArray(n)?n.forEach(l=>u.add(l)):u.add(n),a&&!Array.isArray(a)?u.add(a):Array.isArray(a)&&a.forEach(l=>u.add(l));for(const l of u)if(!(l in e))throw new Ua(`Output channel '${String(l)}' not in channels`);if(s&&s!=="*"){for(const l of s)if(!(l in r))throw new Ua(`Node ${String(l)} not in nodes`)}if(i&&i!=="*"){for(const l of i)if(!(l in r))throw new Ua(`Node ${String(l)} not in nodes`)}}function k_(r,e){if(Array.isArray(r)){for(const t of r)if(!(t in e))throw new Error(`Key ${String(t)} not found in channels`)}else if(!(r in e))throw new Error(`Key ${String(r)} not found in channels`)}var GB=class Y8 extends Ii{constructor(t){super();g(this,"lc_graph_name","Topic");g(this,"unique",!1);g(this,"accumulate",!1);g(this,"seen");g(this,"values");this.unique=(t==null?void 0:t.unique)??this.unique,this.accumulate=(t==null?void 0:t.accumulate)??this.accumulate,this.seen=new Set,this.values=[]}fromCheckpoint(t){const n=new Y8({unique:this.unique,accumulate:this.accumulate});return typeof t<"u"&&(n.seen=new Set(t[0]),n.values=t[1]),n}update(t){let n=!1;this.accumulate||(n=this.values.length>0,this.values=[]);const a=t.flat();if(a.length>0)if(this.unique)for(const s of a)this.seen.has(s)||(n=!0,this.seen.add(s),this.values.push(s));else n=!0,this.values.push(...a);return n}get(){if(this.values.length===0)throw new Lr;return this.values}checkpoint(){return[[...this.seen],this.values]}isAvailable(){return this.values.length!==0}},ZB=class{static subscribeTo(r,e){const{key:t,tags:n}={key:void 0,tags:void 0,...e??{}};if(Array.isArray(r)&&t!==void 0)throw new Error("Can't specify a key when subscribing to multiple channels");let a;typeof r=="string"?t?a={[t]:r}:a=[r]:a=Object.fromEntries(r.map(i=>[i,i]));const s=Array.isArray(r)?r:[r];return new Cu({channels:a,triggers:s,tags:n})}static writeTo(r,e){const t=[];for(const n of r)t.push({channel:n,value:yi,skipNone:!1});for(const[n,a]of Object.entries(e??{}))At.isRunnable(a)||typeof a=="function"?t.push({channel:n,value:yi,skipNone:!0,mapper:Pr(a)}):t.push({channel:n,value:a,skipNone:!1});return new Xr(t)}},KB=class extends At{constructor(){super(...arguments);g(this,"lc_namespace",["langgraph","pregel"])}invoke(e,t){throw new Error("Not implemented")}withConfig(e){return super.withConfig(e)}stream(e,t){return super.stream(e,t)}},WB=class extends KB{constructor(e){super(e);g(this,"lc_namespace",["langgraph","pregel"]);g(this,"lg_is_pregel",!0);g(this,"nodes");g(this,"channels");g(this,"inputChannels");g(this,"outputChannels");g(this,"autoValidate",!0);g(this,"streamMode",["values"]);g(this,"streamChannels");g(this,"interruptAfter");g(this,"interruptBefore");g(this,"stepTimeout");g(this,"debug",!1);g(this,"checkpointer");g(this,"retryPolicy");g(this,"config");g(this,"store");g(this,"cache");g(this,"userInterrupt");g(this,"triggerToNodes",{});let{streamMode:t}=e;if(t!=null&&!Array.isArray(t)&&(t=[t]),this.nodes=e.nodes,this.channels=e.channels,Pn in this.channels&&"lc_graph_name"in this.channels[Pn]&&this.channels[Pn].lc_graph_name!=="Topic")throw new Error(`Channel '${Pn}' is reserved and cannot be used in the graph.`);this.channels[Pn]=new GB({accumulate:!1}),this.autoValidate=e.autoValidate??this.autoValidate,this.streamMode=t??this.streamMode,this.inputChannels=e.inputChannels,this.outputChannels=e.outputChannels,this.streamChannels=e.streamChannels??this.streamChannels,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.stepTimeout=e.stepTimeout??this.stepTimeout,this.debug=e.debug??this.debug,this.checkpointer=e.checkpointer,this.retryPolicy=e.retryPolicy,this.config=e.config,this.store=e.store,this.cache=e.cache,this.name=e.name,this.triggerToNodes=e.triggerToNodes??this.triggerToNodes,this.userInterrupt=e.userInterrupt,this.autoValidate&&this.validate()}static lc_name(){return"LangGraph"}withConfig(e){const t=Un(this.config,e);return new this.constructor({...this,config:t})}validate(){var e;VB({nodes:this.nodes,channels:this.channels,outputChannels:this.outputChannels,inputChannels:this.inputChannels,streamChannels:this.streamChannels,interruptAfterNodes:this.interruptAfter,interruptBeforeNodes:this.interruptBefore});for(const[t,n]of Object.entries(this.nodes))for(const a of n.triggers)(e=this.triggerToNodes)[a]??(e[a]=[]),this.triggerToNodes[a].push(t);return this}get streamChannelsList(){return Array.isArray(this.streamChannels)?this.streamChannels:this.streamChannels?[this.streamChannels]:Object.keys(this.channels)}get streamChannelsAsIs(){return this.streamChannels?this.streamChannels:Object.keys(this.channels)}async getGraphAsync(e){return this.getGraph(e)}*getSubgraphs(e,t){var n;for(const[a,s]of Object.entries(this.nodes)){if(e!==void 0&&!e.startsWith(a))continue;const i=(n=s.subgraphs)!=null&&n.length?s.subgraphs:[s.bound];for(const o of i){const u=j8(o);if(u!==void 0){if(a===e){yield[a,u];return}if(e===void 0&&(yield[a,u]),t){let l=e;e!==void 0&&(l=e.slice(a.length+1));for(const[c,d]of u.getSubgraphs(l,t))yield[`${a}${Tr}${c}`,d]}}}}}async*getSubgraphsAsync(e,t){yield*this.getSubgraphs(e,t)}async _prepareStateSnapshot({config:e,saved:t,subgraphCheckpointer:n,applyPendingWrites:a=!1}){var h,f,p,m,v,_,w,E;if(t===void 0)return{values:{},next:[],config:e,tasks:[]};const s=Pc(this.channels,t.checkpoint);if((h=t.pendingWrites)!=null&&h.length){const F=t.pendingWrites.filter(([k,N])=>k===Ln).map(([k,N,B])=>[String(N),B]);F.length>0&&An(t.checkpoint,s,[{name:Ha,writes:F,triggers:[]}],void 0,this.triggerToNodes)}const i=Object.values(Ki(t.checkpoint,t.pendingWrites,this.nodes,s,t.config,!0,{step:(((f=t.metadata)==null?void 0:f.step)??-1)+1,store:this.store})),o=await ks(this.getSubgraphsAsync()),u=((p=t.config.configurable)==null?void 0:p.checkpoint_ns)??"",l={};for(const F of i){const k=o.find(([B])=>B===F.name);if(!k)continue;let N=`${String(F.name)}${ts}${F.id}`;if(u&&(N=`${u}${Tr}${N}`),n===void 0){const B={configurable:{thread_id:(m=t.config.configurable)==null?void 0:m.thread_id,checkpoint_ns:N}};l[F.id]=B}else{const B={configurable:{[vr]:n,thread_id:(v=t.config.configurable)==null?void 0:v.thread_id,checkpoint_ns:N}},A=k[1];l[F.id]=await A.getState(B,{subgraphs:!0})}}if(a&&((_=t.pendingWrites)!=null&&_.length)){const F=Object.fromEntries(i.map(N=>[N.id,N]));for(const[N,B,A]of t.pendingWrites)[gn,Ot,Wl].includes(B)||N in F&&F[N].writes.push([String(B),A]);const k=i.filter(N=>N.writes.length>0);k.length>0&&An(t.checkpoint,s,k,void 0,this.triggerToNodes)}let c=t==null?void 0:t.metadata;c&&((E=(w=t==null?void 0:t.config)==null?void 0:w.configurable)!=null&&E.thread_id)&&(c={...c,thread_id:t.config.configurable.thread_id});const d=i.filter(F=>F.writes.length===0).map(F=>F.name);return{values:wi(s,this.streamChannelsAsIs),next:d,tasks:V8(i,(t==null?void 0:t.pendingWrites)??[],l,this.streamChannelsAsIs),metadata:c,config:ai(t.config,t.metadata),createdAt:t.checkpoint.ts,parentConfig:t.parentConfig}}async getState(e,t){var u,l,c,d;const n=((u=e.configurable)==null?void 0:u[vr])??this.checkpointer;if(!n)throw new Zl("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});const a=((l=e.configurable)==null?void 0:l.checkpoint_ns)??"";if(a!==""&&((c=e.configurable)==null?void 0:c[vr])===void 0){const h=_f(a);for await(const[f,p]of this.getSubgraphsAsync(h,!0))if(f===h)return await p.getState(Bi(e,{[vr]:n}),{subgraphs:t==null?void 0:t.subgraphs});throw new Error(`Subgraph with namespace "${h}" not found.`)}const s=Un(this.config,e),i=await n.getTuple(e);return await this._prepareStateSnapshot({config:s,saved:i,subgraphCheckpointer:t!=null&&t.subgraphs?n:void 0,applyPendingWrites:!((d=e.configurable)!=null&&d.checkpoint_id)})}async*getStateHistory(e,t){var i,o,u;const n=((i=e.configurable)==null?void 0:i[vr])??this.checkpointer;if(!n)throw new Zl("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});const a=((o=e.configurable)==null?void 0:o.checkpoint_ns)??"";if(a!==""&&((u=e.configurable)==null?void 0:u[vr])===void 0){const l=_f(a);for await(const[c,d]of this.getSubgraphsAsync(l,!0))if(c===l){yield*d.getStateHistory(Bi(e,{[vr]:n}),t);return}throw new Error(`Subgraph with namespace "${l}" not found.`)}const s=Un(this.config,e,{configurable:{checkpoint_ns:a}});for await(const l of n.list(s,t))yield this._prepareStateSnapshot({config:l.config,saved:l})}async bulkUpdateState(e,t){var o,u,l;const n=((o=e.configurable)==null?void 0:o[vr])??this.checkpointer;if(!n)throw new Zl("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});if(t.length===0)throw new Error("No supersteps provided");if(t.some(c=>c.updates.length===0))throw new Error("No updates provided");const a=((u=e.configurable)==null?void 0:u.checkpoint_ns)??"";if(a!==""&&((l=e.configurable)==null?void 0:l[vr])===void 0){const c=_f(a);for await(const[,d]of this.getSubgraphsAsync(c,!0))return await d.bulkUpdateState(Bi(e,{[vr]:n}),t);throw new Error(`Subgraph "${c}" not found`)}const s=async(c,d)=>{var G,te,ve,D,M,P,Z,W,X,Y,re;const h=this.config?Un(this.config,c):c,f=await n.getTuple(h),p=f!==void 0?$c(f.checkpoint):A8(),m={...f==null?void 0:f.checkpoint.channel_versions},v=((G=f==null?void 0:f.metadata)==null?void 0:G.step)??-1;let _=Bi(h,{checkpoint_ns:((te=h.configurable)==null?void 0:te.checkpoint_ns)??""}),w=h.metadata??{};f!=null&&f.config.configurable&&(_=Bi(h,f.config.configurable),w={...f.metadata,...w});const{values:E,asNode:F}=d[0];if(E==null&&F===void 0){if(d.length>1)throw new ar("Cannot create empty checkpoint with multiple updates");const U=await n.put(_,li(p,void 0,v),{source:"update",step:v+1,parents:((ve=f==null?void 0:f.metadata)==null?void 0:ve.parents)??{}},{});return ai(U,f?f.metadata:void 0)}const k=Pc(this.channels,p);if(E===null&&F===Ct){if(d.length>1)throw new ar("Cannot apply multiple updates when clearing state");if(f){const j=Ki(p,f.pendingWrites||[],this.nodes,k,f.config,!0,{step:(((D=f.metadata)==null?void 0:D.step)??-1)+1,checkpointer:n,store:this.store}),ae=(f.pendingWrites||[]).filter(Q=>Q[0]===Ln).map(Q=>Q.slice(1));ae.length>0&&An(p,k,[{name:Ha,writes:ae,triggers:[]}],n.getNextVersion.bind(n),this.triggerToNodes);for(const[Q,C,x]of f.pendingWrites||[])[gn,Ot,Wl].includes(C)||Q in j&&j[Q].writes.push([C,x]);An(p,k,Object.values(j),n.getNextVersion.bind(n),this.triggerToNodes)}const U=await n.put(_,li(p,k,v),{...w,source:"update",step:v+1,parents:((M=f==null?void 0:f.metadata)==null?void 0:M.parents)??{}},uc(m,p.channel_versions));return ai(U,f?f.metadata:void 0)}if(F===ND){if(d.length>1)throw new ar("Cannot copy checkpoint with multiple updates");if(f==null)throw new ar("Cannot copy a non-existent checkpoint");const U=Q=>!Array.isArray(Q)||Q.length===0?!1:Q.every(C=>Array.isArray(C)&&C.length===2),j=li(p,void 0,v),ae=await n.put(f.parentConfig??Bi(f.config,{checkpoint_id:void 0}),j,{source:"fork",step:v+1,parents:((P=f.metadata)==null?void 0:P.parents)??{}},{});if(U(E)){const Q=Ki(j,f.pendingWrites,this.nodes,k,ae,!1,{step:v+2}),C=Object.values(Q).reduce((q,{name:$,id:Ee})=>(q[$]??(q[$]=[]),q[$].push({id:Ee}),q),{}),x=E.reduce((q,$)=>{var Et,Se;const[Ee,Ve]=$;q[Ve]??(q[Ve]=[]);const at=q[Ve].length,ot=(Se=(Et=C[Ve])==null?void 0:Et[at])==null?void 0:Se.id;return q[Ve].push({values:Ee,asNode:Ve,taskId:ot}),q},{});return s(ai(ae,f.metadata),Object.values(x).flat())}return ai(ae,f.metadata)}if(F===Ha){if(d.length>1)throw new ar("Cannot apply multiple updates when updating as input");const U=await ks(q8(this.inputChannels,E));if(U.length===0)throw new ar(`Received no input writes for ${JSON.stringify(this.inputChannels,null,2)}`);An(p,k,[{name:Ha,writes:U,triggers:[]}],n.getNextVersion.bind(this.checkpointer),this.triggerToNodes);const j=((Z=f==null?void 0:f.metadata)==null?void 0:Z.step)!=null?f.metadata.step+1:-1,ae=await n.put(_,li(p,k,j),{source:"input",step:j,parents:((W=f==null?void 0:f.metadata)==null?void 0:W.parents)??{}},uc(m,p.channel_versions));return await n.putWrites(ae,U,Hi(Ha,p.id)),ai(ae,f?f.metadata:void 0)}if(((X=h.configurable)==null?void 0:X.checkpoint_id)===void 0&&(f==null?void 0:f.pendingWrites)!==void 0&&f.pendingWrites.length>0){const U=Ki(p,f.pendingWrites,this.nodes,k,f.config,!0,{store:this.store,checkpointer:this.checkpointer,step:(((Y=f.metadata)==null?void 0:Y.step)??-1)+1}),j=(f.pendingWrites??[]).filter(Q=>Q[0]===Ln).map(Q=>Q.slice(1));j.length>0&&An(f.checkpoint,k,[{name:Ha,writes:j,triggers:[]}],void 0,this.triggerToNodes);for(const[Q,C,x]of f.pendingWrites)[gn,Ot,Wl].includes(C)||U[Q]===void 0||U[Q].writes.push([C,x]);const ae=Object.values(U).filter(Q=>Q.writes.length>0);ae.length>0&&An(p,k,ae,void 0,this.triggerToNodes)}const N=Object.values(p.versions_seen).map(U=>Object.values(U)).flat().find(U=>!!U),B=[];if(d.length===1){let{values:U,asNode:j,taskId:ae}=d[0];if(j===void 0&&Object.keys(this.nodes).length===1)[j]=Object.keys(this.nodes);else if(j===void 0&&N===void 0)typeof this.inputChannels=="string"&&this.nodes[this.inputChannels]!==void 0&&(j=this.inputChannels);else if(j===void 0){const Q=Object.entries(p.versions_seen).map(([C,x])=>Object.values(x).map(q=>[q,C])).flat().filter(([C,x])=>x!==Ot).sort(([C],[x])=>k8(C,x));Q&&(Q.length===1?j=Q[0][1]:Q[Q.length-1][0]!==Q[Q.length-2][0]&&(j=Q[Q.length-1][1]))}if(j===void 0)throw new ar('Ambiguous update, specify "asNode"');B.push({values:U,asNode:j,taskId:ae})}else for(const{asNode:U,values:j,taskId:ae}of d){if(U==null)throw new ar('"asNode" is required when applying multiple updates');B.push({values:j,asNode:U,taskId:ae})}const A=[];for(const{asNode:U,values:j,taskId:ae}of B){if(this.nodes[U]===void 0)throw new ar(`Node "${U.toString()}" does not exist`);const Q=this.nodes[U].getWriters();if(!Q.length)throw new ar(`No writers found for node "${U.toString()}"`);A.push({name:U,input:j,proc:Q.length>1?Zs.from(Q,{omitSequenceTags:!0}):Q[0],writes:[],triggers:[Ot],id:ae??Hi(Ot,p.id),writers:[]})}for(const U of A)await U.proc.invoke(U.input,Pt({...h,store:(h==null?void 0:h.store)??this.store},{runName:h.runName??`${this.getName()}UpdateState`,configurable:{[Bs]:j=>U.writes.push(...j),[gi]:(j,ae=!1)=>lc(p,k,U,j,ae)}}));for(const U of A){const j=U.writes.filter(ae=>ae[0]!==kn);f!==void 0&&j.length>0&&await n.putWrites(_,j,U.id)}An(p,k,A,n.getNextVersion.bind(this.checkpointer),this.triggerToNodes);const L=uc(m,p.channel_versions),V=await n.put(_,li(p,k,v+1),{source:"update",step:v+1,parents:((re=f==null?void 0:f.metadata)==null?void 0:re.parents)??{}},L);for(const U of A){const j=U.writes.filter(ae=>ae[0]===kn);j.length>0&&await n.putWrites(V,j,U.id)}return ai(V,f?f.metadata:void 0)};let i=e;for(const{updates:c}of t)i=await s(i,c);return i}async updateState(e,t,n){return this.bulkUpdateState(e,[{updates:[{values:t,asNode:n}]}])}_defaults(e){var k,N,B;const{debug:t,streamMode:n,inputKeys:a,outputKeys:s,interruptAfter:i,interruptBefore:o,...u}=e;let l=!0;const c=t!==void 0?t:this.debug;let d=s;d===void 0?d=this.streamChannelsAsIs:k_(d,this.channels);let h=a;h===void 0?h=this.inputChannels:k_(h,this.channels);const f=o??this.interruptBefore??[],p=i??this.interruptAfter??[];let m;n!==void 0?(m=Array.isArray(n)?n:[n],l=typeof n=="string"):(((k=e.configurable)==null?void 0:k[au])!==void 0?m=["values"]:m=this.streamMode,l=!0);let v;if(this.checkpointer===!1)v=void 0;else if(e!==void 0&&((N=e.configurable)==null?void 0:N[vr])!==void 0)v=e.configurable[vr];else{if(this.checkpointer===!0)throw new Error("checkpointer: true cannot be used for root graphs.");v=this.checkpointer}const _=e.store??this.store,w=e.cache??this.cache;if(e.durability!=null&&e.checkpointDuring!=null)throw new Error("Cannot use both `durability` and `checkpointDuring` at the same time.");const E=(()=>{if(e.checkpointDuring!=null)return e.checkpointDuring===!1?"exit":"async"})(),F=e.durability??E??((B=e==null?void 0:e.configurable)==null?void 0:B[I8])??"async";return[c,m,h,d,u,f,p,v,_,l,w,F]}async stream(e,t){var i;const n=new AbortController,a={recursionLimit:(i=this.config)==null?void 0:i.recursionLimit,...t,signal:qc(t==null?void 0:t.signal,n.signal).signal},s=await super.stream(e,a);return new x_((t==null?void 0:t.encoding)==="text/event-stream"?NB(s):s,n)}streamEvents(e,t,n){var i,o;const a=new AbortController,s={recursionLimit:(i=this.config)==null?void 0:i.recursionLimit,...t,callbacks:fB((o=this.config)==null?void 0:o.callbacks,t==null?void 0:t.callbacks),signal:qc(t==null?void 0:t.signal,a.signal).signal};return new x_(super.streamEvents(e,s,n),a)}async _validateInput(e){return e}async _validateContext(e){return e}async*_streamIterator(e,t){const n="version"in(t??{})?void 0:(t==null?void 0:t.encoding)??void 0,a=t==null?void 0:t.subgraphs,s=R8(this.config,t);if(s.recursionLimit===void 0||s.recursionLimit<1)throw new Error('Passed "recursionLimit" must be at least 1.');if(this.checkpointer!==void 0&&this.checkpointer!==!1&&s.configurable===void 0)throw new Error('Checkpointer requires one or more of the following "configurable" keys: "thread_id", "checkpoint_ns", "checkpoint_id"');const i=await this._validateInput(e),{runId:o,...u}=s,[l,c,,d,h,f,p,m,v,_,w,E]=this._defaults(u);typeof h.context<"u"?h.context=await this._validateContext(h.context):h.configurable=await this._validateContext(h.configurable);const F=new Z8({modes:new Set(c)});if(this.checkpointer===!0){h.configurable??(h.configurable={});const te=h.configurable[Aa]??"";h.configurable[Aa]=te.split(Tr).map(ve=>ve.split(ts)[0]).join(Tr)}if(c.includes("messages")){const te=new MB(D=>F.push(D)),{callbacks:ve}=h;if(ve===void 0)h.callbacks=[te];else if(Array.isArray(ve))h.callbacks=ve.concat(te);else{const D=ve.copy();D.addHandler(te,!0),h.callbacks=D}}h.writer??(h.writer=te=>{var D,M,P;if(!c.includes("custom"))return;const ve=(P=(M=(D=LD())==null?void 0:D.configurable)==null?void 0:M[Aa])==null?void 0:P.split(Tr).slice(0,-1);F.push([ve??[],"custom",te])}),h.interrupt??(h.interrupt=this.userInterrupt??iB);const k=await yn(h),N=await(k==null?void 0:k.handleChainStart(this.toJSON(),hB(e,"input"),o,void 0,void 0,void 0,(h==null?void 0:h.runName)??this.getName())),B=Bg(this.channels);let A,L;const G=(async()=>{var te,ve,D;try{A=await DB.initialize({input:i,config:h,checkpointer:m,nodes:this.nodes,channelSpecs:B,outputKeys:d,streamKeys:this.streamChannelsAsIs,store:v,cache:w,stream:F,interruptAfter:p,interruptBefore:f,manager:N,debug:this.debug,triggerToNodes:this.triggerToNodes,durability:E});const M=new HB({loop:A,nodeFinished:(te=h.configurable)==null?void 0:te[OD]});t!=null&&t.subgraphs&&(A.config.configurable={...A.config.configurable,[Lc]:A.stream}),await this._runLoop({loop:A,runner:M,debug:l,config:h}),E==="sync"&&await Promise.all((A==null?void 0:A.checkpointerPromises)??[])}catch(M){L=M}finally{try{A&&(await((ve=A.store)==null?void 0:ve.stop()),await((D=A.cache)==null?void 0:D.stop())),await Promise.all((A==null?void 0:A.checkpointerPromises)??[])}catch(M){L=L??M}L?F.error(L):F.close()}})();try{for await(const te of F){if(te===void 0)throw new Error("Data structure error.");const[ve,D,M]=te;if(c.includes(D)){if(n==="text/event-stream"){a?yield[ve,D,M]:yield[null,D,M];continue}a&&!_?yield[ve,D,M]:_?a?yield[ve,M]:yield M:yield[D,M]}}}catch(te){throw await(N==null?void 0:N.handleChainError(L)),te}finally{await G}await(N==null?void 0:N.handleChainEnd((A==null?void 0:A.output)??{},o,void 0,void 0,void 0))}async invoke(e,t){const n=(t==null?void 0:t.streamMode)??"values",a={...t,outputKeys:(t==null?void 0:t.outputKeys)??this.outputChannels,streamMode:n,encoding:void 0},s=[],i=await this.stream(e,a),o=[];let u;for await(const l of i)n==="values"?O8(l)?o.push(l[Ot]):u=l:s.push(l);if(n==="values"){if(o.length>0){const l=o.flat(1);if(u==null)return{[Ot]:l};if(typeof u=="object")return{...u,[Ot]:l}}return u}return s}async _runLoop(e){const{loop:t,runner:n,debug:a,config:s}=e;let i;try{for(;await t.tick({inputKeys:this.inputChannels});){for(const{task:o}of await t._matchCachedWrites())t._outputWrites(o.id,o.writes,!0);a&&kB(t.checkpointMetadata.step,t.channels,this.streamChannelsList),a&&G8(t.step,Object.values(t.tasks)),await n.tick({timeout:this.stepTimeout,retryPolicy:this.retryPolicy,onStepWrite:(o,u)=>{a&&CB(o,u,this.streamChannelsList)},maxConcurrency:s.maxConcurrency,signal:s.signal})}if(t.status==="out_of_steps")throw new IT([`Recursion limit of ${s.recursionLimit} reached`,"without hitting a stop condition. You can increase the",'limit by setting the "recursionLimit" config key.'].join(" "),{lc_error_code:"GRAPH_RECURSION_LIMIT"})}catch(o){if(i=o,!await t.finishAndHandleError(i))throw o}finally{i===void 0&&await t.finishAndHandleError()}}async clearCache(){var e;await((e=this.cache)==null?void 0:e.clear([]))}},po=class J8 extends Ii{constructor(t=!0){super();g(this,"lc_graph_name","EphemeralValue");g(this,"guard");g(this,"value",[]);this.guard=t}fromCheckpoint(t){const n=new J8(this.guard);return typeof t<"u"&&(n.value=[t]),n}update(t){if(t.length===0){const n=this.value.length>0;return this.value=[],n}if(t.length!==1&&this.guard)throw new ar("EphemeralValue can only receive one value per step.");return this.value=[t[t.length-1]],!0}get(){if(this.value.length===0)throw new Lr;return this.value[0]}checkpoint(){if(this.value.length===0)throw new Lr;return this.value[0]}isAvailable(){return this.value.length!==0}};function wt(r,e,t){function n(o,u){var l;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(l=o._zod).traits??(l.traits=new Set),o._zod.traits.add(r),e(o,u);for(const c in i.prototype)c in o||Object.defineProperty(o,c,{value:i.prototype[c].bind(o)});o._zod.constr=i,o._zod.def=u}const a=(t==null?void 0:t.Parent)??Object;class s extends a{}Object.defineProperty(s,"name",{value:r});function i(o){var u;const l=t!=null&&t.Parent?new s:this;n(l,o),(u=l._zod).deferred??(u.deferred=[]);for(const c of l._zod.deferred)c();return l}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:o=>{var u,l;return t!=null&&t.Parent&&o instanceof t.Parent?!0:(l=(u=o==null?void 0:o._zod)==null?void 0:u.traits)==null?void 0:l.has(r)}}),Object.defineProperty(i,"name",{value:r}),i}class Nu extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const YB={};function Ei(r){return YB}function JB(r,e){return typeof e=="bigint"?e.toString():e}function qg(r){return r==null}function Hg(r){const e=r.startsWith("^")?1:0,t=r.endsWith("$")?r.length-1:r.length;return r.slice(e,t)}function gr(r,e,t){Object.defineProperty(r,e,{get(){{const n=t();return r[e]=n,n}},set(n){Object.defineProperty(r,e,{value:n})},configurable:!0})}function XB(r=10){const e="abcdefghijklmnopqrstuvwxyz";let t="";for(let n=0;n<r;n++)t+=e[Math.floor(Math.random()*e.length)];return t}const X8=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};function C_(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function T_(r){if(C_(r)===!1)return!1;const e=r.constructor;if(e===void 0)return!0;const t=e.prototype;return!(C_(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}function QB(r,e,t){const n=new r._zod.constr(e??r._zod.def);return(!e||t!=null&&t.parent)&&(n._zod.parent=r),n}function Qs(r){const e=r;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function su(r,e=0){for(let t=e;t<r.issues.length;t++)if(r.issues[t].continue!==!0)return!0;return!1}function eM(r,e){return e.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(r),t})}function Pl(r){return typeof r=="string"?r:r==null?void 0:r.message}function xi(r,e,t){var a,s,i,o,u,l;const n={...r,path:r.path??[]};if(!r.message){const c=Pl((i=(s=(a=r.inst)==null?void 0:a._zod.def)==null?void 0:s.error)==null?void 0:i.call(s,r))??Pl((o=e==null?void 0:e.error)==null?void 0:o.call(e,r))??Pl((u=t.customError)==null?void 0:u.call(t,r))??Pl((l=t.localeError)==null?void 0:l.call(t,r))??"Invalid input";n.message=c}return delete n.inst,delete n.continue,e!=null&&e.reportInput||delete n.input,n}function Vg(r){return Array.isArray(r)?"array":typeof r=="string"?"string":"unknown"}function Iu(...r){const[e,t,n]=r;return typeof e=="string"?{message:e,code:"custom",input:t,inst:n}:{...e}}const Q8=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(e,JB,2)},enumerable:!0})},e7=wt("$ZodError",Q8),t7=wt("$ZodError",Q8,{Parent:Error});function tM(r,e=t=>t.message){const t={},n=[];for(const a of r.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):n.push(e(a));return{formErrors:n,fieldErrors:t}}function rM(r,e){const t=e||function(s){return s.message},n={_errors:[]},a=s=>{for(const i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(o=>a({issues:o}));else if(i.code==="invalid_key")a({issues:i.issues});else if(i.code==="invalid_element")a({issues:i.issues});else if(i.path.length===0)n._errors.push(t(i));else{let o=n,u=0;for(;u<i.path.length;){const l=i.path[u];u===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return a(r),n}const nM=r=>(e,t,n,a)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise)throw new Nu;if(i.issues.length){const o=new((a==null?void 0:a.Err)??r)(i.issues.map(u=>xi(u,s,Ei())));throw X8(o,a==null?void 0:a.callee),o}return i.value},aM=r=>async(e,t,n,a)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const o=new((a==null?void 0:a.Err)??r)(i.issues.map(u=>xi(u,s,Ei())));throw X8(o,a==null?void 0:a.callee),o}return i.value},r7=r=>(e,t,n)=>{const a=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:t,issues:[]},a);if(s instanceof Promise)throw new Nu;return s.issues.length?{success:!1,error:new(r??e7)(s.issues.map(i=>xi(i,a,Ei())))}:{success:!0,data:s.value}},sM=r7(t7),n7=r=>async(e,t,n)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let s=e._zod.run({value:t,issues:[]},a);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new r(s.issues.map(i=>xi(i,a,Ei())))}:{success:!0,data:s.value}},iM=n7(t7),Fo=wt("$ZodCheck",(r,e)=>{var t;r._zod??(r._zod={}),r._zod.def=e,(t=r._zod).onattach??(t.onattach=[])}),oM=wt("$ZodCheckMaxLength",(r,e)=>{Fo.init(r,e),r._zod.when=t=>{const n=t.value;return!qg(n)&&n.length!==void 0},r._zod.onattach.push(t=>{const n=t._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<n&&(t._zod.bag.maximum=e.maximum)}),r._zod.check=t=>{const n=t.value;if(n.length<=e.maximum)return;const s=Vg(n);t.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:n,inst:r,continue:!e.abort})}}),uM=wt("$ZodCheckMinLength",(r,e)=>{Fo.init(r,e),r._zod.when=t=>{const n=t.value;return!qg(n)&&n.length!==void 0},r._zod.onattach.push(t=>{const n=t._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>n&&(t._zod.bag.minimum=e.minimum)}),r._zod.check=t=>{const n=t.value;if(n.length>=e.minimum)return;const s=Vg(n);t.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:n,inst:r,continue:!e.abort})}}),lM=wt("$ZodCheckLengthEquals",(r,e)=>{Fo.init(r,e),r._zod.when=t=>{const n=t.value;return!qg(n)&&n.length!==void 0},r._zod.onattach.push(t=>{const n=t._zod.bag;n.minimum=e.length,n.maximum=e.length,n.length=e.length}),r._zod.check=t=>{const n=t.value,a=n.length;if(a===e.length)return;const s=Vg(n),i=a>e.length;t.issues.push({origin:s,...i?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},input:t.value,inst:r,continue:!e.abort})}}),cM=wt("$ZodCheckOverwrite",(r,e)=>{Fo.init(r,e),r._zod.check=t=>{t.value=e.tx(t.value)}}),dM={major:4,minor:0,patch:0},sn=wt("$ZodType",(r,e)=>{var a;var t;r??(r={}),gr(r._zod,"id",()=>e.type+"_"+XB(10)),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=dM;const n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(const s of n)for(const i of s._zod.onattach)i(r);if(n.length===0)(t=r._zod).deferred??(t.deferred=[]),(a=r._zod.deferred)==null||a.push(()=>{r._zod.run=r._zod.parse});else{const s=(i,o,u)=>{let l=su(i),c;for(const d of o){if(d._zod.when){if(!d._zod.when(i))continue}else if(l)continue;const h=i.issues.length,f=d._zod.check(i);if(f instanceof Promise&&(u==null?void 0:u.async)===!1)throw new Nu;if(c||f instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await f,i.issues.length!==h&&(l||(l=su(i,h)))});else{if(i.issues.length===h)continue;l||(l=su(i,h))}}return c?c.then(()=>i):i};r._zod.run=(i,o)=>{const u=r._zod.parse(i,o);if(u instanceof Promise){if(o.async===!1)throw new Nu;return u.then(l=>s(l,n,o))}return s(u,n,o)}}r["~standard"]={validate:s=>{var i;try{const o=sM(r,s);return o.success?{value:o.data}:{issues:(i=o.error)==null?void 0:i.issues}}catch{return iM(r,s).then(u=>{var l;return u.success?{value:u.data}:{issues:(l=u.error)==null?void 0:l.issues}})}},vendor:"zod",version:1}}),hM=wt("$ZodAny",(r,e)=>{sn.init(r,e),r._zod.parse=t=>t});function F_(r,e,t){r.issues.length&&e.issues.push(...eM(t,r.issues)),e.value[t]=r.value}const fM=wt("$ZodArray",(r,e)=>{sn.init(r,e),r._zod.parse=(t,n)=>{const a=t.value;if(!Array.isArray(a))return t.issues.push({expected:"array",code:"invalid_type",input:a,inst:r}),t;t.value=Array(a.length);const s=[];for(let i=0;i<a.length;i++){const o=a[i],u=e.element._zod.run({value:o,issues:[]},n);u instanceof Promise?s.push(u.then(l=>F_(l,t,i))):F_(u,t,i)}return s.length?Promise.all(s).then(()=>t):t}});function N_(r,e,t,n){for(const a of r)if(a.issues.length===0)return e.value=a.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:t,errors:r.map(a=>a.issues.map(s=>xi(s,n,Ei())))}),e}const pM=wt("$ZodUnion",(r,e)=>{sn.init(r,e),gr(r._zod,"values",()=>{if(e.options.every(t=>t._zod.values))return new Set(e.options.flatMap(t=>Array.from(t._zod.values)))}),gr(r._zod,"pattern",()=>{if(e.options.every(t=>t._zod.pattern)){const t=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${t.map(n=>Hg(n.source)).join("|")})$`)}}),r._zod.parse=(t,n)=>{let a=!1;const s=[];for(const i of e.options){const o=i._zod.run({value:t.value,issues:[]},n);if(o instanceof Promise)s.push(o),a=!0;else{if(o.issues.length===0)return o;s.push(o)}}return a?Promise.all(s).then(i=>N_(i,t,r,n)):N_(s,t,r,n)}}),mM=wt("$ZodIntersection",(r,e)=>{sn.init(r,e),r._zod.parse=(t,n)=>{const{value:a}=t,s=e.left._zod.run({value:a,issues:[]},n),i=e.right._zod.run({value:a,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([u,l])=>I_(t,u,l)):I_(t,s,i)}});function Hp(r,e){if(r===e)return{valid:!0,data:r};if(r instanceof Date&&e instanceof Date&&+r==+e)return{valid:!0,data:r};if(T_(r)&&T_(e)){const t=Object.keys(e),n=Object.keys(r).filter(s=>t.indexOf(s)!==-1),a={...r,...e};for(const s of n){const i=Hp(r[s],e[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};a[s]=i.data}return{valid:!0,data:a}}if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return{valid:!1,mergeErrorPath:[]};const t=[];for(let n=0;n<r.length;n++){const a=r[n],s=e[n],i=Hp(a,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};t.push(i.data)}return{valid:!0,data:t}}return{valid:!1,mergeErrorPath:[]}}function I_(r,e,t){if(e.issues.length&&r.issues.push(...e.issues),t.issues.length&&r.issues.push(...t.issues),su(r))return r;const n=Hp(e.value,t.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return r.value=n.data,r}const gM=wt("$ZodTransform",(r,e)=>{sn.init(r,e),r._zod.parse=(t,n)=>{const a=e.transform(t.value,t);if(n.async)return(a instanceof Promise?a:Promise.resolve(a)).then(i=>(t.value=i,t));if(a instanceof Promise)throw new Nu;return t.value=a,t}}),yM=wt("$ZodOptional",(r,e)=>{sn.init(r,e),r._zod.optin="optional",r._zod.optout="optional",gr(r._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),gr(r._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${Hg(t.source)})?$`):void 0}),r._zod.parse=(t,n)=>t.value===void 0?t:e.innerType._zod.run(t,n)}),vM=wt("$ZodNullable",(r,e)=>{sn.init(r,e),gr(r._zod,"optin",()=>e.innerType._zod.optin),gr(r._zod,"optout",()=>e.innerType._zod.optout),gr(r._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${Hg(t.source)}|null)$`):void 0}),gr(r._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),r._zod.parse=(t,n)=>t.value===null?t:e.innerType._zod.run(t,n)}),_M=wt("$ZodDefault",(r,e)=>{sn.init(r,e),r._zod.optin="optional",gr(r._zod,"values",()=>e.innerType._zod.values),r._zod.parse=(t,n)=>{if(t.value===void 0)return t.value=e.defaultValue,t;const a=e.innerType._zod.run(t,n);return a instanceof Promise?a.then(s=>O_(s,e)):O_(a,e)}});function O_(r,e){return r.value===void 0&&(r.value=e.defaultValue),r}const bM=wt("$ZodPrefault",(r,e)=>{sn.init(r,e),r._zod.optin="optional",gr(r._zod,"values",()=>e.innerType._zod.values),r._zod.parse=(t,n)=>(t.value===void 0&&(t.value=e.defaultValue),e.innerType._zod.run(t,n))}),wM=wt("$ZodNonOptional",(r,e)=>{sn.init(r,e),gr(r._zod,"values",()=>{const t=e.innerType._zod.values;return t?new Set([...t].filter(n=>n!==void 0)):void 0}),r._zod.parse=(t,n)=>{const a=e.innerType._zod.run(t,n);return a instanceof Promise?a.then(s=>R_(s,r)):R_(a,r)}});function R_(r,e){return!r.issues.length&&r.value===void 0&&r.issues.push({code:"invalid_type",expected:"nonoptional",input:r.value,inst:e}),r}const EM=wt("$ZodCatch",(r,e)=>{sn.init(r,e),gr(r._zod,"optin",()=>e.innerType._zod.optin),gr(r._zod,"optout",()=>e.innerType._zod.optout),gr(r._zod,"values",()=>e.innerType._zod.values),r._zod.parse=(t,n)=>{const a=e.innerType._zod.run(t,n);return a instanceof Promise?a.then(s=>(t.value=s.value,s.issues.length&&(t.value=e.catchValue({...t,error:{issues:s.issues.map(i=>xi(i,n,Ei()))},input:t.value}),t.issues=[]),t)):(t.value=a.value,a.issues.length&&(t.value=e.catchValue({...t,error:{issues:a.issues.map(s=>xi(s,n,Ei()))},input:t.value}),t.issues=[]),t)}}),xM=wt("$ZodPipe",(r,e)=>{sn.init(r,e),gr(r._zod,"values",()=>e.in._zod.values),gr(r._zod,"optin",()=>e.in._zod.optin),gr(r._zod,"optout",()=>e.out._zod.optout),r._zod.parse=(t,n)=>{const a=e.in._zod.run(t,n);return a instanceof Promise?a.then(s=>D_(s,e,n)):D_(a,e,n)}});function D_(r,e,t){return su(r)?r:e.out._zod.run({value:r.value,issues:r.issues},t)}const SM=wt("$ZodReadonly",(r,e)=>{sn.init(r,e),gr(r._zod,"propValues",()=>e.innerType._zod.propValues),gr(r._zod,"optin",()=>e.innerType._zod.optin),gr(r._zod,"optout",()=>e.innerType._zod.optout),r._zod.parse=(t,n)=>{const a=e.innerType._zod.run(t,n);return a instanceof Promise?a.then(B_):B_(a)}});function B_(r){return r.value=Object.freeze(r.value),r}const AM=wt("$ZodCustom",(r,e)=>{Fo.init(r,e),sn.init(r,e),r._zod.parse=(t,n)=>t,r._zod.check=t=>{const n=t.value,a=e.fn(n);if(a instanceof Promise)return a.then(s=>M_(s,t,n,r));M_(a,t,n,r)}});function M_(r,e,t,n){if(!r){const a={code:"custom",input:t,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(a.params=n._zod.def.params),e.issues.push(Iu(a))}}class kM{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const n=t[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const n={...this.get(t)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function CM(){return new kM}const Ll=CM();function TM(r){return new r({type:"any"})}function FM(r,e){return new oM({check:"max_length",...Qs(e),maximum:r})}function $_(r,e){return new uM({check:"min_length",...Qs(e),minimum:r})}function NM(r,e){return new lM({check:"length_equals",...Qs(e),length:r})}function IM(r){return new cM({check:"overwrite",tx:r})}function OM(r,e,t){return new r({type:"array",element:e,...Qs(t)})}function RM(r,e,t){return new r({type:"custom",check:"custom",fn:e,...Qs(t)})}const DM=(r,e)=>{e7.init(r,e),r.name="ZodError",Object.defineProperties(r,{format:{value:t=>rM(r,t)},flatten:{value:t=>tM(r,t)},addIssue:{value:t=>r.issues.push(t)},addIssues:{value:t=>r.issues.push(...t)},isEmpty:{get(){return r.issues.length===0}}})},D0=wt("ZodError",DM,{Parent:Error}),BM=nM(D0),MM=aM(D0),$M=r7(D0),PM=n7(D0),En=wt("ZodType",(r,e)=>(sn.init(r,e),r.def=e,Object.defineProperty(r,"_def",{value:e}),r.check=(...t)=>r.clone({...e,checks:[...e.checks??[],...t.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),r.clone=(t,n)=>QB(r,t,n),r.brand=()=>r,r.register=(t,n)=>(t.add(r,n),r),r.parse=(t,n)=>BM(r,t,n,{callee:r.parse}),r.safeParse=(t,n)=>$M(r,t,n),r.parseAsync=async(t,n)=>MM(r,t,n,{callee:r.parseAsync}),r.safeParseAsync=async(t,n)=>PM(r,t,n),r.spa=r.safeParseAsync,r.refine=(t,n)=>r.check(l$(t,n)),r.superRefine=t=>r.check(c$(t)),r.overwrite=t=>r.check(IM(t)),r.optional=()=>P_(r),r.nullable=()=>L_(r),r.nullish=()=>P_(L_(r)),r.nonoptional=t=>t$(r,t),r.array=()=>UM(r),r.or=t=>qM([r,t]),r.and=t=>VM(r,t),r.transform=t=>z_(r,ZM(t)),r.default=t=>JM(r,t),r.prefault=t=>QM(r,t),r.catch=t=>n$(r,t),r.pipe=t=>z_(r,t),r.readonly=()=>i$(r),r.describe=t=>{const n=r.clone();return Ll.add(n,{description:t}),n},Object.defineProperty(r,"description",{get(){var t;return(t=Ll.get(r))==null?void 0:t.description},configurable:!0}),r.meta=(...t)=>{if(t.length===0)return Ll.get(r);const n=r.clone();return Ll.add(n,t[0]),n},r.isOptional=()=>r.safeParse(void 0).success,r.isNullable=()=>r.safeParse(null).success,r)),LM=wt("ZodAny",(r,e)=>{hM.init(r,e),En.init(r,e)});function zl(){return TM(LM)}const zM=wt("ZodArray",(r,e)=>{fM.init(r,e),En.init(r,e),r.element=e.element,r.min=(t,n)=>r.check($_(t,n)),r.nonempty=t=>r.check($_(1,t)),r.max=(t,n)=>r.check(FM(t,n)),r.length=(t,n)=>r.check(NM(t,n)),r.unwrap=()=>r.element});function UM(r,e){return OM(zM,r,e)}const jM=wt("ZodUnion",(r,e)=>{pM.init(r,e),En.init(r,e),r.options=e.options});function qM(r,e){return new jM({type:"union",options:r,...Qs(e)})}const HM=wt("ZodIntersection",(r,e)=>{mM.init(r,e),En.init(r,e)});function VM(r,e){return new HM({type:"intersection",left:r,right:e})}const GM=wt("ZodTransform",(r,e)=>{gM.init(r,e),En.init(r,e),r._zod.parse=(t,n)=>{t.addIssue=s=>{if(typeof s=="string")t.issues.push(Iu(s,t.value,e));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=t.value),i.inst??(i.inst=r),i.continue??(i.continue=!0),t.issues.push(Iu(i))}};const a=e.transform(t.value,t);return a instanceof Promise?a.then(s=>(t.value=s,t)):(t.value=a,t)}});function ZM(r){return new GM({type:"transform",transform:r})}const KM=wt("ZodOptional",(r,e)=>{yM.init(r,e),En.init(r,e),r.unwrap=()=>r._zod.def.innerType});function P_(r){return new KM({type:"optional",innerType:r})}const WM=wt("ZodNullable",(r,e)=>{vM.init(r,e),En.init(r,e),r.unwrap=()=>r._zod.def.innerType});function L_(r){return new WM({type:"nullable",innerType:r})}const YM=wt("ZodDefault",(r,e)=>{_M.init(r,e),En.init(r,e),r.unwrap=()=>r._zod.def.innerType,r.removeDefault=r.unwrap});function JM(r,e){return new YM({type:"default",innerType:r,get defaultValue(){return typeof e=="function"?e():e}})}const XM=wt("ZodPrefault",(r,e)=>{bM.init(r,e),En.init(r,e),r.unwrap=()=>r._zod.def.innerType});function QM(r,e){return new XM({type:"prefault",innerType:r,get defaultValue(){return typeof e=="function"?e():e}})}const e$=wt("ZodNonOptional",(r,e)=>{wM.init(r,e),En.init(r,e),r.unwrap=()=>r._zod.def.innerType});function t$(r,e){return new e$({type:"nonoptional",innerType:r,...Qs(e)})}const r$=wt("ZodCatch",(r,e)=>{EM.init(r,e),En.init(r,e),r.unwrap=()=>r._zod.def.innerType,r.removeCatch=r.unwrap});function n$(r,e){return new r$({type:"catch",innerType:r,catchValue:typeof e=="function"?e:()=>e})}const a$=wt("ZodPipe",(r,e)=>{xM.init(r,e),En.init(r,e),r.in=e.in,r.out=e.out});function z_(r,e){return new a$({type:"pipe",in:r,out:e})}const s$=wt("ZodReadonly",(r,e)=>{SM.init(r,e),En.init(r,e)});function i$(r){return new s$({type:"readonly",innerType:r})}const o$=wt("ZodCustom",(r,e)=>{AM.init(r,e),En.init(r,e)});function u$(r,e){const t=new Fo({check:"custom",...Qs(e)});return t._zod.check=r,t}function l$(r,e={}){return RM(o$,r,e)}function c$(r,e){const t=u$(n=>(n.addIssue=a=>{if(typeof a=="string")n.issues.push(Iu(a,n.value,t._zod.def));else{const s=a;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),n.issues.push(Iu(s))}},r(n.value,n)),e);return t}var a7=class{constructor(r){g(this,"path");g(this,"ends");At.isRunnable(r.path)?this.path=r.path:this.path=Pr(r.path).withConfig({runName:"Branch"}),this.ends=Array.isArray(r.pathMap)?r.pathMap.reduce((e,t)=>(e[t]=t,e),{}):r.pathMap}run(r,e){return Xr.registerWriter(new Oi({name:"<branch_run>",trace:!1,func:async(t,n)=>{try{return await this._route(t,n,r,e)}catch(a){throw a.name===O6.unminifiable_name&&console.warn(`[WARN]: 'NodeInterrupt' thrown in conditional edge. This is likely a bug in your graph implementation.
NodeInterrupt should only be thrown inside a node, not in edge conditions.`),a}}}))}async _route(r,e,t,n){let a=await this.path.invoke(n?n(e):r,e);Array.isArray(a)||(a=[a]);let s;if(this.ends?s=a.map(o=>Nn(o)?o:this.ends[o]):s=a,s.some(o=>!o))throw new Error("Branch condition returned unknown or null destination");if(s.filter(Nn).some(o=>o.node===Ct))throw new ar("Cannot send a packet to the END node");return await t(s,e)??r}},d$=class{constructor(){g(this,"nodes");g(this,"edges");g(this,"branches");g(this,"entryPoint");g(this,"compiled",!1);this.nodes={},this.edges=new Set,this.branches={}}warnIfCompiled(r){this.compiled&&console.warn(r)}get allEdges(){return this.edges}addNode(...r){function e(n){return n.length>=1&&typeof n[0]!="string"}const t=e(r)?Array.isArray(r[0])?r[0]:Object.entries(r[0]):[[r[0],r[1],r[2]]];if(t.length===0)throw new Error("No nodes provided in `addNode`");for(const[n,a,s]of t){for(const o of[Tr,ts])if(n.includes(o))throw new Error(`"${o}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),n in this.nodes)throw new Error(`Node \`${n}\` already present.`);if(n===Ct)throw new Error(`Node \`${n}\` is reserved.`);const i=Pr(a);this.nodes[n]={runnable:i,metadata:s==null?void 0:s.metadata,subgraphs:zg(i)?[i]:s==null?void 0:s.subgraphs,ends:s==null?void 0:s.ends}}return this}addEdge(r,e){if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),r===Ct)throw new Error("END cannot be a start node");if(e===Vt)throw new Error("START cannot be an end node");if(Array.from(this.edges).some(([t])=>t===r)&&!("channels"in this))throw new Error(`Already found path for ${r}. For multiple edges, use StateGraph.`);return this.edges.add([r,e]),this}addConditionalEdges(r,e,t){var s,i;const n=typeof r=="object"?r:{source:r,path:e,pathMap:t};if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),!At.isRunnable(n.path)){const o=Array.isArray(n.pathMap)?n.pathMap.join(","):Object.keys(n.pathMap??{}).join(",");n.path=Pr(n.path).withConfig({runName:`Branch<${n.source}${o!==""?`,${o}`:""}>`.slice(0,63)})}const a=n.path.getName()==="RunnableLambda"?"condition":n.path.getName();if(this.branches[n.source]&&this.branches[n.source][a])throw new Error(`Condition \`${a}\` already present for node \`${r}\``);return(s=this.branches)[i=n.source]??(s[i]={}),this.branches[n.source][a]=new a7(n),this}setEntryPoint(r){return this.warnIfCompiled("Setting the entry point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(Vt,r)}setFinishPoint(r){return this.warnIfCompiled("Setting a finish point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(r,Ct)}compile({checkpointer:r,interruptBefore:e,interruptAfter:t,name:n}={}){this.validate([...Array.isArray(e)?e:[],...Array.isArray(t)?t:[]]);const a=new s7({builder:this,checkpointer:r,interruptAfter:t,interruptBefore:e,autoValidate:!1,nodes:{},channels:{[Vt]:new po,[Ct]:new po},inputChannels:Vt,outputChannels:Ct,streamChannels:[],streamMode:"values",name:n});for(const[s,i]of Object.entries(this.nodes))a.attachNode(s,i);for(const[s,i]of this.edges)a.attachEdge(s,i);for(const[s,i]of Object.entries(this.branches))for(const[o,u]of Object.entries(i))a.attachBranch(s,o,u);return a.validate()}validate(r){const e=new Set([...this.allEdges].map(([n,a])=>n));for(const[n]of Object.entries(this.branches))e.add(n);for(const n of e)if(n!==Vt&&!(n in this.nodes))throw new Error(`Found edge starting at unknown node \`${n}\``);const t=new Set([...this.allEdges].map(([n,a])=>a));for(const[n,a]of Object.entries(this.branches))for(const s of Object.values(a))if(s.ends!=null)for(const i of Object.values(s.ends))t.add(i);else{t.add(Ct);for(const i of Object.keys(this.nodes))i!==n&&t.add(i)}for(const n of Object.values(this.nodes))for(const a of n.ends??[])t.add(a);for(const n of Object.keys(this.nodes))if(!t.has(n))throw new RT([`Node \`${n}\` is not reachable.`,"","If you are returning Command objects from your node,",'make sure you are passing names of potential destination nodes as an "ends" array','into ".addNode(..., { ends: ["node1", "node2"] })".'].join(`
`),{lc_error_code:"UNREACHABLE_NODE"});for(const n of t)if(n!==Ct&&!(n in this.nodes))throw new Error(`Found edge ending at unknown node \`${n}\``);if(r){for(const n of r)if(!(n in this.nodes))throw new Error(`Interrupt node \`${n}\` is not present`)}this.compiled=!0}},s7=class extends WB{constructor({builder:e,...t}){super(t);g(this,"builder");this.builder=e}attachNode(e,t){this.channels[e]=new po,this.nodes[e]=new Cu({channels:[],triggers:[],metadata:t.metadata,subgraphs:t.subgraphs,ends:t.ends}).pipe(t.runnable).pipe(new Xr([{channel:e,value:yi}],[wr])),this.streamChannels.push(e)}attachEdge(e,t){if(t===Ct){if(e===Vt)throw new Error("Cannot have an edge from START to END");this.nodes[e].writers.push(new Xr([{channel:Ct,value:yi}],[wr]))}else this.nodes[t].triggers.push(e),this.nodes[t].channels.push(e)}attachBranch(e,t,n){e===Vt&&!this.nodes[Vt]&&(this.nodes[Vt]=ZB.subscribeTo(Vt,{tags:[wr]})),this.nodes[e].pipe(n.run(s=>{const i=s.map(o=>Nn(o)?o:{channel:o===Ct?Ct:`branch:${e}:${t}:${o}`,value:yi});return new Xr(i,[wr])}));const a=n.ends?Object.values(n.ends):Object.keys(this.nodes);for(const s of a)if(s!==Ct){const i=`branch:${e}:${t}:${s}`;this.channels[i]=new po,this.nodes[s].triggers.push(i),this.nodes[s].channels.push(i)}}async getGraphAsync(e){var l,c,d,h;const t=e==null?void 0:e.xray,n=new wu,a={[Vt]:n.addNode({schema:zl()},Vt)},s={};let i={};t&&(i=Object.fromEntries((await ks(this.getSubgraphsAsync())).filter(f=>U_(f[1]))));function o(f,p,m,v=!1){if(p===Ct&&s[Ct]===void 0&&(s[Ct]=n.addNode({schema:zl()},Ct)),a[f]!==void 0){if(s[p]===void 0)throw new Error(`End node ${p} not found!`);return n.addEdge(a[f],s[p],m!==p?m:void 0,v)}}for(const[f,p]of Object.entries(this.builder.nodes)){const m=Ur(f),v=p.runnable,_=p.metadata??{};if((l=this.interruptBefore)!=null&&l.includes(f)&&((c=this.interruptAfter)!=null&&c.includes(f))?_.__interrupt="before,after":(d=this.interruptBefore)!=null&&d.includes(f)?_.__interrupt="before":(h=this.interruptAfter)!=null&&h.includes(f)&&(_.__interrupt="after"),t){const w=typeof t=="number"?t-1:t,E=i[f]!==void 0?await i[f].getGraphAsync({...e,xray:w}):v.getGraph(e);if(E.trimFirstNode(),E.trimLastNode(),Object.keys(E.nodes).length>1){let N=function(A){return A?A.lc_runnable:!1},B=function(A,L){if(A!==void 0&&!hi(A))return A;if(N(L))try{let V=L.getName();return V=V.startsWith("Runnable")?V.slice(8):V,V}catch{return L.getName()}else return L.name??"UnknownSchema"};const[F,k]=n.extend(E,m);if(F===void 0)throw new Error(`Could not extend subgraph "${f}" due to missing entrypoint.`);k!==void 0&&(a[m]={name:B(k.id,k.data),...k}),s[m]={name:B(F.id,F.data),...F}}else{const F=n.addNode(v,m,_);a[m]=F,s[m]=F}}else{const w=n.addNode(v,m,_);a[m]=w,s[m]=w}}const u=[...this.builder.allEdges].sort(([f],[p])=>f<p?-1:p>f?1:0);for(const[f,p]of u)o(Ur(f),Ur(p));for(const[f,p]of Object.entries(this.builder.branches)){const m={...Object.fromEntries(Object.keys(this.builder.nodes).filter(v=>v!==f).map(v=>[Ur(v),Ur(v)])),[Ct]:Ct};for(const v of Object.values(p)){let _;v.ends!==void 0?_=v.ends:_=m;for(const[w,E]of Object.entries(_))o(Ur(f),Ur(E),w,!0)}}for(const[f,p]of Object.entries(this.builder.nodes))if(p.ends!==void 0)for(const m of p.ends)o(Ur(f),Ur(m),void 0,!0);return n}getGraph(e){var l,c,d,h;const t=e==null?void 0:e.xray,n=new wu,a={[Vt]:n.addNode({schema:zl()},Vt)},s={};let i={};t&&(i=Object.fromEntries(Go(this.getSubgraphs()).filter(f=>U_(f[1]))));function o(f,p,m,v=!1){return p===Ct&&s[Ct]===void 0&&(s[Ct]=n.addNode({schema:zl()},Ct)),n.addEdge(a[f],s[p],m!==p?m:void 0,v)}for(const[f,p]of Object.entries(this.builder.nodes)){const m=Ur(f),v=p.runnable,_=p.metadata??{};if((l=this.interruptBefore)!=null&&l.includes(f)&&((c=this.interruptAfter)!=null&&c.includes(f))?_.__interrupt="before,after":(d=this.interruptBefore)!=null&&d.includes(f)?_.__interrupt="before":(h=this.interruptAfter)!=null&&h.includes(f)&&(_.__interrupt="after"),t){const w=typeof t=="number"?t-1:t,E=i[f]!==void 0?i[f].getGraph({...e,xray:w}):v.getGraph(e);if(E.trimFirstNode(),E.trimLastNode(),Object.keys(E.nodes).length>1){let N=function(A){return A?A.lc_runnable:!1},B=function(A,L){if(A!==void 0&&!hi(A))return A;if(N(L))try{let V=L.getName();return V=V.startsWith("Runnable")?V.slice(8):V,V}catch{return L.getName()}else return L.name??"UnknownSchema"};const[F,k]=n.extend(E,m);if(F===void 0)throw new Error(`Could not extend subgraph "${f}" due to missing entrypoint.`);k!==void 0&&(a[m]={name:B(k.id,k.data),...k}),s[m]={name:B(F.id,F.data),...F}}else{const F=n.addNode(v,m,_);a[m]=F,s[m]=F}}else{const w=n.addNode(v,m,_);a[m]=w,s[m]=w}}const u=[...this.builder.allEdges].sort(([f],[p])=>f<p?-1:p>f?1:0);for(const[f,p]of u)o(Ur(f),Ur(p));for(const[f,p]of Object.entries(this.builder.branches)){const m={...Object.fromEntries(Object.keys(this.builder.nodes).filter(v=>v!==f).map(v=>[Ur(v),Ur(v)])),[Ct]:Ct};for(const v of Object.values(p)){let _;v.ends!==void 0?_=v.ends:_=m;for(const[w,E]of Object.entries(_))o(Ur(f),Ur(E),w,!0)}}return n}};function U_(r){return typeof r.attachNode=="function"&&typeof r.attachEdge=="function"}function Ur(r){return r==="subgraph"?`"${r}"`:r}const ci=(r,e)=>r.size===e.size&&[...r].every(t=>e.has(t));var h$=class i7 extends Ii{constructor(t){super();g(this,"lc_graph_name","NamedBarrierValue");g(this,"names");g(this,"seen");this.names=t,this.seen=new Set}fromCheckpoint(t){const n=new i7(this.names);return typeof t<"u"&&(n.seen=new Set(t)),n}update(t){let n=!1;for(const a of t)if(this.names.has(a))this.seen.has(a)||(this.seen.add(a),n=!0);else throw new ar(`Value ${JSON.stringify(a)} not in names ${JSON.stringify(this.names)}`);return n}get(){if(!ci(this.names,this.seen))throw new Lr}checkpoint(){return[...this.seen]}consume(){return this.seen&&this.names&&ci(this.seen,this.names)?(this.seen=new Set,!0):!1}isAvailable(){return!!this.names&&ci(this.names,this.seen)}},f$=class o7 extends Ii{constructor(t){super();g(this,"lc_graph_name","NamedBarrierValueAfterFinish");g(this,"names");g(this,"seen");g(this,"finished");this.names=t,this.seen=new Set,this.finished=!1}fromCheckpoint(t){const n=new o7(this.names);if(typeof t<"u"){const[a,s]=t;n.seen=new Set(a),n.finished=s}return n}update(t){let n=!1;for(const a of t)if(this.names.has(a)&&!this.seen.has(a))this.seen.add(a),n=!0;else if(!this.names.has(a))throw new ar(`Value ${JSON.stringify(a)} not in names ${JSON.stringify(this.names)}`);return n}get(){if(!this.finished||!ci(this.names,this.seen))throw new Lr}checkpoint(){return[[...this.seen],this.finished]}consume(){return this.finished&&this.seen&&this.names&&ci(this.seen,this.names)?(this.seen=new Set,this.finished=!1,!0):!1}finish(){return!this.finished&&this.names&&ci(this.names,this.seen)?(this.finished=!0,!0):!1}isAvailable(){return this.finished&&!!this.names&&ci(this.names,this.seen)}};const p$="lg:";var m$=class{constructor(){g(this,"_map",new WeakMap);g(this,"_extensionCache",new Map)}get(r){return this._map.get(r)}extend(r,e){const t=this.get(r);this._map.set(r,e(t))}remove(r){return this._map.delete(r),this}has(r){return this._map.has(r)}getChannelsForSchema(r){const e={},t=_u(r);for(const[n,a]of Object.entries(t)){const s=this.get(a);s!=null&&s.reducer?e[n]=new Bp(s.reducer.fn,s.default):e[n]=new Mg}return e}getExtendedChannelSchemas(r,e){if(Object.keys(e).length===0)return r;const t=Object.entries(e).filter(([,s])=>s===!0).sort(([s],[i])=>s.localeCompare(i)).map(([s,i])=>`${s}:${i}`).join("|"),n=this._extensionCache.get(t)??new WeakMap;if(n.has(r))return n.get(r);let a=r;if(e.withReducerSchema||e.withJsonSchemaExtrasAsDescription){const s=Object.entries(_u(r)).map(([i,o])=>{var c;const u=this.get(o);let l=e.withReducerSchema?((c=u==null?void 0:u.reducer)==null?void 0:c.schema)??o:o;if(e.withJsonSchemaExtrasAsDescription&&(u!=null&&u.jsonSchemaExtra)){const d=vu(l)??vu(o),h=JSON.stringify({...u.jsonSchemaExtra,description:d});l=l.describe(`${p$}${h}`)}return[i,l]});a=a2(r,Object.fromEntries(s)),xr(a)&&(a._def.unknownKeys="strip")}return e.asPartial&&(a=ag(a)),n.set(r,a),this._extensionCache.set(t,n),a}};const Hc=new m$;function g$(r,e){var t;if(e.reducer&&!e.default){const n=s2(r);n!=null&&(e.default=n)}if(e.reducer){const n=Object.assign(r,{lg_reducer_schema:((t=e.reducer)==null?void 0:t.schema)??r});return Hc.extend(n,()=>e),n}else return Hc.extend(r,()=>e),r}const Wa="__root__",Vp=Symbol.for("langgraph.state.partial");var y$=class extends d${constructor(e,t){var a,s;super();g(this,"channels",{});g(this,"waitingEdges",new Set);g(this,"_schemaDefinition");g(this,"_schemaRuntimeDefinition");g(this,"_inputDefinition");g(this,"_inputRuntimeDefinition");g(this,"_outputDefinition");g(this,"_outputRuntimeDefinition");g(this,"_schemaDefinitions",new Map);g(this,"_metaRegistry",Hc);g(this,"_configSchema");g(this,"_configRuntimeSchema");g(this,"_interrupt");g(this,"_writer");if(S$(e)){const i=this._metaRegistry.getChannelsForSchema(e.state),o=e.input!=null?this._metaRegistry.getChannelsForSchema(e.input):i,u=e.output!=null?this._metaRegistry.getChannelsForSchema(e.output):i;this._schemaDefinition=i,this._schemaRuntimeDefinition=e.state,this._inputDefinition=o,this._inputRuntimeDefinition=e.input??Vp,this._outputDefinition=u,this._outputRuntimeDefinition=e.output??e.state}else if(sa(e)){const i=this._metaRegistry.getChannelsForSchema(e);this._schemaDefinition=i,this._schemaRuntimeDefinition=e,this._inputDefinition=i,this._inputRuntimeDefinition=Vp,this._outputDefinition=i,this._outputRuntimeDefinition=e}else if(x$(e))this._schemaDefinition=e.input.spec,this._inputDefinition=e.input.spec,this._outputDefinition=e.output.spec;else if(E$(e))this._schemaDefinition=e.stateSchema.spec,this._inputDefinition=((a=e.input)==null?void 0:a.spec)??this._schemaDefinition,this._outputDefinition=((s=e.output)==null?void 0:s.spec)??this._schemaDefinition;else if(b$(e)||j_(e)){const i=j_(e)?e.spec:e;this._schemaDefinition=i}else if(w$(e)){const i=v$(e.channels);this._schemaDefinition=i}else throw new Error("Invalid StateGraph input. Make sure to pass a valid Annotation.Root or Zod schema.");this._inputDefinition??(this._inputDefinition=this._schemaDefinition),this._outputDefinition??(this._outputDefinition=this._schemaDefinition),this._addSchema(this._schemaDefinition),this._addSchema(this._inputDefinition),this._addSchema(this._outputDefinition);function n(i){return typeof i=="object"&&i!=null&&!("spec"in i)&&!sa(i)}n(t)?(sa(t.context)&&(this._configRuntimeSchema=t.context),this._interrupt=t.interrupt,this._writer=t.writer):sa(t)&&(this._configRuntimeSchema=t)}get allEdges(){return new Set([...this.edges,...Array.from(this.waitingEdges).flatMap(([e,t])=>e.map(n=>[n,t]))])}_addSchema(e){if(!this._schemaDefinitions.has(e)){this._schemaDefinitions.set(e,e);for(const[t,n]of Object.entries(e)){let a;if(typeof n=="function"?a=n():a=n,this.channels[t]!==void 0){if(this.channels[t]!==a&&a.lc_graph_name!=="LastValue")throw new Error(`Channel "${t}" already exists with a different type.`)}else this.channels[t]=a}}}addNode(...e){function t(a){return a.length>=1&&typeof a[0]!="string"}const n=t(e)?Array.isArray(e[0])?e[0]:Object.entries(e[0]).map(([a,s])=>[a,s]):[[e[0],e[1],e[2]]];if(n.length===0)throw new Error("No nodes provided in `addNode`");for(const[a,s,i]of n){if(a in this.channels)throw new Error(`${a} is already being used as a state attribute (a.k.a. a channel), cannot also be used as a node name.`);for(const d of[Tr,ts])if(a.includes(d))throw new Error(`"${d}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),a in this.nodes)throw new Error(`Node \`${a}\` already present.`);if(a===Ct||a===Vt)throw new Error(`Node \`${a}\` is reserved.`);let o=this._schemaDefinition;(i==null?void 0:i.input)!==void 0&&(sa(i.input)?o=this._metaRegistry.getChannelsForSchema(i.input):i.input.spec!==void 0&&(o=i.input.spec)),o!==void 0&&this._addSchema(o);let u;At.isRunnable(s)?u=s:typeof s=="function"?u=new Oi({func:s,name:a,trace:!1}):u=Pr(s);let l=i==null?void 0:i.cachePolicy;typeof l=="boolean"&&(l=l?{}:void 0);const c={runnable:u,retryPolicy:i==null?void 0:i.retryPolicy,cachePolicy:l,metadata:i==null?void 0:i.metadata,input:o??this._schemaDefinition,subgraphs:zg(u)?[u]:i==null?void 0:i.subgraphs,ends:i==null?void 0:i.ends,defer:i==null?void 0:i.defer};this.nodes[a]=c}return this}addEdge(e,t){if(typeof e=="string")return super.addEdge(e,t);this.compiled&&console.warn("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph.");for(const n of e){if(n===Ct)throw new Error("END cannot be a start node");if(!Object.keys(this.nodes).some(a=>a===n))throw new Error(`Need to add a node named "${n}" first`)}if(t===Ct)throw new Error("END cannot be an end node");if(!Object.keys(this.nodes).some(n=>n===t))throw new Error(`Need to add a node named "${t}" first`);return this.waitingEdges.add([e,t]),this}addSequence(e){const t=Array.isArray(e)?e:Object.entries(e);if(t.length===0)throw new Error("Sequence requires at least one node.");let n;for(const[a,s,i]of t){if(a in this.nodes)throw new Error(`Node names must be unique: node with the name "${a}" already exists.`);const o=a;this.addNode(o,s,i),n!=null&&this.addEdge(n,o),n=o}return this}compile({checkpointer:e,store:t,cache:n,interruptBefore:a,interruptAfter:s,name:i,description:o}={}){this.validate([...Array.isArray(a)?a:[],...Array.isArray(s)?s:[]]);const u=Object.keys(this._schemaDefinitions.get(this._outputDefinition)),l=u.length===1&&u[0]===Wa?Wa:u,c=Object.keys(this.channels),d=c.length===1&&c[0]===Wa?Wa:c,h=this._interrupt,f=new _$({builder:this,checkpointer:e,interruptAfter:s,interruptBefore:a,autoValidate:!1,nodes:{},channels:{...this.channels,[Vt]:new po},inputChannels:Vt,outputChannels:l,streamChannels:d,streamMode:"updates",store:t,cache:n,name:i,description:o,userInterrupt:h});f.attachNode(Vt);for(const[p,m]of Object.entries(this.nodes))f.attachNode(p,m);f.attachBranch(Vt,y_,q_(),{withReader:!1});for(const[p]of Object.entries(this.nodes))f.attachBranch(p,y_,q_(),{withReader:!1});for(const[p,m]of this.edges)f.attachEdge(p,m);for(const[p,m]of this.waitingEdges)f.attachEdge(p,m);for(const[p,m]of Object.entries(this.branches))for(const[v,_]of Object.entries(m))f.attachBranch(p,v,_);return f.validate()}};function v$(r){const e={};for(const[t,n]of Object.entries(r))e[t]=Mp(n);return e}var _$=class extends s7{constructor({description:e,...t}){super(t);g(this,"description");g(this,"_metaRegistry",Hc);this.description=e}attachNode(e,t){let n;e===Vt?n=Object.entries(this.builder._schemaDefinitions.get(this.builder._inputDefinition)).map(([u])=>u):n=Object.keys(this.builder.channels);function a(u){if(hn(u))return u.graph===Fa.PARENT?null:u._updateAsTuples();if(Array.isArray(u)&&u.length>0&&u.some(l=>hn(l))){const l=[];for(const c of u)if(hn(c)){if(c.graph===Fa.PARENT)continue;l.push(...c._updateAsTuples())}else l.push([Wa,c]);return l}else if(u!=null)return[[Wa,u]];return null}const s=e;function i(u){if(u){if(hn(u))return u.graph===Fa.PARENT?null:u._updateAsTuples().filter(([l])=>n.includes(l));if(Array.isArray(u)&&u.length>0&&u.some(hn)){const l=[];for(const c of u)if(hn(c)){if(c.graph===Fa.PARENT)continue;l.push(...c._updateAsTuples().filter(([d])=>n.includes(d)))}else{const d=i(c);d&&l.push(...d??[])}return l}else{if(typeof u=="object"&&!Array.isArray(u))return Object.entries(u).filter(([l])=>n.includes(l));{const l=Array.isArray(u)?"array":typeof u;throw new ar(`Expected node "${s.toString()}" to return an object or an array containing at least one Command object, received ${l}`,{lc_error_code:"INVALID_GRAPH_NODE_RETURN_VALUE"})}}}else return null}const o=[{value:yi,mapper:new Oi({func:n.length&&n[0]===Wa?a:i,trace:!1,recurse:!1})}];if(e===Vt)this.nodes[e]=new Cu({tags:[wr],triggers:[Vt],channels:[Vt],writers:[new Xr(o,[wr])]});else{const u=(t==null?void 0:t.input)??this.builder._schemaDefinition,l=Object.fromEntries(Object.keys(this.builder._schemaDefinitions.get(u)).map(h=>[h,h])),c=Object.keys(l).length===1&&Wa in l,d=`branch:to:${e}`;this.channels[d]=t!=null&&t.defer?new TD:new po(!1),this.nodes[e]=new Cu({triggers:[d],channels:c?Object.keys(l):l,writers:[new Xr(o,[wr])],mapper:c?void 0:h=>Object.fromEntries(Object.entries(h).filter(([f])=>f in l)),bound:t==null?void 0:t.runnable,metadata:t==null?void 0:t.metadata,retryPolicy:t==null?void 0:t.retryPolicy,cachePolicy:t==null?void 0:t.cachePolicy,subgraphs:t==null?void 0:t.subgraphs,ends:t==null?void 0:t.ends})}}attachEdge(e,t){if(t!==Ct){if(typeof e=="string")this.nodes[e].writers.push(new Xr([{channel:`branch:to:${t}`,value:null}],[wr]));else if(Array.isArray(e)){const n=`join:${e.join("+")}:${t}`;this.channels[n]=this.builder.nodes[t].defer?new f$(new Set(e)):new h$(new Set(e)),this.nodes[t].triggers.push(n);for(const a of e)this.nodes[a].writers.push(new Xr([{channel:n,value:a}],[wr]))}}}attachBranch(e,t,n,a={withReader:!0}){const s=async(i,o)=>{const u=i.filter(c=>c!==Ct);if(!u.length)return;const l=u.map(c=>Nn(c)?c:{channel:c===Ct?c:`branch:to:${c}`,value:e});await Xr.doWrite({...o,tags:(o.tags??[]).concat([wr])},l)};this.nodes[e].writers.push(n.run(s,a.withReader?i=>uB.doRead(i,this.streamChannels??this.outputChannels,!0):void 0))}async _validateInput(e){if(e==null)return e;const t=(()=>{const n=this.builder._inputRuntimeDefinition,a=this.builder._schemaRuntimeDefinition,s=i=>{if(i!=null)return this._metaRegistry.getExtendedChannelSchemas(i,{withReducerSchema:!0})};if(sa(n))return s(n);if(n===Vp)return ag(s(a))})();if(hn(e)){const n=e;return e.update&&t!=null&&(n.update=Yl(t,e.update)),n}return t!=null?Yl(t,e):e}isInterrupted(e){return O8(e)}async _validateContext(e){const t=this.builder._configRuntimeSchema;return sa(t)&&Yl(t,e),e}};function b$(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Object.keys(r).length>0&&Object.values(r).every(e=>typeof e=="function"||C8(e))}function j_(r){return typeof r=="object"&&r!==null&&"lc_graph_name"in r&&r.lc_graph_name==="AnnotationRoot"}function w$(r){return typeof r=="object"&&r!==null&&r.channels!==void 0}function E$(r){return typeof r=="object"&&r!==null&&r.stateSchema!==void 0}function x$(r){return typeof r=="object"&&r!==null&&r.stateSchema===void 0&&r.input!==void 0&&r.output!==void 0}function S$(r){return!(typeof r!="object"||r==null||!("state"in r)||!sa(r.state)||"input"in r&&!sa(r.input)||"output"in r&&!sa(r.output))}function A$(r){if(Nn(r))return[r];const e=[];hn(r)?e.push(r):Array.isArray(r)&&e.push(...r.filter(hn));const t=[];for(const n of e){if(n.graph===Fa.PARENT)throw new R6(n);Nn(n.goto)||typeof n.goto=="string"?t.push(n.goto):Array.isArray(n.goto)&&t.push(...n.goto)}return t}function q_(){const r=new Oi({func:A$,tags:[wr],trace:!1,recurse:!1,name:"<control_branch>"});return new a7({path:r})}const k$="__remove_all__";function u7(r,e){const t=Array.isArray(r)?r:[r],n=Array.isArray(e)?e:[e],a=t.map(Oa),s=n.map(Oa);for(const c of a)(c.id===null||c.id===void 0)&&(c.id=Ga(),c.lc_kwargs.id=c.id);let i;for(let c=0;c<s.length;c+=1){const d=s[c];(d.id===null||d.id===void 0)&&(d.id=Ga(),d.lc_kwargs.id=d.id),d.getType()==="remove"&&d.id===k$&&(i=c)}if(i!=null)return s.slice(i+1);const o=[...a],u=new Map(o.map((c,d)=>[c.id,d])),l=new Set;for(const c of s){const d=u.get(c.id);if(d!==void 0)c.getType()==="remove"?l.add(c.id):(l.delete(c.id),o[d]=c);else{if(c.getType()==="remove")throw new Error(`Attempting to delete a message with an ID that doesn't exist ('${c.id}')`);u.set(c.id,o.length),o.push(c)}}return o.filter(c=>!l.has(c.id))}var Dt;(function(r){r.assertEqual=a=>{};function e(a){}r.assertIs=e;function t(a){throw new Error}r.assertNever=t,r.arrayToEnum=a=>{const s={};for(const i of a)s[i]=i;return s},r.getValidEnumValues=a=>{const s=r.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),i={};for(const o of s)i[o]=a[o];return r.objectValues(i)},r.objectValues=a=>r.objectKeys(a).map(function(s){return a[s]}),r.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const s=[];for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&s.push(i);return s},r.find=(a,s)=>{for(const i of a)if(s(i))return i},r.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,s=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}r.joinValues=n,r.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s})(Dt||(Dt={}));var H_;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(H_||(H_={}));const Le=Dt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),As=r=>{switch(typeof r){case"undefined":return Le.undefined;case"string":return Le.string;case"number":return Number.isNaN(r)?Le.nan:Le.number;case"boolean":return Le.boolean;case"function":return Le.function;case"bigint":return Le.bigint;case"symbol":return Le.symbol;case"object":return Array.isArray(r)?Le.array:r===null?Le.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?Le.promise:typeof Map<"u"&&r instanceof Map?Le.map:typeof Set<"u"&&r instanceof Set?Le.set:typeof Date<"u"&&r instanceof Date?Le.date:Le.object;default:return Le.unknown}},fe=Dt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class cs extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(s){return s.message},n={_errors:[]},a=s=>{for(const i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,u=0;for(;u<i.path.length;){const l=i.path[u];u===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return a(this),n}static assert(e){if(!(e instanceof cs))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Dt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):n.push(e(a));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}cs.create=r=>new cs(r);const Gp=(r,e)=>{let t;switch(r.code){case fe.invalid_type:r.received===Le.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case fe.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,Dt.jsonStringifyReplacer)}`;break;case fe.unrecognized_keys:t=`Unrecognized key(s) in object: ${Dt.joinValues(r.keys,", ")}`;break;case fe.invalid_union:t="Invalid input";break;case fe.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Dt.joinValues(r.options)}`;break;case fe.invalid_enum_value:t=`Invalid enum value. Expected ${Dt.joinValues(r.options)}, received '${r.received}'`;break;case fe.invalid_arguments:t="Invalid function arguments";break;case fe.invalid_return_type:t="Invalid function return type";break;case fe.invalid_date:t="Invalid date";break;case fe.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:Dt.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case fe.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case fe.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case fe.custom:t="Invalid input";break;case fe.invalid_intersection_types:t="Intersection results could not be merged";break;case fe.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case fe.not_finite:t="Number must be finite";break;default:t=e.defaultError,Dt.assertNever(r)}return{message:t}};let C$=Gp;function T$(){return C$}const F$=r=>{const{data:e,path:t,errorMaps:n,issueData:a}=r,s=[...t,...a.path||[]],i={...a,path:s};if(a.message!==void 0)return{...a,path:s,message:a.message};let o="";const u=n.filter(l=>!!l).slice().reverse();for(const l of u)o=l(i,{data:e,defaultError:o}).message;return{...a,path:s,message:o}};function Ie(r,e){const t=T$(),n=F$({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Gp?void 0:Gp].filter(a=>!!a)});r.common.issues.push(n)}class In{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const a of t){if(a.status==="aborted")return dt;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const a of t){const s=await a.key,i=await a.value;n.push({key:s,value:i})}return In.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const a of t){const{key:s,value:i}=a;if(s.status==="aborted"||i.status==="aborted")return dt;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}}const dt=Object.freeze({status:"aborted"}),Ko=r=>({status:"dirty",value:r}),Kn=r=>({status:"valid",value:r}),V_=r=>r.status==="aborted",G_=r=>r.status==="dirty",mo=r=>r.status==="valid",Vc=r=>typeof Promise<"u"&&r instanceof Promise;var qe;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(qe||(qe={}));class Ws{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Z_=(r,e)=>{if(mo(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new cs(r.common.issues);return this._error=t,this._error}}};function bt(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:a}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(i,o)=>{const{message:u}=r;return i.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??n??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:a}}class It{get description(){return this._def.description}_getType(e){return As(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:As(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new In,ctx:{common:e.parent.common,data:e.data,parsedType:As(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Vc(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:As(e)},a=this._parseSync({data:e,path:n.path,parent:n});return Z_(n,a)}"~validate"(e){var n,a;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:As(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return mo(s)?{value:s.value}:{issues:t.common.issues}}catch(s){(a=(n=s==null?void 0:s.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>mo(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:As(e)},a=this._parse({data:e,path:n.path,parent:n}),s=await(Vc(a)?a:Promise.resolve(a));return Z_(n,s)}refine(e,t){const n=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,s)=>{const i=e(a),o=()=>s.addIssue({code:fe.custom,...n(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof t=="function"?t(n,a):t),!1))}_refinement(e){return new yo({schema:this,typeName:ht.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return $s.create(this,this._def)}nullable(){return vo.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Da.create(this)}promise(){return Yc.create(this,this._def)}or(e){return Kc.create([this,e],this._def)}and(e){return Wc.create(this,e,this._def)}transform(e){return new yo({...bt(this._def),schema:this,typeName:ht.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Kp({...bt(this._def),innerType:this,defaultValue:t,typeName:ht.ZodDefault})}brand(){return new X$({typeName:ht.ZodBranded,type:this,...bt(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Wp({...bt(this._def),innerType:this,catchValue:t,typeName:ht.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Gg.create(this,e)}readonly(){return Yp.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const N$=/^c[^\s-]{8,}$/i,I$=/^[0-9a-z]+$/,O$=/^[0-9A-HJKMNP-TV-Z]{26}$/i,R$=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,D$=/^[a-z0-9_-]{21}$/i,B$=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,M$=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,$$=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,P$="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Cf;const L$=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,z$=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,U$=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,j$=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,q$=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,H$=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,l7="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",V$=new RegExp(`^${l7}$`);function c7(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function G$(r){return new RegExp(`^${c7(r)}$`)}function Z$(r){let e=`${l7}T${c7(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function K$(r,e){return!!((e==="v4"||!e)&&L$.test(r)||(e==="v6"||!e)&&U$.test(r))}function W$(r,e){if(!B$.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function Y$(r,e){return!!((e==="v4"||!e)&&z$.test(r)||(e==="v6"||!e)&&j$.test(r))}class di extends It{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Le.string){const s=this._getOrReturnCtx(e);return Ie(s,{code:fe.invalid_type,expected:Le.string,received:s.parsedType}),dt}const n=new In;let a;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){const i=e.data.length>s.value,o=e.data.length<s.value;(i||o)&&(a=this._getOrReturnCtx(e,a),i?Ie(a,{code:fe.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&Ie(a,{code:fe.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")$$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"email",code:fe.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Cf||(Cf=new RegExp(P$,"u")),Cf.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"emoji",code:fe.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")R$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"uuid",code:fe.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")D$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"nanoid",code:fe.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")N$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"cuid",code:fe.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")I$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"cuid2",code:fe.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")O$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"ulid",code:fe.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),Ie(a,{validation:"url",code:fe.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"regex",code:fe.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?Z$(s).test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?V$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?G$(s).test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?M$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"duration",code:fe.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?K$(e.data,s.version)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"ip",code:fe.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?W$(e.data,s.alg)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"jwt",code:fe.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?Y$(e.data,s.version)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"cidr",code:fe.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?q$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"base64",code:fe.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?H$.test(e.data)||(a=this._getOrReturnCtx(e,a),Ie(a,{validation:"base64url",code:fe.invalid_string,message:s.message}),n.dirty()):Dt.assertNever(s);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(a=>e.test(a),{validation:t,code:fe.invalid_string,...qe.errToObj(n)})}_addCheck(e){return new di({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...qe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...qe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...qe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...qe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...qe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...qe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...qe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...qe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...qe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...qe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...qe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...qe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...qe.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...qe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...qe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...qe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...qe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...qe.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...qe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...qe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...qe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...qe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...qe.errToObj(t)})}nonempty(e){return this.min(1,qe.errToObj(e))}trim(){return new di({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new di({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new di({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}di.create=r=>new di({checks:[],typeName:ht.ZodString,coerce:(r==null?void 0:r.coerce)??!1,...bt(r)});function J$(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=t>n?t:n,s=Number.parseInt(r.toFixed(a).replace(".","")),i=Number.parseInt(e.toFixed(a).replace(".",""));return s%i/10**a}class Ou extends It{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Le.number){const s=this._getOrReturnCtx(e);return Ie(s,{code:fe.invalid_type,expected:Le.number,received:s.parsedType}),dt}let n;const a=new In;for(const s of this._def.checks)s.kind==="int"?Dt.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),Ie(n,{code:fe.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),Ie(n,{code:fe.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),Ie(n,{code:fe.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="multipleOf"?J$(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),Ie(n,{code:fe.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),Ie(n,{code:fe.not_finite,message:s.message}),a.dirty()):Dt.assertNever(s);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,qe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,qe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,qe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,qe.toString(t))}setLimit(e,t,n,a){return new Ou({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:qe.toString(a)}]})}_addCheck(e){return new Ou({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:qe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:qe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:qe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:qe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:qe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:qe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:qe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:qe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:qe.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Dt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ou.create=r=>new Ou({checks:[],typeName:ht.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...bt(r)});class Ru extends It{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Le.bigint)return this._getInvalidInput(e);let n;const a=new In;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),Ie(n,{code:fe.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),Ie(n,{code:fe.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),Ie(n,{code:fe.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):Dt.assertNever(s);return{status:a.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Ie(t,{code:fe.invalid_type,expected:Le.bigint,received:t.parsedType}),dt}gte(e,t){return this.setLimit("min",e,!0,qe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,qe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,qe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,qe.toString(t))}setLimit(e,t,n,a){return new Ru({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:qe.toString(a)}]})}_addCheck(e){return new Ru({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:qe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:qe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:qe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:qe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:qe.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ru.create=r=>new Ru({checks:[],typeName:ht.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,...bt(r)});class K_ extends It{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Le.boolean){const n=this._getOrReturnCtx(e);return Ie(n,{code:fe.invalid_type,expected:Le.boolean,received:n.parsedType}),dt}return Kn(e.data)}}K_.create=r=>new K_({typeName:ht.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...bt(r)});class Gc extends It{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Le.date){const s=this._getOrReturnCtx(e);return Ie(s,{code:fe.invalid_type,expected:Le.date,received:s.parsedType}),dt}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return Ie(s,{code:fe.invalid_date}),dt}const n=new In;let a;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(a=this._getOrReturnCtx(e,a),Ie(a,{code:fe.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):Dt.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Gc({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:qe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:qe.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Gc.create=r=>new Gc({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:ht.ZodDate,...bt(r)});class W_ extends It{_parse(e){if(this._getType(e)!==Le.symbol){const n=this._getOrReturnCtx(e);return Ie(n,{code:fe.invalid_type,expected:Le.symbol,received:n.parsedType}),dt}return Kn(e.data)}}W_.create=r=>new W_({typeName:ht.ZodSymbol,...bt(r)});class Y_ extends It{_parse(e){if(this._getType(e)!==Le.undefined){const n=this._getOrReturnCtx(e);return Ie(n,{code:fe.invalid_type,expected:Le.undefined,received:n.parsedType}),dt}return Kn(e.data)}}Y_.create=r=>new Y_({typeName:ht.ZodUndefined,...bt(r)});class J_ extends It{_parse(e){if(this._getType(e)!==Le.null){const n=this._getOrReturnCtx(e);return Ie(n,{code:fe.invalid_type,expected:Le.null,received:n.parsedType}),dt}return Kn(e.data)}}J_.create=r=>new J_({typeName:ht.ZodNull,...bt(r)});class Zc extends It{constructor(){super(...arguments),this._any=!0}_parse(e){return Kn(e.data)}}Zc.create=r=>new Zc({typeName:ht.ZodAny,...bt(r)});class X_ extends It{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Kn(e.data)}}X_.create=r=>new X_({typeName:ht.ZodUnknown,...bt(r)});class Ys extends It{_parse(e){const t=this._getOrReturnCtx(e);return Ie(t,{code:fe.invalid_type,expected:Le.never,received:t.parsedType}),dt}}Ys.create=r=>new Ys({typeName:ht.ZodNever,...bt(r)});class Q_ extends It{_parse(e){if(this._getType(e)!==Le.undefined){const n=this._getOrReturnCtx(e);return Ie(n,{code:fe.invalid_type,expected:Le.void,received:n.parsedType}),dt}return Kn(e.data)}}Q_.create=r=>new Q_({typeName:ht.ZodVoid,...bt(r)});class Da extends It{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==Le.array)return Ie(t,{code:fe.invalid_type,expected:Le.array,received:t.parsedType}),dt;if(a.exactLength!==null){const i=t.data.length>a.exactLength.value,o=t.data.length<a.exactLength.value;(i||o)&&(Ie(t,{code:i?fe.too_big:fe.too_small,minimum:o?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(Ie(t,{code:fe.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(Ie(t,{code:fe.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>a.type._parseAsync(new Ws(t,i,t.path,o)))).then(i=>In.mergeArray(n,i));const s=[...t.data].map((i,o)=>a.type._parseSync(new Ws(t,i,t.path,o)));return In.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new Da({...this._def,minLength:{value:e,message:qe.toString(t)}})}max(e,t){return new Da({...this._def,maxLength:{value:e,message:qe.toString(t)}})}length(e,t){return new Da({...this._def,exactLength:{value:e,message:qe.toString(t)}})}nonempty(e){return this.min(1,e)}}Da.create=(r,e)=>new Da({type:r,minLength:null,maxLength:null,exactLength:null,typeName:ht.ZodArray,...bt(e)});function zi(r){if(r instanceof _r){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=$s.create(zi(n))}return new _r({...r._def,shape:()=>e})}else return r instanceof Da?new Da({...r._def,type:zi(r.element)}):r instanceof $s?$s.create(zi(r.unwrap())):r instanceof vo?vo.create(zi(r.unwrap())):r instanceof Si?Si.create(r.items.map(e=>zi(e))):r}class _r extends It{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Dt.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Le.object){const l=this._getOrReturnCtx(e);return Ie(l,{code:fe.invalid_type,expected:Le.object,received:l.parsedType}),dt}const{status:n,ctx:a}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ys&&this._def.unknownKeys==="strip"))for(const l in a.data)i.includes(l)||o.push(l);const u=[];for(const l of i){const c=s[l],d=a.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new Ws(a,d,a.path,l)),alwaysSet:l in a.data})}if(this._def.catchall instanceof Ys){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of o)u.push({key:{status:"valid",value:c},value:{status:"valid",value:a.data[c]}});else if(l==="strict")o.length>0&&(Ie(a,{code:fe.unrecognized_keys,keys:o}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of o){const d=a.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new Ws(a,d,a.path,c)),alwaysSet:c in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of u){const d=await c.key,h=await c.value;l.push({key:d,value:h,alwaysSet:c.alwaysSet})}return l}).then(l=>In.mergeObjectSync(n,l)):In.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return qe.errToObj,new _r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i;const a=((i=(s=this._def).errorMap)==null?void 0:i.call(s,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:qe.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new _r({...this._def,unknownKeys:"strip"})}passthrough(){return new _r({...this._def,unknownKeys:"passthrough"})}extend(e){return new _r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new _r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ht.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new _r({...this._def,catchall:e})}pick(e){const t={};for(const n of Dt.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new _r({...this._def,shape:()=>t})}omit(e){const t={};for(const n of Dt.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new _r({...this._def,shape:()=>t})}deepPartial(){return zi(this)}partial(e){const t={};for(const n of Dt.objectKeys(this.shape)){const a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional()}return new _r({...this._def,shape:()=>t})}required(e){const t={};for(const n of Dt.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof $s;)s=s._def.innerType;t[n]=s}return new _r({...this._def,shape:()=>t})}keyof(){return d7(Dt.objectKeys(this.shape))}}_r.create=(r,e)=>new _r({shape:()=>r,unknownKeys:"strip",catchall:Ys.create(),typeName:ht.ZodObject,...bt(e)});_r.strictCreate=(r,e)=>new _r({shape:()=>r,unknownKeys:"strict",catchall:Ys.create(),typeName:ht.ZodObject,...bt(e)});_r.lazycreate=(r,e)=>new _r({shape:r,unknownKeys:"strip",catchall:Ys.create(),typeName:ht.ZodObject,...bt(e)});class Kc extends It{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function a(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=s.map(o=>new cs(o.ctx.common.issues));return Ie(t,{code:fe.invalid_union,unionErrors:i}),dt}if(t.common.async)return Promise.all(n.map(async s=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(a);{let s;const i=[];for(const u of n){const l={...t,common:{...t.common,issues:[]},parent:null},c=u._parseSync({data:t.data,path:t.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const o=i.map(u=>new cs(u));return Ie(t,{code:fe.invalid_union,unionErrors:o}),dt}}get options(){return this._def.options}}Kc.create=(r,e)=>new Kc({options:r,typeName:ht.ZodUnion,...bt(e)});function Zp(r,e){const t=As(r),n=As(e);if(r===e)return{valid:!0,data:r};if(t===Le.object&&n===Le.object){const a=Dt.objectKeys(e),s=Dt.objectKeys(r).filter(o=>a.indexOf(o)!==-1),i={...r,...e};for(const o of s){const u=Zp(r[o],e[o]);if(!u.valid)return{valid:!1};i[o]=u.data}return{valid:!0,data:i}}else if(t===Le.array&&n===Le.array){if(r.length!==e.length)return{valid:!1};const a=[];for(let s=0;s<r.length;s++){const i=r[s],o=e[s],u=Zp(i,o);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return t===Le.date&&n===Le.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Wc extends It{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=(s,i)=>{if(V_(s)||V_(i))return dt;const o=Zp(s.value,i.value);return o.valid?((G_(s)||G_(i))&&t.dirty(),{status:t.value,value:o.data}):(Ie(n,{code:fe.invalid_intersection_types}),dt)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>a(s,i)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Wc.create=(r,e,t)=>new Wc({left:r,right:e,typeName:ht.ZodIntersection,...bt(t)});class Si extends It{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Le.array)return Ie(n,{code:fe.invalid_type,expected:Le.array,received:n.parsedType}),dt;if(n.data.length<this._def.items.length)return Ie(n,{code:fe.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),dt;!this._def.rest&&n.data.length>this._def.items.length&&(Ie(n,{code:fe.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...n.data].map((i,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new Ws(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>In.mergeArray(t,i)):In.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new Si({...this._def,rest:e})}}Si.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Si({items:r,typeName:ht.ZodTuple,rest:null,...bt(e)})};class e4 extends It{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Le.map)return Ie(n,{code:fe.invalid_type,expected:Le.map,received:n.parsedType}),dt;const a=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([o,u],l)=>({key:a._parse(new Ws(n,o,n.path,[l,"key"])),value:s._parse(new Ws(n,u,n.path,[l,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of i){const l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return dt;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of i){const l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return dt;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}}}}e4.create=(r,e,t)=>new e4({valueType:e,keyType:r,typeName:ht.ZodMap,...bt(t)});class Du extends It{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Le.set)return Ie(n,{code:fe.invalid_type,expected:Le.set,received:n.parsedType}),dt;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(Ie(n,{code:fe.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(Ie(n,{code:fe.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const s=this._def.valueType;function i(u){const l=new Set;for(const c of u){if(c.status==="aborted")return dt;c.status==="dirty"&&t.dirty(),l.add(c.value)}return{status:t.value,value:l}}const o=[...n.data.values()].map((u,l)=>s._parse(new Ws(n,u,n.path,l)));return n.common.async?Promise.all(o).then(u=>i(u)):i(o)}min(e,t){return new Du({...this._def,minSize:{value:e,message:qe.toString(t)}})}max(e,t){return new Du({...this._def,maxSize:{value:e,message:qe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Du.create=(r,e)=>new Du({valueType:r,minSize:null,maxSize:null,typeName:ht.ZodSet,...bt(e)});class t4 extends It{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t4.create=(r,e)=>new t4({getter:r,typeName:ht.ZodLazy,...bt(e)});class r4 extends It{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Ie(t,{received:t.data,code:fe.invalid_literal,expected:this._def.value}),dt}return{status:"valid",value:e.data}}get value(){return this._def.value}}r4.create=(r,e)=>new r4({value:r,typeName:ht.ZodLiteral,...bt(e)});function d7(r,e){return new go({values:r,typeName:ht.ZodEnum,...bt(e)})}class go extends It{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return Ie(t,{expected:Dt.joinValues(n),received:t.parsedType,code:fe.invalid_type}),dt}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Ie(t,{received:t.data,code:fe.invalid_enum_value,options:n}),dt}return Kn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return go.create(e,{...this._def,...t})}exclude(e,t=this._def){return go.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}go.create=d7;class n4 extends It{_parse(e){const t=Dt.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Le.string&&n.parsedType!==Le.number){const a=Dt.objectValues(t);return Ie(n,{expected:Dt.joinValues(a),received:n.parsedType,code:fe.invalid_type}),dt}if(this._cache||(this._cache=new Set(Dt.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const a=Dt.objectValues(t);return Ie(n,{received:n.data,code:fe.invalid_enum_value,options:a}),dt}return Kn(e.data)}get enum(){return this._def.values}}n4.create=(r,e)=>new n4({values:r,typeName:ht.ZodNativeEnum,...bt(e)});class Yc extends It{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Le.promise&&t.common.async===!1)return Ie(t,{code:fe.invalid_type,expected:Le.promise,received:t.parsedType}),dt;const n=t.parsedType===Le.promise?t.data:Promise.resolve(t.data);return Kn(n.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Yc.create=(r,e)=>new Yc({type:r,typeName:ht.ZodPromise,...bt(e)});class yo extends It{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ht.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:i=>{Ie(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){const i=a.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return dt;const u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?dt:u.status==="dirty"||t.value==="dirty"?Ko(u.value):u});{if(t.value==="aborted")return dt;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?dt:o.status==="dirty"||t.value==="dirty"?Ko(o.value):o}}if(a.type==="refinement"){const i=o=>{const u=a.refinement(o,s);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?dt:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?dt:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(a.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!mo(i))return dt;const o=a.transform(i.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>mo(i)?Promise.resolve(a.transform(i.value,s)).then(o=>({status:t.value,value:o})):dt);Dt.assertNever(a)}}yo.create=(r,e,t)=>new yo({schema:r,typeName:ht.ZodEffects,effect:e,...bt(t)});yo.createWithPreprocess=(r,e,t)=>new yo({schema:e,effect:{type:"preprocess",transform:r},typeName:ht.ZodEffects,...bt(t)});class $s extends It{_parse(e){return this._getType(e)===Le.undefined?Kn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}$s.create=(r,e)=>new $s({innerType:r,typeName:ht.ZodOptional,...bt(e)});class vo extends It{_parse(e){return this._getType(e)===Le.null?Kn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}vo.create=(r,e)=>new vo({innerType:r,typeName:ht.ZodNullable,...bt(e)});class Kp extends It{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Le.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Kp.create=(r,e)=>new Kp({innerType:r,typeName:ht.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...bt(e)});class Wp extends It{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Vc(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new cs(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new cs(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Wp.create=(r,e)=>new Wp({innerType:r,typeName:ht.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...bt(e)});class a4 extends It{_parse(e){if(this._getType(e)!==Le.nan){const n=this._getOrReturnCtx(e);return Ie(n,{code:fe.invalid_type,expected:Le.nan,received:n.parsedType}),dt}return{status:"valid",value:e.data}}}a4.create=r=>new a4({typeName:ht.ZodNaN,...bt(r)});class X$ extends It{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Gg extends It{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?dt:s.status==="dirty"?(t.dirty(),Ko(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?dt:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,t){return new Gg({in:e,out:t,typeName:ht.ZodPipeline})}}class Yp extends It{_parse(e){const t=this._def.innerType._parse(e),n=a=>(mo(a)&&(a.value=Object.freeze(a.value)),a);return Vc(t)?t.then(a=>n(a)):n(t)}unwrap(){return this._def.innerType}}Yp.create=(r,e)=>new Yp({innerType:r,typeName:ht.ZodReadonly,...bt(e)});function Q$(r,e={},t){return Zc.create()}var ht;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(ht||(ht={}));Zc.create;Ys.create;Da.create;const eP=_r.create;Kc.create;Wc.create;Si.create;go.create;Yc.create;$s.create;vo.create;un.Root({messages:un({reducer:u7,default:()=>[]})});const tP={reducer:{fn:u7},jsonSchemaExtra:{langgraph_type:"messages"},default:()=>[]};eP({messages:g$(Q$(),tP)});NT();const rP=fa(),nP=un.Root({instruction:un({reducer:(r,e)=>e,default:()=>""}),page:un({reducer:(r,e)=>e,default:()=>null}),pendingIntents:un({reducer:(r,e)=>e,default:()=>[]}),currentIntent:un({reducer:(r,e)=>e,default:()=>null}),context:un({reducer:(r,e)=>e,default:()=>null}),patch:un({reducer:(r,e)=>e,default:()=>null}),intentResults:un({reducer:(r,e)=>[...r,...e],default:()=>[]}),cumulativeOps:un({reducer:(r,e)=>[...r,...e],default:()=>[]}),blockedReason:un({reducer:(r,e)=>e,default:()=>null}),confidence:un({reducer:(r,e)=>e,default:()=>1})});async function s4(r){const{baseUrl:e,apiKey:t,modelName:n,messages:a,onToken:s,shouldAbort:i}=r,o=e+"/chat/completions";return new Promise((u,l)=>{let c="";_b({baseURL:o,model:n,apiKey:t,messages:a,onToken:d=>{const h=d.replace(/<think>[\s\S]*?<\/think>/g,"").replace(/<think>[\s\S]*/g,"");c+=h,s&&h&&s(h)},onDone:()=>u(c),onError:d=>l(d),shouldAbort:i})})}function i4(r){const e=r.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),t=e.match(/```json\s*([\s\S]*?)\s*```/i),a=((t==null?void 0:t[1])??e).trim();try{return JSON.parse(a)}catch{const s=a.indexOf("{"),i=a.lastIndexOf("}");if(s!==-1&&i!==-1&&i>s)return JSON.parse(a.slice(s,i+1));throw new Error("\u65E0\u6CD5\u89E3\u6790\u6A21\u578B\u8F93\u51FA\u4E3A JSON")}}function o4(r,e=!1){if(!r)return"patch \u5BF9\u8C61\u4E3A\u7A7A";if(!r.id)return"patch.id \u7F3A\u5931";const t=r.ops||[];if(!e&&t.length===0)return"\u4FEE\u6539\u64CD\u4F5C\u5217\u8868 (ops) \u4E3A\u7A7A\uFF0C\u672A\u751F\u6210\u4EFB\u4F55\u6709\u6548\u6539\u52A8";if(t.length>20)return"\u64CD\u4F5C\u8FC7\u591A\uFF08\u8D85\u8FC7 20 \u4E2A\uFF09\uFF0C\u53EF\u80FD\u5B58\u5728\u5B89\u5168\u98CE\u9669";for(const n of t){if(n.kind==="css"){const a=(n.cssText||"").trim();if([/(@import)\b/i,/\burl\s*\(/i,/\bexpression\s*\(/i,/<\/style>/i].some(i=>i.test(a)))return"CSS \u542B\u9AD8\u98CE\u9669\u8BED\u53E5\uFF08@import/url()/expression/style\u6CE8\u5165\uFF09\uFF0C\u5DF2\u62D2\u7EDD";if(!a.includes("{")||!a.includes("}"))return"CSS \u683C\u5F0F\u9519\u8BEF\uFF1A\u7F3A\u5931\u9009\u62E9\u5668\u6216\u5927\u62EC\u53F7\uFF0C\u8BF7\u786E\u4FDD\u8F93\u51FA\u5B8C\u6574\u7684 CSS \u89C4\u5219\uFF08\u5982 .selector { ... }\uFF09"}if(n.kind==="attr"&&/^on/i.test(n.name))return"\u4E0D\u5141\u8BB8\u5199\u5165 on* \u4E8B\u4EF6\u5C5E\u6027"}return null}class aP{constructor(e,t){g(this,"config");g(this,"callbacks");this.config=e,this.callbacks=t}async handle(e){try{const n=await this.buildGraph().invoke({instruction:e});if(n.blockedReason){this.callbacks.onError("\u65B9\u6848\u88AB\u5B89\u5168\u7B56\u7565\u62E6\u622A\uFF1A"+n.blockedReason),await this.callbacks.onComplete(null);return}const a=n.intentResults&&n.intentResults.length>0,s=n.patch&&n.patch.ops&&n.patch.ops.length>0;if(!n.patch||!a&&!s){this.callbacks.onError("\u672A\u751F\u6210\u6709\u6548\u65B9\u6848\uFF0C\u8BF7\u6362\u4E00\u79CD\u63CF\u8FF0\u91CD\u8BD5\u3002"),await this.callbacks.onComplete(null);return}await this.callbacks.onComplete({patch:n.patch,context:n.context,intentResults:n.intentResults})}catch(t){rP.error("PageSmartEditAssistant\u5931\u8D25:",t),this.callbacks.onError("\u5904\u7406\u5931\u8D25: "+((t==null?void 0:t.message)||String(t))),await this.callbacks.onComplete(null)}}buildGraph(){return new y$(nP).addNode("split_intents",t=>this.splitIntents(t)).addNode("next_intent",t=>this.handleNextIntent(t)).addNode("gather_context",t=>this.gatherContext(t)).addNode("confidence_check",t=>this.checkConfidence(t)).addNode("generate_patch_fragment",t=>this.generatePatchFragment(t)).addNode("finalize_patch",t=>this.finalizePatch(t)).addNode("validate_patch",t=>this.validateAllPatches(t)).addEdge(Vt,"split_intents").addConditionalEdges("split_intents",t=>t.pendingIntents.length>0?"process":"empty",{process:"next_intent",empty:"finalize_patch"}).addEdge("next_intent","gather_context").addEdge("gather_context","confidence_check").addEdge("confidence_check","generate_patch_fragment").addConditionalEdges("generate_patch_fragment",t=>t.pendingIntents.length>0?"continue":"finish",{continue:"next_intent",finish:"finalize_patch"}).addEdge("finalize_patch","validate_patch").addEdge("validate_patch",Ct).compile()}async splitIntents(e){this.callbacks.onStatusUpdate(`\u{1F9E0} **\u6B63\u5728\u5206\u6790\u5E76\u62C6\u5206\u4FEE\u6539\u4EFB\u52A1**

\u6B63\u5728\u8BC6\u522B\u53EF\u72EC\u7ACB\u5904\u7406\u7684\u4FEE\u6539\u6B65\u9AA4\uFF0C\u4EE5\u63D0\u5347\u6267\u884C\u51C6\u786E\u6027\u2026`);const t=Ui.generate("smart_edit_split",{userInput:e.instruction,content:""}),n=await s4({providerCode:this.config.modelInfo.providerCode,baseUrl:this.config.modelInfo.baseUrl,apiKey:this.config.modelInfo.apiKey,modelName:this.config.modelInfo.modelName,messages:t,shouldAbort:this.callbacks.shouldAbort});return{pendingIntents:i4(n)}}async handleNextIntent(e){if(e.pendingIntents.length===0)return{currentIntent:null};const t=e.pendingIntents[0],n=e.pendingIntents.slice(1);return{currentIntent:t,pendingIntents:n}}async gatherContext(e){var s,i;this.callbacks.onStatusUpdate(`\u23F3 **\u6B63\u5728\u83B7\u53D6\u9875\u9762\u72B6\u6001**

\u4EFB\u52A1\uFF1A**${e.currentIntent}**`);const t=await uu("getPageEditContext",{query:e.currentIntent||"",maxTargets:5});if(!t||t.status!=="success")return{blockedReason:(t==null?void 0:t.message)||"\u65E0\u6CD5\u83B7\u53D6\u9875\u9762\u4E0A\u4E0B\u6587"};const a=(((s=t.data)==null?void 0:s.targets)||[]).length>0?1:0;return{context:t.data,page:((i=t.data)==null?void 0:i.page)||null,confidence:a}}async checkConfidence(e){return e.confidence<.5&&this.callbacks.onStatusUpdate(`\u26A0\uFE0F **\u4EFB\u52A1\u5B9A\u4F4D\u7F6E\u4FE1\u5EA6\u8F83\u4F4E**\uFF1A**${e.currentIntent}**`),{}}async generatePatchFragment(e){var c;this.callbacks.onStatusUpdate(`\u23F3 **\u6B63\u5728\u751F\u6210\u4FEE\u6539\u8865\u4E01**
            

\u4EFB\u52A1\uFF1A**${e.currentIntent}**
            

\u52A9\u624B\u6B63\u5728\u5206\u6790\u9875\u9762\u7ED3\u6784\u5E76\u751F\u6210\u5BF9\u5E94\u7684\u4FEE\u6539\u8865\u4E01\uFF0C  
            

\u8BE5\u8FC7\u7A0B\u53EF\u80FD\u9700\u8981\u4E00\u70B9\u65F6\u95F4\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\u2026`);const t=e.page||{url:"",title:""},n=Ui.generate("smart_edit_patch",{userInput:e.currentIntent,pageInfo:t,content:"",targets:((c=e.context)==null?void 0:c.targets)||[],cumulativeOps:e.cumulativeOps}),a=await s4({providerCode:this.config.modelInfo.providerCode,baseUrl:this.config.modelInfo.baseUrl,apiKey:this.config.modelInfo.apiKey,modelName:this.config.modelInfo.modelName,messages:n,shouldAbort:this.callbacks.shouldAbort}),s=i4(a),i=s.ops||[],o={...s,id:`patch-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,page:t,ops:i},u=this.renderOpsMarkdown(i,e.intentResults.length),l={intent:e.currentIntent,patch:o,markdown:`#### \u4EFB\u52A1 ${e.intentResults.length+1}\uFF1A${e.currentIntent}
${u}`};return{cumulativeOps:i,intentResults:[l]}}async finalizePatch(e){return this.callbacks.onStatusUpdate(`\u2728 **\u6B63\u5728\u6574\u7406\u6700\u7EC8\u4FEE\u6539\u65B9\u6848**

\u5373\u5C06\u5B8C\u6210\uFF0C\u8BF7\u7A0D\u5019\u2026`),{patch:{id:`patch-summary-${Date.now()}`,page:e.page||{url:"",title:""},intent:"mixed",summary:`\u5DF2\u751F\u6210 **${e.intentResults.length}** \u4E2A\u72EC\u7ACB\u7684\u4FEE\u6539\u4EFB\u52A1`,steps:e.intentResults.map((n,a)=>`\u4EFB\u52A1 **${a+1}**: ${n.intent}`),risks:["\u8BF7\u6839\u636E\u9700\u8981\u9010\u4E2A\u5E94\u7528\u4FEE\u6539"],ops:[],requiresConfirm:!0}}}async validateAllPatches(e){var t;if(this.callbacks.onStatusUpdate(`\u{1F510} **\u6B63\u5728\u8FDB\u884C\u5B89\u5168\u6821\u9A8C**

\u7528\u4E8E\u786E\u4FDD\u4FEE\u6539\u8FC7\u7A0B\u7684\u53EF\u9760\u6027\u4E0E\u9875\u9762\u7A33\u5B9A\u6027\uFF0C\u8BF7\u7A0D\u5019\u2026`),e.blockedReason)return{};if(e.patch){const n=o4(e.patch,!0);if(n)return{blockedReason:n}}if(e.intentResults&&e.intentResults.length>0)for(const n of e.intentResults){const a=o4(n.patch);if(a)return{blockedReason:`\u4EFB\u52A1 [${n.intent}] \u6821\u9A8C\u5931\u8D25: ${a}`}}else if(!((t=e.patch)!=null&&t.ops)||e.patch.ops.length===0)return{blockedReason:"\u672A\u751F\u6210\u4EFB\u4F55\u6709\u6548\u7684\u4FEE\u6539\u64CD\u4F5C"};return{}}renderOpsMarkdown(e,t){return e.map((n,a)=>{const s=`${t+1}.${a+1}`;if(n.kind==="css"){const i=(n.targets||[]).map(o=>`- \`${o.selector}\`\uFF1A${o.reason}`).join(`
`);return`**${s}. \u6837\u5F0F\u4FEE\u6539\uFF08CSS\uFF09**
${i}

\`\`\`css
${n.cssText}
\`\`\``}return n.kind==="text"?`**${s}. \u6587\u6848\u4FEE\u6539**
- \u76EE\u6807\uFF1A\`${n.selector}\`
- \u65B0\u6587\u6848\uFF1A${n.toText}
- \u539F\u56E0\uFF1A${n.reason}`:`**${s}. \u5C5E\u6027\u4FEE\u6539**
- \u76EE\u6807\uFF1A\`${n.selector}\`
- \u5C5E\u6027\uFF1A\`${n.name}\`
- \u65B0\u503C\uFF1A${n.toValue===null?"\uFF08\u79FB\u9664\uFF09":`\`${n.toValue}\``}
- \u539F\u56E0\uFF1A${n.reason}`}).join(`

`)}}const sP={key:1,class:"chat-container"},iP={class:"chat-header"},oP={class:"chat-title"},uP={key:0,class:"empty-state"},lP={class:"empty-content"},cP={class:"message-content-wrapper"},dP={key:0,class:"message-loading"},hP={class:"message-content"},fP={key:1,class:"patch-structured-content"},pP={key:0,class:"patch-action-bar embedded"},mP={key:1,class:"patch-hint"},gP={key:2,class:"patch-action-container"},yP={key:1,class:"patch-hint secondary"},vP={class:"message-footer"},_P={key:0,class:"message-gap"},bP={class:"message-gap"},wP={class:"chat-footer"},EP={class:"input-container"},xP={class:"function-buttons"},SP={key:0,class:"function-buttons-left"},AP={class:"function-button"},kP={key:1,class:"function-buttons-left"},CP={class:"selected-function-display"},TP={class:"function-display-label"},FP={key:2,class:"function-buttons-left"},NP={class:"page-context-switch-wrapper"},IP={class:"function-buttons-right"},OP={class:"input-wrapper"},RP={key:2,class:"function-selector-popup"},DP={class:"selector-list"},BP=["onClick"],MP={class:"selector-content"},$P={class:"selector-label"},PP={class:"selector-desc"},LP={key:3,class:"function-selector-popup expression-selector-popup"},zP={class:"selector-list"},UP=["onClick"],jP={class:"expression-number"},qP={class:"selector-content"},HP={class:"selector-label"},VP={class:"button-wrapper"},GP=_o({__name:"GenerativeAIChat",props:["expendFlag","inSidepanelFlag"],emits:["update:expendFlag"],setup(r,{emit:e}){const t={ArrowUp:q7,Close:l1,Document:il,Edit:Jp,EditPen:j7,Expand:u1,Files:U7,FullScreen:o1,Loading:Nf,Position:i1,RefreshRight:s1,ScaleToOriginal:a1,Setting:n1,Star:z7,VideoPause:r1},n=fa(),a=r,s=e,i=iu({inputMessage:"",defaultInputMessage:"",chatTitle:"\u65B0\u7684\u804A\u5929",scrollbar:{},messages:[],messageList:ou(null),lastBotMessage:{},pageContent:"",currentChatId:null,switches:{autoScroll:!0,showSendIcon:!0,showHistory:!1,showSetting:!0,usePageContext:!1,showFunctionSelector:!1,showPromptSelector:!1,selectedFunction:null,isStyleAssistantActive:!1},patchStates:{},modelInfo:{providerName:"",providerCode:"",baseUrl:"",apiKey:"",appId:"",modelName:""},chatSettings:{modeCode:"chat",modeName:"\u5BF9\u8BDD\u6A21\u5F0F",maxMemHisSessionNum:12,summaryMode:"detailed",summaryModeName:"\u8BE6\u7EC6\u6A21\u5F0F"},userInfo:{userId:""},baseConfig:{maxTitleLength:15,maxContentLength:5e4},greetingChars:[],greetingAnimationKey:0}),{inputMessage:o,defaultInputMessage:u,chatTitle:l,messages:c,messageList:d,switches:h,lastBotMessage:f,modelInfo:p,pageContent:m,currentChatId:v,userInfo:_,baseConfig:w,greetingChars:E,greetingAnimationKey:F,chatSettings:k,patchStates:N}=Jc(i);let B=null,A=!1;Bu(async()=>{ve();try{const _e=await vb();_e&&_e.userId&&(_.value=_e,n.info("\u83B7\u53D6\u7528\u6237\u4FE1\u606F:",_e))}catch(_e){n.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25:",_e)}const K=await jr(qt.MODEL_INFO_KEY);K&&(p.value={...p.value,...K},h.value.showSetting=!1);const ee=await jr("CHAT_SETTINGS");ee&&(k.value={...k.value,...ee}),k.value.modeCode==="exam"&&(u.value="\u8BF7\u7ED9\u51FA\u8003\u9898\u7B54\u6848",o.value=u.value)}),L7(()=>{B&&(clearTimeout(B),B=null)});const L=U0(()=>k.value.modeCode==="exam"?"\u5BF9\u56DE\u7B54\u4E0D\u6EE1\u610F\uFF1F\u8BF7\u8F93\u5165\u4F60\u7684\u7591\u95EE\uFF0C\u6309Enter\u53D1\u9001\uFF0CAlt+Enter\u6362\u884C\u3002":h.value.selectedFunction&&h.value.selectedFunction.hint?h.value.selectedFunction.hint:"\u8BF7\u8F93\u5165\u4F60\u7684\u95EE\u9898\uFF0C\u6309Enter\u53D1\u9001\uFF0CAlt+Enter\u6362\u884C\u3002\u8F93\u5165 / \u6216\u53CC\u51FB\u8F93\u5165\u6846\u9009\u62E9\u66F4\u591A\u529F\u80FD\u3002"),V=U0(()=>k.value.modeCode!=="chat"?[]:NS({inSidepanelFlag:a.inSidepanelFlag,expendFlag:a.expendFlag}).map(ee=>({...ee,iconComponent:t[ee.icon]||il}))),G=U0(()=>IS(h.value.selectedFunction)),te=K=>{const ee=(K||"").trim();return ee===""||ee==="\u65B0\u7684\u804A\u5929"},ve=()=>{const K="Hello!\u4F60\u597D~",ee=["color-pink","color-blue","color-yellow","color-green","color-purple","color-orange","color-cyan","color-rose"];E.value=Array.from(K).map(_e=>({text:_e,colorClass:ee[Math.floor(Math.random()*ee.length)]})),F.value+=1},D=(K=1e3)=>{B&&clearTimeout(B),B=window.setTimeout(async()=>{B=null,await we()},K)},M=(K,ee="")=>{v.value||(v.value=`chat-${Date.now()}-${Wo()}`,n.info("\u521B\u5EFA\u65B0\u4F1A\u8BDDID:",v.value)),h.value.showSendIcon=!1;const _e={id:Date.now(),content:K,sender:"user",timestamp:Date.now()};c.value.push(_e),te(l.value)&&(l.value=Rn(K.trim())),o.value=u.value,D(),xa(()=>er());const Fe=iu({id:Date.now()+1,content:ee,sender:"assistant",timestamp:Date.now()});return f.value=Fe,c.value.push(Fe),xa(()=>er()),{userMessage:_e,botMessage:Fe}},P=async K=>{try{const{botMessage:ee}=M(K);let _e=K;k.value.modeCode==="exam"?(await j(),_e=Ui.generate("summary",{content:m.value,userInput:K===u.value?"":K,maxLength:w.value.maxContentLength,modeCode:k.value.modeCode,summaryMode:k.value.summaryMode||"detailed"}),await W(ee,_e,!0)):k.value.modeCode==="chat"&&h.value.usePageContext?(await j(),_e=Ui.generate("summary",{content:m.value,userInput:K,maxLength:w.value.maxContentLength,summaryMode:k.value.summaryMode||"detailed"}),await W(ee,_e,!0)):await W(ee,_e,!1)}catch(ee){n.error("handleBasicChat error:",ee),nt({message:"\u53D1\u9001\u6D88\u606F\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\u3002",type:"danger"}),h.value.showSendIcon=!0}},Z=async()=>{try{if(!h.value.showSendIcon){nt("\u8BF7\u7B49\u5F85\u56DE\u7B54\u5B8C\u6210\u518D\u8BD5\uFF01");return}const K=o.value.trim();if(!K){nt("\u8BF7\u8F93\u5165\u4F60\u7684\u95EE\u9898");return}if(K.startsWith(":")||K.startsWith("\uFF1A")){const ee=K.substring(1).trim();if(ee){n.info("\u89E6\u53D1\u57FA\u7840\u5BF9\u8BDD\u6A21\u5F0F (\u4E8C\u6B21\u5BF9\u8BDD):",ee),await P(ee);return}}if(h.value.selectedFunction){const ee=h.value.selectedFunction.key;if(n.info("\u4F7F\u7528\u529F\u80FD\u5904\u7406:",ee,K),ee==="expand"){Et(),C();return}else if(ee==="pageSmartEdit"){await Se();return}else if(ee==="eMailSmartAssistant"){await vt();return}}await P(K)}catch(K){n.error("doSendMessage error:",K),nt({message:"\u53D1\u9001\u6D88\u606F\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\u3002",type:"danger"}),h.value.showSendIcon=!0}},W=async(K,ee,_e)=>{try{if(!ee)return;n.info("memoryStream",{botMessage:K,userInput:ee,needPushFlag:_e}),te(l.value)&&(l.value=Rn(ee),D());let Fe=c.value.filter(ke=>ke.content&&ke.content.trim()&&ke.sender).slice(-k.value.maxMemHisSessionNum).map(ke=>({role:ke.sender,content:ke.content}));if(_e&&Fe.push({role:"user",content:ee}),p.value.providerCode==="dify_workflow"){let ke=_.value.userId||await OS();ke||(ke="default_user_2025"),PS({baseURL:p.value.baseUrl+"/chat-messages",apiKey:p.value.apiKey,messages:Fe,user:ke,conversation_id:"",onToken:Ut=>{h.value.showSendIcon||(K.content+=Ut,ze())},onDone:async()=>{var Ut;h.value.showSendIcon=!0,((Ut=h.value.selectedFunction)==null?void 0:Ut.key)==="pageSmartEdit"&&X(K),await we()},onError:async Ut=>{n.error("Dify stream chat error:",Ut),K.content+=`
\u8BF7\u6C42\u5931\u8D25: `+Ut.message,h.value.showSendIcon=!0,await we()},shouldAbort:()=>h.value.showSendIcon})}else p.value.providerCode==="aliyun_app"?LS({baseURL:p.value.baseUrl,appId:p.value.appId,apiKey:p.value.apiKey,messages:Fe,onToken:ke=>{h.value.showSendIcon||(K.content+=ke,ze())},onDone:async()=>{var ke;h.value.showSendIcon=!0,((ke=h.value.selectedFunction)==null?void 0:ke.key)==="pageSmartEdit"&&X(K),await we()},onError:async ke=>{n.error("Aliyun App stream chat error:",ke),K.content+=`
\u8BF7\u6C42\u5931\u8D25: `+ke.message,h.value.showSendIcon=!0,await we()},shouldAbort:()=>h.value.showSendIcon}):_b({baseURL:p.value.baseUrl+"/chat/completions",model:p.value.modelName,apiKey:p.value.apiKey,messages:Fe,onToken:ke=>{h.value.showSendIcon||(K.content+=ke,ze())},onDone:async()=>{var ke;h.value.showSendIcon=!0,((ke=h.value.selectedFunction)==null?void 0:ke.key)==="pageSmartEdit"&&X(K),await we(),setTimeout(async()=>{},1e3)},onError:async ke=>{K.content+=`
\u8BF7\u6C42\u5931\u8D25: `+ke.message,h.value.showSendIcon=!0,n.error("streamChat error:",ke),await we()},shouldAbort:()=>h.value.showSendIcon})}catch(Fe){n.error("memoryStream error:",Fe),K.content+=`
\u8BF7\u6C42\u5931\u8D25,\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01`,h.value.showSendIcon=!0,await we()}},X=K=>{try{const ee=K.content;if(!ee)return;const _e=ee.match(/```json\s*([\s\S]*?)\s*```/i)||ee.match(/(\{[\s\S]*"ops"[\s\S]*\})/i);if(_e)try{const Ut=_e[1]||_e[0],Jt=JSON.parse(Ut.trim());if(Jt.ops&&Array.isArray(Jt.ops)&&Jt.ops.length>0){N.value[K.id]={isStructured:!1,intents:[{intent:Jt.summary||"\u5BF9\u8BDD\u4FEE\u6539\u5EFA\u8BAE",patch:{...Jt,id:Jt.id||`patch-${Date.now()}`},previewApplied:!1,markdown:""}]};return}}catch(Ut){n.error("\u81EA\u52A8\u63D0\u53D6\u8865\u4E01\u903B\u8F91 JSON \u89E3\u6790\u5931\u8D25:",Ut)}const Fe=ee.match(/```css\s*([\s\S]*?)\s*```/gi);let ke="";if(Fe)ke=Fe.map(Ut=>{const Jt=Ut.match(/```css\s*([\s\S]*?)\s*```/i);return Jt?Jt[1].trim():""}).join(`
`);else{const Ut=ee.match(/([^{}\n]+\s*\{[\s\S]+?\})/gi);Ut&&(ke=Ut.join(`
`))}if(ke&&ke.includes("{")&&ke.includes("}")&&!ke.includes('"ops"')){const Ut={id:`patch-css-${Date.now()}`,page:{url:window.location.href,title:document.title},intent:"style",summary:"CSS \u6837\u5F0F\u4FEE\u6539",steps:["\u5E94\u7528 CSS \u6837\u5F0F"],risks:[],ops:[{kind:"css",cssText:ke,targets:[]}],requiresConfirm:!0};N.value[K.id]={isStructured:!1,intents:[{intent:"CSS \u6837\u5F0F",patch:Ut,previewApplied:!1,markdown:""}]}}}catch(ee){n.warn("\u63D0\u53D6\u8865\u4E01\u5931\u8D25:",ee)}},Y=K=>{K.sender==="user"&&(o.value=K.content,Z(),nt("\u91CD\u65B0\u751F\u6210\u4E2D..."))},re=async()=>{var K;h.value.showSendIcon=!0,((K=f.value)==null?void 0:K.content)===""&&(f.value.content="\u7528\u6237\u624B\u52A8\u7EC8\u6B62\u3002"),await we()},U=K=>{try{if(!K.content||K.content.trim()===""){nt("\u590D\u5236\u5931\u8D25\uFF0C\u5185\u5BB9\u4E3A\u7A7A\uFF01");return}else navigator.clipboard.writeText(K.content.replace(/&lt;/g,"<").replace(/&gt;/g,">")),nt("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\uFF01")}catch{nt({message:"\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u624B\u52A8\u590D\u5236\u3002",type:"warning"})}},j=async()=>{m.value=await jy.fetchWithRetry({maxAttempts:3,retryDelay:1e3,maxLength:w.value.maxContentLength})},ae=K=>{k.value.modeCode==="chat"&&(K==="/"&&!h.value.showFunctionSelector?(h.value.showFunctionSelector=!0,o.value=""):h.value.showFunctionSelector&&K!==""?h.value.showFunctionSelector=!1:K===""&&(h.value.showFunctionSelector=!1,h.value.showPromptSelector=!1),K==="@"&&h.value.selectedFunction&&G.value.length>0&&!h.value.showPromptSelector?(h.value.showPromptSelector=!0,o.value=""):h.value.showPromptSelector&&K!==""&&(h.value.showPromptSelector=!1))},Q=K=>{h.value.selectedFunction=K,h.value.showFunctionSelector=!1,o.value="",n.info("\u9009\u62E9\u529F\u80FD:",K.label)},C=()=>{h.value.selectedFunction=null,h.value.isStyleAssistantActive&&(h.value.isStyleAssistantActive=!1),o.value=""},x=()=>{h.value.showFunctionSelector=!1},q=K=>{o.value=K.content,h.value.showPromptSelector=!1},$=()=>{h.value.showPromptSelector=!1},Ee=()=>{k.value.modeCode==="chat"&&(h.value.selectedFunction&&G.value.length>0&&o.value.trim()===""?h.value.showPromptSelector||(h.value.showPromptSelector=!0,o.value=""):o.value.trim()===""&&!h.value.showFunctionSelector&&V.value.length>0&&(h.value.showFunctionSelector=!0))},Ve=K=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown"].includes(K.key)){if(K.key==="Escape"){h.value.showFunctionSelector?x():h.value.showPromptSelector?$():h.value.selectedFunction&&C();return}if(K.key==="Enter"){if(K.altKey){const _e=K.target,Fe=_e.selectionStart,ke=o.value.slice(0,Fe),Ut=o.value.slice(Fe);o.value=ke+`
`+Ut,xa(()=>{_e.selectionStart=Fe+1,_e.selectionEnd=Fe+1});return}if(K.preventDefault(),h.value.showFunctionSelector){x();return}Z()}}},at=async()=>{try{if(!h.value.showSendIcon){nt("\u8BF7\u7B49\u5F85\u5F53\u524D\u64CD\u4F5C\u5B8C\u6210");return}const K=o.value.trim(),ee=K&&K.length>0?`\u8BF7\u6839\u636E\u9875\u9762\u5185\u5BB9\uFF0C\u56DE\u7B54\u7528\u6237\u7684\u95EE\u9898\uFF1A
 ${K}`:"\u603B\u7ED3\u5F53\u524D\u9875\u9762\u5185\u5BB9",{botMessage:_e}=M(ee,"\u6B63\u5728\u5206\u6790\u9875\u9762\u5185\u5BB9...");m.value=await jy.fetchWithRetry({maxAttempts:3,retryDelay:1e3,maxLength:w.value.maxContentLength});const Fe=Ui.generate("summary",{content:m.value,userInput:K,maxLength:w.value.maxContentLength,summaryMode:k.value.summaryMode||"detailed"});_e.content="",await W(_e,Fe,!0)}catch(K){n.error("\u9875\u9762\u603B\u7ED3\u5931\u8D25:",K),ot(K),h.value.showSendIcon=!0,await we()}},ot=K=>{const ee={"unsupported page":"\u4E0D\u652F\u6301\u5F53\u524D\u9875\u9762\u7C7B\u578B",timeout:"\u5185\u5BB9\u83B7\u53D6\u8D85\u65F6\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u540E\u91CD\u8BD5","empty content":"\u672A\u80FD\u63D0\u53D6\u5230\u6709\u6548\u5185\u5BB9"},_e="\u5185\u5BB9\u63D0\u53D6\u5931\u8D25\uFF0C\u8BF7\u786E\u4FDD\u9875\u9762\u5DF2\u5B8C\u5168\u52A0\u8F7D";f.value.content=ee[K.message.toLowerCase()]||_e},Et=()=>{s("update:expendFlag",!a.expendFlag)},Se=async()=>{try{if(!h.value.showSendIcon){nt("\u8BF7\u7B49\u5F85\u5F53\u524D\u64CD\u4F5C\u5B8C\u6210");return}const K=o.value.trim();if(!K){nt("\u8BF7\u8F93\u5165\u4F60\u7684\u4FEE\u6539\u6307\u4EE4");return}const{botMessage:ee}=M(K,"\u6B63\u5728\u5206\u6790\u9875\u9762\u5E76\u751F\u6210\u53EF\u56DE\u6EDA\u65B9\u6848...");await new aP({modelInfo:p.value,chatSettings:k.value,userId:_.value.userId},{onStatusUpdate:Fe=>{ee.content=Fe,ze()},onContentUpdate:Fe=>{ee.content=Fe,ze()},onStreamToken:Fe=>{ee.content+=Fe,ze()},onError:async Fe=>{ee.content=Fe,ze()},onSuccess:Fe=>{nt(Fe)},onComplete:async Fe=>{Fe!=null&&Fe.intentResults&&Fe.intentResults.length>0?N.value[ee.id]={isStructured:!0,intents:Fe.intentResults.map(ke=>({intent:ke.intent,patch:ke.patch,previewApplied:!1,markdown:ke.markdown}))}:Fe!=null&&Fe.patch&&(N.value[ee.id]={isStructured:!0,intents:[{intent:"\u4FEE\u6539\u65B9\u6848",patch:Fe.patch,previewApplied:!1,markdown:""}]}),h.value.showSendIcon=!0,await we(),xa(()=>er())},shouldAbort:()=>h.value.showSendIcon}).handle(K)}catch(K){n.error("AI\u9875\u9762\u667A\u80FD\u4FEE\u6539\u5931\u8D25:",K),f.value.content="\u5904\u7406\u5931\u8D25: "+K.message,h.value.showSendIcon=!0,await we()}},vt=async()=>{try{if(!h.value.showSendIcon){nt("\u8BF7\u7B49\u5F85\u5F53\u524D\u64CD\u4F5C\u5B8C\u6210");return}const K=o.value.trim();if(!K){nt("\u8BF7\u8F93\u5165\u4F60\u7684\u9700\u6C42");return}const{botMessage:ee}=M(K,"\u6B63\u5728\u5206\u6790\u90AE\u4EF6\u5185\u5BB9...");await j();const _e=Ui.generate("summary",{content:m.value,userInput:K,maxLength:w.value.maxContentLength,summaryMode:k.value.summaryMode||"detailed"});ee.content="",await W(ee,_e,!0)}catch(K){n.error("\u667A\u80FD\u90AE\u4EF6\u52A9\u624B\u5931\u8D25:",K),f.value.content="\u5904\u7406\u5931\u8D25: "+K.message,h.value.showSendIcon=!0,await we()}},Qt=async(K,ee)=>{try{const _e=N.value[K];if(!_e||!_e.intents[ee])return;const Fe=_e.intents[ee],ke=await uu("applyPagePatch",{patch:Fe.patch});(ke==null?void 0:ke.status)==="success"?(Fe.previewApplied=!0,n.info("\u5E94\u7528\u8865\u4E01\u7ED3\u679C:",ke),nt(`\u4EFB\u52A1${ee+1}\u5DF2\u5E94\u7528`),await we()):nt({message:(ke==null?void 0:ke.message)||"\u5E94\u7528\u5931\u8D25",type:"warning"})}catch(_e){nt({message:"\u5E94\u7528\u5931\u8D25: "+_e.message,type:"danger"})}},Sr=async(K,ee)=>{try{const _e=N.value[K];if(!_e||!_e.intents[ee])return;const Fe=_e.intents[ee],ke=await uu("rollbackPagePatch",{patchId:Fe.patch.id});(ke==null?void 0:ke.status)==="success"?(Fe.previewApplied=!1,nt(`\u4EFB\u52A1${ee+1}\u5DF2\u56DE\u6EDA`),await we()):nt({message:(ke==null?void 0:ke.message)||"\u56DE\u6EDA\u5931\u8D25",type:"warning"})}catch(_e){nt({message:"\u56DE\u6EDA\u5931\u8D25: "+_e.message,type:"danger"})}},Vr=K=>{K.modelInfo&&Object.assign(p.value,K.modelInfo),K.chatSettings&&Object.assign(k.value,K.chatSettings),h.value.showSetting=!1,k.value.modeCode==="exam"?(h.value.selectedFunction=null,u.value="\u8BF7\u7ED9\u51FA\u8003\u9898\u7B54\u6848"):u.value="",o.value=u.value},be=()=>{h.value.showSetting=!0},Gr=()=>{h.value.showSetting=!1},Je=()=>{h.value.showHistory=!0},we=async()=>{var ee;const K=Date.now();try{if(A){n.warn("\u6B63\u5728\u4FDD\u5B58\u4E2D\uFF0C\u8DF3\u8FC7\u91CD\u590D\u4FDD\u5B58");return}if(!v.value||c.value.length===0){n.warn("\u65E0\u6CD5\u4FDD\u5B58\u4F1A\u8BDD\uFF1A\u7F3A\u5C11\u4F1A\u8BDDID\u6216\u6D88\u606F\u4E3A\u7A7A");return}A=!0,n.info("\u5F00\u59CB\u4FDD\u5B58\u4F1A\u8BDD:",{chatId:v.value,messageCount:c.value.length});const _e=c.value.map(mt=>({id:mt.id,content:mt.content,sender:mt.sender,timestamp:mt.timestamp,patchState:N.value[mt.id]})),Fe=await jr(qt.CHAT_HISTORY_KEY);let ke=Array.isArray(Fe)?Fe:[],Ut=ke.find(mt=>{var De;return(De=mt==null?void 0:mt.chats)==null?void 0:De.some(Mt=>Mt.id===v.value)}),Jt=Ut?Ut.chats.find(mt=>mt.id===v.value):null;if(Jt){const mt=Jt.title!==l.value,De=(((ee=Jt.messages)==null?void 0:ee.length)||0)!==_e.length,Mt=_e.some((J,me)=>{var tr;const Qe=(tr=Jt.messages)==null?void 0:tr[me];return!Qe||Qe.content!==J.content||Qe.sender!==J.sender});mt||De||Mt?(Jt.title=l.value,Jt.messages=_e,Jt.time=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Jt.timestamp=Date.now(),n.info("\u66F4\u65B0\u73B0\u6709\u4F1A\u8BDD:",Jt.id,"\u53D8\u5316\u7C7B\u578B:",{titleChanged:mt,messageCountChanged:De,hasNewContent:Mt})):n.info("\u4F1A\u8BDD\u65E0\u53D8\u5316\uFF0C\u8DF3\u8FC7\u66F4\u65B0")}else{n.info("\u672A\u627E\u5230\u73B0\u6709\u4F1A\u8BDD\uFF0C\u521B\u5EFA\u65B0\u7684\u4F1A\u8BDD\u8BB0\u5F55");let mt=ke.find(Mt=>Mt.key==="today");mt||(mt={key:"today",title:"\u4ECA\u5929",chats:[]},ke.unshift(mt));const De={id:v.value,title:l.value,time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messages:_e};mt.chats.unshift(De),n.info("\u65B0\u4F1A\u8BDD\u5DF2\u6DFB\u52A0\u5230\u5386\u53F2\u8BB0\u5F55:",De.id)}const hr=ke.flatMap(mt=>mt.chats);if(hr.length>50){hr.sort((Mt,R)=>Mt.timestamp-R.timestamp);const mt=hr.length-50;hr.slice(0,mt).forEach(Mt=>{ke.forEach(R=>{R.chats=R.chats.filter(J=>J.id!==Mt.id)})}),ke=ke.filter(Mt=>Mt.chats.length>0),n.info(`\u6E05\u7406\u4E86 ${mt} \u4E2A\u65E7\u804A\u5929`)}await Mr(qt.CHAT_HISTORY_KEY,ke);const ps=ke.reduce((mt,De)=>mt+De.chats.length,0),kt=Date.now()-K;n.info("\u4F1A\u8BDD\u4FDD\u5B58\u6210\u529F",{totalChats:ps,messageCount:_e.length,assistantMessages:_e.filter(mt=>mt.sender==="assistant").length,userMessages:_e.filter(mt=>mt.sender==="user").length,saveTime:`${kt}ms`})}catch(_e){n.error("\u4FDD\u5B58\u4F1A\u8BDD\u5931\u8D25:",_e)}finally{A=!1}},Ge=()=>{try{v.value=null,l.value="\u65B0\u7684\u804A\u5929",c.value=[],N.value={},h.value.showHistory=!1,h.value.showSendIcon=!0,h.value.isStyleAssistantActive=!1,h.value.selectedFunction=null,ve(),n.info("\u4F1A\u8BDD\u72B6\u6001\u5DF2\u91CD\u7F6E\uFF0C\u7B49\u5F85\u7528\u6237\u64CD\u4F5C")}catch(K){n.error("\u91CD\u7F6E\u4F1A\u8BDD\u72B6\u6001\u5931\u8D25:",K)}},Ae=async(K,ee)=>{try{n.info("\u6536\u5230\u6807\u9898\u66F4\u65B0\u4E8B\u4EF6:",{chatId:K,newTitle:ee}),v.value===K&&(l.value=Rn(ee),n.info("\u5F53\u524D\u4F1A\u8BDD\u6807\u9898\u5DF2\u66F4\u65B0"),await we())}catch(_e){n.error("\u66F4\u65B0\u4F1A\u8BDD\u6807\u9898\u5931\u8D25:",_e)}},ce=async K=>{try{if(n.info("\u5F00\u59CB\u5207\u6362\u4F1A\u8BDD:",{chatId:K.id,title:K.title}),v.value&&c.value.length>0&&(n.info("\u4FDD\u5B58\u5F53\u524D\u4F1A\u8BDD:",v.value),await we()),v.value=K.id,l.value=K.title,o.value="",h.value.showFunctionSelector=!1,h.value.showPromptSelector=!1,h.value.showSendIcon=!0,N.value={},h.value.isStyleAssistantActive=!1,h.value.selectedFunction=null,k.value.modeCode==="exam"&&(u.value="\u8BF7\u7ED9\u51FA\u8003\u9898\u7B54\u6848",o.value=u.value),K.messages&&Array.isArray(K.messages)&&K.messages.length>0){c.value=K.messages.map(_e=>{const Fe={..._e,isHistory:!0};return(!Fe.content||Fe.content=="")&&(Fe.content=" "),Fe.patchState&&(N.value[Fe.id]=Fe.patchState),Fe}),n.info("\u52A0\u8F7D\u4F1A\u8BDD\u6D88\u606F:",K.messages.length,"\u6761");const ee=c.value[c.value.length-1];n.info("\u6700\u540E\u4E00\u6761\u6D88\u606F:",{id:ee.id,sender:ee.sender,contentLength:ee.content.length})}else c.value=[];h.value.showHistory=!1,xa(()=>{er()})}catch(ee){n.error("\u5207\u6362\u4F1A\u8BDD\u5931\u8D25:",ee),nt("\u5207\u6362\u4F1A\u8BDD\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),c.value=[],v.value=null,l.value="\u65B0\u7684\u804A\u5929",h.value.showSendIcon=!0}},Ke=K=>{const ee=K.target;ee.scrollTop+ee.clientHeight>=ee.scrollHeight-100?h.value.autoScroll=!0:h.value.autoScroll=!1},ze=()=>{h.value.autoScroll&&d.value&&xa(()=>{const K=d.value;K&&(K.scrollTop=K.scrollHeight)})},er=()=>{if(d.value){const K=d.value;K&&(K.scrollTop=K.scrollHeight)}},Rn=K=>K.length>w.value.maxTitleLength?K.substring(0,w.value.maxTitleLength)+"...":K;return(K,ee)=>{var mt;const _e=cr("el-icon"),Fe=cr("el-tooltip"),ke=cr("el-col"),Ut=cr("el-row"),Jt=cr("el-drawer"),hr=cr("el-button"),ps=cr("el-switch"),kt=cr("el-input");return ie(h).showSetting?(Oe(),kr(nE,{key:0,onSettingCompleted:Vr,onSettingCancel:Gr})):(Oe(),rt("div",sP,[le("div",iP,[se(Ut,null,{default:xe(()=>[se(ke,{span:3,class:"chat-header-left"},{default:xe(()=>[se(Fe,{class:"box-item",effect:"dark",content:"\u67E5\u770B\u5386\u53F2\u4F1A\u8BDD",placement:"bottom",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(_e,{class:"history-icon",onClick:Je},{default:xe(()=>[se(ie(u1))]),_:1})]),_:1})]),_:1}),se(ke,{span:18},{default:xe(()=>[le("div",oP,Xt(ie(l)),1)]),_:1}),se(ke,{span:3,class:"chat-header-right"})]),_:1}),se(Jt,{modelValue:ie(h).showHistory,"onUpdate:modelValue":ee[0]||(ee[0]=De=>ie(h).showHistory=De),direction:"ltr",size:a.expendFlag?"340px":"302px","with-header":!1,teleported:!1,"lock-scroll":!1},{default:xe(()=>[se(h3,{visible:ie(h).showHistory,onSelectChat:ce,onClearHistory:Ge,onUpdateChatTitle:Ae},null,8,["visible"])]),_:1},8,["modelValue","size"])]),le("div",{class:"chat-main",ref_key:"messageList",ref:d,onScroll:Ke},[ie(c).length===0?(Oe(),rt("div",uP,[le("div",lP,[(Oe(),rt("div",{class:"empty-text",key:ie(F)},[(Oe(!0),rt(Bn,null,Mn(ie(E),(De,Mt)=>(Oe(),rt("span",{key:Mt,class:$i(["falling-char",De.colorClass]),style:d1({animationDelay:`${Mt*150}ms`})},Xt(De.text),7))),128))])),ee[4]||(ee[4]=le("div",{class:"empty-subtext"},"\u5728\u4E0B\u65B9\u8F93\u5165\u6846\u4E2D\u8F93\u5165\u4F60\u7684\u95EE\u9898",-1))])])):nr("",!0),(Oe(!0),rt(Bn,null,Mn(ie(c),De=>{var Mt,R;return Oe(),rt("div",{key:De.id,class:"message-main"},[le("div",{class:$i(["message-wrapper",De.sender])},[le("div",cP,[le("div",{class:"message-bubble",style:d1(a.expendFlag?{maxWidth:"100%"}:{maxWidth:"100%"})},[De.sender==="assistant"&&De.content===""?(Oe(),rt("div",dP,[se(_e,{class:"is-loading"},{default:xe(()=>[se(ie(Nf))]),_:1})])):nr("",!0),le("div",hP,[!ie(N)[De.id]||!ie(N)[De.id].isStructured?(Oe(),kr(Do,{key:0,content:De.content},null,8,["content"])):nr("",!0),ie(N)[De.id]&&ie(N)[De.id].isStructured?(Oe(),rt("div",fP,[De.isHistory?nr("",!0):(Oe(),kr(Do,{key:0,content:`### \u{1F539} \u5DF2\u62C6\u5206\u4E3A **${((R=(Mt=ie(N)[De.id])==null?void 0:Mt.intents)==null?void 0:R.length)||0}** \u4E2A\u72EC\u7ACB\u4FEE\u6539\u4EFB\u52A1

\u8BF7\u5728\u4E0B\u65B9\u4F9D\u6B21\u786E\u8BA4\u5E76\u5E94\u7528\u6BCF\u4E2A\u4EFB\u52A1\u7684\u4FEE\u6539\u65B9\u6848\u3002`},null,8,["content"])),(Oe(!0),rt(Bn,null,Mn(ie(N)[De.id].intents,(J,me)=>(Oe(),rt("div",{key:me,class:"intent-block"},[se(Do,{content:J.markdown},null,8,["content"]),De.isHistory?nr("",!0):(Oe(),rt("div",pP,[le("span",{class:$i(["intent-status",{applied:J.previewApplied}])},Xt(J.previewApplied?"\u5DF2\u5E94\u7528":"\u5F85\u5904\u7406"),3),se(hr,{size:"small",type:"primary",onClick:Qe=>Qt(De.id,me),disabled:J.previewApplied},{default:xe(()=>ee[5]||(ee[5]=[pr(" \u5E94\u7528 ")])),_:2,__:[5]},1032,["onClick","disabled"]),se(hr,{size:"small",type:"danger",onClick:Qe=>Sr(De.id,me),disabled:!J.previewApplied},{default:xe(()=>ee[6]||(ee[6]=[pr(" \u56DE\u6EDA ")])),_:2,__:[6]},1032,["onClick","disabled"])]))]))),128)),De.isHistory?nr("",!0):(Oe(),rt("div",mP,[se(Do,{content:"> **\u{1F4A1} \u63D0\u793A**\uFF1A\u4EE5 `:` \u53F7\u5F00\u5934\u5C06\u5F00\u59CB\u5FAE\u8C03\uFF0C\u4F8B\u5982\uFF1A\u201C`:\u989C\u8272\u518D\u6D45\u4E00\u70B9`\u201D"})]))])):nr("",!0),ie(N)[De.id]&&!ie(N)[De.id].isStructured?(Oe(),rt("div",gP,[De.isHistory?nr("",!0):(Oe(!0),rt(Bn,{key:0},Mn(ie(N)[De.id].intents,(J,me)=>(Oe(),rt("div",{key:me,class:"patch-action-bar embedded secondary"},[le("span",{class:$i(["intent-status",{applied:J.previewApplied}])},Xt(J.previewApplied?"\u5DF2\u5E94\u7528":"\u5F85\u5904\u7406"),3),se(hr,{size:"small",type:"primary",onClick:Qe=>Qt(De.id,me),disabled:J.previewApplied},{default:xe(()=>ee[7]||(ee[7]=[pr(" \u5E94\u7528\u4FEE\u6539 ")])),_:2,__:[7]},1032,["onClick","disabled"]),se(hr,{size:"small",type:"danger",onClick:Qe=>Sr(De.id,me),disabled:!J.previewApplied},{default:xe(()=>ee[8]||(ee[8]=[pr(" \u56DE\u6EDA\u4FEE\u6539 ")])),_:2,__:[8]},1032,["onClick","disabled"])]))),128)),De.isHistory?nr("",!0):(Oe(),rt("div",yP,[se(Do,{content:"> **\u{1F4A1} \u63D0\u793A**\uFF1A\u4EE5 `:` \u53F7\u5F00\u5934\u5C06\u5F00\u59CB\u5FAE\u8C03\uFF0C\u4F8B\u5982\uFF1A\u201C`:\u989C\u8272\u518D\u6D45\u4E00\u70B9`\u201D"})]))])):nr("",!0)])],4)])],2),le("div",vP,[le("div",{class:$i({"message-footer-user":De.sender==="user","message-footer-bot":De.sender==="assistant"})},[De.sender==="user"&&ie(h).showSendIcon?(Oe(),rt("span",_P,[se(Fe,{class:"box-item",effect:"dark",content:"\u91CD\u65B0\u751F\u6210",placement:"bottom",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(_e,{onClick:J=>Y(De),style:{cursor:"pointer"}},{default:xe(()=>[se(ie(s1))]),_:2},1032,["onClick"])]),_:2},1024)])):nr("",!0),le("span",bP,[se(Fe,{class:"box-item",effect:"dark",content:"\u590D\u5236",placement:"bottom",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(_e,{onClick:J=>U(De),style:{cursor:"pointer"}},{default:xe(()=>[se(ie(il))]),_:2},1032,["onClick"])]),_:2},1024)])],2)])])}),128))],544),le("div",wP,[le("div",EP,[le("div",xP,[ie(k).modeCode!=="chat"?(Oe(),rt("div",SP,[le("div",AP," \u5F53\u524D\u5904\u4E8E"+Xt(ie(k).modeName),1)])):ie(h).selectedFunction?(Oe(),rt("div",kP,[le("div",CP,[se(_e,{class:"function-display-icon"},{default:xe(()=>[(Oe(),kr(c1(ie(h).selectedFunction.iconComponent)))]),_:1}),le("span",TP,Xt(ie(h).selectedFunction.label),1),se(_e,{class:"function-display-close",onClick:C},{default:xe(()=>[se(ie(l1))]),_:1})])])):(Oe(),rt("div",FP,[se(Fe,{class:"box-item",effect:"dark",content:"\u5F00\u542F\u540E\uFF0C\u5C06\u7ED3\u5408\u9875\u9762\u5185\u5BB9\u56DE\u7B54\u4F60\u7684\u95EE\u9898",placement:"top",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[le("div",NP,[se(ps,{modelValue:ie(h).usePageContext,"onUpdate:modelValue":ee[1]||(ee[1]=De=>ie(h).usePageContext=De),class:"page-context-switch",size:"small"},null,8,["modelValue"]),le("span",{class:"page-context-label",onClick:ee[2]||(ee[2]=De=>ie(h).usePageContext=!ie(h).usePageContext)},"\u7ED3\u5408\u9875\u9762\u56DE\u7B54")])]),_:1}),se(Fe,{class:"box-item",effect:"dark",content:"\u5BF9\u9875\u9762\u5185\u5BB9\u4E00\u952E\u603B\u7ED3",placement:"top",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(hr,{text:"",onClick:at,class:"function-button"},{default:xe(()=>[se(_e,null,{default:xe(()=>[se(ie(il))]),_:1}),ee[9]||(ee[9]=pr(" \u4E00\u952E\u603B\u7ED3 "))]),_:1,__:[9]})]),_:1})])),le("div",IP,[!a.inSidepanelFlag&&!r.expendFlag?(Oe(),kr(Fe,{key:0,class:"box-item",effect:"dark",content:"\u5168\u5C4F\u5C55\u5F00",placement:"top",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(hr,{text:"",class:"function-button",onClick:Et},{default:xe(()=>[se(_e,null,{default:xe(()=>[se(ie(o1))]),_:1}),ee[10]||(ee[10]=pr(" \u5168\u5C4F\u5C55\u5F00 "))]),_:1,__:[10]})]),_:1})):nr("",!0),!a.inSidepanelFlag&&r.expendFlag?(Oe(),kr(Fe,{key:1,class:"box-item",effect:"dark",content:"\u6536\u8D77\u5168\u5C4F",placement:"top",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(hr,{text:"",class:"function-button",onClick:Et},{default:xe(()=>[se(_e,null,{default:xe(()=>[se(ie(a1))]),_:1}),ee[11]||(ee[11]=pr(" \u6536\u8D77\u5168\u5C4F "))]),_:1,__:[11]})]),_:1})):nr("",!0),se(Fe,{class:"box-item",effect:"dark",content:"\u6A21\u578B\u8BBE\u7F6E",placement:"top",teleported:!1,"popper-class":"ga-tooltip"},{default:xe(()=>[se(hr,{text:"",class:"function-button",onClick:be},{default:xe(()=>[se(_e,null,{default:xe(()=>[se(ie(n1))]),_:1}),ee[12]||(ee[12]=pr(" \u8BBE\u7F6E "))]),_:1,__:[12]})]),_:1})])]),le("div",OP,[ie(h).showFunctionSelector?(Oe(),rt("div",{key:0,class:"function-selector-overlay",onClick:x})):nr("",!0),ie(h).showPromptSelector?(Oe(),rt("div",{key:1,class:"function-selector-overlay",onClick:$})):nr("",!0),ie(h).showFunctionSelector?(Oe(),rt("div",RP,[ee[13]||(ee[13]=le("div",{class:"selector-title"},"\u9009\u62E9\u529F\u80FD",-1)),le("div",DP,[(Oe(!0),rt(Bn,null,Mn(V.value,De=>(Oe(),rt("div",{key:De.key,class:"selector-item",onClick:Mt=>Q(De)},[se(_e,{class:"selector-icon"},{default:xe(()=>[(Oe(),kr(c1(De.iconComponent)))]),_:2},1024),le("div",MP,[le("div",$P,Xt(De.label),1),le("div",PP,Xt(De.desc),1)])],8,BP))),128))])])):nr("",!0),ie(h).showPromptSelector&&G.value.length>0?(Oe(),rt("div",LP,[ee[14]||(ee[14]=le("div",{class:"selector-title"},"\u9009\u62E9\u5E38\u7528\u8BED",-1)),le("div",zP,[(Oe(!0),rt(Bn,null,Mn(G.value,(De,Mt)=>(Oe(),rt("div",{key:Mt,class:"selector-item expression-item",onClick:R=>q(De)},[le("div",jP,Xt(Mt+1),1),le("div",qP,[le("div",HP,Xt(De.content),1)])],8,UP))),128))])])):nr("",!0),se(kt,{modelValue:ie(o),"onUpdate:modelValue":ee[3]||(ee[3]=De=>H7(o)?o.value=De:null),type:"textarea",rows:3,placeholder:L.value,class:"input-box",onKeydown:Ve,onInput:ae,onDblclick:Ee,autosize:{minRows:3,maxRows:6},resize:"none"},null,8,["modelValue","placeholder"]),le("div",VP,[ie(h).showSendIcon?(Oe(),kr(hr,{key:0,type:"primary",disabled:!((mt=ie(o))!=null&&mt.length),onClick:Z,class:"send-button"},{default:xe(()=>[se(_e,null,{default:xe(()=>[se(ie(i1))]),_:1}),ee[15]||(ee[15]=pr(" \u53D1\u9001 "))]),_:1,__:[15]},8,["disabled"])):(Oe(),kr(hr,{key:1,type:"danger",onClick:re,class:"send-button"},{default:xe(()=>[se(_e,null,{default:xe(()=>[se(ie(r1))]),_:1}),ee[16]||(ee[16]=pr(" \u505C\u6B62 "))]),_:1,__:[16]}))])])])])]))}}}),ZP=Mu(GP,[["__scopeId","data-v-091d113a"]]),KP={class:"sidepanel-container"},WP=_o({__name:"Sidepanel",setup(r){return(e,t)=>(Oe(),rt("div",KP,[se(ZP,{expendFlag:!1,inSidepanelFlag:!0})]))}}),YP=Mu(WP,[["__scopeId","data-v-64e87758"]]),h7=V7(YP);h7.use(G7);h7.mount("#app");
